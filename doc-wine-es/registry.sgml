  <sect1 id="registry">
    <title>El Registro</title>

      <para>
        written by Ove Kåven
      </para>
      <para>
      (Extraído de <filename>wine/documentation/registry</filename>)
      </para>

    <para>
      Después de Win3.x, el Registro se convirtió en una parte fundamental
      de Windows. Este es el lugar donde tanto el propio Windows como todas
      las aplicaciones compatibles con Win95/98/NT/2000/etc, guardan su
      configuración y los datos. Mientras la mayoría de los administradores
      prolijos (y los desarrolladores de Wine) maldicen por la retorcida
      naturaleza del Registro de Windows, aún así es necesario para Wine
      darle soporte de alguna manera.
    </para>

    <sect2>
      <title>Estructura del Registro</title>

      <para>
        El Registro de Windows es una estructura de árbol elaborada, y
        ni siquiera la mayoría de los programadores de Windows están
        totalmente familiarizados en como el Registro está estructurado,
        con sus diferentes "hives" y sus numerosos enlaces entre ellos;
        una completa cobertura está fuera del alcance de este documento.
        Pero aquí están las claves básicas que deberías conocer por ahora.
      </para>


      <variablelist>
        <varlistentry>
          <term>HKEY_LOCAL_MACHINE</term>
          <listitem>
            <para>
              Esta clave fundamental de la raíz (en win9x se encuentra
              en el archivo oculto <filename>system.dat</filaname>)
              contiene todo lo relacionado con la instalación actual de
              Windows.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>HKEY_USERS</term>
          <listitem>
            <para>
              Esta clave fundamental de la raíz (en win9x se encuentra
              en el archivo oculto <filename>user.dat</filename>) 
              contiene datos de configuración para cada usuario de la
              instalación.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>HKEY_CLASSES_ROOT</term>
          <listitem>
            <para>
              Este es un enlace a HKEY_LOCAL_MACHINE\Software\Classes.
              Contiene datos describiendo cosas como asociaciones de 
              archivos, manejadores de documentos OLE, y clases COM.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>HKEY_CURRENT_USER</term>
          <listitem>
            <para>
              Este es un link a HKEY_USERS\tu_nombre_de_usuario, en otras
              palabras es tu configuración personal.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>Usando el registro de Windows</title>

      <para>
        Si se apunta Wine a alguna instalación existente de MS Windows
        (seteando los directorios apropiados en 
        <filename>~/.wine/config</filename>, entonces Wine es capaz de
        cargar los datos del registro desde allí. Sin embargo, Wine no
        guardará nada al registro verdadero de Windows, si no que lo
        hará a sus propios archivos de registro. Por supuesto, si un
        valor particular del registro existe en el registro de Windows 
        y en el de Wine, entonces Wine usará el último.
      </para>
      <para>
        Ocasionalmente, Wine podría tener problemas al cargar el registro
        de Windows. Usualmente, esto es porque el registro es
        inconsistente, o está dañado de alguna forma. Si esto se convierte
        en un problema, podría querer bajar el
        <filename>regclean.exe</filename> del sitio web de MS y usarlo
        para limpiar el registro. Alternativamente, puede usar siempre
        el <filename>regedit.exe</filename> para exportar los datos de
        registro que quiera a un archivo de texto, y después
        importarlo a Wine.
      </para>
    </sect2>

    <sect2>
      <title>Archivos de datos del registro de Wine</title>

      <para>
        En el directorio raíz del usurio, existe un subdirectorio
        llamado <filename>.wine</filename>, donde Wine tratará de
        guardar su registro por defecto. Se guarda en cuatro archivos,
        que son:
      </para>

      <variablelist>
        <varlistentry>
          <term><filename>system.reg</filename></term>
          <listitem>
            <para>
              Este archivo contiene HKEY_LOCAL_MACHINE.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><filename>user.reg</filename></term>
          <listitem>
            <para>
              Este archivo contiene HKEY_CURRENT_USER.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><filename>userdef.reg</filename></term>
          <listitem>
            <para>
              Este archivo contiene HKEY_USERS\.Default (es decir, la
              configuraciön de usuario por defecto).
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><filename>wine.userreg</filename></term>
          <listitem>
            <para>
              Wine guarda HKEY_USERS en este arhivo (tanto del 
              usuario por defecto como del actual), pero no lo carga
              desde allí, a menos que <filename>userdef.reg</filename>
              falte.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
      <para>
        Todos estos archivos son archivos de textos leíbles por
        humanos, a diferencia de Windows, puede editarlo si quiere
        con cualquier editor de texto (asegúrese de que Wine no esté
        ejecutándose cuando los modifique, de otra forma los cambios
        van a ser descartados).
      </para>
      <para>
        FIXME: configuración global no está actualmente implementada.

        Además de estos archivos, Wine también puede cargar opcionalmente
        desde el registro global, arhivos de registro residentes en el mismo
        directorio del <filename>wine.config</filename> global (en otras
        palabras, <filename>/usr/local/etc</filename> si lo compila desde
        el fuente). Estos son:
      </para>

      <variablelist>
        <varlistentry>
          <term><filename>wine.systemreg</filename></term>
          <listitem>
            <para>Contiene HKEY_LOCAL_MACHINE.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><filename>wine.userreg</filename></term>
          <listitem>
            <para>Contiene HKEY_USERS.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>Administración del Sistema</title>

      <para>
        Con la estructura de archivo, nombrada arriba, es posible 
        para un administrador de sistema, configurar el sistema, 
        para que una instalación Wine (y aplicaiones) puedan 
        compartirse con todos los usuarios, y todavía permite a 
        todos los usuarios tener su propia configuración personalizada. 
        Un administrador puede, después de tener instalado Wine y 
        cualquier software para Windows, al cual quiera que los 
        usuarios tengan acceso, copiar
        los <filename>system.reg</filename> y
        <filename>wine.userreg</filename> resultantes sobre los
        archivos de registro globales (los cuales asumimos que residirán
        en <filename>/usr/local/etc</filename>), con:
      </para>
      <screen>
cd ~/.wine
cp system.reg /usr/local/etc/wine.systemreg
cp wine.userreg /usr/local/etc/wine.userreg
      </screen>
      <para>
        E incluso enlazarlos a la cuenta del administrador, para hacer
        más fácil instalar después aplicaciones por todo el sistema:
      </para>
      <screen>
ln -sf /usr/local/etc/wine.systemreg system.reg
ln -sf /usr/local/etc/wine.userreg wine.userreg
      </screen>
      <para>
        Notar que el script <filename>tools/wineinstall</filename> 
        hace todo esto por usted, si instala el fuente de Wine
        como root. Si instala después aplicaciones de Windows
        mientras este logueado en él como root, todos sus usurios
        estarán automaticamente habilitados para usarlas.
        Mientras la configuración de la aplicación sea tomada del 
        registro global, las configuraciones personalizadas de usurios
        serán guardadas en sus propios directorios raíz.
      </para>
      <para>
        Pero cuidado con lo que hace con la cuenta global del
        administrador - si copia o hace un link al registro
        del administrador, cualquier usuario puede estar habilitado
        a leer las preferencias del administrador, cosa que puede
        no ser buena, si información importante (contraseñas,
        información personal, etc) es guardada allí.
        Use la cuenta de administrador solo para instalar programas,
        no la use para el trabajo diario; use una cuenta de usurio
        común para eso.
      </para>
    </sect2>

    <sect2>
      <title>EL registro por defecto</title>

      <para>
        Un registro de Windows contiene muchas llaves por defecto,
        y algunos de ellos son necesarios para algunos instaladores
        para operar correctamente.
        Las llaves que los desarrolladores de Wine encontraron
        necesarias para instalar aplicaiones están distribuidas en un
        archivo llamado <filename>winedefault.reg</filename>. Este es
        automaticamente instalado para usted si usa el script,
        <filename>tools/wineinstall</filename> en el fuente de Wine, 
        pero si quiere instalarlo manualmente, puede hacerlo usando la
        herramienta <command>regapi</command> que se encuentra en el 
        directorio <filename>programs/regapi/</filename>, en el fuente
        de Wine.
      </para>
    </sect2>

    <sect2>
      <title>La sección del registro</title>
      <para>
        Con la siguiente información en mente, miremos las opciones de
   <filename>wine.conf</filename> / <filename>~/.wine/config</filename>
        para manejar el registro.
        </para>

      <variablelist>
        <varlistentry>
	  <term>GlobalRegistryDir</term>
	  <listitem>
	    <para>
         Opcional. Establece la ruta para mirar el registro global.
	    </para>
	  </listitem>
	</varlistentry>
        <varlistentry>
          <term>LoadGlobalRegistryFiles</term>
          <listitem>
            <para>
              Controla si se tratará de cargar los arhivos de registro
              global, si existen.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>LoadHomeRegistryFiles</term>
          <listitem>
            <para>
              Controla si se intentarán cargar los archivos de
              registro de usuarios (en el subdirectorio de usuarios
              <filename>.wine</filename> del directorio de inicio.)
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>LoadWindowsRegistryFiles</term>
          <listitem>
            <para>
              Controla si Wine intenta cargar datos de registro
              de un registro real de Windows en una instalación MS
              Windows.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>WritetoHomeRegistryFiles</term>
          <listitem>
            <para>
              Controla si los datos de registro serán escritos
              en los archivos de registro de usuarios. (Actualmente,
              no hay una alternativa, y si deshabilita esta
              opción, Wine no podrá guardar el registro en el disco,
              después de que salga de Wine, sus cambios serán perdidos).
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>SaveOnlyUpdatedKeys</term>
          <listitem>
            <para>
              Controla si el registro entero es guardado en
              el archivo de registro de usuarios, o solo subllaves
              que el usuario haya cambiado. Considerando eso el
              registro de usuarios correrá cualquiera de los arhivos
              globales de registro y archivos de registro de
              Windows, esto usualmente tiene sentido solo para
              guardar subclaves modificadas por el usurio; de esa
              forma, cambios en el resto de los globales o registros
              de Windows todavía afectarán al usuario.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>PeriodicSave</term>
          <listitem>
            <para>
              Si esta opción es seteada a un valor distinto de cero,
               especifica que quiere guardar el registro al disco en
              el intervalo dado. Si no es seteada, el registro será
              guardado en el disco cuando el servidor Wine termine.
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>UseNewFormat</term>
          <listitem>
            <para>
              Esta opción es obsoleta. Wine ahora siempre usa el nuevo
              formato; soporte para todos los formatos viejos que
              fueron removidos hace un tiempo.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>
  </sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-parent-document:("configuring.sgml" "chapter" "sect1" "")
End:
-->

