<chapter id="config">
<title id="install-config">Opciones de Configuración</title>

 <sect1>
  <title>Parámetros de configuración (<application>configure</application>)</title>

  <para>
   El conjunto de parámetros disponibles en <application>configure</application>
   se puede obtener escribiendo

   <programlisting>
    $ ./configure --help
   </programlisting>
  </para>
  <para>
    Los siguientes parámetros pueden ser de interés para los instaladores:
   
   <programlisting>
Nombre de directorios y ficheros:
  --prefix=PREFIX         ficheros de instalación independiente de la arquitectura en PREFIX
                          [/usr/local/pgsql]
  --bindir=DIR            ejecutables de usuario en el DIR [EPREFIX/bin]
  --libdir=DIR            librerías de código objeto en el DIR [EPREFIX/lib]
  --includedir=DIR        ficheros de cabeceras C en el in DIR [PREFIX/include]
  --mandir=DIR            documentación man en el DIR [PREFIX/man]
Características y paquetes:
  --disable-FEATURE       no incluir la FEATURE (lo mismo que --enable-FEATURE=no)
  --enable-FEATURE[=ARG]  incluir FEATURE [ARG=yes]
  --with-PACKAGE[=ARG]    usar PACKAGE [ARG=yes]
  --without-PACKAGE       no usar PACKAGE (lo mismo que --with-PACKAGE=no)
--enable y --with opciones reconocidas:
  --with-template=template                          usar el fichero plantilla del sistema operativo
                              ver directorio plantilla
  --with-includes=incdir                          sitio donde están los fichero cabecera para tk/tcl, etc. en el DIR
  --with-libs=incdir                          buscar librerías también en DIR
  --with-libraries=libdir                          buscar librerías también en DIR
  --enable-locale         activa el soporte local
  --enable-recode         activa el soporte de codificación cirílica
  --with-mb=encoding                          activa el soporte para multi-byte
  --with-pgport=portnum                          cambia el puerto de inicio por defecto
  --with-maxbackends=n                          define el número máximo por defecto de procesos servidores
  --with-tcl              construye interfaces Tcl y pgtclsh
  --with-tclconfig=tcldir                          tclConfig.sh y tkConfig.sh están en DIR
  --with-perl             construye interfaces con Perl
  --with-odbc             construye el paquete del driver ODBC
  --with-odbcinst=odbcdir                          cambia el directorio por defecto de odbcinst.ini
  --enable-cassert        activa los chequeos de afirmación (depurando)
  --with-CC=compiler                          usa el compilador de C especificado
  --with-CXX=compiler                          usa el compilador de C++ especificado
  --without-CXX           previene la construcción de código C++
   </programlisting>
  </para>
  <para>
   Algunos sistemas pueden tener problemas de construcción con algunas características específicas de
   <productname>Postgres</productname>. Por ejemplo, sistemas con el compilador de C++ dañado
   pueden necesitar especificar <option>--without-CXX</option> para el proceso de construcción
   para saltarse la construcción de <filename>libpq++</filename>.
  </para>
 </sect1>
 <sect1>
  <title>Parámetros de construcción (<application>make</application>)</title>

  <para>
    Muchas parámetros relacionados con la instalación pueden activar en la etapa de
    construcción de la instalación de <productname>Postgres</productname>.
  </para>
  <para>
   En muchos casos, estos parámetros deben colocarse en un fichero,
   <filename>Makefile.custom</filename>, utilizado para este propósito.
   La distribución por defecto no contiene este fichero opcional, pero puedes
   crearlo con el editor de texto que tu elijas. Cuando actualizas una instalación,
   tu puedes simplemente copiar tu viejo Makefile.custom a la nueva instalación antes
   que hagas la construcción.
   
   <synopsis>
    make [ <replaceable>variable</replaceable>=<replaceable class="parameter">value</replaceable> [,...] ]
   </synopsis>
  </para>
  <para>
   Unas pocas de las muchas variables que puedes especificar son:

   <variablelist>
    <varlistentry>
     <term>
      <envar>POSTGRESDIR</envar>
     </term>
     <listitem>
      <para>
       Lo más alto en el árbol de la instalación.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      <envar>BINDIR</envar>
     </term>
     <listitem>
      <para>
       Localización de las aplicaciones y utilidades.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      <envar>LIBDIR</envar>
     </term>
     <listitem>
      <para>
       localización de las librerías, incluyendo las librerías compartidas.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      <envar>HEADERDIR</envar>
     </term>
     <listitem>
      <para>
       Localización de los ficheros include.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      <envar>ODBCINST</envar>
     </term>
     <listitem>
      <para>
       localización de las librerías, incluyendo las librerías compartidas
       <application>psqlODBC</application>
       (<acronym>ODBC</acronym>) .
      </para>
     </listitem>
    </varlistentry>
    
   </variablelist>
  </para>
  <para>
    Hay otros parámetros opcionales que no se utilizan comúnmente.
    Muchos de las que listan debajo son apropiadas cuando se estaba
    desarrollando el código del servidor
   <application>Postgres</application> .
   
   <variablelist>
    <varlistentry>
     <term>
      <envar>CFLAGS</envar>
     </term>
     <listitem>
      <para>
       Establece los flags para el compilador de C.
       Debe ser especificado con "+=" para conservar los parámetros por defecto.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      YFLAGS
     </term>
     <listitem>
      <para>
       Establece los flags para el parser yacc/bison.Puede usarse <option>-v</option>
       para ayudar a diagnosticar problemas de construcción de un nuevo  parser.
       Debe ser especificado con "+=" para conservar los parámetros por defecto.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      <envar>USE_TCL</envar>
     </term>
     <listitem>
      <para>
       Activa el constructor del interfaces Tcl.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      <envar>HSTYLE</envar>
     </term>
     <listitem>
      <para>
       Páginas <acronym>HTML</acronym>  estilo DocBook para construir
       la documentación de partida.
       No usar a menos que tu estés desarrollando nueva documentación de documentos fuente
       <acronym>SGML</acronym> compatibles con DocBook en
       <filename>doc/src/sgml/</filename>.
      </para>
     </listitem>
    </varlistentry>
    
    <varlistentry>
     <term>
      <envar>PSTYLE</envar>
     </term>
     <listitem>
      <para>
       Páginas estilo DocBook para construir  la documentación impresa de partida.
       No usar a menos que tu estés desarrollando nueva documentación de documentos fuente
       <acronym>SGML</acronym> compatibles con DocBook en
       <filename>doc/src/sgml/</filename>.
      </para>
     </listitem>
    </varlistentry>
    
   </variablelist>
  </para>
  <para>
   Aquí hay un ejemplo de <filename>Makefile.custom</filename>
   para un sistema Linux PentiumPro:
   
   <programlisting>
# Makefile.custom
# Thomas Lockhart 1999-06-01

POSTGRESDIR= /opt/postgres/current
CFLAGS+= -m486 -O2

# documentation

HSTYLE= /home/tgl/SGML/db118.d/docbook/html
PSTYLE= /home/tgl/SGML/db118.d/docbook/print
   </programlisting>
  </para>
 </sect1> 
 <Sect1>
  <Title>Soporte Local</Title>
  
  <Para>
   <Note>
    <Para>
     Escrito por Oleg Bartunov.
     Ver <ULink url="http://www.sai.msu.su/~megera/postgres/">Oleg's web page</ULink>
     para más información sobre el soporte de lengua local y Rusa.

    </Para>
   </Note>
   Mientras que estaba en un proyecto para una compañía en Moscú, Rusia,
   Me encontré con el problema que postgresql no tenia
   soporte para alfabetos nacionales. Después de mirar posibles soluciones alternativas
   decidí desarrollar un soporte local yo mismo.
   No soy un programador en C pero ya había tenido experiencia con la programación local
   cuando trabajo en perl
   (depurando) y glimpse. Después de bastantes días sumergido por
   el árbol de fuente de <ProductName>Postgres</ProductName> Realice muy pocas correcciones en
   src/backend/utils/adt/varlena.c and src/backend/main/main.c para conseguir lo que quería!
   Di soporte sólo para
   <envar>LC_CTYPE</envar> and <envar>LC_COLLATE</envar>,
   pero más tarde otros lo añadieron para <envar>LC_MONETARY</envar> . Tuve muchos
   mensajes de la gente a cerca de este parche por eso decidí enviarselo a los desarrolladores
   y (sorprendentemente) lo incorporaron dentro de la distribución
   <productname>Postgres</productname> .
  </para>
  <Para>
   La gente a veces se queja que el soporte local no funciona para ellos.
   Hay algunos errores comunes:
   
   <ItemizedList>
    <ListItem>
     <Para>
      No configurar debidamente postgresql antes de compilarlo.
      Tu debes ejecutar la configuración con la opción --enable-locale para activar el soporte local.
      No iniciar el entorno correctamente cuando se inicia postmaster.
      Tu debes definir las variables de entorno
      <envar>LC_CTYPE</envar> and <envar>LC_COLLATE</envar> 
      antes de ejecutar postmaster
      porque por detrás coge información local del entorno.
      Yo uso el siguiente shell script
      (runpostgres):

      <ProgramListing>
       #!/bin/sh
       
       export LC_CTYPE=koi8-r
       export LC_COLLATE=koi8-r
       postmaster -B 1024 -S -D/usr/local/pgsql/data/ -o '-Fe'
      </ProgramListing>

       y lo ejecuto en rc.local así

      <ProgramListing>
       /bin/su - postgres -c "/home/postgres/runpostgres"
      </ProgramListing>

     </Para>
    </ListItem>
    <ListItem>
     <Para>
      Un soporte local estropeado en un OS (por ejemplo, el soporte local en libc
      bajo Linux algunas veces ha sido cambiado
      y esto ha causado muchos problemas)
      El más reciente perl  tiene también soporte local
      y si el soporte local es defectuoso <command>perl -v</command> da
      un aviso parecido a esto:
      
      <programlisting>
       8:17[mira]:~/WWW/postgres>setenv LC_CTYPE not_exist
       8:18[mira]:~/WWW/postgres>perl -v
       perl: warning: Setting locale failed.
       perl: warning: Please check that your locale settings:
       LC_ALL = (unset),
           LC_CTYPE = "not_exist",
           LANG = (unset)
       are supported and installed on your system.
       perl: warning: Falling back to the standard locale ("C").
      </programlisting>

     </Para>
    </ListItem>
    <ListItem>
     <Para>
       Localización errónea de los ficheros locales!

       Las posibles localizaciones son:
      <filename>/usr/lib/locale</filename> 
      (Linux, Solaris), <filename>/usr/share/locale</filename> (Linux), 
      <filename>/usr/lib/nls/loc</filename> (DUX 4.0).
      
      Chequea <command>man locale</command> para encontrar la localización correcta.
      Bajo Linux yo hice un enlace simbólico entre <filename>/usr/lib/locale</filename> y
      <filename>/usr/share/locale</filename> para estar seguro que
      la próxima libc no estropea mi soporte local.
      </Para>
    </ListItem>
   </ItemizedList>
  </para>

  <Sect2>
   <Title>Cuales son los Beneficios?</Title>

   <Para>
    Tu puedes usar  ~* y el operador order by para cadenas que contienen caracteres
    de alfabetos nacionales. Los usuarios no Ingleses
    definitivamente lo necesitan. Si tu no quieres usar el soporte local libera
    la variable USE_LOCALE.
    </para>
  </sect2>

  <Sect2>
   <Title>Cuales son las Desventajas?</Title>
   
   <Para>
    Hay una evidente desventaja si utilizamos el  soporte local - que el la velocidad!
    Por eso, utilízalo sólo si verdaderamente lo necesitas.
   </para>
  </sect2>
 </sect1>
 
 <Sect1>
  <Title>Autenticación Kerberos</Title>

  <Para>
   <productname>Kerberos</productname> es un sistema de autenticación de seguridad estándar industrial
   indicado para ser distribuido bajo redes publicas.
  </para>

  <sect2>
   <title>Disponibilidad</title>
   
   <para>
    El sistema de autenticacion
    <productname>Kerberos</productname>
    no se distribuye con <Productname>Postgres</Productname>.  Las versiones de
    <productname>Kerberos</productname>
    están típicamente disponibles como software opcional para los vendedores de sistemas
    operativos. Además, la distribución del código fuente se pede obtener a través de
    <ulink url="ftp://athena-dist.mit.edu">MIT Project Athena</ulink>.
   </para>
   <note>
    <para>
     Puedes desear obtener la versión del MIT si tu
     proveedor te proporciona una versión, ya que en algunos puntos de venta está
     deliberadamente capado o proporcionado sin interoperatividad con la versión del
     MIT.
    </para>
   </note>
   <para>
    Los usuarios que se encuentran fuera de los Estados Unidos de América o
    Canadá esta avisados de que la distribución del código actual de encriptación de
    <productname>Kerberos</productname>
    está restringida por las leyes de exportación de Gobierno U. S.
   </para>
   <para>
    Las preguntas acerca de tu <productname>Kerberos</productname>
    deben estar dirigidas a tu proveedor o a
    <ulink url="info-kerberos@athena.mit.edu">MIT Project Athena</ulink>.
    Notar que las <acronym>FAQL</acronym>s
    (Lista de preguntas frecuentes) se envían periódicamente a la
    <ulink url="mailto:kerberos@ATHENA.MIT.EDU"><productname>Kerberos</productname> mailing list</ulink>
    (envía
    <ulink url="mailto:kerberos-request@ATHENA.MIT.EDU"> to subscribe</ulink>),
    y
    <ulink url="news:comp.protocols.kerberos">USENET news group</ulink>.
   </para>
  </sect2>
  
  <sect2>
   <title>Instalación</title>

   <para>
    Instalación de
    <productname>Kerberos</productname>
    se trata en detalle en las
    <citetitle>Notas de instalación de Kerberos</citetitle> .
    Tener cuidado que el fichero llave servidor (the <filename>srvtab</filename>
    o <filename>keytab</filename>)
    es de alguna manera accesible para la lectura por la cuenta <productname>Postgres</productname> .
   </para>
   <para>
    <Productname>Postgres</Productname> y sus clientes pueden ser compilables para usar
    la versión 4 o la versión 5 de los protocolos
    <productname>Kerberos</productname>
    del MIT configurando la variable
    <envar>KRBVERS</envar>
    en el fichero <filename>src/Makefile.global</filename> al
    valor apropiado.  Puedes también cambiar la localización donde espera encontrar
    <Productname>Postgres</Productname>
    las librerías asociadas, los ficheros de cabecera y el
    fichero llave del servidor.
   </para>
   <para>
    Cuando la compilación se haya completado, <Productname>Postgres</Productname>
    debe registrarse como un servicio <productname>Kerberos</productname> .
    Mirar las
    <citetitle>Notas de Operaciones de Kerberos</citetitle>
    y las páginas del manual relacionadas para más detalle del registro de servicios.
   </para>
  </sect2>

  <sect2>
   <title>Operaciones</title>
   
   <para>
    Después de la instalación inicial, <Productname>Postgres</Productname>
    debe operar en todos los sentidos como un servicio normal
    <productname>Kerberos</productname> .
    Para más detalles en el uso de la autenticación, ver la
    <citetitle>Guía del Usuario PostgreSQL </citetitle> en las secciones referentes
    a <application>postmaster</application>
    y <application>psql</application>.
   </para>
   <para>
    En los comentarios de la versión 5 de
    <productname>Kerberos</productname> ,
    las siguientes suposiciones están hechas para el usuario
    y el nombrado de servicio:

    <itemizedlist>
     <listitem>
      <para>
       Los nombres de los usuarios principales (anames) se asemen
       para contener el nombre del usuario actual Unix/<Productname>Postgres</Productname>
       en el primer componente.
      </para>
     </listitem>
     <listitem>
      <para>
       El servicio <Productname>Postgres</Productname> se asume para ser tenido como dos componentes,
       el nombre de servicio y el nombre de host, canonizada en la versión 4 (p.e., con todos los
       sufijos de dominio borrados).
      </para>
     </listitem>
     
    </itemizedlist>
   </para>
   <para>
    <table tocentry="1">
     <title>Ejemplos de Parámetros de Kerberos</title>
     <titleabbrev>Kerberos</titleabbrev>

     <tgroup cols="2">
      <thead>
       <row>
	<entry>
	 Parámetro
	</entry>
	<entry>
	 Ejemplo
	</entry>
       </row>
      </thead>
      <tbody>
       <row>
	<entry>
	 user
	</entry>
	<entry>
	 frew@S2K.ORG
	</entry>
       </row>
       <row>
	<entry>
	 user
	</entry>
	<entry>
	 aoki/HOST=miyu.S2K.Berkeley.EDU@S2K.ORG
	</entry>
       </row>	   
       <row>
	<entry>
	 host
	</entry>
	<entry>
	 postgres_dbms/ucbvax@S2K.ORG
	</entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </para>
   <para>
    El soporte de la versión 4 desaparecerá después de algún tiempo tras la puesta en producción
    de la revisión de la versión 5 del MIT.
   </para>
  </sect2>
 </sect1>
</chapter>
