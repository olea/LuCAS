<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.1.2//EN"
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">

<article>

<articleinfo>

<title>Linux con Raíz-NFS Mini-COMO</title>

<author>
<firstname>Andreas Kostyrka
<ulink
url="mailto:andreas@ag.or.at"
>andreas@ag.or.at</ulink
>

Traducido por Rodolfo Pilas <ulink
url="mailto:rodolfo@linux.org.uy"
>rodolfo@linux.org.uy</ulink
></firstname>
</author>

<pubdate>v7, 3 Febrero 1997</pubdate>

<abstract>

<para>
Este Mini-COMO intenta explicar el procedimiento para configurar una
estación de trabajo Linux sin disco, que monte la totalidad de su sistema
de archivos vía NFS. 
</para>

</abstract>

</articleinfo>

<sect1>
<title>Derechos </title>

<para>
 &copy; 1996 Andreas Kostyrka (<literal remap="tt"><ulink
url="mailto:andreas@ag.or.at"
>andreas@ag.or.at</ulink
></literal> o
<literal remap="tt"><ulink
url="mailto:h9207884@falbala.wuwien.ac.at"
>h9207884@albala.wuwien.ac.at</ulink
></literal>) 
</para>

<para>
La última versión de este Mini-COMO se puede encontrar generalmente en
<literal remap="tt"><ulink
url="ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO/mini/NFS-Root"
>ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO/mini/NFS-Root</ulink
></literal> o en
cualquier réplica de sunsite cerca de Usted.
</para>

<para>
Salvo que se indique lo contrario, los documentos COMO de Linux son
propiedad de sus respectivos autores. Los documentos COMO de Linux pueden
ser reproducidos o distribuidos en su totalidad o en parte, en cualquier
medio físico o electrónico, siendo estas declaraciones de derechos
aplicables a todas las copias.  Se permite y se fomenta las
redistribuciones comerciales, pero en esos casos el autor debe ser
notificado.
</para>

<para>
Todas las traducciones y trabajos derivados de cualquier documento COMO de
Linux están cubiertos por esta declaración de derechos. Esto significa que
Usted no puede producir trabajos derivados de un COMO e imponerle
restricciones adicionales. Se puede conceder excepciones a estas reglas
bajo ciertas condiciones;  por favor, contacte el coordinador de los COMO
de Linux en la dirección que se indica abajo.
</para>

<para>
Resumiendo: deseamos promover la diseminación de esta información a través
de tantos canales como sea posible.  Sin embargo, se desea retener los
derechos sobre los documentos HOWTO, y nos gustaría estar informados de
cualquier plan de redistribución. 
</para>

<para>
Si tiene preguntas, por favor, contacte con Andreas Kostyrka <literal remap="tt"><ulink
url="mailto:andreas@ag.or.at"
>andreas@ag.or.at</ulink
></literal>, el autor de
este mini-COMO, o Greg Hankins, el coordinador de los HOWTO de Linux,
<literal remap="tt"><ulink
url="mailto:gregh@sunsite.unc.edu"
>gregh@sunsite.unc.edu</ulink
></literal> vía email o en el teléfono +1 404 853
9989
</para>

<sect2>
<title>Contribuciones</title>

<para>

<itemizedlist>
<listitem>

<para>
 Avery Pennarun <literal remap="tt"><ulink
url="mailto:apenwarr@foxnet.net"
>apenwarr@foxenet.net</ulink
></literal> (cómo arrancar sin LILO)

</para>
</listitem>
<listitem>

<para>
 Ofer Maor <literal remap="tt"><ulink
url="mailto:ofer@hadar.co.il"
>ofer@hadar.co.il</ulink
></literal> (realizó un COMO muy bueno referido a
configurar una estación de trabajo sin discos) 

</para>
</listitem>
<listitem>

<para>
 Christina Leutloff <literal remap="tt"><ulink
url="mailto:leutloff@sundancer.tng.oche.de"
>leutloff@sundancer.tng.oche.de</ulink
></literal> (provee información sobre
netboot)
</para>
</listitem>

</itemizedlist>

</para>

</sect2>

</sect1>

<sect1>
<title>Visión General</title>

<para>
Generalizando, existen los siguientes problemas en las estaciones de
trabajo sin disco:
</para>

<para>

<itemizedlist>
<listitem>

<para>
Deben encontrar su propia dirección IP, y necesitan también el resto
de la configuración de red. 

</para>
</listitem>
<listitem>

<para>
Deben conocer el servidor NFS y el camino para montar su sistema de
archivo raíz. 
</para>
</listitem>

</itemizedlist>

</para>

<para>
La actual implementación de <emphasis remap="it">NFSROOT</emphasis> en el núcleo de Linux (a partir
de la versión 1.3.7x) permite las siguientes soluciones: 
</para>

<para>

<itemizedlist>
<listitem>

<para>
La dirección IP puede ser averiguada mediante RARP, o bien la
configuración total de la red puede ser pasada al núcleo vía parámetros
al núcleo usando <literal remap="tt">LILO</literal> o <literal remap="tt">LOADLIN</literal>.

</para>
</listitem>
<listitem>

<para>
La ruta NFS a montar puede ser pasada vía parámetros al núcleo. Si
no se hace esto, el núcleo asume que el servidor RARP es también servidor
NFS, y utilizará lo que esté compilado por defecto como la ruta.  (el
valor actual por defecto en el núcleo es: 
<literal remap="tt">/tftpboot/direccion_IP_de_la_maquina</literal>) 

</para>
</listitem>
<listitem>

<para>
La configuración del cliente puede averiguarse por <literal remap="tt">BOOTP</literal>.
</para>
</listitem>

</itemizedlist>

</para>

<para>
Antes de iniciar la configuración de un entorno sin disco, deberá decidir
si arrancará vía <literal remap="tt">LILO</literal> o <literal remap="tt">LOADLIN</literal>.  La ventaja de hacerlo es la
flexibilidad, la desventaja es la velocidad. El arranque de un núcleo de
Linux sin <literal remap="tt">LILO</literal> es más rápido.  Esto puede ser o no de importancia. 
</para>

</sect1>

<sect1>
<title>Configuración del servidor</title>

<sect2>
<title>Compilación del núcleo</title>

<para>
Incluir soporte <literal remap="tt">RARP</literal> en el núcleo del servidor será probablemente una
buena idea.  Deberá estar habilitada si se arranca el núcleo sin
parámetros.  Por otro lado, ésto no le ayudará si el cliente no está en la
misma subred que el servidor. 
</para>

<para>
El núcleo para la estación de trabajo necesita como configuraciones
mínimas compiladas las siguientes: 
</para>

<para>

<itemizedlist>
<listitem>

<para>
Soporte para sistema de archivos NFS compilado (no es necesario que
tenga soporte <literal remap="tt">ext2</literal> compilado monolíticamente, como módulo es
suficiente)

</para>
</listitem>
<listitem>

<para>
La opción "<literal remap="tt">Root on NFS</literal>" debe estar habilitada.

</para>
</listitem>
<listitem>

<para>
El controlador que da soporte a la tarjeta de red de la estación de
trabajo debe estar compilado.

</para>
</listitem>
<listitem>

<para>
De acuerdo a sus necesidades tendrá que incluir soporte <literal remap="tt">RARP</literal> o
<literal remap="tt">BOOTP</literal> para <literal remap="tt">NFS-Root</literal>. (con esto me refiero a las opciones que
siguen al apartado NFS del menú configurador del núcleo)
</para>
</listitem>

</itemizedlist>

</para>

<para>
Si la estación de trabajo va a ser iniciada sin pasar parámetros al
núcleo, será necesario declarar el dispositivo raíz en <literal remap="tt">0:255</literal>.  Haga
esto creando el fichero de dispositivo: 
</para>

<para>

<screen>
mknod /dev/nfsroot b 0 255
</screen>

</para>

<para>
Una vez creado, puede establecer el directorio raíz de la imagen del
núcleo con: 
</para>

<para>

<screen>
rdev imagen_del_nucleo /dev/nfsroot
</screen>

</para>

</sect2>

<sect2>
<title>Creación del sistema de archivos raíz</title>

<sect3>
<title>Copiando el sistema de archivos</title>

<para>
<emphasis remap="bf">Atención:</emphasis> si bien estas instrucciones pueden resultar suficientes
para Usted, no significa que sean óptimas en un sistema de trabajo. Hay un
método mejor para configurar máquinas clientes con el sistema archivos
raíz en NFS en el <emphasis remap="it">Cliente-Con-Raíz-NFS mini-COMO</emphasis> de Ofer Maor,
<literal remap="tt"><ulink
url="mailto:ofer@hadar.co.il"
>ofer@hadar.co.il</ulink
></literal>
</para>

<para>
Una vez decida dónde va a ser colocado el árbol raíz, cree éste con (por
ejemplo):
</para>

<para>

<screen>
mkdir -p directorio
tar cClf / - | tar xpCf directorio 
</screen>

</para>

<para>
Si inicia el núcleo sin LILO, entonces el directorio raíz tiene que ser
<literal remap="tt">/tftpboot/dirección-IP</literal>.  Si no le gusta esto, debe cambiarlo en
la cabecera del <literal remap="tt">Makefile</literal> de los fuentes del núcleo, busque una línea
como: <literal remap="tt">NFS_ROOT = -DNFS_ROOT=</literal>. Si cambia esto, será necesario
recompilar el núcleo. 
</para>

</sect3>

<sect3>
<title>Cambios en el sistema de archivos raíz</title>

<para>
Elimine los archivos innecesarios y revise las instrucciones de los
ficheros de inicialización de <literal remap="tt">/etc/rc.d.</literal> Algunos puntos
importantes: 
</para>

<para>

<itemizedlist>
<listitem>

<para>
Un aspecto importante es la configuración de la tarjeta ethernet. 
La estación de trabajo llega con una, al menos parcial, configuración de
<literal remap="tt">eth0</literal>.  Configurar la dirección-IP de la estación de trabajo como la
dirección-IP del servidor no es correcto. (Como comprobó el autor en uno
de sus primeros intentos) 

</para>
</listitem>
<listitem>

<para>
Otro punto es el archivo <literal remap="tt">/etc/fstab</literal> de la estación de
trabajo, que debe estar configurado para un sistema de archivos NFS.

</para>
</listitem>
<listitem>

<para>
<emphasis remap="bf">CUIDADO:</emphasis> No confundir el sistema de archivos raíz del
servidor y el sistema de archivos raíz de la estación de trabajo.  (Yo
configuraba el <literal remap="tt">rc.inet1</literal> del servidor y me sorprendía al ver que la
estación de trabajo seguía sin funcionar) 
</para>
</listitem>

</itemizedlist>

</para>

</sect3>

<sect3>
<title>Exportando el sistema de archivos</title>

<para>
Exporte el directorio raíz a la estación de trabajo. Consulte
<literal remap="tt">exports(5)</literal>. Se deberá reiniciar <literal remap="tt">nfsd/mountd</literal> después de este
cambio.  Con RedHat esto puede llevarse a cabo fácilmente ejecutando:
</para>

<para>

<screen>
/etc/rc.d/init.d/nfs stop 
/etc/rcd/init.d/nfs start
</screen>

</para>

</sect3>

<sect3>
<title>Configuración RARP</title>

<para>
Configure <literal remap="tt">RARP</literal> en algún servidor de su red.  Si arranca sin
parámetros en <literal remap="tt">nfsroot</literal>, el servidor <literal remap="tt">RARP</literal> debe además ser servidor
NFS.  Generalmente este será el servidor NFS. Para poder hacerlo, se
necesita que el núcleo tenga soporte <literal remap="tt">RARP</literal>.
</para>

<para>
Para hacer esto, ejecute (y coloque en algún lugar de <literal remap="tt">/etc/rc.d</literal>
en el servidor): 
</para>

<para>

<screen>
/sbin/rarp -s direccion-ip direccion-MAC-de-la-tarjeta
</screen>

</para>

<para>
donde
</para>

<para>
<variablelist>

<varlistentry>
<term>direccion-ip:</term>
<listitem>
<para>
Dirección IP de la estación de trabajo y,
</para>
</listitem></varlistentry>
<varlistentry>
<term>direccion-MAC-de-la-tarjeta:</term>
<listitem>
<para>
Dirección MAC o hardware de la
tarjeta de red de la estación de trabajo.
</para>
</listitem></varlistentry>
</variablelist>
</para>

<para>
ejemplo:
</para>

<para>

<screen>
/sbin/rarp -s 131.131.90.200 00:00:c0:47:10:12
</screen>

</para>

<para>
También puede usar un mnemónico en lugar de la dirección-IP, cuando el
servidor esté capacitado para resolverlo, bien por poder encontrarlo en
(<literal remap="tt">/etc/hosts</literal> o por búsquedas en DNS) 
</para>

</sect3>

<sect3>
<title>Configuración de <literal remap="tt">BOOTP</literal></title>

<para>
Para configurar BOOTP necesita editar <literal remap="tt">/etc/bootptab</literal>.  Por favor
consulte las páginas <literal remap="tt">man</literal> sobre <literal remap="tt">bootpd(8)</literal> y <literal remap="tt">bootptab(5)</literal>. 
</para>

</sect3>

<sect3>
<title>Cómo averiguar las direcciones del hardware</title>

<para>
<emphasis remap="it">¡No sé cuáles son las direcciones MAC o de hardware! ¿Cómo puedo
averiguarlas?</emphasis> 
</para>

<para>

<itemizedlist>
<listitem>

<para>
Arranque Linux con el disquete que ha hecho y busque la línea donde
se reconoce la tarjeta de red. Normalmente se muestran 6 bytes
hexadecimales que son la dirección de la tarjeta. 

</para>
</listitem>
<listitem>

<para>
Arranque la máquina con cualquier sistema operativo que tenga
soporte TCP/IP y haga un <literal remap="tt">ping</literal> a la estación de trabajo desde el
servidor.  Revise el cache-ARP ejecutando: <literal remap="tt">/sbin/arp -a</literal>
</para>
</listitem>

</itemizedlist>

</para>

</sect3>

</sect2>

</sect1>

<sect1>
<title>Arranque de la estación de trabajo</title>

<sect2>
<title>Uso de una ROM de inicio (<emphasis remap="it">BOOT ROM</emphasis>)</title>

<para>
Como yo no he usado ninguna en mis pruebas, solamente puedo dar algunas
ideas (cortesía de Christian Leutloff, <literal remap="tt"><ulink
url="mailto:leutloff@sundancer.tng.oche.de"
>leutloff@sundancer.tng.oche.de</ulink
></literal>): 
</para>

<para>

<itemizedlist>
<listitem>

<para>
No es posible utilizar ROMs de arranque "normales". 

</para>
</listitem>
<listitem>

<para>
Existe el paquete <literal remap="tt">netboot</literal> de Gero Kuhlmann, que permite crear
ROMs de inicio para Linux y que contiene la información necesaria. 
<literal remap="tt">netboot</literal> está disponible en servidores ftp de Linux o como paquete
Debian (<literal remap="tt">netboot-0.4</literal>). 

</para>
</listitem>
<listitem>

<para>
Lea detenidamente la documentación que viene con su ROM de arranque. 

</para>
</listitem>
<listitem>

<para>
Probablemente sea necesario habilitar <literal remap="tt">tftpd</literal> en el servidor,
dependerá de la forma en que su ROM de inicio cargue el núcleo.

</para>
</listitem>
<listitem>

<para>
Cualquier información sobre vendedores de ROMs con estas
características para Linux será bienvenida, ya que nadie tiene acceso a
una máquina grabadora (especialmente en Europa donde yo resido). Y yo la
incluiría aquí.
</para>
</listitem>

</itemizedlist>

</para>

</sect2>

<sect2>
<title>Uso de un disquete de arranque</title>

<para>
Si ha exportado el sistema de archivos con el nombre correcto y su
servidor NFS es también el servidor RARP (lo cual implica que las máquinas
están en la misma subred), puede entonces simplemente arrancar Linux desde
un disquete (necesita tener configurado como dispositivo raíz de dicho
núcleo <literal remap="tt">0:255</literal>).
</para>

<para>
Esto asume que el directorio raíz en el servidor es
<literal remap="tt">/tftpboot/dirección-IP</literal> (este valor puede ser modificado cuando se
compila el núcleo).
</para>

</sect2>

<sect2>
<title>Uso de un gestor de arranque y RARP</title>

<para>
Pase al núcleo todos los parámetros cuando arranca y agregue
</para>

<para>

<screen>
 
nfsroot=dir-IP-servidor:/ruta/a/montar 
</screen>

</para>

<para>
donde <literal remap="tt">dir-IP-servidor</literal> es la dirección IP de su servidor NFS, y
<literal remap="tt">/ruta/a/montar</literal> es la trayectoria (<emphasis remap="it">path</emphasis>) al directorio raíz. 
</para>

<para>
Sugerencias:
</para>

<para>

<itemizedlist>
<listitem>

<para>
Cuando utilice LILO considere usar la opción "<literal remap="tt">lock</literal>": 
Simplemente escriba una vez los parámetros correctos y agregue
"<literal remap="tt">lock</literal>". La siguiente vez que arranque deje que LILO haga todo. 

</para>
</listitem>
<listitem>

<para>
Cuando genere un disco específico para una estación de trabajo,
puede utilizar la opción <literal remap="tt">append=</literal> en el fichero de configuración
<literal remap="tt">lilo.conf</literal>
</para>
</listitem>

</itemizedlist>

</para>

</sect2>

<sect2>
<title>Uso de un gestor de arranque sin RARP</title>

<para>
Además de <literal remap="tt">nfsroot</literal> ponga el argumento
<literal remap="tt">nfsaddrs=maq-IP:serv-IP:pasa-IP:masc-IP:nombre-maq</literal> como
parámetros para el núcleo.  El núcleo configurará <literal remap="tt">eth0</literal> con los
parámetros que le ha proporcionado:
</para>

<para>
<variablelist>

<varlistentry>
<term><literal remap="tt">maq-IP</literal></term>
<listitem>
<para>
Dirección IP de la estación de trabajo
</para>
</listitem></varlistentry>
<varlistentry>
<term><literal remap="tt">serv-IP</literal></term>
<listitem>
<para>
Dirección IP del servidor NFS
</para>
</listitem></varlistentry>
<varlistentry>
<term><literal remap="tt">pasa-IP</literal></term>
<listitem>
<para>
Dirección de la pasarela
</para>
</listitem></varlistentry>
<varlistentry>
<term><literal remap="tt">masc-IP</literal></term>
<listitem>
<para>
Máscara de red
</para>
</listitem></varlistentry>
<varlistentry>
<term><literal remap="tt">nombre-maq</literal></term>
<listitem>
<para>
Nombre de la máquina
</para>
</listitem></varlistentry>
</variablelist>
</para>

</sect2>

</sect1>

<sect1>
<title>Temas relacionados</title>

<para>

<itemizedlist>
<listitem>

<para>
Puede encontrar un cliente BOOTP en:  <literal remap="tt"><ulink
url="ftp://sunsite.unc.edu/system/Network/admin/bootpc.v045.tgz"
>ftp://sunsite.unc.edu/system/Network/admin/bootpc.v045.tgz</ulink
></literal>

Con las nuevas actualizaciones, <literal remap="tt">bzImage</literal> y <literal remap="tt">initrd</literal> (que según
entiendo se incorporan a partir de la versión 1.3.73), se puede hacer que
funcione una estación de trabajo correctamente.

</para>
</listitem>
<listitem>

<para>
En el directorio de documentación de las fuentes del núcleo se
encuentra un archivo documentando los sistemas Raíz-NFS. 

</para>
</listitem>
<listitem>

<para>
Existe una actualización en circulación que permite tener un archivo
de intercambio (swap) sobre NFS. 
</para>
</listitem>

</itemizedlist>

</para>

</sect1>

<sect1 id="Grupos">
<title>Anexo: El INSFLUG </title>

<para>
El <emphasis>INSFLUG</emphasis> forma parte del grupo internacional 
<emphasis remap="it">Linux Documentation Project</emphasis>, 
encargándose de las traducciones al castellano de los Howtos (Comos),
así como la producción de documentos originales en aquellos casos
en los que no existe análogo en inglés.
</para>

<para>
En el <emphasis remap="bf">INSFLUG</emphasis> se orienta preferentemente a la traducción de documentos
breves, como los <emphasis>COMOs</emphasis> y <emphasis>PUFs</emphasis> (<emphasis remap="bf">P</emphasis>reguntas de
<emphasis remap="bf">U</emphasis>so <emphasis remap="bf">F</emphasis>recuente, las <emphasis remap="it">FAQs</emphasis>. <literal remap="tt">:)</literal> ), etc.
</para>

<para>
Diríjase a la sede del INSFLUG para más información al respecto.
</para>

<para>
En la sede del INSFLUG encontrará siempre las <emphasis remap="bf">últimas</emphasis> versiones 
de las traducciones:  <literal remap="tt"><ulink
url="http://www.insflug.org"
>www.insflug.org</ulink
></literal>. Asegúrese de comprobar cuál es la última versión 
disponible en el Insflug antes de bajar un documento de un servidor réplica.
</para>

<para>
Se proporciona también una lista de los servidores
réplica (<emphasis remap="it">mirror</emphasis>) del Insflug más cercanos a Vd.,  
e información relativa a otros recursos en castellano.
</para>

<para>
Francisco José Montilla, <literal remap="tt"><ulink
url="mailto:pacopepe@insflug.org"
>pacopepe@insflug.org</ulink
></literal>.
</para>

</sect1>

</article>
