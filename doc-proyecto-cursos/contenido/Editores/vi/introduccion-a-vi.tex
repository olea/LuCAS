\porcion{Introducción al editor de textos \emph{vi}}
\autor{\LDP}
\colaborador{}
\revisor{\LLC}
\traductor{}

El editor \comando{vi} es lo que se conoce como un \emph{editor de
pantalla}, donde uno apenas realiza los cambios en el archivo que se
está editando, los visualiza. Los sistemas basados en UNIX en general
traen consigo instalados varios editores de texto, y \comando{vi} es
uno de los más conocidos y accesibles, y es por eso que conocer al
menos los rudimentos de este editor es muy conveniente.

Quizás al usuario novato o venido de otros entornos diferentes a UNIX
le parezca un tanto extraño el uso de este editor, ya que no utiliza
menús desplegables, ni teclas de función convencionales. Sin embargo,
\comando{vi} es un editor de texto extremadamente potente, cuyo manejo
con la práctica permite realizar tareas avanzadas de edición muy
rápidamente.

Para hacer uso de este editor, sólo se ejecuta pasándole como
argumento el nombre del archivo a editar:

\begin{vscreen}
$ vi <nombre_de_archivo>
\end{vscreen}
%$

Básicamente, \comando{vi} posee dos \emph{modos} de funcionamiento: el
\emph{modo de inserción} y el \emph{modo de comandos}. Apenas se carga
\comando{vi}, el editor se encuentra en modo de comandos, es decir, que
el teclado no está activado para recibir texto y agregarlo al archivo,
sino que cada tecla del teclado corresponde a un comando del editor.
Más adelante se listarán los comandos más comúnmente utilizados. Ahora
se verán los conceptos para utilizarlos.

Para ingresar al modo de inserción, sólo es necesario presionar la
tecla \boton{Insert} del teclado. Luego ya es posible ingresar texto
normalmente, como se puede observar en la figura
\ref{fig:ViEnModoDeInsercion}. Para volver al modo de comandos, basta 
con presionar la tecla \boton{Esc}.

\figura{\comando{vi} en modo de inserción}{ViEnModoDeInsercion}{width=11cm}{Editores/vi/modo-de-insercion.png}

En modo de comandos, se debe tener en cuenta que generalmente el
comando que se ejecuta se aplica a la línea o carácter donde se
encuentre el cursor. Así por ejemplo, si se presiona la tecla
\boton{x}\footnote{Siempre tener en cuenta que las mayúsculas se
diferencian de las minúsculas. Es un error muy común tener el
\boton{Bloq Mayús} activado.}, se borra el carácter donde el cursor
está posicionado. Otro ejemplo es, si se presiona 2 veces consecutivas
la tecla \boton{d}, se eliminará la línea completa donde se encuentre
el cursor.

Además del modo de comandos normal que posee \comando{vi}, donde no es
necesario presionar la tecla \boton{Enter} para ejecutar comandos,
existe otra manera de ejecutarlos: \comando{vi} utiliza \emph{detrás
de cámaras} el editor de línea \comando{ex}. Muchos de los comandos
que se necesitan, se ejecutan a través de \comando{ex}. Para activar
el modo de comandos de este editor de línea, se presiona la tecla
\boton{:} y luego se escribe el comando, seguido de \comando{Enter},
como veremos más adelante. Como ejemplo se puede dar uno muy
interesante: para salir de \comando{vi} sin grabar en disco se debe
escribir \comando{:q!} seguido de la tecla \boton{Enter}.

Una particularidad que posee \comando{vi} es la de poder hacer
repeticiones de comandos. Si se escribe un número (en modo de
comandos, obviamente) inmediatamente seguido de un comando, este
comando se ejecutará la cantidad de veces que se le haya
especificado. Un ejemplo práctico de esto es que si se necesita
eliminar 3 líneas de texto, con el comando \comando{3dd} se puede
realizar en vez de ejecutar \comando{dd} 3 veces.

A continuación se listan los comandos más comúnmente utilizados:

\begin{description}
\item[i] Ingresar al modo de inserción.
\item[r] Ingresar al modo de inserción (reemplazo).
\item[cw] Reemplazar hasta el final de palabra.
\item[D] Borrar desde el cursor hasta el final de la línea.
\item[ZZ] Salir de \comando{vi} grabando los cambios.
\item[\$] Ir al fin de línea. Es equivalente a la tecla \boton{Fin}.
\item[\^] Ir al comienzo de línea. Es equivalente a la tecla \boton{Inicio}.
\item[dd] Cortar línea al \emph{portapapeles} (también se usa para borrar).
\item[Y] Copiar la línea actual al \emph{portapapeles}.
\item[p] Pegar el contenido del \emph{portapapeles} a la derecha del cursor.
\item[P] Pegar el contenido del \emph{portapapeles} a la izquierda del cursor.
\item[o] Comenzar edición abajo del cursor.
\item[O] Comenzar edición arriba del cursor.
\item[a] Comenzar edición a la derecha del cursor.
\end{description}

Además, los comandos de \comando{ex} más comúnmente utilizados son:

\begin{description}
\item[:wq] Salir de \comando{vi} grabando los cambios.
\item[:w] Grabar los cambios sin salir.
\item[:n,m s/cadena1/cadena2/g] Buscar <<cadena1>> y reemplazarla por 
<<cadena2>> desde la línea número <<n>> hasta la línea número <<m>> 
(se puede escribir \$ para hacer referencia al final del archivo).
\item[:q!] Salir sin grabar los cambios.
\end{description}

Como comando adicional, es importante nombrar al comando de búsqueda.
Éste se ejecuta presionando la tecla \boton{/} seguida de la cadena de
texto a buscar, y \boton{Enter} para confirmar. El cursor se
posicionará en la primera ocurrencia de la cadena a buscar. Presionando
\boton{n} se buscará la siguiente ocurrencia de la búsqueda.

\begin{ejemplo}
Una tarea que quizás parezca complicada es la de buscar y reemplazar,
por lo que se presenta un ejemplo aclaratorio. Supóngase el caso de la
figura \ref{fig:BuscarReemplazarAntes}. Se puede observar que se
quiere reemplazar desde la línea 1 hasta el final del archivo todas
las ocurrencias de <<vi>> por <<emacs>>\footnote{Emacs es otro editor
de texto excelente, por cierto.}. El resultado se puede observar en la
figura \ref{fig:BuscarReemplazarDespues}.

\figura{Comando de buscar y reemplazar}{BuscarReemplazarAntes}{width=11cm}{Editores/vi/buscar-reemplazar.png}

\figura{Resultado del reemplazo}{BuscarReemplazarDespues}{width=11cm}{Editores/vi/buscar-reemplazar-despues.png}

Como se ve, se han reemplazado todas las ocurrencias de la cadena
<<vi>>. Esto a veces no es lo correcto, como puede observarse en la
figura.

\end{ejemplo}

\begin{ejemplo}
Supóngase que se tiene un párrafo de 10 líneas en un texto que se debe
mover a otro sitio del archivo. Una solución no muy óptima es borrar
las líneas y volver a escribirlas donde corresponde; pero mejor aún es
cortar esas 10 líneas y pegarlas en el nuevo sitio. Para ello, el
cursor debe estar posicionado en la primer línea del párrafo. Luego
ejecutar el comando \comando{10dd}, posicionar el cursor en el lugar
donde debe ir el párrafo y ejecutar el comando \comando{p}. ¡Así de
fácil!
\end{ejemplo}
