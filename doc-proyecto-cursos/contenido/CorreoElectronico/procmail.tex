\porcion{Configuración de filtros con \comando{procmail}}
\autor{\NC}
\colaborador{}
\traductor{}
\revisor{\LLC}

El comando \comando{procmail} sirve para el procesamiento de correos
apenas llegan. Es útil para realizar filtros según los datos del
correo entrante. El archivo de configuración principal es
\archivo{\$HOME/.procmailrc}\footnote{\archivo{\$HOME} es el 
directorio personal del usuario.}, en donde se definen reglas para
realizar tareas en base al contenido o encabezado de cada correo.

\begin{ejemplo}

Suponiendo que se posee una subscripción en la lista de correos
{\tt cursos-linux@listas.hispalinux.es} y que los mensajes 
provenientes de esa lista llegan de la siguiente manera:

\begin{vscreen}
  De: Nicolás César <ncesar@ciudad.com.ar>
   A: Proyecto Cursos <cursos-linux@listas.hispalinux.es>
Tema: Comentario de procmail
----
Lista,
	Cuento a todos que hoy escribí la parte de procmail que faltaba,
(...)
Saludos,
Nicolás César
\end{vscreen}

Se puede crear una regla que diga ``Todos los mensajes con
destinatario {\tt cursos-linux@listas.hispalinux.es} vayan a la
carpeta \archivo{ProyectoCursos}'' de la siguiente forma:

\begin{vscreen}
:0:
*^To.*cursos-linux@listas.hispalinux.es
ProyectoCursos
\end{vscreen}
\end{ejemplo}

La primera línea va más allá del alcance de este curso. Para mayor
información, \comando{man procmailrc}.  Las siguientes líneas son
``condiciones\footnote{En el ejemplo sólo existe una}''. Las
condiciones comienzan con un `*' inicial. Todo lo que viene tras este
carácter se pasa al \comando{egrep} interno literalmente, salvo los
espacios en blanco iniciales y finales. 

Para explicar un poco de detalles a continuación hay un resumen corto
de expresiones regulares:

\begin{description}

\item[\^] \emph{Comienzo de linea}, los caracteres restantes deben ser el
principio de la línea. Ej. ``\emph{\^Había una}'' coincide con la línea
<<\emph{Había una vez}>> pero no con <<\emph{Dicen que había una vez}>>.

\item[\$] \emph{Fin de línea}, los caracteres previos deben ser los últimos
de la línea. Ej. ``\emph{ción\$}'' coincide con la línea <<\emph{En la estación}>>
pero no con <<\emph{superposición de ideas}>>.

\item[.] \emph{Cualquier carácter}, Ej. ``\emph{....}'' coincide con <<\emph{hola}>> y
con <<\emph{es 1}>> pero no con <<\emph{hello}>> ni con <<\emph{es una}>>.

\item[*] \emph{cero o n veces}, el grupo de caracteres o carácter anterior debe repetirse 
cero o n veces. Ej. ``\emph{ba*}'' coincide con la línea <<\emph{baaa}>> o con <<\emph{ba}>> o con
<<\emph{a}>> pero no con <<\emph{caa}>> o con <<\emph{c}>>.

\end{description}

Para mucha más información {\tt man grep}. Existen expresiones
regulares mucho más complejas; pero con la breve descripción realizada,
ya es posible analizar la segunda línea de nuestro ejemplo:

\begin{vscreen}
^To.*cursos-linux@listas.hispalinux.es
\end{vscreen}


<<\^>> significa comienzo de línea, entonces <<To>> debe estar al comienzo
de la línea. Luego la expresión <<.*>> significa ``cualquier carácter
cero o más veces'' y <<cursos-linux@listas.hispalinux.es>> dice que
debe estar literalmente escrito en la línea, en algún lugar.

Entonces correos que posean las siguientes líneas (en el encabezado
típicamente) se considerarán:

\begin{itemize}
\item To:cursos-linux@listas.hispalinux.es
\item To: cursos-linux@listas.hispalinux.es (Proyecto Cursos)
\item To: Proyecto Cursos <cursos-linux@listas.hispalinux.es>
\end{itemize}

Pero no se considerarán correos con:

\begin{itemize}
\item From: cursos-linux@listas.hispalinux.es
\item Esto es para <cursos-linux@listas.hispalinux.es>
\item Cc: cursos-linux@listas.hispalinux.es
\end{itemize}

Y la última línea de nuestro ejemplo es el nombre de archivo donde se
copiarán los correos que pasen las reglas anteriores. En este caso
``ProyectoCursos''. También se puede redireccionar a algún comando u otro
tipo de acciones.

Existen varios archivos de utilidad que el \comando{procmail} revisa si existen.
Uno muy útil es \archivo{.forward}. El contenido del archivo es una dirección
de correo a enviar todo el correo entrante, especialmente útil si se desea redireccionar 
todos los correos.

\begin{vscreen}
[usuario@maquina usuario]$echo nueva.direccion@otrohost.com.ar >> $HOME/.forward
\end{vscreen}

Redireccionaría todos los correos a nueva.direccion@otrohost.com.ar
