\subsection*{buffer\_head}

La estructura de datos \ds{buffer\_head} mantiene información sobre un
bloque de búfer en el caché de búfer.
\SeeModule{include/linux/\\fs.h}
\begin{tscreen}\begin{verbatim}
/* bh state bits */
#define BH_Uptodate  0   /* 1 si el búfer contiene datos válidos     */
#define BH_Dirty     1   /* 1 si el búfer está sucio                 */
#define BH_Lock      2   /* 1 si el búfer tiene cerrojo puesto       */
#define BH_Req       3   /* 0 si el búfer ha sido invalidado         */
#define BH_Touched   4   /* 1 si el búfer ha sido tocado (envejecido)*/
#define BH_Has_aged  5   /* 1 si el búfer ha envejecido (aging)      */
#define BH_Protected 6   /* 1 si el búfer está protegido             */
#define BH_FreeOnIO  7   /* 1 para descartar el buffer_head después  */
                              de IO                                  */

struct buffer_head {
  /* primera línea de caché: */
  unsigned long      b_blocknr;    /* número de bloque               */
  kdev_t             b_dev;        /* dispositivo (B_FREE = libre)   */
  kdev_t             b_rdev;       /* dispositivo real               */
  unsigned long      b_rsector;    /* ubicación real del búfer       */
                                        en el disco                  */
  struct buffer_head *b_next;      /* lista de la cola hash          */
  struct buffer_head *b_this_page; /* lista circular de búferes en
                                        una página                   */
  /* Segunda línea de caché : */
  unsigned long      b_state;      /* buffer state bitmap (above)    */
  struct buffer_head *b_next_free;
  unsigned int       b_count;      /* usuarios que usan este bloque  */
  unsigned long      b_size;       /* tamaño del bloque              */

  /* Siguen datos que nos son críticos para la performance: */
  char               *b_data;      /* apuntador al bloque de datos   */
  unsigned int       b_list;       /* Lista en la cual aparece este
                                       búfer                         */
  unsigned long      b_flushtime;  /* Momento en el cual este búfer
                                        (sucio) deberá escribirse    */
  unsigned long      b_lru_time;   /* Momento cuando se usó por última
                                         vez este búfer.             */
  struct wait_queue  *b_wait;
  struct buffer_head *b_prev;      /* lista hash doblemente enlazada */
  struct buffer_head *b_prev_free; /* lista doblemente enlazada 
                                        de búferes                   */
  struct buffer_head *b_reqnext;   /* cola de solicitudes            */
};
\end{verbatim}\end{tscreen}

