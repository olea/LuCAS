<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.1.2//EN"
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">

<article>

<articleinfo>

<title>EL CÓMO DEL UMSDOS</title>

<author>
<firstname>Jacques Gelinas, <ulink
url="mailto:jacques@solucorp.qc.ca"
>jacques@solucorp.qc.ca</ulink
>
Traducido por: Carlos García Arques <ulink
url="mailto:cgarcia@dit.upm.es"
>cgarcia@dit.upm.es</ulink
></firstname>
</author>

<pubdate>v1.1, 13 November 1995</pubdate>

<abstract>

<para>
Umsdos es un sistema de ficheros de Linux sobre uno FAT. Ofrece una
alternativa al sistema de ficheros ext2. Su objetivo
principal es conseguir una más fácil coexistencia con los datos
de una partición FAT, compartiéndola.
En este documento primero se explica cómo usar <literal remap="tt">umsdos</literal> con
diversas configuraciones, y después se explica cómo funciona
y se da alguna información. Se deja para el lector la decisión
de si es una buena elección para él.
</para>

</abstract>

</articleinfo>

<sect1>
<title>¿Dónde está el UMSDOS?</title>

<sect2>
<title>Historia</title>

<para>
El proyecto <literal remap="tt">umsdos</literal> comenzó en 1992 y se puso a disposición
de la red en enero del 1994 en forma de parche. Se incluyó en
la distribución estándar del núcleo (<emphasis>kernel</emphasis>) de linux
en Julio, comenzando con el núcleo 1.1.36.
</para>

<para>
<literal remap="tt">umsdos</literal> fue pronto adoptado por la distribución <emphasis>Slackware</emphasis>,
incluso antes de que fuera oficialmente incluido en el núcleo.
</para>

<para>
<literal remap="tt">umsdos</literal> empezó a ser mejorado a partir del núcleo 1.1.60.
Su rendimiento ha mejorado radicalmente, especialmente en lo que
se refiere a escritura. A partir del 1.1.70 (más o menos), vuelve
a ser estable.
</para>

<para>
Un error de consideración fue corregido en <emphasis>Linux</emphasis> 1.2.2. El 
error en cuestión estaba dando la lata a los usuarios desde el 
principio (se cambiaba el nombre a algunos ficheros dando la
impresión de que habían desaparecido). Nótese
que la <emphasis>Slackware</emphasis> 2.2 aún incluye la versión 1.2.1 del
núcleo, luego contiene ese error.
</para>

</sect2>

<sect2>
<title>Disponibilidad</title>

<para>
Está disponible como parche para los núcleos 1.0.x. Va incluido
en los núcleos 1.2. Se puede compilar dentro del núcleo o
cargarlo como módulo. Sin embargo, hay que tener en cuenta que
hoy por hoy, si se quiere usar <literal remap="tt">umsdos</literal> en forma de módulo cargable
se debe también usar el sistema de ficheros Ms-DOS como 
módulo cargable. Esto es debido a una limitación en el sistema
de módulos (algunos símbolos se exportan sólo cuando los
controladores se instalan como módulos).
</para>

</sect2>

<sect2>
<title>Distribuciones que lo soportan</title>

<para>
Por el momento creo que sólo <emphasis>Slackware</emphasis> lo incluye. Seguramente
me equivoco, así que por favor corregidme.
</para>

</sect2>

<sect2>
<title>Lugar original donde encontrarlo</title>

<para>
El lugar original de <literal remap="tt">umsdos</literal> es <literal remap="tt"><ulink
url="ftp://sunsite.unc.edu"
>sunsite.unc.edu</ulink
></literal>. Se debe
buscar en el directorio 
 <literal remap="tt">/pub/Linux/system/Filesystems/umsdos</literal>.
</para>

</sect2>

<sect2>
<title>Documentación Técnica</title>

<para>
Hay un montón de documentación sobre el funcionamiento interno de
<literal remap="tt">umsdos</literal>. Se encuentra disponible tanto en formato <literal remap="tt">HTML</literal>
como en formato texto en la misma ubicación que las utilidades.
</para>

<para>
Por lo que yo sé, la versión <literal remap="tt">HTML</literal> no está disponible en 
ningún servidor de Web. Se debe transferir, destarrar, y leer
localmente.
</para>

</sect2>

<sect2>
<title>Quién lo escribió</title>

<para>
Jacques Gelinas <literal remap="tt"><ulink
url="mailto:jacques@solucorp.qc.ca"
>jacques@solucorp.qc.ca</ulink
></literal>
</para>

</sect2>

</sect1>

<sect1>
<title><literal remap="tt">umsdos</literal> como partición raíz</title>

<sect2>
<title>El concepto de la pseudorraíz.</title>

<para>
Mediante el uso de <literal remap="tt">umsdos</literal>, <emphasis>Linux</emphasis> se puede instalar
en una partición de DOS normal y corriente. <emphasis>Linux</emphasis> se
instala entonces como segundo (o tercer) sistema operativo
en la partición. Para evitar conflictos con los nombres
de los ficheros (Si ya hubiera, por ejemplo, un directorio
bin, o tmp, en el disco C:), <literal remap="tt">umsdos</literal> utiliza un inteligente
truco: La pseudorraíz.
</para>

<para>
Todos los ficheros de <emphasis>Linux</emphasis> se instalan en un subdirectorio
del DOS llamado <literal remap="tt">linux</literal>. Generalmente <literal remap="tt">C:&bsol;LINUX</literal>. La estructura
normal de directorios de <emphasis>Linux/Unix</emphasis> va ahí. Así se tiene
</para>

<para>

<itemizedlist>
<listitem>

<para>
 C:\LINUX\BIN
</para>
</listitem>
<listitem>

<para>
 C:\LINUX\ETC
</para>
</listitem>
<listitem>

<para>
 C:\LINUX\LIB
</para>
</listitem>
<listitem>

<para>
 C:\LINUX\ROOT
</para>
</listitem>
<listitem>

<para>
 C:\LINUX\SBIN
</para>
</listitem>
<listitem>

<para>
 C:\LINUX\TMP
</para>
</listitem>
<listitem>

<para>
 C:\LINUX\USR
</para>
</listitem>
<listitem>

<para>
 C:\LINUX\VAR
</para>
</listitem>

</itemizedlist>

</para>

<para>
Cuando arranca, el <literal remap="tt">umsdos</literal> trata de encontrar el directorio
<literal remap="tt">linux</literal> y el <literal remap="tt">/linux/etc</literal>. Si existen, activa el modo
pseudorraíz.
</para>

<para>
Básicamente, el modo pseudorraíz cambia el directorio raíz de la
partición a <literal remap="tt">C:&bsol;LINUX</literal> con lo que queda el
árbol de directorios convencional de <emphasis>Unix</emphasis>
</para>

<para>

<itemizedlist>
<listitem>

<para>
/bin
</para>
</listitem>
<listitem>

<para>
/etc
</para>
</listitem>
<listitem>

<para>
/lib
</para>
</listitem>
<listitem>

<para>
/root
</para>
</listitem>
<listitem>

<para>
/sbin
</para>
</listitem>
<listitem>

<para>
/tmp
</para>
</listitem>
<listitem>

<para>
/usr
</para>
</listitem>
<listitem>

<para>
/var
</para>
</listitem>

</itemizedlist>

</para>

<para>
A esta lista añade uno nuevo llamado <literal remap="tt">DOS</literal>, que es un directorio
virtual.
</para>

</sect2>

<sect2>
<title>Lo que hay que saber de la pseudorraíz</title>

<para>

<itemizedlist>
<listitem>

<para>
 Sólo se puede activar este modo al arrancar el sistema.
No hay manera de activarlo mediante una operación de
montado (con el comando <literal remap="tt">mount</literal>).
</para>
</listitem>
<listitem>

<para>
 Este mecanismo no es más que una visión diferente de un
sistema de ficheros <literal remap="tt">umsdos</literal> normal. Esto significa que
una partición que se usa habitualmente como partición
raíz se puede montar normalmente sin que se produzca ningún
efecto de pseudorraíz.

Por ejemplo, si se arranca linux con un disquete de
mantenimiento y se monta la que es habitualmente la partición
raíz en <literal remap="tt">/mnt</literal>, todos los directorios de linux
se encontrarán en 
<literal remap="tt">/mnt/linux/bin, /mnt/linux/etc</literal>, etc...
</para>
</listitem>

</itemizedlist>

</para>

</sect2>

</sect1>

<sect1>
<title>Distintos aspectos del funcionamiento de <literal remap="tt">umsdos</literal></title>

<sect2>
<title>Opciones de <literal remap="tt">mount</literal></title>

<para>
Se pueden usar las mismas opciones que para el sistema de ficheros
Ms-DOS. La opción <literal remap="tt">conv=</literal> es cuestionable en un sistema <literal remap="tt">umsdos</literal>.
Yo sugiero evitarla. Las opciones que más probablemente se querrá
usar son
</para>

<para>

<itemizedlist>
<listitem>

<para>
<literal remap="tt">uid=</literal>
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">gid=</literal>
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">umask=</literal>
</para>
</listitem>

</itemizedlist>

</para>

<para>
Únicamente se debe recordar que <literal remap="tt">umsdos</literal> trata los directorios
no promovidos de la misma forma que el sistema de ficheros
<emphasis>Ms-DOS</emphasis>. Las opciones de arriba se aplicarán globalmente
a todos los directorios no promovidos. <emphasis>uid</emphasis> establece
el propietario por omisión, <emphasis>gid</emphasis> establece el grupo por
omisión, y <emphasis>umask</emphasis> establece los permisos por omisión.
</para>

</sect2>

<sect2>
<title>Cómo establecer los valores por omisión para la raíz</title>

<para>
<literal remap="tt">umssetup</literal> sirve para establecer en tiempo de ejecución 
el propietario de la partición raíz. Para otras particiones
<literal remap="tt">umsdos</literal>, se pueden usar las opciones de mount o umssetup.
La manera recomendada para particiones no raíz es poner la
opción apropiada en <literal remap="tt">/etc/fstab</literal>. Aquí va un ejemplo. Se
debería poner lo siguiente en <literal remap="tt">/etc/rc.d/rc.S</literal>
</para>

<para>

<screen>
       /sbin/umssetup -u jack -g group -m 0755 /
</screen>

</para>

</sect2>

<sect2>
<title>Swap o no swap</title>

<para>
El uso de un fichero de intercambio (<emphasis>swap</emphasis>) es por lo general
más lento que una partición de intercambio. Sin embargo, es mucho
más flexible.  Un fichero de intercambio en una partición <literal remap="tt">umsdos</literal>
se configura de la misma manera que para cualquier otro sistema
de ficheros de <emphasis>Linux</emphasis>. Por ejemplo, para poner 8 megaoctetos
de fichero de intercambio en el directorio raíz:
</para>

<para>

<screen>
dd if=/dev/zero bs=1024k count=8 of=/swap
mkswap /swap 8192
sync
swapon /swap
</screen>

</para>

<para>
Una vez hecho esto, se puede poner lo siguiente en <literal remap="tt">/etc/fstab</literal>
</para>

<para>

<screen>
/swapswapswapdefault   
</screen>

</para>

<para>
Y el fichero de intercambio se activará en cada arranque del sistema
(hay por lo general un "<literal remap="tt">swapon -a</literal>" en <literal remap="tt">/etc/rc.d/rc.S</literal>).
</para>

</sect2>

</sect1>

<sect1>
<title>Cómo arrancar un sistema <literal remap="tt">umsdos</literal></title>

<sect2>
<title>Loadlin</title>

<para>
El paquete <literal remap="tt">lodlin15.tgz</literal> está disponible en 
<literal remap="tt"><ulink
url="ftp://sunsite.unc.edu/pub/Linux/system/Bootutils"
>ftp://sunsite.unc.edu/pub/Linux/system/Bootutils</ulink
></literal>
Esta utilidad es
especialmente apropiada para arrancar un sistema <literal remap="tt">umsdos</literal>.
Generalmente todo lo que hay que hacer es
</para>

<para>

<screen>
Arrancar el DOS
C:&#62;loadlinx zimage root=D:
</screen>

</para>

<para>
Donde <literal remap="tt">zimage</literal> es una imagen normal (comprimida) del núcleo que
simplemente se ha copiado a algún sitio del disco del DOS. <literal remap="tt">D:</literal>
es el disco del DOS donde se ha instalado <emphasis>Linux</emphasis>.
</para>

</sect2>

<sect2>
<title>Con un disquete</title>

<para>
Arrancar un sistema <literal remap="tt">umsdos</literal> con un disquete no es distinto
a arrancar un sistema <emphasis>Ext2</emphasis>. Se necesita un fichero (<literal remap="tt">zImage</literal>)
con una imagen comprimida del núcleo convenientemente inicializado
para localizar la partición raíz <literal remap="tt">umsdos</literal>.
Esto se consigue generalmente con la orden <literal remap="tt">rdev</literal>. La secuencia
siguiente inicializa una <literal remap="tt">zImage</literal> y la pone en un disquete.
</para>

<para>

<screen>
rdev zImage /dev/hda1
rdev -R zImage 0
dd if=zImage bs=8192 of=/dev/fd0
</screen>

</para>

<para>
Si esto parece lioso, se puede simplemente crear un disco de
arranque de Ms-DOS e incluir lo siguiente en él:
</para>

<para>

<itemizedlist>
<listitem>

<para>
<literal remap="tt">loadlin.exe</literal>
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">loadlinx.exe</literal>
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">zimage</literal>
</para>
</listitem>

</itemizedlist>

</para>

<para>
y ponerle un <literal remap="tt">autoexec.bat</literal> como este
</para>

<para>

<screen>
loadlinx zimage rw root=C:
</screen>

</para>

</sect2>

<sect2>
<title><literal remap="tt">LILO</literal></title>

<para>
<literal remap="tt">LILO</literal>, el programa de arranque oficial de <emphasis>Linux</emphasis> también se
puede usar para arrancar un sistema <literal remap="tt">umsdos</literal>. Sin embargo,
no tengo ninguna experiencia con él. Desde la versión 1.1.60
debería funcionar. Por favor mandadme correo si sabéis algo.
</para>

</sect2>

<sect2>
<title>Cómo defragmentar una partición <literal remap="tt">umsdos</literal></title>

<para>
Se puede hacer con cualquier herramienta de DOS. Los ficheros
creados por <literal remap="tt">umsdos</literal> no tienen nada de especial. Y <literal remap="tt">umsdos</literal>
no espera nada especial (estructura del directorio, orden de las
entradas en el directorio, etc...) del sistema de ficheros DOS
que lo soporta.
</para>

<para>
Por lo que yo sé, no hay ninguna herramienta de <emphasis>Linux</emphasis> que
haga esto.
</para>

</sect2>

<sect2>
<title>Trucos avanzados</title>

<para>
<literal remap="tt">umsdos</literal> se apoya en el fichero <literal remap="tt">--linux-.---</literal> que a su vez
se apoya en el directorio del <emphasis>DOS</emphasis>. A algunos usuarios puede
apetecerles experimentar un poco. La utilidad <literal remap="tt">udosctl</literal>, que es
parte del paquete <literal remap="tt">umsdos_progs</literal> (que también contiene <literal remap="tt">umssync</literal>
y <literal remap="tt">umssetup</literal>) permite hacer operaciones básicas con los 
directorios (listado, borrado) independientemente del fichero
<literal remap="tt">--linux-.---</literal> y del directorio del <emphasis>DOS</emphasis>.
</para>

</sect2>

</sect1>

<sect1>
<title>Principios básicos</title>

<sect2>
<title>Introducción</title>

<para>
<literal remap="tt">umsdos</literal> hace corresponder los ficheros de <emphasis>Linux</emphasis> directamente
con ficheros de <emphasis>Ms-DOS</emphasis>. La traducción es uno a uno (biyectiva).
No se toca el contenido de los ficheros. <literal remap="tt">umsdos</literal> sólo actúa sobre
los nombres. Con los ficheros especiales (enlaces y dispositivos, por
ejemplo) utiliza una gestión especial.
</para>

<para>
Por cada directorio hay un fichero llamado <literal remap="tt">--linux-.---</literal>.
</para>

</sect2>

<sect2>
<title><literal remap="tt">umsdos</literal> puede reemplazar al sistema de ficheros <emphasis>Ms-DOS</emphasis>.</title>

<para>
Se puede ver <literal remap="tt">umsdos</literal> como un superconjunto de propósito
general del sistema de ficheros <emphasis>Ms-DOS</emphasis> de linux.  Esta
flexibilidad es, de hecho, la causa de gran parte de la confusión
sobre <literal remap="tt">umsdos</literal>. Aquí está el porqué. Si se intenta montar un
disquete <emphasis>DOS</emphasis> recién formateado con esto
</para>

<para>

<screen>
mount -t umsdos /dev/fd0 /mnt
</screen>

</para>

<para>
Y se hace esto,
</para>

<para>

<screen>
ls / &#62;/mnt/FICHEROCONNOMBREMUYLARGO
ls -l /mnt
</screen>

</para>

<para>
Se obtiene lo siguiente
</para>

<para>

<screen>
-rwxr-xr-x   1 root     root  302 Apr 14 23:25 ficheroc
</screen>

</para>

<para>
Así, que, por el momento, parece como si el sistema de ficheros
<literal remap="tt">umsdos</literal> no hiciera mucho más (la verdad es que nada más)
que el sistema de ficheros <emphasis>Ms-DOS</emphasis> normal de <emphasis>Linux</emphasis>.
</para>

<para>
<emphasis>???</emphasis>
</para>

</sect2>

<sect2>
<title>Promoción de directorios</title>

<para>
No es muy impresionante por el momento. Ahora viene la gracia.
A menos que se promueva, un directorio <emphasis>DOS</emphasis> será manejado
igual por <literal remap="tt">umsdos</literal> que como lo sería por el sistema de
ficheros <emphasis>DOS</emphasis>.  <literal remap="tt">umsdos</literal> utiliza un fichero especial
en cada subdirectorio para hacer la traducción entre las
capacidades extendidas de <literal remap="tt">umsdos</literal> y las limitaciones del
sistema de ficheros <emphasis>DOS</emphasis>.  Este fichero es invisible para los
usuarios de <literal remap="tt">umsdos</literal>, pero es visible cuando se arranca en
<emphasis>DOS</emphasis>. Para evitar llenar la partición <emphasis>DOS</emphasis> inútilmente
con esos ficheros (<literal remap="tt">--linux-.---</literal>), el fichero es ahora
opcional. Si no existe, <literal remap="tt">umsdos</literal> se comporta como <emphasis>Ms-DOS</emphasis>.
</para>

<para>
Cuando se promueve un directorio, cualquier operación posterior
será hecha con la semántica completa de la que normalmente disfrutan
los usuarios de <emphasis>Unix</emphasis> y <emphasis>Linux</emphasis>. Y cualquier subdirectorio
creado desde entonces (en un directorio ya promovido) será 
promovido silenciosamente.
</para>

<para>
Esta característica permite organizar la partición <emphasis>DOS</emphasis> en
material del <emphasis>DOS</emphasis> y material del <emphasis>Linux</emphasis>. Es importante
entender que el fichero <literal remap="tt">--linux-.---</literal> ocupa algo de espacio
(generalmente 2k por directorio). El <emphasis>DOS</emphasis> habitualmente utiliza
bloques grandes (de hasta 16k para una partición de 500M), así
que evitar que haya ficheros <literal remap="tt">--linux-.---</literal> en todas partes
puede resultar beneficioso.
</para>

</sect2>

<sect2>
<title>Cómo promover: <literal remap="tt">/sbin/umssync</literal></title>

<para>
Se puede promover un directorio en cualquier momento usando
<literal remap="tt">/sbin/umssync</literal>. Se puede usar en cualquier momento.
Al promover un directorio ocurre lo siguiente
</para>

<para>

<itemizedlist>
<listitem>

<para>
Se crea un <literal remap="tt">--linux-.---</literal>.
</para>
</listitem>
<listitem>

<para>
Se establece una relación uno a uno (biyectiva) entre el
contenido del fichero <literal remap="tt">--linux-.---</literal> y lo que en ese
momento sea el contenido del directorio.
</para>
</listitem>

</itemizedlist>

</para>

<para>
<literal remap="tt">/sbin/ummsync</literal> conserva un fichero <literal remap="tt">--linux-.---</literal>
ya existente. No lo crea de la nada todas las veces. Simplemente
le añade las entradas que le falten (Ficheros creados durante una
sesión <emphasis>DOS</emphasis>) y le quita las entradas que se refieran a ficheros
que ya no existen en el directorio <emphasis>DOS</emphasis>. De ahí le viene
el nombre. <literal remap="tt">umssync</literal> pone <emphasis>--linux-.---</emphasis> en sincronismo
con el directorio <emphasis>DOS</emphasis> que hay debajo.
</para>

</sect2>

<sect2>
<title>Uso de <literal remap="tt">/sbin/umssync</literal> durante el arranque</title>

<para>
Es una buena idea poner, si no existiera, una llamada a
<literal remap="tt">/sbin/umssyc</literal> al final del fichero <literal remap="tt">/etc/rc.d/rc.S</literal>. La
línea siguiente es adecuada para la mayor parte de los sistemas:
</para>

<para>

<screen>
/sbin/umssync -r99 -c -i+ /
</screen>

</para>

<para>
La opción <literal remap="tt">-c</literal> evita que <literal remap="tt">umssync</literal> promueva directorios.
Solamente actualizará los ficheros <literal remap="tt">--linux-.---</literal> donde
ya existan.
</para>

<para>
Esa línea tiene utilidad si se accede al directorio <emphasis>Linux</emphasis> durante
las sesiones <emphasis>DOS</emphasis>. No existe en <emphasis>Linux</emphasis> una manera eficiente
de decir que un directorio ha sido modificado por el <emphasis>DOS</emphasis> así
que <literal remap="tt">umsdos</literal> no puede hacer un <emphasis>umssync</emphasis> según se necesite.
</para>

</sect2>

<sect2>
<title>Cómo DESpromover</title>

<para>
Simplemente hay que eliminar el fichero <literal remap="tt">--linux-.---</literal> usando
el <emphasis>DOS</emphasis>. Aunque quien lo haga acabará arrepintiéndose.
</para>

</sect2>

<sect2>
<title>¿Qué pasa con los ficheros creados durante una sesión <emphasis>DOS</emphasis>?</title>

<para>
A menos que se use <literal remap="tt">umssync</literal> en un directorio donde el <emphasis>DOS</emphasis>
haya añadido o borrado ficheros, se advertirán algunas dificultades:
</para>

<para>

<itemizedlist>
<listitem>

<para>
No hace que se caiga el sistema ni causa grandes problemas,
sólo incomodidad :-)
</para>
</listitem>
<listitem>

<para>
Los ficheros creados por el <emphasis>DOS</emphasis>:

<itemizedlist>
<listitem>

<para>
Serán invisibles desde <emphasis>Linux</emphasis>.
</para>
</listitem>
<listitem>

<para>
Cuando se intente crear un fichero con el mismo nombre,
dará un mensaje de error diciendo que el fichero
ya existe.
</para>
</listitem>
<listitem>

<para>
Esto, más que un verdadero problema, crea confusión.
No daña el sistema de ficheros.
</para>
</listitem>

</itemizedlist>

</para>
</listitem>
<listitem>

<para>
Los ficheros borrados por el <emphasis>DOS</emphasis> no causan problemas.
<literal remap="tt">umsdos</literal> advertirá su ausencia en el primer acceso.
Se mostrará (y generalmente se escribirá en 
<literal remap="tt">/var/adm/syslog</literal>) un mensaje al respecto.
</para>
</listitem>

</itemizedlist>

</para>

</sect2>

</sect1>

<sect1>
<title>Instalación/Desinstalación y algunos truquillos</title>

<para>
La instalación de un sistema basado en <literal remap="tt">umsdos</literal> no difiere
gran cosa de la instalación de un sistema <emphasis>Linux</emphasis>
ordinario (basado en <emphasis>Ext2</emphasis>).
</para>

<para>
Hay dos diferencias fundamentales.
</para>

<sect2>
<title>La pseudorraíz <literal remap="tt">/mnt/linux</literal></title>

<para>
Los pasos normales de una instalación son
</para>

<para>

<orderedlist>
<listitem>

<para>
Hacer una partición con <literal remap="tt">fdisk</literal> y formatearla.
</para>
</listitem>
<listitem>

<para>
Montarla en el directorio <literal remap="tt">/mnt</literal> de nuestro disco raíz de
instalación.
</para>
</listitem>
<listitem>

<para>
Copiar todos los paquetes en <literal remap="tt">/mnt</literal>.
</para>
</listitem>

</orderedlist>

</para>

<para>
El paso 1 no es necesario con <literal remap="tt">umsdos</literal> (¿acaso no era el objetivo
de <literal remap="tt">umsdos</literal> no tener que reformatear?).
</para>

<para>
Es posible instalar un sistema <literal remap="tt">umsdos</literal> simplemente copiando
todos los paquetes en <literal remap="tt">/mnt</literal>. Funcionaría, pero crearía
una ristra de subdirectorios en el directorio raíz del <emphasis>DOS</emphasis>
(<literal remap="tt">C:</literal>) y no sería agradable. Esa es la razón por la que todas
las instalaciones con <literal remap="tt">umsdos</literal> usan la pseudorraíz. Y es la
gran diferencia entre una instalación normal con <emphasis>Ext2</emphasis> y una
con <literal remap="tt">umsdos</literal>: Los ficheros se copian en <literal remap="tt">/mnt/linux</literal>.
</para>

</sect2>

<sect2>
<title>Preparar <literal remap="tt">/mnt/linux</literal></title>

<para>
<literal remap="tt">/mnt/linux</literal> no es un directorio ordinario. Tiene que ser
promovido para que maneje correctamente los nombres largos
de <emphasis>Linux</emphasis> y los ficheros especiales (enlaces, dispositivos).
Los pasos requeridos para poner a punto <literal remap="tt">/mnt/linux</literal> son:
</para>

<para>

<orderedlist>
<listitem>

<para>
<literal remap="tt">mkdir /mnt/linux</literal>
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">umssync /mnt/linux</literal>
</para>
</listitem>

</orderedlist>

</para>

<para>
¡Y ya está!
</para>

</sect2>

<sect2>
<title>Asegurarse de que <literal remap="tt">/mnt/linux/</literal> está correctamente configurado.</title>

<para>
A pesar de que la puesta a punto de <literal remap="tt">/mnt/linux</literal> es muy
sencilla, hay circulando por ahí muchos paquetes de instalación
que lo hacen mal. ¿Cómo es posible?
</para>

<para>
El problema de instalación más importante suele provenir
del uso de versiones incompatibles del programa <literal remap="tt">umssync</literal>.
<literal remap="tt">umsdos</literal> fue actualizado en Linux 1.1.88
(No lo recuerdo con exactitud) y quedó un fallo
en <literal remap="tt">umssync</literal>. Para evitar confusión entre la
comunidad de <emphasis>Linux</emphasis>, se decidió incrementar el
nivel de compatibilidad requerido para todas las
herramientas de <literal remap="tt">umsdos</literal>. Las antiguas versiones
de las utilidades fueron simplemente rechazadas.
</para>

<para>
Parece que muchas distribuciones no han actualizado
el <literal remap="tt">umssync</literal> de sus disquetes de instalación.
</para>

<para>
Todavía hay muchas distribuciones en ese estado por ahí. El
resultado de hecho es que el directorio <literal remap="tt">/mnt/linux</literal> no
se promueve y se truncan todos los nombres largos de fichero y
se rechazan todos los ficheros especiales.
</para>

<para>
Es posible comprobar si algo ha ido mal en los primeros momentos
de la instalación. Gracias al mecanismo de pseudoconsolas de
<emphasis>Linux</emphasis> se puede hacer sin salir del programa de instalación.
Hay que seguir los siguientes pasos:
</para>

<para>

<orderedlist>
	<listitem>

	<para>
	Pulsar <literal remap="tt">Alt-F2</literal> (la tecla <literal remap="tt">Alt</literal> al mismo tiempo
	que la tecla <literal remap="tt">F2</literal>).
	</para>
	</listitem>
	<listitem>

	<para>
	entrar como superusuario (<literal remap="tt">root</literal>).
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">cd /mnt/linux</literal>

	Si eso falla, es que se está haciendo demasiado pronto.
	Al terminar la selección de paquetes es un buen momento
	para hacerlo.
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">&#62;TOTO</literal>
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">ls -l</literal>

Debería aparecer un fichero vacío llamado <literal remap="tt">TOTO</literal> en letras
mayúsculas. Si aparece en minúsculas algo ha ido mal.
Intentaremos ejecutar <literal remap="tt">umssync</literal> de nuevo.
<literal remap="tt">umssync</literal> puede usarse una y otra vez sin ningún problema.

<literal remap="tt">umssync .</literal>
(el punto es parte de la orden)
Si no aparece ningún mensaje de error, volveremos a hacer
la comprobación del <literal remap="tt">TOTO</literal>. Si aparece <literal remap="tt">TOTO</literal>
correctamente todo está bien. La instalación tiene algo
extraño, pero lo hemos solucionado.

</para>
</listitem>
<listitem>

<para>
Pulsar <literal remap="tt">Alt-F1</literal> para volver a la pantalla de instalación.
</para>
</listitem>

</orderedlist>

</para>

<para>
Si la comprobación falla, la mejor solución es hacerse con
un disco de instalación más moderno. Normalmente se puede
arreglar el disco raíz de instalación poniéndole una
versión más moderna de <literal remap="tt">umssync</literal>. No es difícil, pero
se requiere un sistema <emphasis>Linux</emphasis> en funcionamiento. Simplemente
hay que montar el disco raíz y reemplazar el <literal remap="tt">umssync</literal>
problemático por uno nuevo.
</para>

</sect2>

<sect2>
<title><literal remap="tt">Oops releasing pseudo root ...</literal></title>

<para>
La mayor parte de las instalaciones <literal remap="tt">umsdos</literal> que fallan
lo hacen mostrando ese curioso mensaje. Por muy extraño que
parezca el mensaje, no se trata de un bug (<emphasis>error</emphasis>) en
<literal remap="tt">umsdos</literal>. Estas son las causas conocidas:
</para>

<para>

<itemizedlist>
<listitem>

<para>
La más común

La instalación de <emphasis>Slackware</emphasis> trata de configurar un
fichero de intercambio (<emphasis>swap</emphasis>) en los primeros momentos
de la instalación.  Para hacerlo, pide que se seleccione
una partición (un disco del DOS), entonces lo monta y
configura el fichero de intercambio.

Cuando se instala un sistema <emphasis>Slackware</emphasis>, se debe
configurar la partición receptora antes de instalar nada.
Esto normalmente significa que se monta la partición
<emphasis>DOS</emphasis> en <literal remap="tt">/mnt</literal>, se crea el directorio
<literal remap="tt">/mnt/linux</literal>, y se le aplica <literal remap="tt">umssync</literal>.

De ahí es de donde viene la mayor parte de los problemas.
La mayoría de los usuarios olvidan el paso de
"configuración de la partición receptora" (<emphasis>"setup target
partition"</emphasis>) y pasan sin más al resto de la instalación.
Como <literal remap="tt">/mnt</literal> está ya montado, este error pasa
desapercibido.
Eso significa que <literal remap="tt">/mnt/linux</literal> no ha sido creado
adecuadamente (No ha sido promovido). Ningún fichero
especial, ni enlace, ni fichero con nombre largo se
podrá crear correctamente.

</para>
</listitem>
<listitem>

<para>
Programa <literal remap="tt">umssync</literal> no válido

No se ha creado <literal remap="tt">/mnt/linux</literal> correctamente. Esto está
generalmente causado por un programa <literal remap="tt">umssync</literal>
inadecuado en el disco de instalación raíz.

</para>
</listitem>
<listitem>
<para>
Un antiguo error en <literal remap="tt">umsdos</literal>
</para>
<para>
Había un error en <literal remap="tt">umsdos</literal> previo a <emphasis>Linux 1.2.2</emphasis>.
El modo pseudo-root no se activaba adecuadamente si no
existía el fichero <literal remap="tt">/etc/init</literal>. Ahora <literal remap="tt">init</literal>
se ubica en <literal remap="tt">/sbin</literal>. Se puede solucionar esto
haciéndose con un nuevo núcleo. Eso es lo recomendado
puesto que había otro error que se solucionó en la
versión 1.2.2.
</para>

<para>
Si no es posible la actualización, habrá que hacer lo
siguiente
</para>

<para>

<orderedlist>
	<listitem>

	<para>
	Arrancar con el disquete de instalación.
	</para>
	</listitem>
	<listitem>

	<para>
	Entrar como superusuario.
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">mount -t umsdos /dev/hdXX /mnt</literal>

	Donde <literal remap="tt">/dev/hdXX</literal> es la partición <emphasis>DOS</emphasis>.
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">cd /mnt/linux/etc</literal>
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">ln -s ../sbin/init init</literal>
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">cd /</literal>
	</para>
	</listitem>
	<listitem>

	<para>
	<literal remap="tt">Ctrl-Alt-Del</literal>
	</para>
	</listitem>
	<listitem>

	<para>
	Arrancar el sistema <literal remap="tt">umsdos</literal> normalmente.
	</para>
	</listitem>

</orderedlist>

</para>
</listitem>

</itemizedlist>
</para>

<para>
Por desgracia, los dos primeros problemas de instalación producen
una instalación completamente inservible. Se debe desinstalar
(Véase la sección siguiente) y volver a instalar.
</para>

</sect2>

<sect2>
<title>Cómo DESinstalar un sistema <literal remap="tt">umsdos</literal></title>

<para>
Una cosa que sorprende agradablemente de <literal remap="tt">umsdos</literal> y su
mecanismo de pseudorraíz es que se puede DESinstalar sin
problemas. Simplemente hay que arrancar en <emphasis>DOS</emphasis> y borrar
recursivamente el directorio <literal remap="tt">linux</literal>. Eso es todo. <literal remap="tt">umsdos</literal>
no requiere ningún controlador especial en el config.sys, ni
crea nada extraño fuera del directorio <literal remap="tt">linux</literal>.
</para>

</sect2>

<sect2>
<title>Mover un sistema <literal remap="tt">umsdos</literal> a otro disco <emphasis>DOS</emphasis></title>

<para>
Se puede hacer desde <emphasis>Linux</emphasis> o desde <emphasis>DOS</emphasis>.  Sólamente hay
que copiar recursivamente el directorio <literal remap="tt">linux</literal> de un disco al
otro. Después hay que ajustar el sistema de arranque (generalmente
el programa loadlin) y el fichero <literal remap="tt">/etc/fstab</literal>.
</para>

<para>
<literal remap="tt">umsdos</literal> puede vivir en cualquier disco <emphasis>DOS</emphasis>. No hay necesidad
de instalarlo en el disco <literal remap="tt">C:</literal>, ni en el primer disco duro.
No importa en absoluto.
</para>

<para>
De hecho, se puede decidir tener varias instalaciones <literal remap="tt">umsdos</literal>
en distintos discos simplemente para experimentar.
</para>

</sect2>

<sect2>
<title>Cómo instalar 50 sistemas con <literal remap="tt">umsdos</literal></title>

<para>
¿Y si instalamos un montón de sistemas <emphasis>Linux</emphasis> en un santiamén?
</para>

<para>
Los sistemas <literal remap="tt">umsdos</literal> viven en un mundo <emphasis>DOS</emphasis>. Se puede
sacar provecho de esto si se quiere instalar <emphasis>Linux</emphasis> fácilmente.
</para>

<para>
Se puede instalar y configurar un sistema con <literal remap="tt">umsdos</literal> en
un ordenador, y, cuando se está satisfecho con la configuración
y los distintos paquetes seleccionados, arrancar en <emphasis>DOS</emphasis> y
copiar el directorio <literal remap="tt">linux</literal> completo al servidor de ficheros
de <emphasis>DOS</emphasis> (en caso de que exista, claro. Tal vez un 
PC-NFS). Entonces se va a otro ordenador con <emphasis>DOS</emphasis> y simplemente
se copian los ficheros del disco de red al disco duro local.
Eso es todo. Sólamente habrá que ajustar el fichero .bat de
arranque (<emphasis>Loadlinx</emphasis>) y ya.
</para>

<para>
Con unos ajustes mínimos (nombre de la máquina, dirección IP),
cualquiera puede instalar un sistema <emphasis>Linux</emphasis> en un minuto.
</para>

<para>
Los lectores interesados apuntarán que instalar un sistema
<emphasis>Linux</emphasis> copiando un sistema en funcionamiento también 
sirve para cualquier otro tipo de sistema <emphasis>Linux</emphasis>, incluyendo
los basados en <emphasis>Ext2</emphasis>.
</para>

<para>
Una de las bellezas de <emphasis>Linux</emphasis> es que no hay fichero ocultos
que tengan que ser instalados por un mágico programa de instalación.
</para>

</sect2>

</sect1>

<sect1>
<title>Disponer una sección <emphasis>Linux</emphasis> en una partición <emphasis>DOS</emphasis></title>

<para>
Incluso para los usuarios de <emphasis>Ext2</emphasis> (sistema de ficheros
nativo de <emphasis>Linux</emphasis>) tiene utilidad <literal remap="tt">umsdos</literal>. La siguiente
es una situación frecuente:
</para>

<para>

<itemizedlist>
<listitem>

<para>
Como <emphasis>Linux</emphasis> es tu sistema operativo preferido, la 
partición de <emphasis>Linux</emphasis> empieza a llenarse más y más.
</para>
</listitem>
<listitem>

<para>
Tu partición de <emphasis>DOS</emphasis> está medio vacía y cogiendo polvo.
</para>
</listitem>
<listitem>

<para>
De repente te quedas sin espacio en la partición <emphasis>Ext2</emphasis>.
</para>
</listitem>
<listitem>

<para>
Aún no estás seguro de querer deshacerte del <emphasis>DOS</emphasis>.
</para>
</listitem>

</itemizedlist>

</para>

<para>
<literal remap="tt">umsdos</literal> puede salvar la situación. Se puede poner un directorio
<emphasis>Linux</emphasis> en la partición de <emphasis>DOS</emphasis> y usarlo sin restricciones
para <emphasis>Linux</emphasis>. Por ejemplo, pongamos que queremos crear un
nuevo directorio llamado <literal remap="tt">"extra"</literal> en el disco <literal remap="tt">C:</literal>. Y
queremos que se comporte como un directorio normal de <emphasis>Linux</emphasis>.
Habría que hacer lo siguiente (suponiendo que <literal remap="tt">C:</literal> es <literal remap="tt">/dev/hda1</literal>):
</para>

<para>

<screen>
mkdir /c
/sbin/mount -t umsdos /dev/hda1 /c
mkdir /c/extra
umssync /c/extra
</screen>

</para>

<para>
Hay que ser superusuario (<literal remap="tt">root</literal>) para hacerlo.
</para>

<para>
Si se configura el <literal remap="tt">/etc/fstab</literal> adecuadamente, siempre 
se tendrá acceso al directorio <literal remap="tt">/c/extra</literal>.
</para>

</sect1>

<sect1 id="porque">
<title>POR-QUÉ-UMSDOS </title>

<para>
No basta con explicar cómo funciona o se instala un sistema
con <literal remap="tt">umsdos</literal>. La mayoría de la gente busca algunos consejos
sobre si usar <literal remap="tt">umsdos</literal> o no.
</para>

<sect2>
<title>El objetivo de <literal remap="tt">umsdos</literal></title>

<para>
El objetivo de <literal remap="tt">umsdos</literal> era facilitar la instalación de <emphasis>Linux</emphasis>.
Otro objetivo era facilitar su DESinstalación. La idea detrás
de esto era favorecer la difusión de <emphasis>Linux</emphasis>.
La instalación de un nuevo sistema operativo es siempre problemática.
<emphasis>OS/2</emphasis> por ejemplo enguarrina tranquilamente el directorio
raíz del disco <literal remap="tt">C:</literal> con una ristra de nuevos directorios.
Si eres tan inteligente como yo, además te borra los ficheros
<literal remap="tt">config.sys</literal> y <literal remap="tt">autoexec.bat</literal> :-(
</para>

<para>
El invento de la pseudorraíz de <literal remap="tt">umsdos</literal> evita esta invasión
no deseada. <emphasis>Linux</emphasis> se puede DESinstalar sin ningún
efecto lateral.
</para>

</sect2>

<sect2>
<title>Quién lo necesita</title>

<para>
Si se tiene un disco duro pequeño, <literal remap="tt">umsdos</literal> permite compartir
el espacio del disco entre <emphasis>DOS</emphasis> y <emphasis>Linux</emphasis>. Un disco de
menos de 300M es en mi opinión un disco pequeño. Baso esta 
opinión en el tamaño de los diversos paquetes disponibles hoy
día. Un popular procesador de textos se puede cepillar unos
70 megaoctetos si se seleccionan todas las opciones.
</para>

<para>
Si se tiene un disco duro más grande, se debe tomar en consideración
la opción de tener una partición dedicada para <emphasis>Linux</emphasis> donde
use el sistema de ficheros <emphasis>Ext2</emphasis>. <emphasis>Ext2</emphasis> utiliza un tamaño
de bloque más pequeño que <emphasis>DOS</emphasis> (exactamente 1K) por lo que
instalar muchos ficheros pequeños utiliza menos espacio que en
una partición <literal remap="tt">umsdos</literal>.
</para>

</sect2>

<sect2>
<title>Acerca de la eficiencia</title>

<para>
Lo siguiente es aplicable a <literal remap="tt">umsdos</literal> si se le compara con <emphasis>Ext2</emphasis>.
</para>

<para>

<itemizedlist>
<listitem>

<para>
El manejo de directorios es más rápido en <emphasis>Ext2</emphasis>. Esto
es debido a la sobrecarga de la estructura de doble
directorio de <literal remap="tt">umsdos</literal>.
</para>
</listitem>
<listitem>

<para>
El acceso a los ficheros (lectura y escritura) es probablemente
más rápido en <literal remap="tt">umsdos</literal> que en <emphasis>Ext2</emphasis>. Esto es debido a
la simplicidad del sistema de ficheros con <emphasis>FAT</emphasis> usado
por el <emphasis>DOS</emphasis>.

Téngase en cuenta que esta simplicidad tiene un coste:


<itemizedlist>
<listitem>

<para>
Un máximo de alrededor de 65.000 ficheros o bloques
por partición. Esto también significa que una
partición de 500 megaoctetos utiliza un tamaño de
bloque de 16K. En otras palabras, un fichero
que contenga un sólo octeto consumirá 16K de espacio
de disco.
</para>
</listitem>
<listitem>

<para>
Todo es controlado por una <literal remap="tt">FAT</literal> ubicada al principio
del disco duro. Esto hace probablemente más frágil
al sistema de ficheros <emphasis>DOS</emphasis>.
</para>
</listitem>
<listitem>

<para>
No se toman precauciones para evitar la fragmentación
de los ficheros. Un sistema <literal remap="tt">umsdos</literal> se
usará generalmente como estación de trabajo de
un sólo usuario. En ese caso tiene demasiada
importancia. Si se usa como sistema multiusuario,
los ficheros se esparcirán por todo el disco,
reduciendo la eficiencia de los accesos a
los mismos.
</para>
</listitem>

</itemizedlist>

</para>
</listitem>
<listitem>

<para>
Los enlaces simbólicos se guardan en ficheros normales. Si
se
intenta tener muchos, se encontrará que <literal remap="tt">umsdos</literal>
usa bastante más espacio de disco que <emphasis>Ext2</emphasis>.
</para>
</listitem>

</itemizedlist>

</para>

</sect2>

</sect1>

<sect1 id="Grupos">
<title>Anexo: El INSFLUG </title>

<para>
El <emphasis>INSFLUG</emphasis> forma parte del grupo internacional 
<emphasis remap="it">Linux Documentation Project</emphasis>, 
encargándose de las traducciones al castellano de los Howtos (Comos),
así como la producción de documentos originales en aquellos casos
en los que no existe análogo en inglés.
</para>

<para>
En el <emphasis remap="bf">INSFLUG</emphasis> se orienta preferentemente a la traducción de documentos
breves, como los <emphasis>COMOs</emphasis> y <emphasis>PUFs</emphasis> (<emphasis remap="bf">P</emphasis>reguntas de
<emphasis remap="bf">U</emphasis>so <emphasis remap="bf">F</emphasis>recuente, las <emphasis remap="it">FAQs</emphasis>. <literal remap="tt">:)</literal> ), etc.
</para>

<para>
Diríjase a la sede del INSFLUG para más información al respecto.
</para>

<para>
En la sede del INSFLUG encontrará siempre las <emphasis remap="bf">últimas</emphasis> versiones 
de las traducciones:  <literal remap="tt"><ulink
url="http://www.insflug.org"
>www.insflug.org</ulink
></literal>. Asegúrese de comprobar cuál es la última versión 
disponible en el Insflug antes de bajar un documento de un servidor réplica.
</para>

<para>
Se proporciona también una lista de los servidores
réplica (<emphasis remap="it">mirror</emphasis>) del Insflug más cercanos a Vd.,  
e información relativa a otros recursos en castellano.
</para>

<para>
Francisco José Montilla, <literal remap="tt"><ulink
url="mailto:pacopepe@insflug.org"
>pacopepe@insflug.org</ulink
></literal>.
</para>

</sect1>

</article>
