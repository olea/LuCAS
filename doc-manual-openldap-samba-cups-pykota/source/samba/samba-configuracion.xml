<?xml version="1.0" encoding="ISO-8859-1" ?>

<chapter id="samba-configuracion-samba">

<chapterinfo>
	<keywordset>
		<keyword>Samba</keyword>
		<keyword>configuración</keyword>
	</keywordset>
</chapterinfo>

<title>Configuración de Samba</title>

<sect1 id="samba-configuracion-samba-introduccion">
	<title>Introducción</title>

	<para>Este capítulo está dedicado a la configuración de Samba, primero se mostrará como es la
	estructura de un archivo de configuración para Samba y luego se procederá a mostrar las distintas
	opciones de configuración para obtener el resultado esperado.</para>

	<note><para>Para obtener la configuración de Samba se han utilizado las siguientes entradas
	bibliográficas, a parte de las páginas del manual que provee Samba:
	<xref linkend="bibliografia-lemaire-01"/>, <xref linkend="bibliografia-syroid-01"/>,
	<xref linkend="bibliografia-syroid-02"/>, <xref linkend="bibliografia-milne-01"/>,
	<xref linkend="bibliografia-milne-02"/>, <xref linkend="bibliografia-ts-eckstein-collier-brown-01"/>,
	<xref linkend="bibliografia-vernooij-terpstra-carter-01"/>,
	<xref linkend="bibliografia-coupeau-01"/>.</para></note>

</sect1>

<!-- ARCHIVO -->

<sect1 id="samba-configuracion-estructura-smb.conf">
	<title>Estructura del archivo <filename>smb.conf</filename></title>

	<para>La configuración de Samba se almacena en el archivo <filename>smb.conf</filename>, que
	en el sistema Debian GNU/Linux se encuentra en el directorio
	<filename class="directory">/etc/samba/</filename>. La edición de este archivo se puede hacer
	utilizando un editor de textos o haciendo uso de herramientas gráficas, como la que provee
	Samba: <application>SWAT</application> (vea el <xref linkend="samba-instalacion-configuracion-swat"/>
	para más información).</para>

	<sect2 id="samba-configuracion-sintaxis-smb.conf">
		<title>Sintaxis</title>

		<para>El archivo <filename>smb.conf</filename> utiliza la misma sintaxis que los antiguos
		ficheros .ini de Windows 3.1: cada archivo consistía en varias secciones, las cuales
		comenzaban con el nombre de la sección entre corchetes ([]) en una nueva línea. Cada
		una contenía cero o más pares llave/valor separados por un signo de igualdad (=). El
		archivo de configuración de Samba es un archivo en texto plano, por lo que se puede
		editar con cualquier editor de textos.</para>

		<para>Cada sección en el archivo <filename>smb.conf</filename> representa un recurso
		compartido en el servidor Samba. La sección <quote>global</quote> es especial,
		ya que contiene opciones que se aplican a todo el servidor Samba y no sólo a un
		recurso compartido en particular.</para>

		<para>Un archivo de configuración realmente pequeño, podría ser:</para>

		<example id="samba-configuracion-sintaxis-smb.conf-ejemplo1">
			<title>Un archivo <filename>smb.conf</filename> mínimo</title>

<programlisting>[global]
workgroup = GRUPODETRABAJO
netbios name = MINOMBRE

[recurso-compartido1]
path = /tmp

[recurso-compartido2]
path = /otro_directorio_compartido
comment = Algunos archivos aleatorios</programlisting>
		</example>
	</sect2>

	<sect2 id="samba-configuracion-comprobar-smb.conf">
		<title>Comprobando el archivo <filename>smb.conf</filename></title>

		<para>Es importante validar el contenido del archivo <filename>smb.conf</filename> haciendo
		uso del programa <command>testparm</command>. Si <command>testparm</command> se ejecuta
		correctamente, listará los servicios cargados.</para>

		<para>En el <xref linkend="samba-configuracion-comprobar-smb.conf-ejemplo1"/> se comprobará
		el archivo que viene por defecto (vea el apéndice <xref linkend="samba-smb.conf-por-defecto"/>)
		con el paquete de Samba de la distribución Debian GNU/Linux, una vez instalado el paquete.</para>

		<example id="samba-configuracion-comprobar-smb.conf-ejemplo1">
			<title>Comprobando el archivo por defecto <filename>smb.conf</filename> con
			<command>testparm</command></title>

<screen><prompt>#</prompt> <userinput>/usr/bin/testparm </userinput>
<computeroutput>Load smb config files from /etc/samba/smb.conf
Processing section "[homes]"
Processing section "[printers]"
Processing section "[print$]"
Loaded services file OK.
Server role: ROLE_STANDALONE
Press enter to see a dump of your service definitions

<userinput>[ENTER]</userinput>
# Global parameters
[global]
        workgroup = GSRDOMAIN
        server string = %h server (Samba %v)
        obey pam restrictions = Yes
        passdb backend = tdbsam, guest
        passwd program = /usr/bin/passwd %u
        passwd chat = *Enter\snew\sUNIX\spassword:* %n\n *Retype\snew\sUNIX\spassword:* %n\n .
        syslog = 0
        log file = /var/log/samba/log.%m
        max log size = 1000
        dns proxy = No
        panic action = /usr/share/samba/panic-action %d
        invalid users = root

[homes]
        comment = Home Directories
        create mask = 0700
        directory mask = 0700
        browseable = No

[printers]
        comment = All Printers
        path = /tmp
        create mask = 0700
        printable = Yes
        browseable = No

[print$]
        comment = Printer Drivers
        path = /var/lib/samba/printers</computeroutput></screen>
		</example>
	</sect2>

</sect1>

<sect1 id="samba-configuracion-samba-opciones">
	<title>Ajustando el archivo de configuración de Samba</title>

	<sect2 id="samba-configuracion-samba-opciones-introduccion">
		<title>Introducción</title>

		<para>En esta sección se configurará Samba como un Controlador Primario de Dominio
		que almacena su base de datos <acronym>SAM</acronym> en un servidor OpenLDAP.</para>

		<para>Para la configuración se asumirá que:</para>

		<itemizedlist mark="fillcircle">
			<listitem>
				<para>El nombre del dominio será: <emphasis>GSRDOMAIN</emphasis></para>
			</listitem>
			<listitem>
				<para>El nombre del servidor Netbios será: <emphasis>TODOSCSI</emphasis></para>
			</listitem>
			<listitem>
				<para>El directorio home de los usuarios estará en:
				<filename class="directory">/home/samba/users/NOMBREUSUARIO</filename></para>
			</listitem>
			<listitem>
				<para>Los perfiles móviles se almacenarán en:
				<filename class="directory">/home/samba/profiles/NOMBREUSUARIO</filename></para>
			</listitem>
		</itemizedlist>
	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-global">
		<title>[global] - sección global</title>

		<para>En la sección global se configurarán los parámetros globales del servidor. Entre otras
		cosas, se definirán los programas que serán utilizados para que un usuario pueda cambiar su
		clave (<emphasis>passwd program</emphasis>) y el diálogo que se establecerá entre el servidor
		y el usuario durante este cambio.</para>

		<para>La opción <quote>add user script</quote> permite al demonio <application>smb</application>
		añadir, como usuario root, una nueva máquina. Cuando una máquina contacta con el dominio,
		este script es llamado y la nueva máquina es añadida al dominio. Esto hace que la administración
		de las cuentas para las máquinas sea muy sencilla. Por razones de seguridad, no todas las
		máquinas pueden entrar en el dominio, sólo aquellas cuyo administrador tenga una cuenta
		con los privilegios suficientes.</para>

		<para>En las secciones siguientes se mostrarán los parámetros más importantes de la configuración
		de Samba, en el <xref linkend="samba-smb.conf-completo"/> se muestra un archivo
		de configuración completo para Samba.</para>

		<sect3 id="samba-configuracion-samba-opciones-global-busqueda-identificacion">
			<title>[global] - Búsqueda/Identificación</title>

<programlisting>[global]
   workgroup = GSRDOMAIN <co id="workgroup"/>
   netbios name = TODOSCSI <co id="netbios_name"/>
   server string = SAMBA-LDAP PDC server <co id="server_string"/></programlisting>

			<calloutlist>
				<callout arearefs="workgroup">
					<para>Definición del nombre del dominio.</para>
				</callout>
				<callout arearefs="netbios_name">
					<para>Nombre Netbios por el cual el servidor Samba se va a conocer.</para>
				</callout>
				<callout arearefs="server_string">
					<para>Descripción del servidor.</para>
				</callout>
			</calloutlist>
		</sect3>

		<sect3 id="samba-configuracion-samba-opciones-global-autentificacion">
			<title>[global] - Autentificación</title>

<programlisting>   security = user <co id="security"/>
   encrypt passwords = true <co id="encrypt_passwords"/>
   passdb backend = ldapsam:ldap://gsr.pt <co id="passdb_backend"/>
   guest account = guest <co id="guest_account"/>
   invalid users = root <co id="invalid_users"/>
   unix password sync = yes <co id="unix_password_sync"/>
   passwd program = /usr/sbin/smbldap-passwd -o %u <co id="passwd_program"/>
   passwd chat = *Enter\snew\sUNIX\spassword:* %n\n *Retype\snew\sUNIX\spassword:* %n\n . <co id="passwd_chat"/>
   </programlisting>

			<calloutlist>
				<callout arearefs="security">
					<para>Opción necesaria para la administración de dominios por parte de Samba.</para>
				</callout>
				<callout arearefs="encrypt_passwords">
					<para>Se activa el cifrado para el almacenado de las claves</para>
				</callout>
				<callout arearefs="passdb_backend">
					<para>Se asigna a esta opción el valor: <quote>ldapsam:ldap://gsr.pt</quote>,
					indicándole a Samba que las claves se almacenarán y recuperarán del servidor
					<acronym>LDAP</acronym> definido.</para>
				</callout>
				<callout arearefs="guest_account">
					<para>Nombre del usuario <quote>invitado</quote>, este podrá acceder
					a aquellos recursos con el parámetro <quote>guest ok</quote> sin
					autentificarse.</para>
				</callout>
				<callout arearefs="invalid_users">
					<para>Lista de usuarios a los cuales no se le permite el acceso a Samba.</para>
				</callout>
				<callout arearefs="unix_password_sync">
					<para>Se activa la sincronización entre las claves Unix y las claves Samba.</para>
				</callout>
				<callout arearefs="passwd_program">
					<para>Programa utilizado durante el cambio de clave de un usuario. Vea el
					<xref linkend="smbldap-tools"/> para saber como obtener esta herramienta.</para>
				</callout>
				<callout arearefs="passwd_chat">
					<para>Texto que se mostrará durante el cambio de una clave mediante Samba.</para>
				</callout>
			</calloutlist>
		</sect3>

		<sect3 id="samba-configuracion-samba-opciones-global-ldap">
			<title>[global] - <acronym>LDAP</acronym></title>
		
<programlisting>   ldap admin dn = cn=admin,dc=gsr,dc=pt <co id="ldap-admin-dn"/>
;   ldap server = gsr.pt <co id="ldap-server"/>
;   ldap port = 389 <co id="ldap-port"/>
   ldap ssl = start_tls <co id="ldap-ssl"/>
   ldap delete dn = no <co id="ldap-delete-dn"/>
   ldap filter = <![CDATA[(&(uid=%u)(objectclass=sambaSamAccount))]]> <co id="ldap-filter"/>
   ldap suffix = ou=people,dc=gsr,dc=pt <co id="ldap-suffix"/>
   ldap user suffix = ou=people <co id="ldap-user-suffix"/>
   ldap group suffix = ou=groups <co id="ldap-group-suffix"/>
   ldap machine suffix = ou=machines <co id="ldap-machine-suffix"/></programlisting>
		
			<calloutlist>
				<callout arearefs="ldap-admin-dn">
					<para>Esta línea le dice a Samba quien es el administrador del directorio
					<acronym>LDAP</acronym>. Este será el usuario empleado por Samba cuando
					se realicen operaciones de añadir, borrar o modificar cuentas de usuario.</para>
				</callout>
				<callout arearefs="ldap-server">
					<para>Parámetro que contiene el <acronym>FQDN</acronym> del servidor
					<acronym>ldap</acronym>. Se necesita para encontrar la información sobre las cuentas
					de usuario. Este parámetro se comenta, ya que parece que Samba no lo
					reconoce.</para>
				</callout>
				<callout arearefs="ldap-port">
					<para>Indica en que puerto está escuchando <acronym>LDAP</acronym>. El puerto
					389 es el puerto estándar para las conexiones sin cifrado; el 636
					es el puerto estándar para las conexiones con cifrado. Si la línea
					<quote>ldap ssl</quote> posee el valor <quote>on</quote>, Samba intentará
					automáticamente conectarse por el puerto 636 para contactar con el servidor
					<acronym>LDAP</acronym>. Este parámetro se comenta, ya que parece que Samba no lo
		            reconoce.</para>
				</callout>
				<callout arearefs="ldap-ssl">
					<para>Opción que determina si cifrar o no las comunicaciones entre el servidor
					Samba y el servidor <acronym>LDAP</acronym>. Se ha seleccionado la conexión
					por <acronym>TLS</acronym>, como ya viene siendo habitual a lo largo
					de toda la documentación.</para>
				</callout>
				<callout arearefs="ldap-delete-dn">
					<para>Este parámetro especifica si al realizar una operación de borrado en
					ldapsam, se borra la entrada completa o solamente los atributos específicos de
					Samba.</para>
				</callout>
				<callout arearefs="ldap-filter">
					<para>Filtro de búsqueda para <acronym>LDAP</acronym>.</para>
				</callout>
				<callout arearefs="ldap-suffix">
					<para>Parámetro que especifica la base para todas las búsquedas en
					<acronym>LDAP</acronym>.</para>
				</callout>
				<callout arearefs="ldap-user-suffix">
					<para>Parámetro que indica donde se añaden los usuarios dentro del árbol.</para>
				</callout>
				<callout arearefs="ldap-group-suffix">
					<para>Parámetro que indica donde se añaden los grupos de usuarios dentro del árbol.</para>
				</callout>
				<callout arearefs="ldap-machine-suffix">
					<para>Parámetro que indica donde se añaden las máquinas dentro del árbol.</para>
				</callout>
			</calloutlist>
		</sect3>

		<sect3 id="samba-configuracion-samba-opciones-global-impresion">
			<title>[global] - impresión</title>

<programlisting>   load printers = yes <co id="load_printers"/>
   printing = cups <co id="printing"/>
   printcap name = cups <co id="printcap_name"/>
   printer admin = @domainadmins <co id="printer_admin"/></programlisting>

			<calloutlist>
				<callout arearefs="load_printers">
					<para>Se cargan automáticamente la lista de impresoras disponibles.</para>
				</callout>
				<callout arearefs="printing printcap_name">
					<para>Estilo de impresión ha utilizar, en este caso se utilizará la impresión
					con <acronym>CUPS</acronym> (vea la <xref linkend="cups-parte"/> dedicada
					a <acronym>CUPS</acronym>.)</para>
				</callout>
				<callout arearefs="printer_admin">
					<para>Grupo de usuarios que tienen permiso para añadir y configurar
					impresoras, a parte del usuario <quote>root</quote>.</para>
				</callout>
			</calloutlist>
		</sect3>

		<sect3 id="samba-configuracion-samba-opciones-global-controlador-dominio">
			<title>[global] - Controlador de dominio</title>

<programlisting>   os level = 80 <co id="os_level"/>
   preferred master = yes <co id="preferred_master"/>
   domain master = yes <co id="domain_master"/>
   local master = yes <co id="local_master"/>
   domain logons = yes <co id="domain_logons"/>
   logon path = \\%L\profiles\%u <co id="logon_path"/>
   logon drive = H: <co id="logon_drive"/>
   logon home = \\%L\%u\.profile <co id="logon_home"/>
   logon script = <co id="logon_script"/>
;   domain admin group = @domainadmins <co id="domain_admin_group"/></programlisting>

			<calloutlist>
				<callout arearefs="os_level">
					<para>Parámetro que controla el nivel en el que Samba se anunciará
					como elección de búsqueda. El valor de este parámetro
					determinará si el demonio <application>nmbd</application>
					tendrá alguna posibilidad de llegar a ser un buscador primario
					local para el grupo de trabajo en el área de broadcast local.</para>
				</callout>
				<callout arearefs="preferred_master domain_master local_master domain_logons">
					<para>Estos parámetros juegan un papel fundamental asegurando el control
					del dominio y el soporte de autentificación en red. Una descripción
					más detallada de los mismos se encuentra en la página del manual
					smb.conf(5).</para>
				</callout>
				<callout arearefs="logon_path logon_drive logon_home logon_script">
					<para>Opciones que facilitan las operaciones de autentificado de clientes
					y facilitan el control automatizado para la administración de
					redes sobrecargadas. Más información en la página del manual
					smb.conf(5).</para>
				</callout>
				<callout arearefs="domain_admin_group">
					<para>Parámetro que acepta usuarios y grupos de usuarios que serán
					administradores de dominio. Este parámetro se comenta, ya que parece que Samba no lo
                    reconoce.</para>
				</callout>
			</calloutlist>
		</sect3>

		<sect3 id="samba-configuracion-samba-opciones-global-misc">
			<title>[global] - Misceláneo</title>

<programlisting>   socket options = TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF=8192 <co id="socket_options"/>
   idmap uid = 10000-20000 <co id="idmap_uid"/>
   idmap gid = 10000-20000 <co id="idmap_gid"/>
   template shell = /bin/bash <co id="template_shell"/>
   add user script = /usr/sbin/smbldap-useradd -w %u <co id="add_user_script"/></programlisting>

			<calloutlist>
				<callout arearefs="socket_options">
					<para>Distintas opciones que mejoran el rendimiento del servidor Samba.</para>
				</callout>
				<callout arearefs="idmap_uid idmap_gid">
					<para>Estos dos parámetros especifican el rango de los ids de usuario
					y grupo, respectivamente, que serán utilizados en el mapeado de usuarios/grupos
					Unix en <acronym>SID</acronym>s de usuarios/grupos <acronym>NT</acronym>.</para>
				</callout>
				<callout arearefs="template_shell">
					<para>Shell que el demonio <application>winbindd</application> añadirá
					a la información de un usuario, cuando este valor no sea omitido.</para>
				</callout>
				<callout arearefs="add_user_script">
					<para>Se hace uso de las herramientas <emphasis>smbldap-tools</emphasis>
					para añadir maquinas (En el <xref linkend="smbldap-tools"/> se
					muestra un ejemplo de instalación y configuración de estas herramientas).</para>
				</callout>
			</calloutlist>
		</sect3>
	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-homes">
		<title>[homes] - directorios personales</title>

		<para>Esta sección permite la compartición del directorio <emphasis>home</emphasis>
		de los usuarios, de forma que, dependiendo que usuario se haya autentificado en el
		sistema, Samba compartirá su directorio personal únicamente a él.</para>

		<para>Los parámetros más importantes de esta sección se muestran a continuación:</para>

<programlisting>   browseable = yes <co id="browseable-homes"/>
   writeable = yes <co id="writeable-homes"/>
   create mask = 0700 <co id="create_mask-homes"/>
   directory mask = 0700 <co id="directory_mask-homes"/></programlisting>

			<calloutlist>
				<callout arearefs="browseable-homes">
					<para>Indica si este recurso aparecerá en la lista de recursos compartidos
					o no. En este caso, si se mostrará.</para>
				</callout>
				<callout arearefs="writeable-homes">
					<para>Esta opción permite escribir datos en los directorios <emphasis>home</emphasis>,
					si su valor fuese <quote>no</quote>, los directorios <emphasis>home</emphasis>
					se compartirían como sólo lectura.</para>
				</callout>
				<callout arearefs="create_mask-homes">
					<para>Máscara de creación de archivos, el valor de este parámetro indicará
					los permisos que tendrán los archivos de nueva creación.</para>
				</callout>
				<callout arearefs="directory_mask-homes">
					<para>Máscara de creación de directorios, el valor de este parámetro indicará
					los permisos que tendrán los directorios de nueva creación.</para>
				</callout>
			</calloutlist>

	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-netlogon">
		<title>[netlogon]</title>

		<para>El recurso compartido <emphasis>NETLOGON</emphasis> juega un papel fundamental
		en el soporte de inicio de sesión en un dominio y Miembro de Dominio. Este recurso compartido
		se provee en todos los Controladores de Dominio de Microsoft. Se utiliza para proveer
		de scripts de inicio de sesión, para almacenar archivos de Políticas de Grupo
		(<filename>NTConfig.POL</filename>), así como la localización de otras herramientas comunes
		que se puedan necesitar para el proceso de inicio de sesión. Este es un recurso esencial
		en un Controlador de dominio.</para>

		<para>Los parámetros más importantes de esta sección se muestran a continuación:</para>

<programlisting>   path = /home/samba/netlogon <co id="path-netlogon"/>
   writeable = no <co id="writeable-netlogon"/>
   write list = @domainadmins <co id="write_list-netlogon"/></programlisting>

			<calloutlist>
				<callout arearefs="path-netlogon">
					<para>Directorio donde se van a alojar los scripts.</para>
				</callout>
				<callout arearefs="writeable-netlogon">
					<para>No se permite escribir en el recurso compartido, sólo lectura.</para>
				</callout>
				<callout arearefs="write_list-netlogon">
					<para>Lista de usuarios/grupos que tienen permiso de escritura en el recurso
					compartido.</para>
				</callout>
			</calloutlist>

	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-profiles">
		<title>[profiles] - perfiles móviles</title>

		<para>Este recurso compartido se utiliza para almacenar los perfiles de escritorio de los
		usuarios. Cada usuario ha de tener un directorio en el raíz de este recurso compartido.
		Este recurso ha de tener permisos de escritura para los usuarios y debería tener
		la permisos de lectura globales. Samba-3 tiene un módulo <acronym>VFS</acronym>
		denominado <quote>fake_permissions</quote> (permisos <quote>falsos</quote>) que se
		deberían instalar en este recurso. Este módulo permitiría a un administrador de Samba
		hacer el directorio de sólo lectura para todo el mundo. Por supuesto, esto sólo es
		útil una vez se ha creado correctamente el perfil.</para>

		<para>Los parámetros más importantes de esta sección se muestran a continuación:</para>

<programlisting>   path = /home/samba/profiles <co id="path-profiles"/>
   writeable = yes <co id="writeable-profiles"/>
   browseable = no <co id="browseable-profiles"/>
   create mask = 0600 <co id="create_mask-profiles"/>
   directory mask = 0700 <co id="directory_mask-profiles"/></programlisting>

			<calloutlist>
				<callout arearefs="path-profiles">
					<para>Directorio donde se almacenarán los perfiles móviles, bajo este
					directorio, cada usuario tendrá una carpeta con su nombre.</para>
				</callout>
				<callout arearefs="writeable-profiles">
					<para>Se permite escribir en el recurso compartido.</para>
				</callout>
				<callout arearefs="browseable-profiles">
					<para>Indica si este recurso aparecerá en la lista de recursos compartidos
					o no. En este caso, no se mostrará.</para>
				</callout>
				<callout arearefs="create_mask-profiles">
					<para>Máscara de creación de archivos, el valor de este parámetro indicará
					los permisos que tendrán los archivos de nueva creación.</para>
				</callout>
				<callout arearefs="directory_mask-profiles">
					<para>Máscara de creación de directorios, el valor de este parámetro indicará
					los permisos que tendrán los directorios de nueva creación.</para>
				</callout>
			</calloutlist>
	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-printers">
		<title>[printers] - impresoras</title>

		<para>Este es un recurso compartido especial que crea automáticamente servicios de impresión.
		La forma en que trabaja es la siguiente: si se crea un recurso compartido con el nombre
		[printers] en el archivo de configuración, Samba leerá automáticamente el archivo de
		definición de sus impresoras y creará una impresora compartida para cada impresora
		que aparezca en el archivo. Por ejemplo, si posee tres impresoras definidas:
		una <emphasis>lp</emphasis> otra <emphasis>pcl</emphasis> y una última <emphasis>ps</emphasis>,
		Samba proveerá tres impresoras compartidas con esos nombres, cada una configurada con las
		opciones que aparezcan en el recurso compartido [printers].</para>

		<para>Los parámetros más importantes de esta sección se muestran a continuación:</para>


<programlisting>   browseable = no <co id="browseable-printers"/>
   path = /tmp <co id="path-printers"/>
   printable = yes <co id="printable-printers"/>
   guest ok = no <co id="guest_ok-printers"/>
   writable = no <co id="writable-printers"/>
   create mask = 0700 <co id="create_mask-printers"/></programlisting>

			<calloutlist>
				<callout arearefs="browseable-printers">
					<para>Indica si este recurso aparecerá en la lista de recursos compartidos
					o no. En este caso, no se mostrará.</para>
				</callout>
				<callout arearefs="path-printers">
					<para>Directorio que utilizará Samba como cola de impresión.</para>
				</callout>
				<callout arearefs="printable-printers">
					<para>Como este parámetro tiene el valor <emphasis>yes</emphasis>, los clientes
					que se conecten al servidor, podrán abrir, escribir en y enviar archivos
					a la cola de impresión, es decir, al directorio especificado por la variable
					<emphasis>path</emphasis>.</para>
				</callout>
				<callout arearefs="guest_ok-printers">
					<para>No se permitirán las conexiones sin autentificación a este recurso.</para>
				</callout>
				<callout arearefs="writable-printers">
					<para>No se permite escribir en el recurso compartido.</para>
				</callout>
				<callout arearefs="create_mask-printers">
					<para>Máscara de creación de archivos, el valor de este parámetro indicará
					los permisos que tendrán los archivos de nueva creación.</para>
				</callout>
			</calloutlist>
	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-print">
		<title>[print$] - controladores de impresión</title>

		<para>Al igual que un servidor de impresión Windows <acronym>NT</acronym>, para soportar
		la descarga de controladores por parte de clientes con distintas arquitecturas, se han
		de crear varios subdirectorios dentro del servicio [print$]. Estos se corresponderán
		con cada una de las arquitecturas soportadas. Samba también sigue este esquema.
		Así como el nombre del recurso compartido ha de ser [print$], los subdirectorios
		han de ser exactamente los nombres que se listan a continuación (puede obviar
		aquellos subdirectorios para las arquitecturas que no necesite soporte).</para>

		<para>Por lo tanto, se ha de crear la estructura de directorios que se muestra
		a continuación, bajo el directorio compartido por [print$]. Cree aquellos
		directorios para aquellas arquitecturas que quiera dar soporte:</para>

		<example id="samba-configuracion-samba-opciones-seccion-print-ejemplo1">
			<title>[print$] - Subdirectorios para las distintas arquitecturas</title>

<programlisting>[print$]--+
          |--W32X86           # controladores para Windows NT x86
          |--WIN40            # controladores para Windows 95/98
          |--W32ALPHA         # controladores para Windows NT Alpha_AXP
          |--W32MIPS          # controladores para Windows NT R4000</programlisting>
		</example>

		<note><para>El paquete <quote>samba</quote> de Debian <acronym>GNU</acronym>/Linux
		crea esta estructura de directorios bajo
		<filename class="directory">/var/lib/samba/printers</filename>.</para></note>

		<para>Los parámetros más importantes de esta sección se muestran a continuación:</para>

<programlisting>   path = /var/lib/samba/printers <co id="path-print"/>
   browseable = yes <co id="browseable-print"/>
   writeable = no <co id="writeable-print"/>
   guest ok = no <co id="guest_ok-print"/>
   write list = root, @domainadmins <co id="write_list-print"/></programlisting>

			<calloutlist>
				<callout arearefs="path-print">
					<para>Directorio donde se almacenarán los controladores de impresión para las distintas
					arquitecturas.</para>
				</callout>
				<callout arearefs="browseable-print">
					<para>Indica si este recurso aparecerá en la lista de recursos compartidos
					o no. En este caso, si se mostrará.</para>
				</callout>
				<callout arearefs="writeable-print">
					<para>No se permite escribir en el recurso compartido.</para>
				</callout>
				<callout arearefs="guest_ok-print">
					<para>No se permitirán las conexiones sin autentificación a este recurso.</para>
				</callout>
				<callout arearefs="write_list-print">
					<para>Lista de usuarios/grupos que tienen permiso de escritura en el recurso
					compartido.</para>
				</callout>
			</calloutlist>
	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-tmp">
		<title>[tmp] - Directorio temporal</title>

		<para>A modo de ejemplo, se va a compartir el directorio temporal
		<filename class="directory">/tmp</filename> con los siguientes parámetros:</para>


<programlisting>   comment = Temporal <co id="comment-tmp"/>
   writeable = yes <co id="writeable-tmp"/>
   path = /tmp <co id="path-tmp"/>
   guest ok = no <co id="guest_ok-tmp"/></programlisting>

			<calloutlist>
				<callout arearefs="comment-tmp">
					<para>Comentario del recurso compartido.</para>
				</callout>
				<callout arearefs="writeable-tmp">
					<para>Se permite la escritura en este recurso.</para>
				</callout>
				<callout arearefs="path-tmp">
					<para>Directorio compartido dentro del sistema.</para>
				</callout>
				<callout arearefs="guest_ok-tmp">
					<para>No se permiten conexiones anónimas al directorio, todo
					usuario ha de autentificarse para acceder a este recurso.</para>
				</callout>
			</calloutlist>
	</sect2>

	<sect2 id="samba-configuracion-samba-opciones-seccion-cdrom">
		<title>[cdrom] - CDROM</title>

		<para>Otro ejemplo de compartición será el CDROM del sistema. Los parámetros empleados
		en esta ocasión serán:</para>


<programlisting>   comment = Samba server's CD-ROM <co id="comment-cdrom"/>
   writable = no <co id="writable-cdrom"/>
   locking = no <co id="locking-cdrom"/>
   path = /cdrom <co id="path-cdrom"/>
   guest ok = yes <co id="guest_ok-cdrom"/></programlisting>

			<calloutlist>
				<callout arearefs="comment-cdrom">
					<para>Comentario del recurso compartido.</para>
				</callout>
				<callout arearefs="writable-cdrom">
					<para>No se permite la escritura en este recurso compartido.</para>
				</callout>
				<callout arearefs="locking-cdrom">
					<para>No se bloquearán realmente los archivos a petición de los clientes,
					simplemente se informará de que el bloqueo ha sido efectivo.</para>
				</callout>
				<callout arearefs="path-cdrom">
					<para>Ruta hacia el recurso compartido.</para>
				</callout>
				<callout arearefs="guest_ok-cdrom">
					<para>Se permitirá el acceso a este recurso a los usuarios invitados,
					es decir, aquellos usuarios que no se han autentificado.</para>
				</callout>
			</calloutlist>

		<tip><para>Normalmente, para acceder al contenido de un <acronym>CDROM</acronym> es
		necesario montarlo primero. Por lo que se recomienda instalar el parche
		<ulink url="http://supermount-ng.sourceforge.net/">supermount</ulink>
		en el núcleo Linux, de forma que el montado
		y desmontado del <acronym>CDROM</acronym> sea transparente al usuario. Cuando se
		intenta acceder al recurso, el <acronym>CDROM</acronym> se montará automáticamente.</para>

		<para>Una vez aplicado el parche en el núcleo y seleccionado para la compilación, se
		ha de modificar la entrada para el <acronym>CDROM</acronym> dentro del archivo
		<filename>/etc/fstab</filename>, de forma que quede algo similar a:</para>

<programlisting><![CDATA[<file system> <mount point> <type>     <options>                             <dump><pass>
none          /cdrom        supermount dev=/dev/cdrom,fs=auto,ro,auto,user,exec  0     0]]></programlisting></tip>
	</sect2>
</sect1>

</chapter>
