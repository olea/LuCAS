<?xml version="1.0" encoding="ISO-8859-1" ?>

<chapter id="pykota-probando">

<chapterinfo>
	<keywordset>
		<keyword>pykota</keyword>
		<keyword>pruebas</keyword>
	</keywordset>
</chapterinfo>

<title>Probando el sistema de cuotas</title>

<!-- CONSIDERACIONES PREVIAS  -->

<sect1 id="pykota-pruebas-intro">
	<title>Introducción</title>

	<para>Este capítulo pondrá a prueba el sistema de cuotas de impresión, para ver
	si funciona como debe. Se realizarán pruebas sobre los dos tipos de cuotas
	empleados.</para>
</sect1>

<sect1 id="pykota-pruebas-usuario-printquota">
	<title>Usuario <emphasis>printquota</emphasis></title>

	<para>En las siguientes secciones se van a mostrar tres ejemplos a la hora de imprimir
	un determinado documento:</para>

	<itemizedlist>
		<listitem>
			<para>Se alcanza el límite blando de la cuota de impresión,
			<xref linkend="pykota-pruebas-usuario-printquota-limite-blando"/>.</para>
		</listitem>
		<listitem>
			<para>Se intenta imprimir un documento mayor que la cuota disponible,
			<xref linkend="pykota-pruebas-usuario-printquota-intentando-sobrepasar-limite-duro"/>.</para>
		</listitem>
		<listitem>
			<para>Se alcanza el límite duro de la cuota de impresión,
			<xref linkend="pykota-pruebas-usuario-printquota-limite-duro"/>.</para>
		</listitem>
	</itemizedlist>

	<sect2 id="pykota-pruebas-usuario-printquota-limite-blando">
		<title>Alcanzando el límite blando</title>

		<para>Recuerde que este usuario tiene un límite de impresión de 10 páginas
		(vea el <xref linkend="pykota-estableciendo-cuotas-usuarios-ex1"/> para más detalles).
		Se va a imprimir un documento de 5 páginas y se va a comprobar que ocurre en el
		sistema de cuotas:</para>
	
		<figure>
			<title>Impresión de un documento de 5 páginas I</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="./imagenes/pykota-printsaldo1.png" format="PNG"/>
				</imageobject>
		
				<caption>
					<para></para>
				</caption>
			</mediaobject>
		</figure>
	
		<figure>
			<title>Impresión de un documento de 5 páginas II</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="./imagenes/pykota-printsaldo2.png" format="PNG"/>
				</imageobject>
		
				<caption>
					<para></para>
				</caption>
			</mediaobject>
		</figure>
	
		<figure>
			<title>Impresión de un documento de 5 páginas III</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="./imagenes/pykota-printsaldo3.png" format="PNG"/>
				</imageobject>
		
				<caption>
					<para></para>
				</caption>
			</mediaobject>
		</figure>
	
		<figure>
			<title>Impresión de un documento de 5 páginas IV</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="./imagenes/pykota-printsaldo4.png" format="PNG"/>
				</imageobject>
		
				<caption>
					<para></para>
				</caption>
			</mediaobject>
		</figure>
	
		<para>Tras la impresión de este documento, aparece un nuevo archivo <acronym>PDF</acronym>
		bajo el directorio <filename class="directory">cups-pdf</filename>
		del home del usuario <emphasis>printquota</emphasis> con un nombre similar a:
		<filename>job_2-untitled_document.pdf</filename>.</para>
	
		<para>Si ahora se revisa el estado de la cuota de este usuario, se obtendrá algo similar
		a:</para>

		<example id="pykota-pruebas-usuario-printquota-limite-blando-ex1">
			<title>Revisando la cuota de impresión del usuario <emphasis>printquota</emphasis> I</title>

<screen><prompt>#</prompt> <userinput>/usr/bin/repykota --printer LaserColor</userinput>
<computeroutput>Informe para la cuota user en la impresora LaserColor ()
Tiempo de gracia para páginas: 7 día(s)
Precio por trabajo: 0.000
Precio por página: 0.090
Usuario         usado   blando  duro    saldo gracia          total     pagado
------------------------------------------------------------------------------
printquot +Q       5       5      10      -0.45 2004-10-21        5       0.00
                                                  Total :         5       0.00
                                                   Real :         0
</computeroutput></screen>
		</example>
	
		<para>Se puede observar que ha consumido 5 páginas de su cuota de impresión. PyKota
		también informa del coste de la impresión (-0.45), el valor negativo indica
		que el usuario no ha pagado por esta impresión. A continuación se va a imprimir
		una página más, para rebasar el límite suave de la cuota, y ver qué ocurre.</para>
	
		<para>Tras realizar esta primera impresión, el usuario <emphasis>printquota</emphasis>
		recibirá un correo electrónico, informándole de que ha alcanzado su límite
		blando de impresión. Así mismo, el administrador del sistema de impresión,
		recibirá otro correo, informándole de que el usuario <emphasis>printquota</emphasis>
		tiene su cuota de impresión baja (recuerde que este comportamiento se ha
		definido en la <xref linkend="pykota-configuracion-repaso-conf-mailto"/>).
		A continuación puede ver los correos enviados:</para>

		<example id="pykota-pruebas-usuario-printquota-ex3">
			<title>Correo de aviso enviado al usuario <emphasis>printquota</emphasis> - límite suave sobrepasado -</title>

<programlisting><![CDATA[From: root@localhost
Subject: Cuota de Impresión Baja
To: printquota@gsr.pt

Ha alcanzado su límite blando en la cuota de impresión.
Esto significa que podrá seguir imprimiendo algún tiempo,
pero debería contactar con su administrador para comprar
más cuota de impresión.

Entre en contacto con su administrador de sistema, por favor :

        Sergio González González - <root@localhost>]]></programlisting>
		</example>
	
		<example id="pykota-pruebas-usuario-printquota-ex4">
			<title>Correo de aviso enviado al administrador - cuota de impresión baja -</title>

<programlisting><![CDATA[From: root@localhost
Subject: Cuota de impresión
To: root@localhost

Cuota de impresión baja para el usuario printquota en la impresora LaserColor]]></programlisting>
		</example>
	</sect2>

	<sect2 id="pykota-pruebas-usuario-printquota-intentando-sobrepasar-limite-duro">
		<title>Impresión de un documento mayor a la cuota disponible</title>

		<para>En esta sección se ha intentado imprimir un documento de dimensiones
		superiores a la cuota del usuario <emphasis>printquota</emphasis>:</para>

		<figure>
			<title>Impresión de un documento que supera la cuota disponible</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="./imagenes/pykota-printsaldo5.png" format="PNG"/>
				</imageobject>
		
				<caption>
					<para>Intento de impresión de un documento que superaría la
					cuota de impresión del usuario.</para>
				</caption>
			</mediaobject>
		</figure>

		<para>Debido a que se ha configurado PyKota en modo <emphasis>strict</emphasis> (vea
		la <xref linkend="pykota-configuracion-repaso-conf-enforcement"/>), el documento que
		se ha tratado de imprimir, no se imprimirá. Como resultado a esta acción, el usuario
		<emphasis>printquota</emphasis> y el administrador del sistema de impresión
		recibirán los siguientes correos:</para>

		<example id="pykota-pruebas-usuario-printquota-intentando-sobrepasar-limite-duro-ex1">
			<title>Correo de aviso enviado al usuario <emphasis>printquota</emphasis> - límite duro sobrepasado -</title>

<programlisting><![CDATA[From: root@localhost
Subject: Cuota de Impresión Excedida
To: printquota@gsr.pt

Ha alcanzado su límite duro en la cuota de impresión.
Esto significa que no podrá volver a imprimir.
Contacte con su administrador en <root@gsr.pt> tan
pronto como le sea posible para solucionar el
problema.

Entre en contacto con su administrador de sistema, por favor :

        Sergio González González - <root@localhost>]]></programlisting>
		</example>
	
		<example id="pykota-pruebas-usuario-printquota-intentando-sobrepasar-limite-duro-ex2">
			<title>Correo de aviso enviado al administrador - cuota de impresión excedida -</title>

<programlisting><![CDATA[From: root@localhost
Subject: Cuota de impresión
To: root@localhost

Cuota de impresión excedida para el usuario printquota en la impresora LaserColor]]></programlisting>
		</example>

		<important><para>Si se hubiese utilizado el modo <emphasis>laxist</emphasis>, el documento
		se habría impreso en su totalidad, obteniéndose como resultado una cuota negativa para
		el usuario en cuestión.</para></important>

		<para>El aviso recibido, tanto por el usuario <emphasis>printquota</emphasis> como por
		el administrador del sistema de impresión, no es del todo cierto. Es cierto que se ha
		alcanzado el límite duro de la cuota de impresión con el trabajo enviado a la cola de
		impresión, pero debido a que este sobrepasaba el límite de la cuota de impresión,
		el trabajo no se ha impreso. Como resultado, la cuota del usuario
		<emphasis>printquota</emphasis> permanece igual que antes de haber enviado el trabajo
		a la cola de impresión:</para>

		<example id="pykota-pruebas-usuario-printquota-intentando-sobrepasar-limite-duro-ex3">
			<title>Revisando la cuota de impresión del usuario <emphasis>printquota</emphasis></title>

<screen><prompt>#</prompt> <userinput>/usr/bin/repykota --printer LaserColor</userinput>
<computeroutput>Informe para la cuota user en la impresora LaserColor ()
Tiempo de gracia para páginas: 7 día(s)
Precio por trabajo: 0.000
Precio por página: 0.090
Usuario         usado   blando  duro    saldo gracia          total     pagado
------------------------------------------------------------------------------
printquot +Q       5       5      10      -0.45 2004-10-21        5       0.00
                                                  Total :         5       0.00
                                                   Real :         0
</computeroutput></screen>
		</example>
	</sect2>

	<sect2 id="pykota-pruebas-usuario-printquota-limite-duro">
		<title>Alcanzando el límite duro</title>

		<para>Ahora se van a imprimir 4 páginas más, acabando de esta forma la
		cuota de impresión.</para>
	
		<note><para>Si se intentan imprimir 5 páginas, alcanzando de esta forma el límite duro,
		ocurrirá lo mismo que el ejemplo mostrado en la
		<xref linkend="pykota-pruebas-usuario-printquota-intentando-sobrepasar-limite-duro"/>.</para></note>
	
		<example id="pykota-pruebas-usuario-printquota-limite-duro-ex1">
			<title>Revisando la cuota de impresión del usuario <emphasis>printquota</emphasis></title>

<screen><prompt>#</prompt> <userinput>/usr/bin/repykota --printer LaserColor</userinput>
<computeroutput>Informe para la cuota user en la impresora LaserColor ()
Tiempo de gracia para páginas: 7 día(s)
Precio por trabajo: 0.000
Precio por página: 0.090
Usuario         usado   blando  duro    saldo gracia          total     pagado
------------------------------------------------------------------------------
printquot +Q       9       5      10      -0.81 2004-10-21        9       0.00
                                                  Total :         9       0.00
                                                   Real :         5

</computeroutput></screen>
		</example>
	
		<para>Los correos de notificación que se han recibido en esta ocasión son los
		siguientes:</para>
	
		<example id="pykota-pruebas-usuario-printquota-ex6">
			<title>Correo de aviso enviado al usuario <emphasis>printquota</emphasis> - límite blando sobrepasado -</title>

<programlisting><![CDATA[From: root@localhost
Subject: Cuota de Impresión Baja
To: printquota@gsr.pt

Ha alcanzado su límite blando en la cuota de impresión.
Esto significa que podrá seguir imprimiendo algún tiempo,
pero debería contactar con su administrador para comprar
más cuota de impresión.

Entre en contacto con su administrador de sistema, por favor :

        Sergio González González - <root@localhost>]]></programlisting>
		</example>
	
		<example id="pykota-pruebas-usuario-printquota-ex7">
			<title>Correo de aviso enviado al administrador - cuota excedida -</title>

<programlisting><![CDATA[From: root@localhost
Subject: Cuota de impresión
To: root@localhost

Cuota de impresión excedida para el usuario sergio en la impresora LaserColor]]></programlisting>
		</example>

		<para>A partir de este momento, el usuario <emphasis>printquota</emphasis> no podrá
		volver a imprimir, hasta que no obtenga más cuota de impresión.</para>

		<note><para>El comportamiento del sistema de impresión con la opción
		<emphasis>laxist</emphasis> hubiese sido ligeramente diferente. Por lo tanto, la
		elección de uno u otro comportamiento ha de elegirse en función de sus preferencias.</para></note>
	</sect2>

	<sect2 id="pykota-pruebas-usuario-printquota-reinicio-cuotas">
		<title>Reinicio de la cuota de impresión</title>

		<para>Supongamos ahora que el sistema reinicia las cuotas de los usuarios cada cierto
		período de tiempo:</para>

		<example id="pykota-pruebas-usuario-printquota-reinicio-cuotas-ex1">
			<title>Reinicio de la cuota de impresión para el usuario <emphasis>printquota</emphasis></title>

<screen><prompt>#</prompt> <userinput>/usr/bin/edpykota --reset printquota</userinput></screen>
		</example>

		<para>A partir de ese momento, el usuario <emphasis>printquote</emphasis> dispone de nuevo
		de una cuota de impresión de 10 páginas:</para>

		<example id="pykota-pruebas-usuario-printquota-reinicio-cuotas-ex2">
			<title>Información sobre la cuota del usuario <emphasis>printquota</emphasis>, tras su reinicio I</title>

<screen><prompt>#</prompt> <userinput>/usr/bin/repykota --printer LaserColor</userinput>
<computeroutput>Informe para la cuota user en la impresora LaserColor ()
Tiempo de gracia para páginas: 7 día(s)
Precio por trabajo: 0.000
Precio por página: 0.090
Usuario         usado   blando  duro    saldo gracia          total     pagado
------------------------------------------------------------------------------
printquot -Q       0       5      10      -0.81 2004-10-21        9       0.00
                                                  Total :         9       0.00
                                                   Real :         9

</computeroutput></screen>
		</example>

		<para>Si se realiza en este momento una nueva impresión, el informe para el
		usuario <emphasis>printquota</emphasis> sería:</para>

		<example id="pykota-pruebas-usuario-printquota-reinicio-cuotas-ex3">
			<title>Información sobre la cuota del usuario <emphasis>printquota</emphasis>, tras su reinicio II</title>

<screen><prompt>#</prompt> <userinput>/usr/bin/repykota --printer LaserColor</userinput>
<computeroutput>Informe para la cuota user en la impresora LaserColor ()
Tiempo de gracia para páginas: 7 día(s)
Precio por trabajo: 0.000
Precio por página: 0.090
Usuario         usado   blando  duro    saldo gracia          total     pagado
------------------------------------------------------------------------------
printquot +Q       5       5      10      -1.26 2004-10-21       14       0.00
                                                  Total :        14       0.00
                                                   Real :         9

</computeroutput></screen>
		</example>

		<para>Como se ha podido comprobar, el sistema de cuotas funciona de la manera esperada.
		Con esto concluirían las pruebas sobre el sistema de cuotas de impresión.</para>
	</sect2>

</sect1>

<sect1 id="pykota-pruebas-usuario-printsaldo">
	<title>usuario <emphasis>printsaldo</emphasis></title>

	<para>El usuario <emphasis>printsaldo</emphasis> posee una cuota de impresión
	basada en saldo; su comportamiento es similar al mostrado en la
	<xref linkend="pykota-pruebas-usuario-printquota"/>, por lo que se
	deja como trabajo para el lector las pruebas con este tipo de cuotas.</para>

	<tip><para>Imagínese que el usuario <emphasis>printsaldo</emphasis>
	desea imprimir el documento que está leyendo, pero no tiene ni idea
	de lo que puede costar su impresión. Por este motivo, ha decidido
	consultar, antes de imprimir, el precio de impresión en cada una
	de las impresoras disponibles en el sistema. El resultado ha sido
	el siguiente:</para>

	<example id="pykota-pruebas-usuario-printsaldo-ex1">
		<title>Coste de impresión de un documento</title>

<screen><prompt>$</prompt> <userinput>/usr/bin/pykotme ldap+samba+cups+pykota.ps</userinput>
<computeroutput>Tamaño del trabajo : 759 página(s)
Coste en la impresora LaserColor : 68.31
Coste en la impresora LaserBN : 22.77
Coste en la impresora Plotter : 380.50
Coste en la impresora Sublimacion : 494.10
Coste en la impresora Multifuncion : 18.98
Coste en la impresora InyeccionBN : 18.98
Coste en la impresora InyeccionColor : 53.13</computeroutput></screen>
	</example>

	</tip>
</sect1>

</chapter>
