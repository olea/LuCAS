


MIRROR(1L)                                             MIRROR(1L)


NNAAMMEE
       mirror - mirror packages on remote sites

SSYYNNOOPPSSIISS
       mmiirrrroorr [[ffllaaggss]] --gg_s_i_t_e::_p_a_t_h_n_a_m_e
       mmiirrrroorr [[ffllaaggss]] [[ccoonnffiigg--ffiilleess]]

DDEESSCCRRIIPPTTIIOONN
       MMiirrrroorr is a package written in Perl that uses the ftp pro­
       tocol to  duplicate  a  directory  hierarchy  between  the
       machine it is run on and a remote host.  It avoids copying
       files unnecessarily by comparing the file time-stamps  and
       sizes  before  transferring.  Amongst other things, it can
       optionally compress, gzip, and split files.

       It was written for use by archive maintainers but  can  be
       used by anyone wanting to transfer a lot of files via ftp.

       Regardless of how it is called, mmiirrrroorr always performs the
       same  basic steps.  It connects to the remote site, inter­
       nally builds a  directory  listing  of  the  local  target
       directory,  builds  one for the remote directory, compares
       them, creates any subdirectories required,  transfers  the
       appropriate  files  (setting  their  time-stamps  to match
       those on the remote site),  creates  any  symbolic  links,
       removes any unnecessary objects and finally drops the con­
       nection.

       MMiirrrroorr can handle symbolic links but not  ordinary  links.
       It  does not duplicate owner or group information.  If you
       require any of these options, use rrddiisstt(1) instead.

       MMiirrrroorr is called in one of two ways shown in the  synopsis
       above.

       The  first  method  is used to retrieve a remote directory
       into the current directory.  If you are mirroring a direc­
       tory,  it  would  be  best  to end the pathname in a slash
       ('/') so the remote recursive listing is  smaller  or  use
       the  --rr  flag  to  suppress recursion (see --gg below).  The
       mmiirrrroorr..ddeeffaauullttss file is not used.

       In the second method given in the synopsis above, a  mini­
       mal  number  of  arguments are required and mmiirrrroorr is con­
       trolled by the settings read from the configuration  files
       (or  standard input).  If a file named mmiirrrroorr..ddeeffaauullttss can
       be found in either the directory the mmiirrrroorr executable  is
       in  or  in the PPEERRLLLLIIBB path, then it is loaded first. This
       is used to provide common defaults for all config-files.

       MMiirrrroorr was written to mirror remote Un*x archives, but has
       grown (like topsy).





                            Mirror 2.6                          1





MIRROR(1L)                                             MIRROR(1L)


OOPPTTIIOONNSS
       --dd     Enable  debugging.   If this argument is given more
              than once, the debugging level will increase.  Cur­
              rently the maximum useful level is four.

       --pppackage
              Only  mirror the given package.  This option may be
              given multiple times in which case  all  the  given
              packages  will  be  mirrored.  Without this option,
              all packages will be mirrored.  Package is a regexp
              matched against the package variable.

       --RRpackage
              Similar  to  --pp  but  skips  all  packages until it
              reaches the given package.  Useful  for  restarting
              failed mirror runs from where they left off.

       --nn     Do nothing except compare local and remote directo­
              ries, no file transfers are done.  Sets debug level
              to  two,  so you are shown a trace of what would be
              done.

       --FF     Use temporary ddbbmm files for the  information  about
              files.   This  is useful if you mirror a very large
              directory.  See the variable _u_s_e___f_i_l_e_s.

       --ggsite::path
              Get all files  on  given  site.   If  path  matches
                .*/.+    then it is the name of the directory and
              the last part is the pattern of filenames  to  get.
              If  path  matches    .*/   then it is the name of a
              directory and all its contents are retrieved.  Oth­
              erwise  path  is the pattern to be used in '/'.  If
              you use host:/fred, a full directory listing  of  /
              on the remote host will be done.  If all you wanted
              was the contents of the  directory  /fred,  specify
              host:/fred/.

       --rr     Equivalent to --kk_r_e_c_u_r_s_i_v_e=false

       --vv     Print the version details of mirror and exit.

       --TT     Force  the  time  stamps  of  any local files to be
              reset to be the same as the remote files.  Normally
              only  used  when  initialising  a mirror area using
              existing files contents.

       --UU[[filename]]
              Record all uploads into the given filename.  Remem­
              ber  that  mirror  changes into _l_o_c_a_l___d_i_r to do its
              work, so it should  be  a  full  pathname.   If  no
              parameter     is     given,    it    defaults    to
              `pwd`/upload_log.day.month.year.




                            Mirror 2.6                          2





MIRROR(1L)                                             MIRROR(1L)


       --kk_k_e_y=value
              Override any default key/value.

       --mm     Equivalent to --kk_m_o_d_e___c_o_p_y=true

       --tt     Equivalent to --kk_t_e_x_t___m_o_d_e=true

       --ff     Equivalent to --kk_f_o_r_c_e=true

       --sssite Equivalent to --kk_s_i_t_e=site

       --uuuser Equivalent  to  --kk_r_e_m_o_t_e___u_s_e_r=user  You  are   then
              prompted for a password, with echo turned off.  The
              password is used to set _r_e_m_o_t_e___p_a_s_s_w_o_r_d.

       --LL     Just generate a pretty printed version of the input
              and exit.

       --GG     Get  files  from the remote machine.  The local and
              remote directories have to be given on the  command
              line.  (This option is no longer supported.)

       --PP     Put  files  onto the remote machine.  The local and
              remote directories have to be given on the  command
              line.  (This option is no longer supported.)

       --CCfile Specify  config-files.  Needed to give config-files
              with --PP and --GG options.  (This option is no  longer
              supported.)


CCOONNFFIIGGUURRAATTIIOONN FFIILLEE
       Configuration  files are parsed as a series of statements.
       Blank lines and lines beginning with a hash  are  ignored.
       Each statement is of the form
              _k_e_y_w_o_r_d==value
       or
              _k_e_y_w_o_r_d++value

       You   can  add  whitespace  before  the  keyword  and  the
       equals/plus.    Everything   immediately   following   the
       equals/plus  is the value, including any leading or trail­
       ing whitespace.  The equals version sets  the  keyword  to
       this  value, while the plus version concatenates the value
       onto the end of the default.

       A statement can be continued over multiple lines by ending
       all  lines  except  the last, with the character ampersand
       ('&').  The line following the ampersand, is  appended  to
       the current line with all leading whitespace removed.

       Here  is  a  list  of  the  keywords and their values with
       defaults given  inside  square  brackets.   Those  options
       flagged with a star are not yet implemented.



                            Mirror 2.6                          3





MIRROR(1L)                                             MIRROR(1L)


       Although  there are a lot of keywords that can be set, the
       built-in defaults will handle most cases.   Normally  only
       _p_a_c_k_a_g_e, _s_i_t_e, _r_e_m_o_t_e___d_i_r and _l_o_c_a_l___d_i_r need to be set.

       _p_a_c_k_a_g_e        Should  be a unique name for the package to
                      be mirrored.  ['']

       _c_o_m_m_e_n_t        Used in reports.  ['']

       _s_k_i_p           Setting this entry causes this  package  to
                      be  skipped.  The  value is reported as the
                      reason for skipping.  (It  is  easier  than
                      commenting the entry out.)  ['']

       _s_i_t_e           Site-name or IP address of the remote site.
                      ['']

       _r_e_m_o_t_e___d_i_r     Remote  directory  to  mirror.   See   also
                      _r_e_c_u_r_s_e___h_a_r_d.  ['']

       _l_o_c_a_l___d_i_r      Local directory.  ['']

       _r_e_m_o_t_e___u_s_e_r    Username  to  use  at remote site.  [anony­
                      mous]

       _r_e_m_o_t_e___p_a_s_s_w_o_r_d
                      Password   to   use   at    remote    site.
                      [user@localhostname]

       _r_e_m_o_t_e___a_c_c_o_u_n_t Account  name/password  (to  use  at remote
                      site, after  logging  in  anonymously  (for
                      systems that use it).  ['']

       _g_e_t___p_a_t_t       Regexp  of  remote  pathnames  to retrieve.
                      [.]

       _f_a_i_l_e_d___g_e_t_s___e_x_c_l
                      Regexp of messages to ignore, when the  ftp
                      get command failed.  ['']

       _e_x_c_l_u_d_e___p_a_t_t   Regexp of remote pathnames to ignore.  ['']

       _u_p_d_a_t_e___l_o_c_a_l   Set _g_e_t___p_a_t_t to be  _l_o_c_a_l___d_i_r/*.   This  is
                      useful  if you only want to mirror selected
                      subdirectories   of   a   remote   archive.
                      [false]

       _l_o_c_a_l___i_g_n_o_r_e   Regexp  of local pathnames to ignore.  Use­
                      ful to skip restricted  local  directories.
                      ['']

       _d_o___d_e_l_e_t_e_s     Delete  destination  files if not in source
                      tree.  [false]




                            Mirror 2.6                          4





MIRROR(1L)                                             MIRROR(1L)


       _d_e_l_e_t_e___p_a_t_t    Regexp of  local  pathnames  to  check  for
                      deletions.   Names that are not matched are
                      not checked.  The match by  _d_e_l_e_t_e___e_x_c_l  is
                      done to all files selected by this pattern.
                      [.]

       _d_e_l_e_t_e___g_e_t___p_a_t_t
                      Set _d_e_l_e_t_e___p_a_t_t to be _g_e_t___p_a_t_t.  [false]

       _d_e_l_e_t_e___e_x_c_l    Regexp of local pathnames to never  delete.
                      ['']

       _s_a_v_e___d_e_l_e_t_e_s   Save  local files into _s_a_v_e___d_i_r rather than
                      deleting.  [false]

       _s_a_v_e___d_i_r       Where local files no longer on remote  site
                      are transferred to.  [Old]

       _m_a_x___d_e_l_e_t_e___f_i_l_e_s
                      If  there  are more than this many files to
                      delete, do not delete, just warn.   If  the
                      value  ends with percent character the this
                      is the percentage of files before  deletion
                      disabled.  [10%]

       _m_a_x___d_e_l_e_t_e___d_i_r_s
                      If  there  are more than this many directo­
                      ries to delete, do not delete,  just  warn.
                      If  the  value  ends with percent character
                      the this is the percentage  of  directories
                      before deletion disabled.  [10%]

       _m_a_x___d_a_y_s       If  >0,  ignore  files older than this many
                      days.  Any ignored files will not be trans­
                      ferred or deleted.  [0]

       _s_t_o_r_e___r_e_m_o_t_e___l_i_s_t_i_n_g
                      Local  pathname  where  remote listings are
                      kept.  Useful if you have a slow network or
                      want  to  perform several operations on the
                      same package without retrieving  the  index
                      every time.  ['']

       _s_p_l_i_t___m_a_x      If  >0  and the size of the file is greater
                      than this, the  file  is  split  up  to  be
                      stored  locally  (filename  must also match
                      _s_p_l_i_t___p_a_t_t).  [0]

       _s_p_l_i_t___p_a_t_t     regexp of  remote  pathnames  to  split  up
                      before storing locally.  ['']

       _s_p_l_i_t___c_h_u_n_k    Size   of   chunks  to  split  files  into.
                      [102400]




                            Mirror 2.6                          5





MIRROR(1L)                                             MIRROR(1L)


       _l_s___l_R___f_i_l_e     Remote file containing ls-lR, otherwise run
                      remote ls.  ['']

       _l_o_c_a_l___l_s___l_R___f_i_l_e
                      Local  file containing ls-lR, otherwise use
                      remote _l_s___l_R___f_i_l_e.   This  is  useful  when
                      first mirroring a large package.  ['']

       _r_e_c_u_r_s_i_v_e      Do subdirectories as well.  [true]

       _r_e_c_u_r_s_e___h_a_r_d   Have to generate remote ls by doing cwd and
                      ls for each  subdirectory.   In  this  case
                      remote_dir  must  be absolute (begin with a
                      /) not relative. Use the pwd command in ftp
                      to  find  the  path  for   the start of the
                      remote archive  area.   (Not  available  if
                      _r_e_m_o_t_e___f_s is vms.)  [false]

       _f_l_a_g_s___r_e_c_u_r_s_i_v_e
                      Flags  to  send to remote ls to do a recur­
                      sive listing.  ['-lRat']

       _f_l_a_g_s___n_o_n_r_e_c_u_r_s_i_v_e
                      Flags to send to remote ls  to  do  a  non-
                      recursive listing.  ['-lat']

       _r_e_m_o_t_e___f_s      Remote file store type.  Handles uunniixx, ddllss,
                      nneettwwaarree, vvmmss, ddoossffttpp,  mmaaccooss,  llssppaarrssee  and
                      iinnffoommaacc.   See the FILESTORES section below
                      for more details.  [unix]

       _v_m_s___k_e_e_p___v_e_r_s_i_o_n_s
                      When mirroring vms files, keep the  version
                      numbers.    If   false,  the  versions  are
                      stripped off and the only  the  base  file­
                      names are kept.  [true]

       _v_m_s___x_f_e_r___t_e_x_t  Pattern  of  vms  files to transfer in TEXT
                      mode          (case           insensitive).
                      ['readme$|info$|listing$|.c$']

       _n_a_m_e___m_a_p_p_i_n_g_s  Remote to local pathname mappings (a perl ss
                      command, eg. s:old:new:).  ['']

       _e_x_t_e_r_n_a_l___m_a_p_p_i_n_g
                      External routine to perform name  mappings.
                      ['']

       _g_e_t___n_e_w_e_r      Get  the  remote  file if its date is newer
                      than local.  [true]

       _g_e_t___s_i_z_e___c_h_a_n_g_e
                      Get the file if the size is different  from
                      local.    If  a  file  is  compressed  when



                            Mirror 2.6                          6





MIRROR(1L)                                             MIRROR(1L)


                      fetched, the size is automatically ignored.
                      [true]

       _c_o_m_p_r_e_s_s___p_a_t_t  Regexp  of files to compress before storing
                      locally.  See _g_e_t___s_i_z_e___c_h_a_n_g_e.  ['']

       _c_o_m_p_r_e_s_s___e_x_c_l  Regexp  of  files  not  to  compress  (case
                      insensitive).  [\.(z|gz)$]

       _c_o_m_p_r_e_s_s___p_r_o_g  Program  to  compress files.  If set to the
                      word compress or gzip,  the  full  pathname
                      and  correct _c_o_m_p_r_e_s_s___s_u_f_f_i_x will automati­
                      cally be set.  When using gzip, level -9 is
                      used.   Note  that  _c_o_m_p_r_e_s_s___s_u_f_f_i_x  can be
                      reset to a non-standard value by setting it
                      after _c_o_m_p_r_e_s_s___p_r_o_g.  [compress]

       _c_o_m_p_r_e_s_s___s_u_f_f_i_x
                      Character(s)  the  compress program appends
                      to files.  If  _c_o_m_p_r_e_s_s___p_r_o_g  is  compress,
                      this  defaults  to .Z.  If _c_o_m_p_r_e_s_s___p_r_o_g is
                      gzip, this defaults to .gz.  ['']

       _c_o_m_p_r_e_s_s___c_o_n_v___p_a_t_t
                      If _c_o_m_p_r_e_s_s___p_r_o_g is  gzip,  files  matching
                      this  pattern  are uncompressed and gzip'ed
                      before storing locally.   Compression  con­
                      version  is  only  meant  to do compress to
                      gzip conversion.  [(\.Z|\.taz)$]

       _c_o_m_p_r_e_s_s___c_o_n_v___e_x_p_r
                      Perl expression to convert suffix from com­
                      press         to         gzip        style.
                      [s/\.Z$/\.gz/;s/\.taz$/\.tgz/]

       _c_o_m_p_r_e_s_s___s_i_z_e___f_l_o_o_r
                      Only compress files smaller than this size.
                      [0]

       _f_o_r_c_e___t_i_m_e_s    Force  local  times  to match remote times.
                      [yes]

       _r_e_t_r_y___c_a_l_l     If initial connect fails, retry ONCE  after
                      ONE  minute.  This is to handle sites which
                      reverse lookup the incoming host but  some­
                      times timeout on the first attempt.  [yes]

       _u_p_d_a_t_e___l_o_g     Filename,  relative  to _l_o_c_a_l___d_i_r, where an
                      update report is to be kept.  ['']

       _m_a_i_l___t_o        Mail a log of the work done to  this  comma
                      separated list of people.  ['']

       _u_s_e_r           User   name   or   uid  to  give  to  local



                            Mirror 2.6                          7





MIRROR(1L)                                             MIRROR(1L)


                      pathnames.  ['']

       _g_r_o_u_p          Group name or gid to give  to  local  path­
                      names.  ['']

       _f_i_l_e___m_o_d_e      Mode to give files created locally.  [0444]

       _d_i_r___m_o_d_e       Mode to give directories  created  locally.
                      [0755]

       _t_i_m_e_o_u_t        Timeout  ftp  requests after this many sec­
                      onds.  [40]

       _f_t_p___p_o_r_t       Port number of remote ftp daemon.  [21]

       _p_r_o_x_y          Set to 1 to use proxy ftp service.  [0]

       _p_r_o_x_y___f_t_p___p_o_r_t Port number of  proxy-service  ftp  daemon.
                      This  value  should be changed depending on
                      which proxy library you are using.  [4514]

       _p_r_o_x_y___g_a_t_e_w_a_y  Name of proxy-service, may also be supplied
                      by  the environment variable IINNTTEERRNNEETT__HHOOSSTT.
                      [internet-gateway]

       _u_s_i_n_g___s_o_c_k_s    Set to 1 if you are using a  SOCKS  version
                      of perl.  [0]

       _p_a_s_s_i_v_e___f_t_p    Set to 1 if you want to use the PASV exten­
                      sion of the FTP protocol.  Especially  use­
                      ful   with   firewalls,   other  proxy  FTP
                      servers, and the variable _u_s_i_n_g___s_o_c_k_s.  [0]

       _m_o_d_e___c_o_p_y      Flag indicating if we need to copy the mode
                      bits.  [false]

       _i_n_t_e_r_a_c_t_i_v_e    A non-batch transfer.  Implied by --gg  flag.
                      [false]

       _t_e_x_t___m_o_d_e      If  true,  files  are  transferred  in text
                      mode.  Un*x prefers binary so that  is  the
                      default.  [false]

       _f_o_r_c_e          If  true,  all  files  will  be transferred
                      regardless of size or time-stamp.  [false]

       _g_e_t___f_i_l_e       Perform get, not put by default.  [true]

       _v_e_r_b_o_s_e        Verbose messages.  [false]

       _d_e_l_e_t_e___s_o_u_r_c_e  Delete the  source  files  and  directories
                      once  transferred.  (This is no longer sup­
                      ported.)  [false]




                            Mirror 2.6                          8





MIRROR(1L)                                             MIRROR(1L)


       _d_i_s_c_o_n_n_e_c_t     Disconnect from remote site at end of pack­
                      age.  [false]

       _m_a_i_l___p_r_o_g      Program called to send to the _m_a_i_l___t_o list.
                      May be passed  the  argument  _m_a_i_l___s_u_b_j_e_c_t.
                      Defaults  to  mailx, Mail, mail or whatever
                      is available on your system.  ['']

       _m_a_i_l___s_u_b_j_e_c_t   mirror update ['-s]

       _h_o_s_t_n_a_m_e       Mirror automatically skips  packages  whose
                      site  variable matches this host.  Defaults
                      to the local hostname.  ['']

       _u_s_e___f_i_l_e_s      Put the associative arrays that mirror uses
                      into tmp files.  [false]

       _u_m_a_s_k          Do   not  allow  setuid  things  across  by
                      default.  [07000]

       _u_s_e___t_i_m_e_l_o_c_a_l  Time-stamp files to local  time  zone.   If
                      false,  the  time  zone  is set to offset 0
                      (compatible with older versions of mmiirrrroorr).
                      [true]

       _r_e_m_o_t_e___g_r_o_u_p   If  present  set  the  remote 'site group'.
                      ['']

       _r_e_m_o_t_e___g_p_a_s_s   If present set  the  remote  'site  gpass'.
                      ['']

       _r_e_m_o_t_e___i_d_l_e    If  not  null,  try and set the remote idle
                      timer to this.  ['']

       _m_a_k_e___b_a_d___s_y_m_l_i_n_k_s
                      If true, symlinks will be made  to  invalid
                      (non-existent) pathnames.  Under older ver­
                      sions this defaulted to true.  [false]

       _f_o_l_l_o_w___l_o_c_a_l___s_y_m_l_i_n_k_s
                      Regexp of pathnames that should be followed
                      to  the  file  or  directory they point at.
                      This makes local symlinks invisible to mmiirr­­
                      rroorr.  ['']

       _g_e_t___m_i_s_s_i_n_g    Really  get files.  When set to false, only
                      deletions  and  symlinking  will  be  done.
                      Used  to  delete  expired  files older than
                      _m_a_x___d_a_y_s without  retrieving  older  files.
                      [true]

       Each  group of keywords defines how to mirror a particular
       package and should begin with a unique _p_a_c_k_a_g_e line.   The
       package  name  is  used in report generation and by the --pp



                            Mirror 2.6                          9





MIRROR(1L)                                             MIRROR(1L)


       argument, so pick something mnemonic.  The minimum  needed
       for  each  package  is  the  _p_a_c_k_a_g_e, _s_i_t_e, _r_e_m_o_t_e___d_i_r and
       _l_o_c_a_l___d_i_r.  On finding a package  line,  all  the  default
       values are reset.

       If  the  package  name  is  ddeeffaauullttss, then no site is con­
       tacted, but the default values given for any keywords  are
       changed.   Normally  all the defaults are in the file mmiirr­­
       rroorr..ddeeffaauullttss which will be automatically loaded before any
       package details.

              ## SSaammppllee mmiirrrroorr..ddeeffaauullttss
              ppaacckkaaggee==ddeeffaauullttss
                   ## TThhee LLOOCCAALL hhoossttnnaammee -- iiff nnoott tthhee ssaammee aass ``hhoossttnnaammee`` rreettuurrnnss
                   ## ((II aaddvveerrttiissee tthhee nnaammee ssrrcc..ddoocc..iicc..aacc..uukk bbuutt tthhee mmaacchhiinnee iiss
                   ##  rreeaallllyy ppuuffffiinn..ddoocc..iicc..aacc..uukk..))
                   hhoossttnnaammee==ssrrcc..ddoocc..iicc..aacc..uukk
                   ## KKeeeepp aallll llooccaall__ddiirrss rreellaattiivvee ttoo hheerree
                   llooccaall__ddiirr==//ppuubblliicc//
                   rreemmoottee__ppaasssswwoorrdd==uukkuuuugg--ssoofftt@@ddoocc..iicc..aacc..uukk

       If  the  package is not ddeeffaauullttss, then mmiirrrroorr will perform
       the  following  steps.   Unless  an  internal  failure  is
       detected,  any  error will cause the current package to be
       skipped and the next one tried.

       If mmiirrrroorr is not already connected to the  site,  it  will
       disconnect  from  any  site it is already connected to and
       attempt to connect to the remote site's  ffttpp  daemon.   It
       will  then login using the given remote username and pass­
       word.  Once connected, mmiirrrroorr turns on binary mode  trans­
       fers.   Next  it  changes to the given local directory and
       scans it to get  the  details  of  the  local  files  that
       already  exist.  If necessary, the local directory will be
       created.  Once this is completed, the remote directory  is
       scanned  in a similar fashion.  MMiirrrroorr does this by chang­
       ing to the remote directory and running the ftp LIST  com­
       mand,  passing the _f_l_a_g_s___r_e_c_u_r_s_i_v_e options or _f_l_a_g_s___n_o_n_r_e_­
       _c_u_r_s_i_v_e depending on the  value  of  _r_e_c_u_r_s_i_v_e_.   Alterna­
       tively  a  file  containing  the  directory listing may be
       retrieved.  Each remote pathname will have  any  specified
       mappings performed on it to create a local pathname.  Then
       any  checks  specified  by  the  _e_x_c_l_u_d_e___p_a_t_t,   _m_a_x___d_a_y_s,
       _g_e_t___n_e_w_e_r  and  _g_e_t___s_i_z_e___c_h_a_n_g_e  keywords  are  applied on
       names of files or symlinks.  Only _e_x_c_l_u_d_e___p_a_t_t checking is
       applied to directories.

       The  above creates a list of all required remote files and
       the local pathnames to store them in.

       Once the directory  listing  is  completed,  all  required
       files  are  fetched  from the remote site into their local
       path names.  This is done by retrieving the  file  into  a
       temporary  file in the target directory.  If required, the



                            Mirror 2.6                         10





MIRROR(1L)                                             MIRROR(1L)


       temporary file is compressed, gzip'ed or  split  (or  com­
       pressed or gzip'ed and then split).  The temporary file is
       renamed when the transfer is successful.

FFIILLEESSTTOORREESS
       Mirror uses the remote directory listing to work out  what
       files are available.  Mirror was originally targetted con­
       nect to unix ftp daemons using a standard _l_s command.   To
       use  a unix host with a non-standard ls or a non unix host
       it is necessary to set the _r_e_m_o_t_e___f_s variable to match the
       kind of directory listing that will be returned.  There is
       some interaction between _r_e_m_o_t_e___f_s and other variables  in
       particular      _f_l_a_g_s___r_e_c_u_r_s_i_v_e,      _r_e_c_u_r_s_e___h_a_r_d     and
       _g_e_t___s_i_z_e___c_h_a_n_g_e.  The following sub sections show examples
       of the results of running the ftp _d_i_r command on the vari­
       ous kinds of archive and recommendations for related vari­
       ables.  With some unusually setups archive you may have to
       vary from the recommended variable setups.

   rreemmoottee__ffss==uunniixx
              ttoottaall 6655
              --rrww--rr----rr---- 11 uukkuuuugg  uukkuuuugg   22224455 JJuunn 2288 2200::0066 RREEAADDMMEE
              --rrww--rr----rr---- 11 uukkuuuugg  uukkuuuugg  6611994499 JJuunn 2299 1199::1133 mmiirrrroorr--22..11..ttaarr..ggzz

       This is the default and you should not  normally  have  to
       reset any other variables.

   rreemmoottee__ffss==ddllss
              0000iinnddeexx..ttxxtt      118899991166
              00rreeaaddmmee            55779933
              11__xx//                  ==  OOSS//22 11..xx--ssppeecciiffiicc ffiilleess

       This is an _l_s variant used on some unix archives.  It pro­
       vides descriptions of known  items  in  the  listing.  Set
       _f_l_a_g_s___r_e_c_u_r_s_i_v_e to -dtR.

   rreemmoottee__ffss==nneettwwaarree
              -- [[RR--------FF----]] jjrrdd                  11664466       MMaayy 0077 2211::4433    iinnddeexx
              dd [[RR--------FF----]] jjrrdd                   551122       SSeepp 0099 1100::5522    nneettwwiirree
              dd [[RR--------FF----]] jjrrdd                   551122       SSeepp 0022 0011::3311    ppkkttddrrvvrr
              dd [[RRWWCCEE--FF----]] jjrrdd                   551122       SSeepp 0044 1100::5555    iinnccoommiinngg

       or

              --[[RR--------FF----]] 11 jjrrdd                  11664466       MMaayy 0077 2211::4433    iinnddeexx
              dd[[RR--------FF----]] 11 jjrrdd                   551122       SSeepp 0099 1100::5522    nneettwwiirree
              dd[[RR--------FF----]] 11 jjrrdd                   551122       SSeepp 0022 0011::3311    ppkkttddrrvvrr

       This is used by Novell archives.  Set _r_e_c_u_r_s_e___h_a_r_d to true
       and  set  _f_l_a_g_s___r_e_c_u_r_s_i_v_e  to  be   nothing.    See   also
       _r_e_m_o_t_e___d_i_r.

   ddoossffttpp
              0000--iinnddeexx..ttxxtt  66,,447711 1133::5544  77//2200//9933   aallaabbaammaa..ttxxtt   11,,224466 2233::2299  55//0088//9922



                            Mirror 2.6                         11





MIRROR(1L)                                             MIRROR(1L)


              aallaasskkaa..ttxxtt      887733 2233::2299  55//0088//9922   aallbbeerrttaa..ttxxtt   22,,116622 2233::2299  55//0088//9922

       dosftp   is   for   an  ftp  daemon  on  dos  boxes.   Set
       _r_e_c_u_r_s_e___h_a_r_d to true and set _f_l_a_g_s___r_e_c_u_r_s_i_v_e  to  nothing.
       See also _r_e_m_o_t_e___d_i_r.

   rreemmoottee__ffss==mmaaccooss
              --------------rr----      00      112277   112277 AAuugg 2277 1133::5533 !!GGoopphheerr LLiinnkkss
              ddrrwwxxrrwwxxrr--xx          ffoollddeerr    3322 SSeepp  99 1166::3300 FFAAQQ
              ddrrwwxxrrwwxx--wwxx          ffoollddeerr     00 SSeepp  99 0099::5599 iinnccoommiinngg

       macos  is  for  one  of  Macintosh  ftp  daemon  variants.
       Although the  output  is  similar  to  unix  it  the  unix
       _r_e_m_o_t_e___f_s type cannot cope with it because there are three
       file  sizes  for  each  file.   Set_r_e_c_u_r_s_e___h_a_r_d  to  true,
       _f_l_a_g_s___r_e_c_u_r_s_i_v_e  to  nothing, _g_e_t___s_i_z_e___c_h_a_n_g_e to false and
       _c_o_m_p_r_e_s_s___p_a_t_t to nothing (this last setting is due to  the
       unusual  file  names  upsetting the shell used to run com­
       press).  See also _r_e_m_o_t_e___d_i_r.

   rreemmoottee__ffss==vvmmss
              UUSSEERRSS::[[AANNOONNYYMMOOUUSS..PPUUBBLLIICC]]

              11--RREEAADDMMEE..FFIIRRSSTT;;1133     99  1144--JJUUNN--11999933 1133::0099 [[AANNOONNYYMMOOUUSS]] ((RRWWEE,,RRWWEE,,RREE,,RREE))
              PPAALLTTEERR..DDIIRR;;11          11  1188--JJAANN--11999933 1111::5566 [[AANNOONNYYMMOOUUSS]] ((RRWWEE,,RRWWEE,,RREE,,RREE))
              PPRREESSSS--RREELLEEAASSEESS..DDIIRR;;11
                                    11  1111--AAUUGG--11999922 2200::0055 [[AANNOONNYYMMOOUUSS]] ((RRWWEE,,RRWWEE,,,,))


       alternatively:

              [[VVMMSSSSEERRVV..FFIILLEESS]]AALLAARRMM..DDIIRR;;11      11//33          55--MMAARR--11999933 1188::0099
              [[VVMMSSSSEERRVV..FFIILLEESS]]AALLAARRMM..TTXXTT;;11      11//33          44--FFEEBB--11999933 1122::2200

       Set _f_l_a_g_s___r_e_c_u_r_s_i_v_e  to  '[...]'  and  _g_e_t___s_i_z_e___c_h_a_n_g_e  to
       false.   _r_e_c_u_r_s_e___h_a_r_d is not available with vms.  See also
       the _v_m_s___k_e_e_p___v_e_r_s_i_o_n_s and _v_m_s___x_f_e_r___t_e_x_t variables.


   rreemmoottee__ffss==iinnffoommaacc
       This is a special just meant to handle the sumex-aim.stan­
       ford.edu info-mac directory listing stored on that archive
       in help/all-files.  _r_e_c_u_r_s_e___h_a_r_d should be set to true.

   rreemmoottee__ffss==ddoossiisshh
       This is for a DOS/Windows FTP server with  a  faintly  DOS
       like output

              0033--0044--9944  0088::4455PPMM       <<DDIIRR>>          ..
              0033--0044--9944  0088::4455PPMM       <<DDIIRR>>          ....
              0033--0044--9944  0099::5588AAMM                 99771188 CCoonndduuiitt
              0033--0044--9944  0099::5599AAMM                 88774455 EEvvee

       _r_e_c_u_r_s_e___h_a_r_d  should be set to true and _f_l_a_g_s___r_e_c_u_r_s_i_v_e to



                            Mirror 2.6                         12





MIRROR(1L)                                             MIRROR(1L)


       nothing.

   rreemmoottee__ffss==llssppaarrssee
       Allow reparsing of the listing generated  by  mirror  with
       debugging  turned  to a high level.  Meant only for mirror
       wizards.

EEXXAAMMPPLLEESS
       Here is the  mirror.defaults  file  from  the  archive  on
       src.doc.ic.ac.uk:

              ## TThhiiss iiss tthhee ddeeffaauulltt mmiirrrroorr sseettttiinnggss uusseedd bbyy mmyy ssiittee::
              ## ssrrcc..ddoocc..iicc..aacc..uukk ((114466..116699..22..11))
              ## TThhiiss iiss hhoommee ooff tthhee UUKKUUUUGG SSooffttwwaarree DDiissttrriibbuuttiioonn SSeerrvviiccee

              ppaacckkaaggee==ddeeffaauullttss
                   ## TThhee LLOOCCAALL hhoossttnnaammee -- iiff nnoott tthhee ssaammee aass ``hhoossttnnaammee``
                   ## ((II aaddvveerrttiissee tthhee nnaammee ssrrcc..ddoocc..iicc..aacc..uukk bbuutt tthhee mmaacchhiinnee iiss
                   ##  rreeaallllyy ppuuffffiinn..ddoocc..iicc..aacc..uukk))
                   hhoossttnnaammee==ssrrcc..ddoocc..iicc..aacc..uukk
                   ## KKeeeepp aallll llooccaall__ddiirrss rreellaattiivvee ttoo hheerree
                   llooccaall__ddiirr==//ppuubblliicc//
                   rreemmoottee__ppaasssswwoorrdd==uukkuuuugg--ssoofftt@@ddoocc..iicc..aacc..uukk
                   mmaaiill__ttoo==
                   ## DDoonn''tt mmiirrrroorr ffiillee mmooddeess..  SSeett aallll ddiirrss//ffiilleess ttoo tthheessee
                   ddiirr__mmooddee==00775555
                   ffiillee__mmooddee==00444444
                   ## BByy ddeeffaauulltt,, ffiilleess aarree oowwnneedd bbyy rroooott..zzeerroo
                   uusseerr==00
                   ggrroouupp==00
              ##    ## KKeeeepp aa lloogg ffiillee iinn eeaacchh uuppddaatteedd ddiirreeccttoorryy
              ##    uuppddaattee__lloogg==..mmiirrrroorr
                   uuppddaattee__lloogg==
                   ## DDoonn''tt oovveerrwwrriittee mmyy mmiirrrroorr lloogg wwiitthh tthhee rreemmoottee oonnee..
                   ## DDoonn''tt rreettrriieevvee aannyy ooff tthheeiirr mmiirrrroorr tteemmppoorraarryy ffiilleess..
                   ## DDoonn''tt ttoouucchh aannyytthhiinngg wwhhoossee nnaammee bbeeggiinnss wwiitthh aa ssppaaccee!!
                   ## nnoorr aannyy FFSSPP oorr ggoopphheerr ffiilleess......
                   eexxcclluuddee__ppaatttt==((^^||//))((..mmiirrrroorr$$||..iinn....**..$$||MMIIRRRROORR..LLOOGG||##..**##||..FFSSPP||..ccaacchhee||..zziippppeedd||lloosstt++ffoouunndd//|| ))
                   ## TTrryy ttoo ccoommpprreessss eevveerryytthhiinngg
                   ccoommpprreessss__ppaatttt==..
                   ccoommpprreessss__pprroogg==ccoommpprreessss
                   ## DDoonn''tt ccoommpprreessss iinnffoorrmmaattiioonn ffiilleess,, ffiilleess tthhaatt ddoonn''tt bbeenneeffiitt ffrroomm
                   ## bbeeiinngg ccoommpprreesssseedd,, ffiilleess tthhaatt tteellll ffttppdd,, ggoopphheerr,, wwaaiiss...... ttoo ddoo tthhiinnggss,,
                   ## tthhee ssoouurrcceess ffoorr ccoommpprreessssiioonn pprrooggrraammss......
                   ## ((NNoottee tthhiiss iiss tthhee oonnllyy rreeggeexxpp tthhaatt iiss ccaassee iinnsseennssiittiivvee..))
                   ccoommpprreessss__eexxccll++||^^..nnoottaarr$$||--zz||..ttaazz$$||..ttaarr..ZZ||..aarrcc$$||..zziipp$$||..llzzhh$$||..zzoooo$$||..eexxee$$||..llhhaa$$||..zzoomm$$||..ggiiff$$||..jjppeegg$$||..jjppgg$$||..mmppeegg$$||..aauu$$||rreeaadd..**mmee||iinnddeexx||..mmeessssaaggee||iinnffoo||ffaaqq||ggzziipp||ccoommpprreessss
                   ## DDoonn''tt ddeelleettee oowwnn mmiirrrroorr lloogg oorr aannyy ..nnoottaarr ffiilleess ((iinnccll iinn ssuubbddiirrss))
                   ddeelleettee__eexxccll==((^^||//))..((mmiirrrroorr||nnoottaarr))$$
                   ## IIggnnoorree aannyy llooccaall rreeaaddmmee ffiilleess
                   llooccaall__iiggnnoorree==RREEAADDMMEE..ddoocc..iicc
                   ## AAuuttoommaattiiccaallllyy ddeelleettee llooccaall ccooppiieess ooff ffiilleess tthhaatt tthhee
                   ## rreemmoottee ssiittee hhaass zzaappppeedd
                   ddoo__ddeelleetteess==ttrruuee




                            Mirror 2.6                         13





MIRROR(1L)                                             MIRROR(1L)


       Here are some sample package descriptions:

              ppaacckkaaggee==ggnnuu
                   ccoommmmeenntt==PPoowweerrffuull aanndd ffrreeee UUnn**xx uuttiilliittiieess
                   ssiittee==pprreepp..aaii..mmiitt..eedduu
                   rreemmoottee__ddiirr==//ppuubb//ggnnuu
                   ## LLooccaall__ddiirr++ ccaauusseess ggnnuu ttoo bbee aappppeennddeedd ttoo tthhee ddeeffaauulltt llooccaall__ddiirr
                   ## ssoo mmaakkiinngg //ppuubblliicc//ggnnuu
                   llooccaall__ddiirr++ggnnuu
                   eexxcclluuddee__ppaatttt++||^^LLiissttAArrcchhiivveess//||^^lloosstt++ffoouunndd//||^^sscchheemmee--77..00//||^^..hhiissttoorryy
                   ## II tteenndd ttoo oonnllyy kkeeeepp tthhee llaatteesstt ccoouuppllee ooff vveerrssiioonnss ooff tthhiinnggss
                   ## tthhiiss ssttooppss mmiirrrroorr ffrroomm rreettrriieevviinngg tthhee oollddeerr vveerrssiioonnss II''vvee rreemmoovveedd
                   mmaaxx__ddaayyss==3300
                   ddoo__ddeelleetteess==ffaallssee

              ppaacckkaaggee==XX1111RR55
                   ccoommmmeenntt==XX WWiinnddoowwss ((wwiinnddoowwiinngg ggrraapphhiiccss ssyysstteemm ffoorr UUnn**xx))
                   ssiittee==eexxppoorrtt..llccss..mmiitt..eedduu
                   rreemmoottee__ddiirr==//ppuubb//RR55
                   llooccaall__ddiirr++ccoommppuuttiinngg//ggrraapphhiiccss//ssyysstteemmss//XX1111//ppuubb//RR55
                   ## TThhiiss iiss aa llooccaall ssyymmlliinnkk ttoo tthhee ffrreeee--ffoorr--aallll ccoonnttrriibb aarreeaa
                   ## aanndd iiss mmiirrrroorreedd eellsseewwhheerree
                   llooccaall__iiggnnoorree==^^ccoonnttrriibb$$
                   ## DDoonn''tt ccoommpprreessss aa tthhiinngg..  IItt iiss aallrreeaaddyy ccoommpprreesssseedd
                   ## bbuutt ddooeessnn''tt llooookk iitt..
                   ccoommpprreessss__ppaatttt==

              ppaacckkaaggee==ccnneewwss
                   ccoommmmeenntt==TThhee CC NNeewwss ssyysstteemm
                   ssiittee==ffttpp..ccss..ttoorroonnttoo..eedduu
                   rreemmoottee__ddiirr==//ppuubb//cc--nneewwss
                   llooccaall__ddiirr++ccoommppuuttiinngg//uusseenneett//ssooffttwwaarree//ttrraannssppoorrtt//cc
                   ccoommpprreessss__eexxccll++||ppaattcchheess//PPAATTCCHHDDAATTEESS||WWhheerreeFFrroomm

              ## TTHHIISS IISS JJUUSSTT AA TTEESSTT
              ppaacckkaaggee==tteesstt vvmmss ssiittee
                   ssiittee==vvmmssbbooxx..ssoommeewwhheerree..aacc..uukk
                   llooccaall__ddiirr==//ttmmpp//ccooppyy44
                   rreemmoottee__ddiirr==vvmmsssseerrvv//ffiilleess
                   rreemmoottee__ffss==vvmmss
                   ## MMuusstt ddoo tthheessee sseettttiinnggss ffoorr VVMMSS
                   ffllaaggss__rreeccuurrssiivvee==[[......]]
                   ggeett__ssiizzee__cchhaannggee==ffaallssee

              ## aanndd oonn,, aanndd oonn ......


HHIINNTTSS
       On  adding a new package, first check it out by turning on
       the --nn option.

       If you are adding to an existing archive, then it is  usu­
       ally  best  to force the time-stamps of the existing local
       files so time comparisons with the remote files will work.



                            Mirror 2.6                         14





MIRROR(1L)                                             MIRROR(1L)


       Try  and  keep  all packages that are being retrieved from
       the same site together.  That way mmiirrrroorr will only have to
       login once.

       Remember that all regexp's are Perl regular expressions.

       If  the  remote  site  contains  symlinks that you want to
       "flatten out" into the corresponding files, then  do  this
       by changing the flags passed to the remote ls:
              _f_l_a_g_s___r_e_c_u_r_s_i_v_e++L
       or
              _f_l_a_g_s___n_o_n_r_e_c_u_r_s_i_v_e++L

       First  test  this by trying a llss --llRRaattLL on the remote site
       under the ftp command to check whether  the  remote  file-
       store has any symlink loops.

       If you are mirroring a very large site that changes infre­
       quently, add _m_a_x___d_a_y_s=7 to the settings after it  is  ini­
       tially  mirrored.   That way mirror will only have to con­
       sider recent files when updating.  Then once  a  week,  or
       whenever necessary, call mirror with --kk_m_a_x___d_a_y_s=0 to force
       a full update.

       If you don't want to compress  anything  from  the  remote
       site  the  easiest  way  to  do  this  is  to set the _c_o_m_­
       _p_r_e_s_s___p_a_t_t to nothing.

       If you want to run a command at the  end  of  mirroring  a
       package  a useful trick is to reset the _m_a_i_l___p_r_o_g variable
       to be the program name and _m_a_i_l___t_o to be the arguments.

       For netware, dosftp, macos and VMS you should normally set
       remote_dir to be the home directory of the remote ftp dae­
       mon.  Connect in manually and  before  changing  directory
       use  the  pwd  command  to find where home is.  If you are
       only mirroring part of the tree then give  the  full  path
       name including this home directory at the start.

       macos  names can sometimes contain characters that make it
       hard to pass them through un*x shells.  Since  compressing
       files  is  done  via  a shell it would be best to turn off
       compression with compress_patt=

       macos files seem to always change size when transfered, in
       either  binary  or  text mode.  So it would be best to set
       get_size_change=false

NNEETTIIQQUUEETTTTEE
       If you are going to mirror a remote site, please obey  any
       restrictions that the site administrators place on access.
       You can generally find the restrictions on  connecting  to
       the  archive using the standard ffttpp command.  Any restric­
       tions are normally  given  as  a  login  banner  or  in  a



                            Mirror 2.6                         15





MIRROR(1L)                                             MIRROR(1L)


       (hopefully) obvious file.

       Here are, what I hope are, some good general rules:

       Only  mirror a site well outside the working hours of both
       the local and remote sites.

       It is probably unfriendly to try to mirror a  remote  site
       more than once a day.

       Before  trying  to  mirror a remote site, try and find the
       packages you want from local archives, as no one  will  be
       pleased  if  you  soak up a lot of network bandwidth need­
       lessly.

       If you have a local archive, then tell people about it  so
       they  don't  have to waste bandwidth and CPU at the remote
       site.

       Do remember to check your config-files from time  to  time
       in  case  the  remote  archive  has  changed  their access
       restrictions.

       Check the remote site regularly for any new  restrictions.

SSEEEE AALLSSOO
       perl(l), ftp(1), mm(1)

BBUUGGSS
       Some of the netiquette guidelines should be enforced.

       Should be able to cope with links as well as symlinks.

       Suffers from _c_r_e_e_p_i_n_g _f_e_a_t_u_r_i_s_m.

RREEMMEEMMBBEERR
       Objects in a mirror are closer than you think!

AAUUTTHHOORR
       Written  by Lee McLoughlin <lmjm@doc.ic.ac.uk>.  It uses a
       heavily rewritten and extended version of the ftp.pl pack­
       age originally by: Alan R. Martello <al@ee.pitt.edu> which
       uses lchat.pl which is based on the chat2.pl  package  by:
       Randal L. Schwartz <merlyn@ora.com>

       Special  thanks  to the following people for patches, com­
       ments and other suggestions that have  helped  to  improve
       mirror.  If I have omitted anyone, please contact me.

       James Revell <revell@uunet.uu.net>
       Chris Myers <chris@wugate.wustl.edu>
       Amos Shapira <amoss@cs.huji.ac.il>
       Paul A Vixie <vixie@pa.dec.com>
       Jonathan Kamens <jik@pit-manager.mit.edu>



                            Mirror 2.6                         16





MIRROR(1L)                                             MIRROR(1L)


       Christian Andretzky <casys@otto.mb3.tu-chemnitz.de>
       Kean Stump <kean@ucs.orst.edu>
       Anita Eijs <anita@hermes.bouw.tno.nl>
       Simon E Sperro <S.E.Sperro@gdr.bath.ac.uk>
       Aaron Wohl <aw0g+@andrew.cmu.edu>
       Michael Meissner <meissner@osf.org>
       Michael Graff <explorer@iastate.edu>
       Bradley Rhoades <us267388@mail.mmmg.com>
       Edwards Reed <eer@cinops.xerox.com>
       Joachim Schrod <schrod@iti.informatik.th-darmstadt.de>
       David Woodgate <David.Woodgate@mel.dit.csiro.au>
       Pieter Immelman <pi@itu1.sun.ac.za>
       Jost Krieger <x920031@bus072.rz.ruhr-uni-bochum.de>
       Erez HWank1 Zadok <ezk@cs.columbia.edu>











































                            Mirror 2.6                         17


