<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.1.2//EN"
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">

<article>

<articleinfo>

<title>DNS COMO</title>

<author>
<firstname>Nicolai Langfeldt <ulink
url="mailto:janl@math.uio.no"
>janl@math.uio.no</ulink
>
Traducción: Pedro Pablo Fábrega Martínez <ulink
url="mailto:pfabrega@arrakis.es"
>pfabrega@arrakis.es</ulink
> Julio 1997</firstname>
</author>

<pubdate>v1.3.2, 3 Junio 1997</pubdate>

<abstract>

<para>
COMO ser un administrador DNS en poco tiempo.
</para>

</abstract>

</articleinfo>

<sect1>
<title>Preámbulo</title>

<para>
<variablelist>

<varlistentry>
<term>Claves:</term>
<listitem>
<para>
DNS, bind, named, dialup, ppp, slip, Internet, domain,
name, hosts, resolving
</para>
</listitem></varlistentry>
</variablelist>
</para>

<sect2>
<title>Rollo Legal</title>

<para>
&copy;opyright 1995 Nicolai Langfeldt. No modificar sin incluir el
copyright, distribúyalo libremente, pero mantenga el mensaje de copyright.
</para>

</sect2>

<sect2>
<title>Créditos y solicitud de ayuda.</title>

<para>
Quiero dar las gracias a Arnt Gulbrandsen, quien leyó los borradores para
este trabajo dedicándole mucho de su tiempo y proporcionando muchas y muy
útiles sugerencias. También quiero dar las gracias a aquellas personas que
me enviaron sugerencias por email y gracias por sus notas. Gracias, me
ayudasteis a seguir con esto. 
</para>

<para>
Esto nunca será un documento acabado, por favor mandadme correo con
vuestros problemas y éxitos, esto hará mejorar este COMO. Así que por
favor mandad dinero, comentarios y/o preguntas a <literal remap="tt"><ulink
url="mailto:janl@math.uio.no"
>janl@math.uio.no</ulink
></literal>.  Si envía un
E-mail, por favor asegúrese de que su dirección de remitente es correcta,
recibo un montón de E-mail. Asimismo, por favor lea la sección de las PUF
(<xref linkend="PUF"/>) antes de enviarme un mail.
</para>

<para>
Si quiere traducir este COMO, por favor notifíquemelo para que yo pueda
mantener la pista de las lenguas en las que he sido publicado <literal remap="tt">:-)</literal>. 
</para>

</sect2>

<sect2>
<title>Dedicatoria</title>

<para>
Este COMO está dedicado a Anne Line Norheim. Aunque ella probablemente
nunca lo leerá porque no es de esa clase de chicas. 
</para>

</sect2>

</sect1>

<sect1>
<title>Introducción.</title>

<para>
Lo que es esto y lo que no es.
</para>

<para>
Para los que comienzan, <emphasis remap="bf">DNS</emphasis> es el <emphasis remap="bf">Domain Name System (Sistema
de Nombres de Dominio)</emphasis>, las reglas de nomenclatura de las máquinas y
el software que mapea los nombres a números IP. Este documento COMO trata
de cómo definir tales conversiones usando un sistema <emphasis remap="bf">Linux</emphasis>. Una
conversión es simplemente una asociación entre dos cosas, en este caso un
nombre de máquina, como <literal remap="tt">ftp.linux.org</literal> y el número IP de la
máquina, <literal remap="tt">199.249.150.4</literal>.
</para>

<para>
El DNS es, para los no iniciados (Vd. <literal remap="tt">;-)</literal>, una de las áreas mas
opacas de la administración de una red. Este COMO tratará de aclarar
algunas cosas. 
</para>

<para>
Este documento describe cómo configurar un servidor de nombres DNS simple. 
Comenzaremos con un servidor <emphasis remap="it">caching only
server</emphasis>
<footnote>

<para>
Servidor que se limita a guardar en una caché las IPs
de los nombres de máquina más solicitados, obteniéndolas de servidores
externos.
</para>

</footnote>
, y continuaremos con la configuración de un servidor
DNS primario para un dominio. Para configuraciones más complejas puede
consultar la sección de PUF (<xref linkend="PUF"/>) de este documento. Si lo que
busca no está descrito allí, necesitará <emphasis remap="it">Documentación Real</emphasis>.
Volveremos a lo que es la <emphasis remap="it">Documentación Real</emphasis> en el último capítulo. 
</para>

<para>
<emphasis remap="bf">Antes de empezar</emphasis>, debe configurar su sistema convenientemente, de
forma que pueda hacer <literal remap="tt">telnet</literal> desde y hacia su máquina, efectuando
satisfactoriamente toda clase de conexiones de red, especialmente
<literal remap="tt">telnet 127.0.0.1</literal> entrando en su propia máquina (compruébelo
ahora). También necesita que los archivos <literal remap="tt">/etc/host.conf</literal> (o
<literal remap="tt">/etc/nsswitch.conf</literal>), <literal remap="tt">/etc/resolv.conf</literal> y
<literal remap="tt">/etc/hosts</literal> sean correctos como punto de partida, ya que no
explicaré sus funciones aquí.  Si NO tiene aun esta configuración y no
funciona en red, el <emphasis remap="it">NET-2 HOWTO</emphasis> explica como hacerlo. Léalo. 
</para>

<para>
Si está usando SLIP o PPP necesitará que funcionen correctamente. Lea el
<emphasis remap="it">PPP-COMO</emphasis> si no es así. 
</para>

<para>
Cuando digo <emphasis remap="it">``su máquina''</emphasis> quiero decir la máquina en la que está
intentando configurar DNS. No cualquier otra máquina que pueda tener en su
red. 
</para>

<para>
Supongo que <emphasis remap="bf">no está detrás de cualquier clase de cortafuegos</emphasis>
(<emphasis remap="it">firewall</emphasis>) que bloquee peticiones de nombres. Si necesita una
configuración especial, vea la sección PUF (<xref linkend="PUF"/>). 
</para>

<para>
El servicio de nombres en Unix es llevado a cabo por un programa, llamado
<literal remap="tt">named</literal>.
</para>

<para>
Éste forma parte del paquete <literal remap="tt">bind</literal>, que es coordinado por Paul Vixie
para <emphasis remap="it">The Internet Software Consortium</emphasis>. <literal remap="tt">named</literal> está incluido
en la mayoría de las distribuciones de Linux y generalmente se instala
como <literal remap="tt">/usr/sbin/named</literal>. Si tiene el fichero <literal remap="tt">named</literal>
probablemente pueda usarlo; si no lo tiene, puede obtener el binario en un
ftp de Linux, o conseguir los últimos y más voluminosos fuentes en
<literal remap="tt"><ulink
url="ftp://ftp.vix.com/pub/bind"
>ftp://ftp.vix.com/pub/bind</ulink
></literal>, bien de los subdirectorios de
versión actual, o de prueba, lo que mejor se adapte a su estilo de vida. 
</para>

<para>
<emphasis remap="bf">DNS es una base de datos cuyo ámbito es la Red</emphasis>. Tenga cuidado con
lo que pone en ella. Si pone incongruencias, Vd. y los demás obtendrán
incongruencias de ella. Mantenga su DNS limpia y consistente y conseguirá
un buen servicio de ella. Aprenda a usarla, administrarla, depurarla y
será otro buen administrador, salvando a la red de caer sobre sus rodillas
sobrecargada por falta de mantenimiento. 
</para>

<para>
En este documento expongo de forma llana varias cosas que no son
completamente verdad (son al menos medias verdades). Todo esto lo hago en
aras de la simplicidad. Todas funcionarán (probablemente <literal remap="tt">;-)</literal> si cree
en lo que digo.
</para>

<para>
<variablelist>

<varlistentry>
<term>Aviso:</term>
<listitem>
<para>
Haga una copia de seguridad de todos los archivos que le
indico que cambie si ya los tiene, y así si después si no funciona podrá
volver al principio. 
</para>
</listitem></varlistentry>
</variablelist>
</para>

</sect1>

<sect1>
<title>Servidor de nombres de ``sólo cacheo''.</title>

<para>
Un primer ataque a la configuración DNS, muy útil para los usuarios de
conexiones telefónicas.
</para>

<para>
Un servidor de nombres de ``sólo cacheo'' (<emphasis remap="it">caching only nameserver</emphasis>) 
obtendrá la respuesta a las solicitudes de nombre provenientes de su red
preguntando a servidores externos, recordando la respuesta para la próxima
vez que lo necesite. 
</para>

<para>
Lo primero que necesita es el archivo llamado <literal remap="tt">/etc/named.boot</literal>. 
Este archivo es leído cuando se inicia <literal remap="tt">named</literal>. Por ahora contendrá
simplemente: 
</para>

<para>

<screen>
;  Archivo boot de servidor de nombres de solo cacheo:
;
directory /var/named
;
; tipo          dominio                         fichero o maquina fuente
cache           .                               root.cache
primary         0.0.127.in-addr.arpa            pz/127.0.0
</screen>

</para>

<para>
<variablelist>

<varlistentry>
<term>MUY IMPORTANTE:</term>
<listitem>
<para>
En algunas versiones de este documento, en el
contenido de los archivos que aquí aparecen hay un par de espacios o
tabuladores antes del primer carácter no blanco. Se supone que estos
caracteres <emphasis remap="bf">NO</emphasis> están en el archivo.  Borre cualquier espacio
inicial de los archivos que corte y pegue de este COMO. 
</para>
</listitem></varlistentry>
</variablelist>
</para>

<para>
La línea <literal remap="tt">directory</literal> indica a <literal remap="tt">named</literal> dónde buscar los
archivos. Todos los archivos indicados a continuación serán relativos a
este directorio.  <literal remap="tt">/var/named</literal> es el directorio correcto de acuerdo
con el <emphasis remap="it"> LFS, Linux File system Standard</emphasis>. Así, <literal remap="tt">pz</literal> es un
directorio bajo <literal remap="tt">/var/named</literal>, esto es, <literal remap="tt">/var/named/pz</literal>. 
</para>

<sect2>
<title><literal remap="tt">/var/named/root.cache</literal></title>

<para>
Vamos a describir el archivo llamado <literal remap="tt">/var/named/root.cache</literal>
nombrado en el archivo <literal remap="tt">boot.named</literal>. 
</para>

<para>
<literal remap="tt">/var/named/root.cache</literal> debería contener esto:
</para>

<para>

<screen>
 .       518400  NS      D.ROOT-SERVERS.NET.
 .       518400  NS      E.ROOT-SERVERS.NET.
 .       518400  NS      I.ROOT-SERVERS.NET.
 .       518400  NS      F.ROOT-SERVERS.NET.
 .       518400  NS      G.ROOT-SERVERS.NET.
 .       518400  NS      A.ROOT-SERVERS.NET.
 .       518400  NS      H.ROOT-SERVERS.NET.
 .       518400  NS      B.ROOT-SERVERS.NET.
 .       518400  NS      C.ROOT-SERVERS.NET.
;
D.ROOT-SERVERS.NET.     3600000 A       128.8.10.90
E.ROOT-SERVERS.NET.     3600000 A       192.203.230.10
I.ROOT-SERVERS.NET.     3600000 A       192.36.148.17
F.ROOT-SERVERS.NET.     3600000 A       192.5.5.241
G.ROOT-SERVERS.NET.     3600000 A       192.112.36.4
A.ROOT-SERVERS.NET.     3600000 A       198.41.0.4
H.ROOT-SERVERS.NET.     3600000 A       128.63.2.53
B.ROOT-SERVERS.NET.     3600000 A       128.9.0.107
C.ROOT-SERVERS.NET.     3600000 A       192.33.4.12
</screen>

</para>

<para>
¡Recuerde lo que dije sobre los espacios iniciales!
</para>

<para>
Este archivo describe los servidores de nombres raíz en el mundo. Este
archivo cambiará a lo largo del tiempo y tiene que ser mantenido y
actualizado con una cierta regularidad.  Vea la sección de mantenimiento
(<xref linkend="mantenimiento"/>) para saber cómo mantenerlo actualizado. Este
archivo está descrito en la página <literal remap="tt">man</literal> de <literal remap="tt">named</literal>, pero
esto es, IMHO
<footnote>

<para>
<emphasis remap="it">In My Honest Opinion</emphasis>, EMMO o <emphasis remap="it">En Mi
Modesta Opinión</emphasis> en castellano.
</para>

</footnote>
, más apropiado para gente
que ya comprende <literal remap="tt">named</literal>.
</para>

<para>
La siguiente línea de <literal remap="tt">named.boot</literal> es la línea <literal remap="tt">primary</literal>.
Explicaré su uso en un capítulo posterior: Por ahora, cree un archivo
llamado <literal remap="tt">127.0.0</literal> en el subdirectorio <literal remap="tt">pz</literal>: 
</para>

<para>

<screen>
@               IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                                1       ; Numero de Serie
                                28800   ; Tasa de Refresco
                                7200    ; Tasa de Reintento
                                604800  ; Caducidad para secundario
                                86400)  ; Validez para Clientes
                        NS      ns.linux.bogus.
1                       PTR     localhost.
</screen>

</para>

<para>
A continuación necesita el archivo <literal remap="tt">/etc/resolv.conf</literal>, que será
algo similar a este:
</para>

<para>

<screen>
search subdominio.su-dominio.edu su-dominio.edu
nameserver 127.0.0.1
</screen>

</para>

<para>
La línea `<literal remap="tt">search</literal>' especifica en qué dominios se buscaría para
cualquier nombre de máquina a la que quiera conectar. La línea
`<literal remap="tt">nameserver</literal>' especifica la dirección de su servidor de nombres,
en este caso su propia máquina, ya que es ahí donde <literal remap="tt">named</literal> se
estará ejecutando. Si quiere una lista de varios servidores ponga una
línea <literal remap="tt">nameserver</literal> para cada uno. (Nota: <literal remap="tt">named</literal> nunca lee
este archivo, lo hace el resolutor que usa <literal remap="tt">named</literal>).
</para>

<para>
Para ilustrar lo que hace este archivo: 
 Si un cliente intenta buscar
a <literal remap="tt">fulano</literal>, <literal remap="tt">fulano.subdominio.su-dominio.edu</literal> se probará
primero, a continuación <literal remap="tt">fulano.su-dominio.edu</literal>, y finalmente
<literal remap="tt">fulano</literal>. Si un cliente intenta buscar <literal remap="tt">sunsite.unc.edu</literal>,
<literal remap="tt">sunsite.unc.edu.subdominio.su-dominio.edu</literal> se prueba primero (sí,
es tonto, pero es así como tiene que ser), después
<literal remap="tt">sunsite.unc.edu.su-dominio.edu</literal>, y finalmente
<literal remap="tt">sunsite.unc.edu</literal>. Puede que no quiera poner demasiados dominios en
la línea <literal remap="tt">search</literal>, lleva su tiempo el efectuar las búsquedas. 
</para>

<para>
El ejemplo supone que pertenece al dominio
<literal remap="tt">subdominio.su-dominio.edu</literal>, su máquina probablemente se llame
<literal remap="tt">su-maquina.subdominio.su-dominio.edu</literal>. La línea <literal remap="tt">search</literal> no
debería contener su <emphasis remap="it">TLD</emphasis> (<emphasis remap="it">Top Level Domain</emphasis> o <emphasis remap="it">Dominio de
Nivel Superior</emphasis>, `<literal remap="tt">edu</literal>' en este caso).  Si necesita conectar
frecuentemente con máquinas de otro dominio, puede añadir ese dominio a la
línea <literal remap="tt">search</literal> como sigue: 
</para>

<para>

<screen>
search subdominio.su-dominio.edu su-dominio.edu otro-dominio.com
</screen>

</para>

<para>
y así sucesivamente. Obviamente necesita poner un dominio real en su
lugar. Por favor, dése cuenta de la falta de puntos al final de estos
nombres de dominio. 
</para>

<para>
Lo siguiente, dependiendo de su versión de la librería <literal remap="tt">libc</literal> puede
necesitar arreglar <literal remap="tt">/etc/nsswitch.conf</literal> o <literal remap="tt">/etc/host.conf</literal>. 
Si ya tiene <literal remap="tt">nsswitch.conf</literal> corregiremos éste, en otro caso
arreglaremos <literal remap="tt">host.conf</literal>.
</para>

</sect2>

<sect2>
<title><literal remap="tt">/etc/nsswitch.conf</literal></title>

<para>
Se trata de un extenso archivo donde se especifica de dónde obtener las
diferentes clases de tipos de datos, y de cuál archivo o base de datos. 
Generalmente contiene comentarios útiles al comienzo, que por cierto
debería considerar leer ahora. Después busque la línea que comienza por
<literal remap="tt">hosts:</literal>, debe leerse:
</para>

<para>

<screen>
hosts:      files dns
</screen>

</para>

<para>
Si no hay una línea que comience por <literal remap="tt">`hosts:'</literal> póngala. Eso indica
que los programas deben mirar primero en el fichero <literal remap="tt">/etc/hosts</literal> ,
y después comprobar DNS de acuerdo con <literal remap="tt">resolv.conf</literal>.
</para>

</sect2>

<sect2>
<title><literal remap="tt">/etc/host.conf</literal></title>

<para>
Probablemente contiene varias líneas, una de ellas debería comenzar con
<literal remap="tt">order</literal> y tendría que parecerse a lo siguiente: 
</para>

<para>

<screen>
order hosts,bind
</screen>

</para>

<para>
Si no hay una línea <literal remap="tt">order</literal> tiene que incluirla.  Esto le indica a
las rutinas de resolución de nombres que busquen primero en
<literal remap="tt">/etc/hosts</literal>, y pregunte luego al servidor de nombres (que dijo en
<literal remap="tt">resolv.conf</literal> que está en <literal remap="tt">127.0.0.1</literal>). Estos dos últimos
archivos están documentados en la página de manual <literal remap="tt">resolv (8)</literal>
(haciendo <literal remap="tt">man 8 resolv</literal>)  en la mayoría de las distribuciones
<emphasis remap="bf">Linux</emphasis>. Esta página de manual es de obligada lectura <emphasis remap="it">IMHO</emphasis>, y
todos, especialmente los administradores DNS, deberían leerla. Hágalo
ahora, si se dice a sí mismo <emphasis remap="it">``lo haré más tarde''</emphasis> entonces nunca
lo hará.
</para>

</sect2>

<sect2>
<title>Arranque de <literal remap="tt">named</literal></title>

<para>
Después de todo esto, ya es hora de iniciar <literal remap="tt">named</literal>.  Si está
utilizando una conexión telefónica, conéctese primero. Teclee <literal remap="tt">ndc
start</literal> y presione <literal remap="tt">return</literal>, sin opciones. Si tiene problemas
intente <literal remap="tt">/usr/sbin/ndc start</literal> en su lugar.  Si el problema persiste
vea la sección PUF (<xref linkend="PUF"/>). Ahora ya puede comprobar su
configuración. Si mira en el archivo de mensajes de <literal remap="tt">syslog</literal>
(generalmente llamado <literal remap="tt">/var/adm/messages</literal>, o en el directorio
<literal remap="tt">/var/log</literal>) mientras inicia <literal remap="tt">named</literal>, (haga <literal remap="tt">tail -f
/var/adm/messages</literal>) debería ver algo como esto: 
</para>

<para>

<screen>
 Jun 30 21:50:55 roke named[2258]: starting.  named 4.9.4-REL Sun Jun 30 21:29:03 MET DST 1996   
                            janl@roke.slip.ifi.uio.no:/var/tmp/bind/named
 Jun 30 21:50:55 roke named[2258]: cache zone "" loaded (serial 0)
 Jun 30 21:50:55 roke named[2258]: primary zone "0.0.127.in-addr.arpa" loaded (serial 1)
</screen>

</para>

<para>
Si hay cualquier mensaje de error se deberá a alguna equivocación. 
<literal remap="tt">named</literal> determinará el archivo que ocasiona el error (de
<literal remap="tt">named.boot</literal> o <literal remap="tt">root.cache</literal> espero :-). Mate a <literal remap="tt">named</literal> y
vuelva a comprobar el archivo.
</para>

<para>
Ahora es el momento de iniciar <literal remap="tt">nslookup</literal> para examinar su trabajo: 
</para>

<para>

<screen>
     $ nslookup
     Default Server:  localhost
     Address:  127.0.0.1

     &#62;
</screen>

</para>

<para>
Si es eso lo que obtiene entonces está funcionando.  Eso espero. En
cualquier otro caso, vuelva atrás y compruébelo todo. Cada vez que cambie
el archivo <literal remap="tt">named.boot</literal> tiene que reinicializar <literal remap="tt">named</literal>
usando el comando <literal remap="tt">ndc restart</literal>.
</para>

<para>
Ahora puede introducir una consulta. Intente buscar alguna máquina cercana
a la suya. <literal remap="tt">pat.uio.no</literal> está cerca de mí, en la Universidad de
Oslo:
</para>

<para>

<screen>
     &#62; pat.uio.no
     Server:  localhost
     Address:  127.0.0.1

     Name:    pat.uio.no
     Address:  129.240.2.50
</screen>

</para>

<para>
<literal remap="tt">nslookup</literal> ahora solicita a <literal remap="tt">named</literal> que busque la máquina
<literal remap="tt">pat.uio.no</literal>.  Contactará con alguna de las máquinas servidoras de
nombres nombradas en el archivo <literal remap="tt">root.cache</literal>, y preguntará allí.
Puede tardar un poco antes de conseguir el resultado ya que busca todos
los dominios indicados en <literal remap="tt">/etc/resolv.conf</literal>. 
</para>

<para>
Si intenta de nuevo obtendrá esto:
</para>

<para>

<screen>
     &#62; pat.uio.no
     Server:  localhost
     Address:  127.0.0.1

     Non-authoritative answer:
     Name:    pat.uio.no
     Address:  129.240.2.50
</screen>

</para>

<para>
Nota a la línea ``<literal remap="tt">Non-authoritative answer:</literal>'' : le dedicaremos un
poco de tiempo. Esto significa que <literal remap="tt">named</literal> no sale de la red para
preguntar esta vez, en su lugar mira en su caché y lo encuentra allí. Pero
la información de la caché puede no estar actualizada. Entonces informa de
este peligro (de modo un tanto eufemístico) con <literal remap="tt">Non-authorative
answer:</literal>. Cuando <literal remap="tt">nslookup</literal> dice esto la segunda vez que
pregunta por una máquina, es un signo seguro de que <literal remap="tt">named</literal>
almacena la información en la caché y que está funcionando. Ahora puede
salir de <literal remap="tt">nslookup</literal> usando el comando <literal remap="tt">exit</literal>. 
</para>

<para>
Si es un usuario de conexiones telefónicas, (ppp, slip) por favor lea la
sección sobre conexiones telefónicas (<xref linkend="timofonicas"/>), hay algunas
advertencias para Vd.
</para>

<para>
Ahora ya sabe cómo configurar un servidor de nombres de ``sólo cacheo''. 
Tómese una cerveza, un vaso de leche o cuaquier otra cosa que prefiera
para celebrarlo.
</para>

</sect2>

</sect1>

<sect1>
<title>Un dominio simple.</title>

<para>
Como configurar su propio dominio.
</para>

<sect2>
<title>Pero primero algo de teoría a secas.</title>

<para>
Antes de comenzar realmente con esta sección, voy a dar un poco de teoría
sobre cómo funciona DNS.  Y lo va a leer porque será mejor para Vd.  Si no
quiere, al menos debería echar un vistazo rápido. Deje el repaso cuando
sepa lo que debe incluir en su archivo <literal remap="tt">named.boot</literal>. 
</para>

<para>
El DNS es un sistema jerárquico. La raíz se escribe como `<literal remap="tt">.</literal>' y se
denomina <emphasis remap="it">`root'</emphasis>. Debajo hay cierto número de Dominios de Nivel
Superior (<emphasis remap="it">Top Level Domains</emphasis>, <emphasis remap="it">TLD</emphasis>s), los más conocidos son
<literal remap="tt">ORG, COM, EDU</literal> y <literal remap="tt">NET</literal>, pero hay muchos más. 
</para>

<para>
Cuando se busca una máquina, la pregunta procede recursivamente en la
jerarquía comenzando desde arriba. Si quiere localizar la dirección de
<literal remap="tt">prep.ai.mit.edu</literal>, su servidor de nombres ha de encontrar primero
un servidor de nombres que sirva a <literal remap="tt">edu</literal>. Pregunta al servidor
<literal remap="tt">.</literal> (ya conoce los servidores <literal remap="tt">.</literal>, es para lo que se utiliza el
<literal remap="tt">archivo root.cache</literal>), y el servidor <literal remap="tt">.</literal> proporcionará una lista
de servidores <literal remap="tt">edu</literal>: 
</para>

<para>

<screen>
     $ nslookup
     Default Server:  localhost
     Address:  127.0.0.1
</screen>

</para>

<para>
Comienza preguntando a un servidor raíz.
</para>

<para>

<screen>
     &#62; server c.root-servers.net.
     Default Server:  c.root-servers.net
     Address:  192.33.4.12
</screen>
   
</para>

<para>
Pone el tipo de petición (<emphasis remap="it">Query</emphasis>) a <literal remap="tt">NS</literal> (<emphasis remap="it">Name Server
records</emphasis>). 
</para>

<para>

<screen>
&#62; set q=ns 
</screen>

</para>

<para>
Pregunta por <literal remap="tt">edu</literal>.
</para>

<para>

<screen>
&#62; edu.
</screen>
 
</para>

<para>
El punto (".") final aquí es significativo, indica al servidor que le
pedimos un <literal remap="tt">edu</literal> que está justo debajo de ".", y esto reduce la
búsqueda un poco.  
</para>

<para>

<screen>
     edu     nameserver = A.ROOT-SERVERS.NET
     edu     nameserver = H.ROOT-SERVERS.NET
     edu     nameserver = B.ROOT-SERVERS.NET
     edu     nameserver = C.ROOT-SERVERS.NET
     edu     nameserver = D.ROOT-SERVERS.NET
     edu     nameserver = E.ROOT-SERVERS.NET
     edu     nameserver = I.ROOT-SERVERS.NET
     edu     nameserver = F.ROOT-SERVERS.NET
     edu     nameserver = G.ROOT-SERVERS.NET
     A.ROOT-SERVERS.NET      internet address = 198.41.0.4
     H.ROOT-SERVERS.NET      internet address = 128.63.2.53
     B.ROOT-SERVERS.NET      internet address = 128.9.0.107
     C.ROOT-SERVERS.NET      internet address = 192.33.4.12
     D.ROOT-SERVERS.NET      internet address = 128.8.10.90
     E.ROOT-SERVERS.NET      internet address = 192.203.230.10
     I.ROOT-SERVERS.NET      internet address = 192.36.148.17
     F.ROOT-SERVERS.NET      internet address = 192.5.5.241
     G.ROOT-SERVERS.NET      internet address = 192.112.36.4
</screen>

</para>

<para>
Esto nos dice que <literal remap="tt">*.root-servers.net</literal> sirve a <literal remap="tt">edu.</literal>, y así
podemos seguir preguntando a <literal remap="tt">C</literal>. Ahora queremos saber quién sirve el
siguiente nivel del nombre de dominio: <literal remap="tt">mit.edu.</literal> 
</para>

<para>

<screen>
     &#62; mit.edu.
     Server:  c.root-servers.net
     Address:  192.33.4.12

     Non-authoritative answer:
     mit.edu nameserver = STRAWB.mit.edu
     mit.edu nameserver = W20NS.mit.edu
     mit.edu nameserver = BITSY.mit.edu

     Authoritative answers can be found from:
     STRAWB.mit.edu  internet address = 18.71.0.151
     W20NS.mit.edu   internet address = 18.70.0.160
     BITSY.mit.edu   internet address = 18.72.0.3
</screen>

</para>

<para>
<literal remap="tt">steawb, w20ns</literal> y <literal remap="tt">bitsy</literal> sirven a <literal remap="tt">mit</literal>, selecciona uno 
y pregunta por <literal remap="tt">ai.mit.edu</literal>:
</para>

<para>

<screen>
     &#62; server W20NS.mit.edu.
</screen>

</para>

<para>
Los nombres de máquina no son sensibles a mayúsculas/minúsculas, pero como
yo uso el ratón para cortar y pegar, obtengo una copia tal y como aparece
en la pantalla. 
</para>

<para>

<screen>
     Server:  W20NS.mit.edu
     Address:  18.70.0.160

     &#62; ai.mit.edu.
     Server:  W20NS.mit.edu
     Address:  18.70.0.160

     Non-authoritative answer:
     ai.mit.edu      nameserver = WHEATIES.AI.MIT.EDU
     ai.mit.edu      nameserver = ALPHA-BITS.AI.MIT.EDU
     ai.mit.edu      nameserver = GRAPE-NUTS.AI.MIT.EDU
     ai.mit.edu      nameserver = TRIX.AI.MIT.EDU
     ai.mit.edu      nameserver = MUESLI.AI.MIT.EDU

     Authoritative answers can be found from:
     AI.MIT.EDU      nameserver = WHEATIES.AI.MIT.EDU
     AI.MIT.EDU      nameserver = ALPHA-BITS.AI.MIT.EDU
     AI.MIT.EDU      nameserver = GRAPE-NUTS.AI.MIT.EDU
     AI.MIT.EDU      nameserver = TRIX.AI.MIT.EDU
     AI.MIT.EDU      nameserver = MUESLI.AI.MIT.EDU
     WHEATIES.AI.MIT.EDU     internet address = 128.52.32.13
     WHEATIES.AI.MIT.EDU     internet address = 128.52.35.13
     ALPHA-BITS.AI.MIT.EDU   internet address = 128.52.32.5
     ALPHA-BITS.AI.MIT.EDU   internet address = 128.52.37.5
     GRAPE-NUTS.AI.MIT.EDU   internet address = 128.52.32.4
     GRAPE-NUTS.AI.MIT.EDU   internet address = 128.52.36.4
     TRIX.AI.MIT.EDU internet address = 128.52.32.6
     TRIX.AI.MIT.EDU internet address = 128.52.38.6
     MUESLI.AI.MIT.EDU       internet address = 128.52.32.7
     MUESLI.AI.MIT.EDU       internet address = 128.52.39.7
</screen>

</para>

<para>
Entonces <literal remap="tt">weaties.ai.mit.edu</literal> es un servidor de nombres para
<literal remap="tt">ai.mit.edu</literal>: 
</para>

<para>

<screen>
     &#62; server WHEATIES.AI.MIT.EDU.
     Default Server:  WHEATIES.AI.MIT.EDU
     Addresses:  128.52.32.13, 128.52.35.13
</screen>

</para>

<para>
Ahora cambia el tipo de solicitud; ha encontrado el servidor de nombres y
va a preguntar todo lo que queremos saber sobre <literal remap="tt">prep.ai.mit.edu</literal>.
</para>

<para>

<screen>
     &#62; set q=any
     &#62; prep.ai.mit.edu.
     Server:  WHEATIES.AI.MIT.EDU
     Addresses:  128.52.32.13, 128.52.35.13

     prep.ai.mit.edu CPU = dec/decstation-5000.25    OS = unix
     prep.ai.mit.edu
             inet address = 18.159.0.42, protocol = tcp
              #21 #23 #25 #79
     prep.ai.mit.edu preference = 1, mail exchanger = life.ai.mit.edu
     prep.ai.mit.edu internet address = 18.159.0.42
     ai.mit.edu      nameserver = alpha-bits.ai.mit.edu
     ai.mit.edu      nameserver = wheaties.ai.mit.edu
     ai.mit.edu      nameserver = grape-nuts.ai.mit.edu
     ai.mit.edu      nameserver = mini-wheats.ai.mit.edu
     ai.mit.edu      nameserver = trix.ai.mit.edu
     ai.mit.edu      nameserver = muesli.ai.mit.edu
     ai.mit.edu      nameserver = count-chocula.ai.mit.edu
     ai.mit.edu      nameserver = life.ai.mit.edu
     ai.mit.edu      nameserver = mintaka.lcs.mit.edu
     life.ai.mit.edu internet address = 128.52.32.80
     alpha-bits.ai.mit.edu   internet address = 128.52.32.5
     wheaties.ai.mit.edu     internet address = 128.52.35.13
     wheaties.ai.mit.edu     internet address = 128.52.32.13
     grape-nuts.ai.mit.edu   internet address = 128.52.36.4
     grape-nuts.ai.mit.edu   internet address = 128.52.32.4
     mini-wheats.ai.mit.edu  internet address = 128.52.32.11
     mini-wheats.ai.mit.edu  internet address = 128.52.54.11
     mintaka.lcs.mit.edu     internet address = 18.26.0.36
</screen>

</para>

<para>
De esta forma comenzando en <literal remap="tt">.</literal> ha encontrado los sucesivos servidores
de nombre para el siguiente nivel en el nombre de dominio. Si ha usado su
propio servidor DNS en lugar de usar todos esos otros servidores, su
<literal remap="tt">named</literal>, desde luego, habrá almacenado en el caché toda la
información que haya encontrado mientras profundizaba en la búsqueda, y en
consecuencia no tendrá que preguntar de nuevo durante un tiempo. 
</para>

<para>
Se habla mucho menos sobre él, pero un dominio importante es
<literal remap="tt">in-addr.arpa</literal>. También está anidado como los dominios
<emphasis remap="it">'normales'</emphasis>. <literal remap="tt">in-addr.arpa</literal> nos permite determinar el
nombre de la máquina cuando conocemos su dirección IP. Una cosa importante
aquí es observar que que las direcciones IP están escritas en orden
inverso en el dominio <literal remap="tt">in-addr.arpa</literal>. Si tiene la dirección de
máquina <literal remap="tt">192.128.52.43</literal>, <literal remap="tt">named</literal> procede como para el ejemplo de
<literal remap="tt">prep.ai.mit.edu</literal>: Busca los servidores <literal remap="tt">arpa.</literal>.  Busca los
servidores <literal remap="tt">in-addr.arpa.</literal>, los servidores
<literal remap="tt">192.in-addr.arpa.</literal>, los servidores <literal remap="tt">128.192.in-addr.arpa.</literal> , y
los servidores <literal remap="tt">52.128.192.in-addr.arpa.</literal> y finalmente, los registros
necesarios para <literal remap="tt">43.52.128.192.in-addr.arpa.</literal> ¿Inteligente? (Diga
`sí'). La inversión de números puede ser confusa los 2 primeros años. 
</para>

<para>
He contado una mentira. DNS no funciona como he dicho de forma literal.
Pero es bastante parecido. 
</para>

</sect2>

<sect2>
<title>Nuestro propio dominio</title>

<para>
Ahora vamos a definir nuestro propio dominio.  Vamos a crear el dominio
<literal remap="tt">linux.bogus</literal> y definir máquinas en él. Uso un nombre de dominio
totalmente falso para estar seguro de que no molestamos a nadie de fuera.
</para>

<para>
Ya hemos comenzado esta parte con la siguiente línea en
<literal remap="tt">named.boot</literal>:
</para>

<para>

<screen>
primary         0.0.127.in-addr.arpa            pz/127.0.0
</screen>

</para>

<para>
Por favor tome nota de la ausencia de `.' al final de los nombres de
dominio en este archivo. La primera línea nombra al archivo
<literal remap="tt">pz/127.0.0</literal> como definición de <literal remap="tt">0.0.127.in-addr.arpa</literal>. Ya hemos
configurado este archivo, en él podremos leer: 
</para>

<para>

<screen>
@               IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                                1       ; Numero de Serie
                                28800   ; Tasa de Refresco
                                7200    ; Tasa de Reintento
                                604800  ; Caducidad para secundario
                                86400)  ; Tiempo de Validez para Clientes
                        NS      ns.linux.bogus.
1                       PTR     localhost.
</screen>

</para>

<para>
Por favor observe los `<literal remap="tt">.</literal>' al final de los nombres de dominio completo
en contraste con el archivo <literal remap="tt">named.boot</literal> anterior. A algunas
personas les gusta iniciar cada zona del archivo con una directiva
<literal remap="tt">$ORIGIN</literal>, pero esto es superfluo. El origen (lugar de la
jerarquía DNS a donde pertenece) de un fichero de zona se especifica en la
columna <literal remap="tt">dominio</literal> del archivo <literal remap="tt">named.boot</literal>; en este caso es
<literal remap="tt">0.0.127.in-addr.arpa.</literal>
</para>

<para>
Este ``fichero de zona'' contiene tres <emphasis remap="it">registros de recursos</emphasis>
(RRs): Un <literal remap="tt">RR SOA</literal>, Un <literal remap="tt">RR NS</literal> y un <literal remap="tt">RR PTR</literal>.
<literal remap="tt">SOA</literal> es una abreviatura de <emphasis remap="it">Start Of Authority</emphasis>. La
`<literal remap="tt">&commat;</literal>' es una notación especial que simboliza el origen, y como
la columna <literal remap="tt">dominio</literal> para este archivo indica
<literal remap="tt">0.0.127.in-addr.arpa</literal>. La primera línea realmente significa: 
</para>

<para>

<screen>
       0.0.127.IN-ADDR.ARPA. IN      SOA ...
</screen>

</para>

<para>
<literal remap="tt">NS</literal> es el <literal remap="tt">RR Name Server</literal> (Servidor de Nombres), e indica
a DNS qué máquina es el servidor de nombres del dominio. Y finalmente el
registro <literal remap="tt">PTR</literal> tiene valor <literal remap="tt">1</literal> (igual a
<literal remap="tt">1.0.0.127.IN-ADDR.ARPA</literal>, esto es, <literal remap="tt">127.0.0.1</literal>) que es el
<literal remap="tt">localhost</literal> de <literal remap="tt">named</literal>.
</para>

<para>
El registro <literal remap="tt">SOA</literal> es el preámbulo de todos los archivos de zona y
debe haber uno exactamente en cada archivo de zona, como primer registro
de todos. El registro <literal remap="tt">SOA</literal> describe la zona, de dónde proviene
(una máquina llamada <literal remap="tt">linux.bogus</literal>), quién es el responsable de su
contenido (<literal remap="tt">hostmaster&commat;linux.bogus</literal>), qué versión del
archivo de zona es (<literal remap="tt">Numero de Serie</literal>, <literal remap="tt">1</literal>), y otras cosas que
tienen que ver con el caché y los servidores secundarios DNS. Para el
resto de los campos (<literal remap="tt">Tasa de Refresco</literal>, <literal remap="tt">Tasa de
Reintento</literal>, <literal remap="tt">Caducidad para secundario</literal> y <literal remap="tt">Tiempo de Validez
para Clientes</literal>) use los valores que aparecen aquí para mayor
seguridad. 
</para>

<para>
El registro <literal remap="tt">NS</literal> nos indica quién efectúa el servicio DNS para
<literal remap="tt">0.0.127.in-addr.arpa</literal>, que es <literal remap="tt">ns.linux.bogus</literal>. El registro
<literal remap="tt">PTR</literal> nos dice que <literal remap="tt">1.0.0.127.in-addr.arpa</literal> (aka
<literal remap="tt">127.0.0.1</literal>) es conocido como <literal remap="tt">localhost</literal>.
</para>

<para>
Ahora reiniciamos <literal remap="tt">named</literal> (el comando es <literal remap="tt">ndc restart</literal>) y
usamos <literal remap="tt">nslookup</literal> para examinar lo que ha hecho: 
</para>

<para>

<screen>
     $ nslookup

     Default Server:  localhost
     Address:  127.0.0.1

     &#62; 127.0.0.1
     Server:  localhost
     Address:  127.0.0.1

     Name:    localhost
     Address:  127.0.0.1

</screen>

</para>

<para>
así obtiene <literal remap="tt">localhost</literal> de <literal remap="tt">127.0.0.1</literal>, bien. Ahora para
nuestra tarea principal, el dominio <literal remap="tt">linux.bogus</literal>, inserte una
nueva línea, <literal remap="tt">primary</literal>, en <literal remap="tt">named.boot</literal>: 
</para>

<para>

<screen>
primary               linux.bogus                     pz/linux.bogus
</screen>

</para>

<para>
Observe que continúa la ausencia de "<literal remap="tt">.</literal>" final en el nombre de dominio
del archivo <literal remap="tt">named.boot</literal>. 
</para>

<para>
En el archivo de zona de <literal remap="tt">linux.bogus</literal> pondremos algunos datos
totalmente falsos
<footnote>

<para>
N del T 
 Por si no lo ha notado todavía,
<emphasis remap="it">bogus</emphasis> en inglés significa precisamente <emphasis remap="it">falso</emphasis>.
</para>

</footnote>
: 
</para>

<para>

<screen>
;
; Fichero de zona para linux.bogus
;
; Minimo indspensable para tener funcionando un dominio
;
@       IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                        199511301       ; Numero de serie, fecha de hoy + n. de serie de hoy
                        28800           ; Tasa de Refresco, en segundos
                        7200            ; Tasa de Reintento, en segundos
                        3600000         ; Caducidad para secundario, en segundos
                        86400 )         ; Tiempo de Validez para Clientes, en segundos
                NS      ns.linux.bogus.
                NS      ns.friend.bogus.
                MX      10 mail.linux.bogus   ; Intercambiador de Correo Primario
                MX      20 mail.friend.bogus. ; Intercambiador de Correo Secundario

localhost       A       127.0.0.1
ns              A       127.0.0.2
mail            A       127.0.0.4
</screen>

</para>

<para>
Deben de observarse dos cosas sobre los registros <literal remap="tt">SOA</literal>. 
<literal remap="tt">ns.linux.bogus</literal> debe ser una máquina actual con un registro
<literal remap="tt">A</literal>. No es legal tener un registro <literal remap="tt">CNAME</literal> para la máquina
mencionada en el registro <literal remap="tt">SOA</literal>. Su nombre no necesita ser
<literal remap="tt">ns</literal>, podría ser cualquier nombre legal de máquina. A continuación,
en <literal remap="tt">hostmaster.linux.bogus</literal> deberá aparecer algo como
<literal remap="tt">hostmaster&commat;linux.bogus</literal>; esto sería un alias de email, o
una cuenta de correo, donde la(s) persona(s) que realizan el mantenimiento
de DNS deberían leer con frecuencia el correo. Cualquier email respecto
del dominio será mandado a la dirección aquí indicada. El nombre no tiene
por que ser <literal remap="tt">hostmaster</literal>, puede ser cualquier dirección email
legal, pero la dirección email <literal remap="tt">hostmaster</literal> funcionará bien. 
</para>

<para>
Hay un nuevo tipo de <literal remap="tt">RR</literal> en este archivo, el <literal remap="tt">MX</literal>, o
<emphasis remap="it">Mail eXchanger</emphasis>. Este indica el sistema de correo a donde mandar
el correo dirigido a <literal remap="tt">alguien&commat;linux.bogus</literal>, pudiendo ser
también <literal remap="tt">mail.linux.bogus</literal> o <literal remap="tt">mail.friend.bogus</literal>.  El número
que precede a cada nombre de máquina es la prioridad del <literal remap="tt">RR MX</literal>.
El <literal remap="tt">RR</literal> con el número más bajo (<literal remap="tt">10</literal>) es aquel al que el correo será
enviado primero.  Si este falla, puede ser mandado a otro con un número
más alto, que será gestor secundario de correo, como
<literal remap="tt">mail.friend.bogus</literal> que tiene una prioridad <literal remap="tt">20</literal> aquí.
</para>

<para>
Reinicie <literal remap="tt">named</literal> ejecutando <literal remap="tt">ndc restart</literal>.  Examine los
resultados con <literal remap="tt">nslookup</literal>: 
</para>

<para>

<screen>
     $ nslookup
     &#62; set q=any
     &#62; linux.bogus
     Server:  localhost
     Address:  127.0.0.1

     linux.bogus
             origin = linux.bogus
             mail addr = hostmaster.linux.bogus
             serial = 199511301
             refresh = 28800 (8 hours)
             retry   = 7200 (2 hours)
             expire  = 604800 (7 days)
             minimum ttl = 86400 (1 day)
     linux.bogus     nameserver = ns.linux.bogus
     linux.bogus     nameserver = ns.friend.bogus
     linux.bogus     preference = 10, mail exchanger = mail.linux.bogus.linux.bogus
     linux.bogus     preference = 20, mail exchanger = mail.friend.bogus
     linux.bogus     nameserver = ns.linux.bogus
     linux.bogus     nameserver = ns.friend.bogus
     ns.linux.bogus  internet address = 127.0.0.2
     mail.linux.bogus        internet address = 127.0.0.4
</screen>

</para>

<para>
Con un examen cuidadoso podrá descubrir un error. La línea
</para>

<para>

<screen>
       linux.bogus     preference = 10, mail exchanger = mail.linux.bogus.linux.bogus
</screen>

</para>

<para>
está equivocada. Debería ser
</para>

<para>

<screen>
       linux.bogus     preference = 10, mail exchanger = mail.linux.bogus
</screen>

</para>

<para>
Cometí el error de forma deliberada para que aprenda de él <literal remap="tt">:-)</literal>
Mirando en el archivo de zona podemos ver que la línea
</para>

<para>

<screen>
     @               MX      10 mail.linux.bogus     ; Intercambiador de Correo Primario
</screen>

</para>

<para>
no tiene punto. O tiene demasiados <literal remap="tt">linux.bogus</literal>.  Si un nombre de
máquina no termina en punto en un archivo de zona, el origen es añadido a
su final. Así, 
</para>

<para>

<screen>
@               MX      10 mail.linux.bogus.    ; Intercambiador de Correo Primario
</screen>

</para>

<para>
o
</para>

<para>

<screen>
@               MX      10 mail                 ; Primary Mail Exchanger
</screen>

</para>

<para>
serán correctos. Yo prefiero la última forma, hay que escribir menos. En
un archivo de zona el dominio debería ser escrito y terminado con un
punto, o no debe ser incluido, en cuyo caso se referirá al origen por
defecto.  Debo hacer hincapié que en el archivo <literal remap="tt">named.boot</literal> no
debería haber puntos después de los nombres de dominio. No tiene ni idea
de cuantas veces un '.' por estar o por no estar ha hecho fallar toda una
configuración y ha confundido horrorosamente a la gente...
</para>

<para>
Una vez hecha esta <emphasis remap="it">puntualización</emphasis>, he aquí el nuevo archivo de zona,
con algo de información extra también:
</para>

<para>

<screen>
;
; Archivo de zona para  linux.bogus
;
; minimo indispensable para hacer funcionar un dominio
;
@       IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                        199511301       ; Numero de Serie, fecha de hoy + n. de serie de hoy 
                        28800           ; Tasa de Refresco, en segundos
                        7200            ; Tasa de Reintento, en segundos
                        604800          ; Caducidad para secundario, en segundos
                        86400 )         ; Validez para Clientes, en segundos

                NS      ns              ; Direccion de Internet del servidor de nombres
                NS      ns.friend.bogus.
                MX      10 mail         ; Intercambiador de Correo Primario
                MX      20 mail.friend.bogus. ; Intercambiador de Correo Secundario

localhost       A       127.0.0.1
ns              A       127.0.0.2
mail            A       127.0.0.4
;
; Extras
;
@               TXT     "Linux.Bogus, your DNS consultants"

ns              MX      10 mail
                MX      20 mail.friend.bogus.
                HINFO   "Pentium" "Linux 1.2"
                TXT     "RMS"
richard         CNAME   ns
www             CNAME   ns

donald          A       127.0.0.3
                MX      10 mail
                MX      20 mail.friend.bogus.
                HINFO   "i486"  "Linux 1.2"
                TXT     "DEK"

mail            MX      10 mail
                MX      20 mail.friend.bogus.
                HINFO   "386sx" "Linux 1.0.9"

ftp             A       127.0.0.5
                MX      10 mail
                MX      20 mail.friend.bogus.
                HINFO   "P6" "Linux 1.3.59"
</screen>

</para>

<para>
Puede que quiera desplazar los tres primeros registros tipo <literal remap="tt">A</literal>
(<literal remap="tt">localhost, ns</literal> y <literal remap="tt">mail</literal>) junto con los otros registros de su mismo
tipo (<literal remap="tt">donald</literal>, <literal remap="tt">mail</literal>, y <literal remap="tt">ftp</literal>), en vez de colocarlos separados
al principio como aquí. 
</para>

<para>
Hay varios registros nuevos aquí: <literal remap="tt">HINFO</literal> (<emphasis remap="it">Host
INFOrmation</emphasis>), tiene dos partes, es una buena costumbre poner comillas
a cada uno. La primera parte es el hardware o CPU de la máquina, y la
segunda parte corresponde al software o Sistema Operativo de la misma. 
<literal remap="tt">ns</literal> tiene una CPU Pentium con Linux 1.2. El registro <literal remap="tt">TXT</literal> es
un texto en formato libre que puede usar para cualquier cosa que le
interese.  <literal remap="tt">CNAME</literal> (<emphasis remap="it">Canonical NAME</emphasis>) es una forma de dar a
cada máquina varios nombres. Por tanto <literal remap="tt">richard</literal> y <literal remap="tt">www</literal> son
alias para <literal remap="tt">ns</literal>.  Es importante observar que los registros
<literal remap="tt">A</literal>, <literal remap="tt">MX</literal>, <literal remap="tt">CNAME</literal> y <literal remap="tt">SOA</literal> <emphasis remap="bf">nunca deben
hacer referencia al registro</emphasis> <literal remap="tt">CNAME</literal>, sólo pueden referirse a
registros <literal remap="tt">A</literal>.
</para>

<para>

<screen>
fulanito  CNAME   richard                 ; ¡¡¡NO!!!
</screen>

</para>

<para>
siendo correcto tener 
</para>

<para>

<screen>
fulanito  CNAME   ns                      ; ¡¡¡SI!!!
</screen>

</para>

<para>
También es importante observar que <literal remap="tt">CNAME</literal> no es un nombre de
máquina legal para direcciones de correo: 
<literal remap="tt">webmaster&commat;www.linux.bogus</literal> es una dirección email ilegal
dada en la configuración anterior. Encontrará muy pocos administradores de
correo de Ahí Afuera que recomienden esta regla, incluso si a Vd. le
funciona.  La forma de evitar esto es usar un registro <literal remap="tt">A</literal> (y
quizás algunos otros también, como un registro <literal remap="tt">MX</literal>) en su lugar: 
</para>

<para>

<screen>
www     A       127.0.0.2
</screen>

</para>

<para>
Paul Vixie, el principal gurú de <literal remap="tt">named</literal> recomienda no usar CNAME.
Por tanto considere el no utilizarlo seriamente. 
</para>

<para>
Cargue la nueva base de datos ejecutando <literal remap="tt">ndc reload</literal>, esto provoca
la lectura de sus archivos de nuevo.
</para>

<para>

<screen>
     $ nslookup
     Default Server:  localhost
     Address:  127.0.0.1

     &#62; ls -d linux.bogus
</screen>

</para>

<para>
Esto haría que todos los registros fuesen listados.
</para>

<para>

<screen>
     [localhost]
      linux.bogus.       SOA   ns.linux.bogus hostmaster.linux.bogus. (199511301 28800 7200 604800 86400)
      linux.bogus.       NS    ns.linux.bogus
      linux.bogus.       NS    ns.friend.bogus
      linux.bogus.       MX    10   mail.linux.bogus
      linux.bogus.       MX    20   mail.friend.bogus
      linux.bogus.       TXT   "Linux.Bogus, your DNS consultants"
      localhost          A     127.0.0.1
      mail               A     127.0.0.4
      mail               MX    10   mail.linux.bogus
      mail               MX    20   mail.friend.bogus
      mail               HINFO 386sx       Linux 1.0.9
      donald             A     127.0.0.3
      donald             MX    10   mail.linux.bogus
      donald             MX    20   mail.friend.bogus
      donald             HINFO i486        Linux 1.2
      donald             TXT   "DEK"
      www                CNAME ns.linux.bogus
      richard            CNAME ns.linux.bogus
      ftp                A     127.0.0.5
      ftp                MX    10   mail.linux.bogus
      ftp                MX    20   mail.friend.bogus
      ftp                HINFO P6          Linux 1.3.59
      ns                 A     127.0.0.2
      ns                 MX    10   mail.linux.bogus
      ns                 MX    20   mail.friend.bogus
      ns                 HINFO Pentium     Linux 1.2
      ns                 TXT   "RMS"
      linux.bogus.       SOA   ns.linux.bogus hostmaster.linux.bogus. (199511301 28800 7200 604800 86400)
</screen>

</para>

<para>
Esto está bien. Comprobemos qué dice para <literal remap="tt">www</literal> sólo:
</para>

<para>

<screen>
     &#62; set q=any
     &#62; www.linux.bogus.
     Server:  localhost
     Address:  127.0.0.1

     www.linux.bogus canonical name = ns.linux.bogus
</screen>

</para>

<para>
...En otras palabras, el nombre real de 
<literal remap="tt">www.linux.bogus</literal> es <literal remap="tt">ns.linux.bogus</literal>
</para>

<para>

<screen>
     linux.bogus     nameserver = ns.linux.bogus
     linux.bogus     nameserver = ns.friend.bogus
     ns.linux.bogus  internet address = 127.0.0.2
</screen>

</para>

<para>
y <literal remap="tt">ns.linux.bogus</literal> tiene la dirección <literal remap="tt">127.0.0.2</literal>. Parece
correcto también.
</para>

</sect2>

<sect2>
<title>Relajémonos</title>

<para>
Desde luego, este dominio es falso, y como tal son todas sus direcciones,
y quizás, desafortunadamente sea un poco confuso. Para un ejemplo real
de dominio vea la siguiente sección. 
</para>

</sect2>

</sect1>

<sect1>
<title>Un ejemplo de dominio real</title>

<para>
Donde describiremos algunos archivos de zona reales.
</para>

<para>
Los usuarios han sugerido que incluya un ejemplo real de dominio que esté
en funcionamiento como explicación de las diferencias entre un dominio en
funcionamiento y el ejemplo falso que no era del todo muy claro.
</para>

<para>
Una cosa sobre este ejemplo: ¡NO lo introduzca en su servidor de nombres!.
Úselo sólo como lectura de referencia. Si quiere experimentar, hágalo con
el ejemplo falso. Yo uso este ejemplo con permiso de David Bullock y
LAND-5. Estos archivos eran los usados el 24 de Septiembre de 1996, y
podrían diferir de los que encuentre si pregunta ahora al servidor de
nombres LAND-5. También tenga en mente eliminar los espacios iniciales
;-). 
</para>

<sect2>
<title><literal remap="tt">/etc/named.boot</literal> (o <literal remap="tt">/var/named/named.boot</literal>)</title>

<para>
Aquí encontramos la líneas <literal remap="tt">primary</literal> para las dos zonas que
necesitamos: la red <literal remap="tt">127.0.0.0</literal> y también la subred <literal remap="tt">206.6.177</literal> de
<literal remap="tt">LAND-5</literal>. Una línea <literal remap="tt">primary</literal> para la zona de redirección
(<literal remap="tt">forward</literal>) <literal remap="tt">land-5.com</literal> de <literal remap="tt">land-5</literal>. Observe también que en
lugar de situar los archivos en un directorio llamado <literal remap="tt">pz</literal>, como hago
en este COMO, él los sitúa en un directorio llamado <literal remap="tt">zone</literal>. 
</para>

<para>

<screen>
;  Fichero de arranque para el servidor de nombres LAND-5
;
directory /var/named
;
; tipo          dominio                         fichero o maquina origen
cache           .                               root.cache
primary         0.0.127.in-addr.arpa            zone/127.0.0
primary         177.6.206.in-addr.arpa          zone/206.6.177
primary         land-5.com                      zone/land-5.com
</screen>

</para>

</sect2>

<sect2>
<title><literal remap="tt">/var/named/root.cache</literal></title>

<para>
Tenga en cuenta que este archivo varía con mucha frecuencia, y que el
listado de aquí es viejo. Mejor utilice uno producido ahora.
</para>

<para>

<screen>
; &#60;&#60;&#62;&#62; DiG 2.1 &#60;&#60;&#62;&#62;
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&#62;&#62;HEADER&#60;&#60;- opcode: QUERY, status: NOERROR, id: 6
;; flags: qr rd ra; Ques: 1, Ans: 9, Auth: 0, Addit: 9
;; QUESTIONS:
;;      ., type = NS, class = IN

;; ANSWERS:
 .       518357  NS      H.ROOT-SERVERS.NET.
 .       518357  NS      B.ROOT-SERVERS.NET.
 .       518357  NS      C.ROOT-SERVERS.NET.
 .       518357  NS      D.ROOT-SERVERS.NET.
 .       518357  NS      E.ROOT-SERVERS.NET.
 .       518357  NS      I.ROOT-SERVERS.NET.
 .       518357  NS      F.ROOT-SERVERS.NET.
 .       518357  NS      G.ROOT-SERVERS.NET.
 .       518357  NS      A.ROOT-SERVERS.NET.

;; ADDITIONAL RECORDS:
H.ROOT-SERVERS.NET.     165593  A       128.63.2.53
B.ROOT-SERVERS.NET.     165593  A       128.9.0.107
C.ROOT-SERVERS.NET.     222766  A       192.33.4.12
D.ROOT-SERVERS.NET.     165593  A       128.8.10.90
E.ROOT-SERVERS.NET.     165593  A       192.203.230.10
I.ROOT-SERVERS.NET.     165593  A       192.36.148.17
F.ROOT-SERVERS.NET.     299616  A       192.5.5.241
G.ROOT-SERVERS.NET.     165593  A       192.112.36.4
A.ROOT-SERVERS.NET.     165593  A       198.41.0.4

;; Total query time: 250 msec
;; FROM: land-5 to SERVER: default -- 127.0.0.1
;; WHEN: Fri Sep 20 10:11:22 1996
;; MSG SIZE  sent: 17  rcvd: 312
</screen>

</para>

</sect2>

<sect2>
<title><literal remap="tt">/var/named/zone/127.0.0</literal></title>

<para>
Lo básico, el registro obligatorio <literal remap="tt">SOA</literal>, y el registro que mapea
<literal remap="tt">127.0.0.1</literal> a <literal remap="tt">localhost</literal>. Se requieren ambos. No debería
haber ninguno más en este fichero. Probablemente nunca se necesitará
actualizarlo, salvo que cambien su servidor de nombres o la dirección del
<literal remap="tt">hostmaster</literal>.
</para>

<para>

<screen>
@               IN      SOA     land-5.com. root.land-5.com. (
                                199609203   ; Numero de Serie
                                28800   ; Tasa de Refresco
                                7200    ; Tasa de Reintento
                                604800  ; Caducidad para secundario
                                86400)  ; Validez para clientes
                        NS      land-5.com.

1                       PTR     localhost.
</screen>

</para>

</sect2>

<sect2>
<title><literal remap="tt">/var/named/zone/land-5.com</literal></title>

<para>
Aquí vemos el registro <literal remap="tt">SOA</literal> y los registros <literal remap="tt">NS</literal>
necesarios. Podemos observar que dispone de un servidor de nombres
secundario <literal remap="tt">ns2.psi.net</literal>. Esto es como debe ser, tenga siempre un
servidor secundario de seguridad. También podemos ver que tiene una
máquina principal llamada <literal remap="tt">land-5</literal> que se encarga de todos los
diferentes servicios, y que se ha hecho usando <literal remap="tt">CNAME</literal> (una
alternativa al uso de los registros <literal remap="tt">A</literal>). 
</para>

<para>
Como puede ver en el registro <literal remap="tt">SOA</literal>, el origen del archivo de zona
es <literal remap="tt">land-5.com</literal>, la persona de contacto es
<literal remap="tt">root&commat;land-5.com.</literal> <literal remap="tt">hostmaster</literal> es otro uso frecuente
para la persona de contacto. El número de serie en el formato habitual
<emphasis remap="it">yyyymmdd</emphasis> con el número de serie de hoy añadido; esta es probablemente
la sexta versión del archivo de zona del 20 de Septiembre de 1996.
Recuerde que el número de serie debe incrementerse monótonamente, aquí hay
sólo un dígito para las series de hoy, así que después de 9 ediciones
tendrá que esperar hasta mañana antes de poder editar el el archivo de
nuevo. Considere el uso de dos dígitos. 
</para>

<para>

<screen>
@       IN      SOA     land-5.com. root.land-5.com. (
                        199609206       ; Numero de Serie, fecha de hoy + numero de serie de hoy
                        10800           ; Tasa de Refresco, en segundos
                        7200            ; Tasa de Reintento, en segundos
                        10800           ; Caducidad para secundario, en segundos
                        86400 )         ; Validez para Clientes, en segundos
                NS      land-5.com.
                NS      ns2.psi.net.
                MX      10 land-5.com.  ; Intercambiador Primario de Correo

localhost       A       127.0.0.1

router          A       206.6.177.1

land-5.com.     A       206.6.177.2
ns              CNAME   land-5.com.
ftp             CNAME   land-5.com.
www             CNAME   land-5.com.
mail            CNAME   land-5.com.
news            CNAME   land-5.com.

funn            A       206.6.177.3
illusions       CNAME   funn.land-5.com.
@               TXT     "LAND-5 Corporation"

;
;       Estaciones de Trabajo
;
ws_177200       A       206.6.177.200
                MX      10 land-5.com.   ; Primary Mail Host
ws_177201       A       206.6.177.201
                MX      10 land-5.com.   ; Primary Mail Host
ws_177202       A       206.6.177.202
                MX      10 land-5.com.   ; Primary Mail Host
ws_177203       A       206.6.177.203
                MX      10 land-5.com.   ; Primary Mail Host
ws_177204       A       206.6.177.204
                MX      10 land-5.com.   ; Primary Mail Host
ws_177205       A       206.6.177.205
                MX      10 land-5.com.   ; Primary Mail Host
; {Muchas definiciones repetitivas borradas}
ws_177250       A       206.6.177.250
                MX      10 land-5.com.   ; Primary Mail Host
ws_177251       A       206.6.177.251
                MX      10 land-5.com.   ; Primary Mail Host
ws_177252       A       206.6.177.252
                MX      10 land-5.com.   ; Primary Mail Host
ws_177253       A       206.6.177.253
                MX      10 land-5.com.   ; Primary Mail Host
ws_177254       A       206.6.177.254
                MX      10 land-5.com.   ; Primary Mail Host
</screen>

</para>

<para>
Otra cosa a tener en cuenta es que las estaciones de trabajo no tienen
nombres propios, sino un prefijo seguido por las dos últimas porciones de
los números IP. Usar tal convención puede simplificar el mantenimiento
significativamente, pero puede resultar un poquito impersonal. 
</para>

</sect2>

<sect2>
<title><literal remap="tt">/var/named/zone/206.6.177</literal></title>

<para>
Comentaré este archivo después.
</para>

<para>

<screen>
@               IN      SOA     land-5.com. root.land-5.com. (
                                199609206  ; Numero de Serie
                                28800   ; Tasa de Refresco
                                7200    ; Tasa de Reintento
                                604800  ; Caducidad para secundario
                                86400)  ; Validez para Clientes
                        NS      land-5.com.
                        NS      ns2.psi.net.
;
;       Servidores
;
1       PTR     router.land-5.com.
2       PTR     land-5.com.
3       PTR     funn.land-5.com.
;
;       Estaciones de Trabajo
;
200     PTR     ws_177200.land-5.com.
201     PTR     ws_177201.land-5.com.
202     PTR     ws_177202.land-5.com.
203     PTR     ws_177203.land-5.com.
204     PTR     ws_177204.land-5.com.
205     PTR     ws_177205.land-5.com.
; {Eliminadas muchas definiciones repetitivas}
250     PTR     ws_177250.land-5.com.
251     PTR     ws_177251.land-5.com.
252     PTR     ws_177252.land-5.com.
253     PTR     ws_177253.land-5.com.
254     PTR     ws_177254.land-5.com.
</screen>

</para>

<para>
La <emphasis remap="bf">zona de resolución inversa</emphasis> es la parte de la configuración que
parece crear más dolores de cabeza. <emphasis remap="bf">Se usa para encontrar el nombre de
la máquina a partir de su dirección IP</emphasis>. Ejemplo: suponga que está en
un servidor <literal remap="tt">irc</literal> y acepta conexiones de clientes <literal remap="tt">irc</literal>.  El
servidor <literal remap="tt">irc</literal> es noruego y sólo quiere aceptar conexiones de clientes
de Noruega y otros países escandinavos. Cuando se produce una conexión de
un cliente, la librería <emphasis remap="it">C</emphasis> es capaz de indicar el número IP de la
máquina conectada porque el número IP del cliente está contenido en todos
los paquetes que se pasan a través de la red. Ahora puede llamar a una
función llamada <literal remap="tt">gethostbyaddr</literal> que busca el nombre de la máquina
dada su dirección IP. 
</para>

<para>
<literal remap="tt">gethostbyaddr</literal> interrogará a un servidor DNS el cual efectuará una
búsqueda DNS para la máquina. Suponiendo que la conexión cliente viene de
<literal remap="tt">ws_177200.land-5.com</literal>, la dirección IP que la librería <emphasis remap="it">C</emphasis>
proporciona al servidor irc será <literal remap="tt">206.6.177.200</literal>. Para encontrar el
nombre de la máquina necesitamos encontrar
<literal remap="tt">200.177.6.206.in-addr.arpa</literal>. El servidor DNS primero encuentra los
servidores <literal remap="tt">arpa.</literal>, después los servidores <literal remap="tt">in-addr.arpa.</literal>, a
continuación sigue por <literal remap="tt">206</literal>, <literal remap="tt">6</literal> y al final busca el servidor para
la zona <literal remap="tt">177.6.206.in-addr.arpa</literal> en <literal remap="tt">land-5</literal>. Aquí obtendrá
finalmente que para <literal remap="tt">200.177.6.206.in-addr.arpa</literal> tenemos un registro
`<literal remap="tt">PTR ws_177200.land-5.com</literal>', que significa que el nombre que va
con <literal remap="tt">206.6.177.200</literal> es <literal remap="tt">ws_177200.land-5.com</literal>. Como con la
explicación de cómo buscar <literal remap="tt">prep.ai.mit.edu</literal>, esto es ligeramente
ficticio. 
</para>

<para>
Volviendo al ejemplo del servidor irc.  El servidor irc sólo acepta
conexiones de los países escandinavos, osea, <literal remap="tt">*.no</literal>, <literal remap="tt">*.se</literal>, y
<literal remap="tt">*.dk</literal>; el nombre <literal remap="tt">ws_177200.land-5.com</literal> claramente no se ajusta a
ninguno de ellos, y el servidor denegará la conexión. Si no hubiese habido
resolución inversa de <literal remap="tt">206.2.177.200</literal> mediante la zona
<literal remap="tt">in-addr.arpa</literal> el servidor habría sido incapaz de de encontrar el
nombre y habría tenido que comparar <literal remap="tt">206.2.177.200</literal> con <literal remap="tt">*.no</literal>,
<literal remap="tt">*.se</literal> y <literal remap="tt">*.dk</literal>, es decir, cifras con nombres, ninguna de las cuales
concordaría. 
</para>

<para>
Algunas personas le dirán que la resolución inversa sólo es importante
para los servidores, o que no tienen importancia. No es así;  muchos
servidores de ftp, news, irc e incluso algunos servidores http (WWW) NO
aceptarán conexiones de máquinas de las cuales no son capaces de resolver
el nombre. Por tanto el mapeo inverso de máquinas es de hecho obligatorio. 
</para>

</sect2>

</sect1>

<sect1 id="mantenimiento">
<title>Mantenimiento </title>

<para>
Manteniéndolo en funcionamiento.
</para>

<para>
Hay una tarea de mantenimiento que tiene que realizar con <literal remap="tt">named</literal>,
además de mantenerlo en funcionamiento. Esta tarea es mantener el archivo
<literal remap="tt">root.cache</literal> actualizado. La forma más fácil es usar <literal remap="tt">dig</literal>,
primero ejecute <literal remap="tt">dig</literal> sin argumentos, conseguirá
<literal remap="tt">root.cache</literal> de acuerdo con su propio servidor.  Entonces pregunte
a alguno de los servidores raíz listados con
</para>

<para>

<screen>
dig @rootserver 
</screen>

</para>

<para>
Podrá observar que la salida se parece terriblemente al archivo
<literal remap="tt">root.cache</literal> excepto por un par de números extras. Esos números no
ocasionan problemas. Guárdelo en un archivo
</para>

<para>

<screen>
dig @rootserver . ns &#62; root.cache.new
</screen>

</para>

<para>
y sustituya el antiguo <literal remap="tt">root.cache</literal> con él. 
</para>

<para>
Recuerde reiniciar <literal remap="tt">named</literal> después de sustituir el archivo caché. 
</para>

<para>
Al Longyear me envió este script que puede ser ejecutado automáticamente
para actualizar <literal remap="tt">root.cache</literal>, instale una entrada en el
<literal remap="tt">crontab</literal> para ejecutarlo una vez al mes y olvídese.  El script
supone que trabaja con correo y que el alias de mail <literal remap="tt">hostmaster</literal> está
definido. Debe editarlo para ajustarlo a su configuración.
</para>

<para>

<screen>
#!/bin/sh
#
# Actualizacion del cache del servidor de nombres una vez al mes.
# Esto es ejecutado automaticamente mediante una entrada de cron
#
(
 echo "To: hostmaster &#60;hostmaster&#62;"
 echo "From: system &#60;root&#62;"
 echo "Subject: Actualizacion automatica del fichero named.boot"
 echo

 export PATH=/sbin:/usr/sbin:/bin:/usr/bin:
 cd /var/named

 dig @rs.internic.net . ns &#62;root.cache.new

 echo "El fichero named.boot ha sido actualizado para contener la 
siguiente informacion:"
 echo
 cat root.cache.new

 chown root.root root.cache.new
 chmod 444 root.cache.new
 rm -f root.cache.old
 mv root.cache root.cache.old
 mv root.cache.new root.cache
 ndc restart
 echo
 echo "El servidor de nombres ha sido rearrancado a fin de asegurar que la
actualizacion es completa."
 echo "El anterior fichero root.cache se ha renombrado a /var/named/root.cache.old."
) 2&#62;&#38;1 | /usr/lib/sendmail -t
exit 0
</screen>

</para>

<para>
Alguno de ustedes puede haber observado que el archivo <literal remap="tt">root.cache</literal>
está también disponible mediante ftp en <emphasis remap="it">Internic</emphasis>. Por favor NO
utilice ftp para actualizar <literal remap="tt">root.cache</literal>, el método anterior es mucho
más amistoso con la red. 
</para>

</sect1>

<sect1 id="timofonicas">
<title>Configuración de Conexiones Automáticas vía telefónica .</title>

<para>
Esta sección explica cómo he dispuesto las cosas para automatizarlo todo. 
Mi método puede que no se adapte completamente al suyo, pero puede obtener
ideas de algunas de las cosas que he hecho. También, uso <literal remap="tt">ppp</literal> para
marcar, mientras que mucha gente usa <literal remap="tt">slip</literal> o <literal remap="tt">cslip</literal> y por tanto
casi toda su configuración puede ser distinta a la mía.  Pero el programa
de slip <literal remap="tt">dip</literal> debería poder hacer muchas de las cosas que yo hago.
</para>

<para>
Normalmente, cuando no estoy conectado a la red tengo un archivo
<literal remap="tt">resolv.conf</literal> que simplemente contiene la línea
</para>

<para>

<screen>
     domain uio.no
</screen>

</para>

<para>
Eso me asegura que no tengo que esperar a que la librería de resolución de
nombres del sistema intente conectar con un servidor de nombres que no
puede ayudarme.  Pero cuando me conecto quiero arrancar mi <literal remap="tt">named</literal>
y tener un <literal remap="tt">resolv.conf</literal> parecido a los descritos anteriormente. He
resuelto esto teniendo dos archivos <literal remap="tt">resolv.conf</literal> llamados
<literal remap="tt">resolv.conf.local</literal> y <literal remap="tt">resolv.conf.connected</literal>. El último se parece
al <literal remap="tt">resolv.conf</literal> descrito anteriormente en este documento. 
</para>

<para>
Para conectarme automáticamente a la red ejecuto un script llamado
<literal remap="tt">ppp-on</literal>: 
</para>

<para>

<screen>
#!/bin/sh
echo llamando...
pppd
</screen>

</para>

<para>
<literal remap="tt">pppd</literal> tiene un archivo llamado <literal remap="tt">options</literal> que indica las
características de la conexión. Una vez que mi conexión ppp está activa
<literal remap="tt">pppd</literal> llama a un <emphasis remap="it">script</emphasis> llamado <literal remap="tt">ip-up</literal> (este está
descrito en la página <literal remap="tt">pppd (8)</literal> de man). He aquí una parte del
<emphasis remap="it">script</emphasis>:
</para>

<para>

<screen>
#!/bin/sh
interface="$1"
device="$2"
speed="$3"
myip="$4"
upip="$5"
 ...
cp -v /etc/resolv.conf.connected /etc/resolv.conf
 ...
/usr/sbin/named
</screen>

</para>

<para>
Es decir, arranco el <literal remap="tt">named</literal> desde aquí. Cuando se corta la conexión
ppp, <literal remap="tt">pppd</literal> ejecuta un script llamado <literal remap="tt">ip-down</literal>: 
</para>

<para>

<screen>
#!/bin/sh
cp /etc/resolv.conf.local /etc/resolv.conf
read namedpid &#60; /var/run/named.pid
kill $namedpid
</screen>

</para>

<para>
Así configuramos las cosas de una forma cuando estamos conectados y las
desconfiguramos cuando nos desconectamos. 
</para>

<para>
Algunos programas, <literal remap="tt">irc</literal> y <literal remap="tt">talk</literal> me vienen a la mente,
hacen algunas suposiciones, y para que en <literal remap="tt">irc</literal> el comportamiento
de las capacidades <literal remap="tt">dcc</literal>, y <literal remap="tt">talk</literal> funcionen bien tiene que
modificar su archivo <literal remap="tt">hosts</literal>.  Yo he insertado en mi script
<literal remap="tt">ip-up</literal> lo siguiente:
</para>

<para>

<screen>
cp /etc/hosts.ppp /etc/hosts
echo $myip      roke &#62;&#62;/etc/hosts
</screen>

</para>

<para>
<literal remap="tt">hosts.ppp</literal> simplemente contiene
</para>

<para>

<screen>
127.0.0.1       localhost
</screen>

</para>

<para>
y <literal remap="tt">echo</literal> inserta la dirección IP que he recibido para mi nombre de host
(<literal remap="tt">roke</literal>). Vd. deberá usar en su lugar el nombre de su máquina. Este
nombre se puede saber con el comando <literal remap="tt">hostname</literal>.
</para>

<para>
Probablemente no sea inteligente ejecutar <literal remap="tt">named</literal> cuando no esté
conectado a la red, esto es porque <literal remap="tt">named</literal> intentará enviar
solicitudes a la red y eso consume tiempo, y Vd. tendrá que esperar este
tiempo cada vez que algún programa intente resolver un nombre. Si está
usando conexiones telefónicas debería iniciar <literal remap="tt">named</literal> cuando se
conecte y matarlo cuando se desconecte. Pero por favor lea la sección de
PUF (<xref linkend="PUF"/>) para los trucos.
</para>

<para>
A algunas personas le gusta usar la directiva <literal remap="tt">forwarders</literal> para
conexiones de escasa velocidad. Si su proveedor de Internet tiene
servidores DNS en <literal remap="tt">1.2.3.4</literal> y <literal remap="tt">1.2.3.5</literal> puede insertar la línea
</para>

<para>

<screen>
forwarders 1.2.3.4 1.2.3.5
</screen>

</para>

<para>
en el archivo <literal remap="tt">named.boot</literal>.  Deje también vacío el archivo
<literal remap="tt">root.cache</literal>. Esto disminuirá el tráfico IP que origina su máquina.
Esto es especialmente importante si paga por cada byte que circule por el
cable. Tiene el valor añadido de evitarle el deber del mantenimiento; no
tiene porqué actualizar un archivo <literal remap="tt">root.cache</literal> vacío. 
</para>

</sect1>

<sect1 id="PUF">
<title>PUFs <emphasis remap="it">Preguntas de Uso Frecuente (FAQ)</emphasis></title>

<para>
En esta sección incluyo algunas de las preguntas más frecuentes realizadas
relativas a DNS y este COMO. Y las respuestas <literal remap="tt">:-)</literal> Por favor, lea esta
sección antes de enviarme correo electrónico. 
</para>

<sect2>
<title>¿Cómo uso DNS desde dentro de un cortafuegos (<emphasis remap="it">firewall</emphasis>)?</title>

<para>
Unas cuantas pistas:  `<literal remap="tt">forwarders</literal>', `<literal remap="tt">slave</literal>', y echar un vistazo
a la literatura que hay al final de este COMO.
</para>

</sect2>

<sect2>
<title>¿Cómo hago que DNS rote entre las direcciones disponibles para un
servicio, por ejemplo para <literal remap="tt">www.siempre.ocupado</literal> para obtener
balanceo de carga o similar?</title>

<para>
Haga varios registros <literal remap="tt">A</literal> para <literal remap="tt">www.siempre.ocupado</literal> y use <literal remap="tt">bind
4.9.3</literal> o posterior. <literal remap="tt">bind</literal> hará una rotación tipo <emphasis remap="it">round-robin</emphasis> de
las respuestas. Esto no funcionará con versiones anteriores de <literal remap="tt">bind</literal>.
</para>

</sect2>

<sect2>
<title>Quiero configurar DNS en una intranet (cerrada) ¿qué hago? </title>

<para>
Elimine el archivo de caché y haga los archivos de zona. Eso también
significa que nunca tendrá que actualizar el archivo de caché. 
</para>

</sect2>

<sect2>
<title>Mi sistema no tiene el programa <literal remap="tt">ndc</literal>. ¿Qué hago? </title>

<para>
El <emphasis remap="it">bind</emphasis> instalado en su sistema es viejo y de alguna forma obsoleto. 
Si la seguridad es importante para Vd.: actualice <emphasis remap="it">bind</emphasis>
inmediatamente. Si no, de todas formas podrá vivir con ello. En lugar de
ejecutar <literal remap="tt">ndc start</literal> ejecute <literal remap="tt">named</literal>; <literal remap="tt">ndc reload</literal> será
<literal remap="tt">named.reload</literal> y <literal remap="tt">ndc restart</literal> será <literal remap="tt">named.restart</literal>. Esos
programas probablemente estarán en <literal remap="tt">/usr/sbin</literal>.
</para>

</sect2>

<sect2>
<title>¿Cómo configuro un servidor de nombres secundario? </title>

<para>
Si el servidor primario tiene la dirección <literal remap="tt">127.0.0.1</literal>, ponga la
siguiente línea en el archivo <literal remap="tt">named.boot</literal> de su secundario: 
</para>

<para>

<screen>
      secondary     linux.bogus             127.0.0.1       sz/linux.bogus
</screen>

</para>

</sect2>

<sect2>
<title>Quiero que <emphasis remap="it">bind</emphasis> se ejecute cuando me desconecto de la red. </title>

<para>
He recibido este mail de Ian Clark, <literal remap="tt"><ulink
url="mailto:ic@deakin.edu.au"
>ic@deakin.edu.au</ulink
></literal> donde explica
la forma de hacer esto: 
</para>

<para>
``Ejecuto named en la máquina que hace <emphasis remap="it">masquerading</emphasis> aquí. Tengo dos
archivos <literal remap="tt">root.cache</literal>, uno llamado <literal remap="tt">root.cache.real</literal> que contiene el
servidor de nombres raíz real y el otro llamado <literal remap="tt">root.cache.falso</literal>
que contiene... 
</para>

<para>

<screen>
          ; root.cache.falso
          ; este archivo no contiene informacion
</screen>

</para>

<para>
Cuando dejo de estar conectado copio el archivo <literal remap="tt">root.cache.falso</literal> en
<literal remap="tt">root.cache</literal> y reinicio <literal remap="tt">named</literal>.
</para>

<para>
Cuando me conecto copio <literal remap="tt">root.cache.real</literal> en <literal remap="tt">root.cache</literal> y
reinicio <literal remap="tt">named</literal>. 
</para>

<para>
Esto se hace desde <literal remap="tt">ip-down</literal> &amp; <literal remap="tt">ip-up</literal> respectivamente. 
</para>

<para>
La primera vez que efectúo una consulta <emphasis remap="it">off line</emphasis> sobre un nombre de
dominio del cual <literal remap="tt">named</literal> no tiene detalles, éste pone una entrada como
esta en <literal remap="tt">messages</literal>...
</para>

<para>

<screen>
          Jan 28 20:10:11 hazchem named[10147]: No root nameserver for class IN
</screen>

</para>

<para>
con la cual puedo convivir sin problemas.
</para>

<para>
Esto ciertamente parece funcionarme. Puedo usar el servidor de nombres
para máquinas locales mientras no estoy conectado sin el retraso con
nombres de dominio externos, y cuando sí estoy conectado, funciona de
forma normal con dominios externos.''
</para>

</sect2>

<sect2>
<title>¿Dónde almacena su caché el servidor de nombres? ¿Hay alguna
forma de controlar el tamaño del caché? </title>

<para>
El caché se almacena en memoria completamente.  No se escribe en disco en
ningún momento. Cada vez que mata a <literal remap="tt">named</literal> se pierde el caché. El
caché no es controlable de ninguna forma, <literal remap="tt">named</literal> lo maneja de acuerdo
con unas reglas simples. No puede controlar ni el caché ni su tamaño de
ninguna forma ni por ningún motivo. Si quiere, puede cambiar esto tocando
los fuentes de <literal remap="tt">named</literal>, lo cual no es recomendable.
</para>

</sect2>

<sect2>
<title>¿Salva <literal remap="tt">named</literal> el caché entre reinicios? ¿Puedo guardarlo?</title>

<para>
No, <literal remap="tt">named</literal> no salva el caché cuando muere. Esto significa que el caché
se debe reconstruir de nuevo cada vez que mate y reinicie <literal remap="tt">named</literal>. No
hay forma de hacer que <literal remap="tt">named</literal> salve el caché en un archivo. Si quiere,
puede cambiar esto tocando los fuentes de <literal remap="tt">named</literal>, lo cual no es
recomendable. 
</para>

</sect2>

</sect1>

<sect1 id="documentacion">
<title>Cómo hacerse un gran <emphasis remap="it">admin</emphasis> DNS.</title>

<para>
Documentación y herramientas.
</para>

<para>
Existe <emphasis remap="it">Documentación Real</emphasis>. En línea e impresa. Se requiere la lectura
de esta documentación para seguir los pasos de pequeño a gran <emphasis remap="it">admin</emphasis>
DNS. En formato impreso el libro estándar es <emphasis remap="it">DNS and BIND</emphasis> de C. Liu y
P.  Albitz de <emphasis remap="it">O'Reilly &amp; Associates</emphasis>, Sebastopol, CA, ISBN
0-937175-82-X. Lo leí, es excelente. Hay también una sección sobre DNS en
<emphasis remap="it">TCP/IP Network Administration</emphasis>, de Craig Hunt de <emphasis remap="it">O'Reilly</emphasis>...,
ISBN 0-937175-82-X. Otros libros necesarios para un Buenos Administradores
DNS (o bueno para cualquier cosa de la materia) es <emphasis remap="it">Zen and the Art of
Motorcycle Maintenance</emphasis> de Robert M.  Prisig <literal remap="tt">:-)</literal> Disponible con ISBN
0688052304 y otros.
</para>

<para>
Puede encontrar material en línea en <literal remap="tt"><ulink
url="http://www.dns.net/dnsrd/"
>http://www.dns.net/dnsrd/</ulink
>,
<ulink
url="http://www.vix.com/isc/bind/"
>http://www.vix.com/isc/bind/</ulink
></literal>; una <emphasis remap="it">PUF</emphasis>, un manual de
referencia (<emphasis remap="it">BOG</emphasis>;  <emphasis remap="it">Bind Operations Guide</emphasis>) así como <emphasis remap="it">papers</emphasis> y
definición de protocolos y diversos retoques o <emphasis remap="it">hacks</emphasis> de DNS (éstos y
la mayoría, si no todas las referencias mencionadas arriba, están también
contenidas en la distribución de <emphasis remap="it">bind</emphasis>).  No he leído la mayoría, pero
tampoco soy un gran admin DNS.  Arnt Gulbrandsen, por otra parte ha leído
el <emphasis remap="it">BOG</emphasis> y está extasiado con él <literal remap="tt">:-)</literal>. El grupo de noticias
<literal remap="tt">comp.protocols.tcp-ip.domains</literal> es sobre DNS. En suma, hay un gran
número de <literal remap="tt">RFC</literal>s sobre DNS, las más importantes son probablemente las
siguientes:
</para>

<para>
<variablelist>

<varlistentry>
<term>RFC 2052</term>
<listitem>
<para>
A. Gulbrandsen, P. Vixie, <emphasis remap="it">A DNS RR for specifying the location of
services (DNS SRV)</emphasis>, Octubre de 1996
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1918</term>
<listitem>
<para>
Y. Rekhter, R. Moskowitz, D. Karrenberg, G. de Groot, E. Lear, <emphasis remap="it">Address
Allocation for Private Internets</emphasis>, 02/29/1996. 
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1912</term>
<listitem>
<para>
D. Barr, <emphasis remap="it">Common DNS Operational and Configuration Errors</emphasis>, 02/28/1996. 
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1713</term>
<listitem>
<para>
A. Romao, <emphasis remap="it">Tools for DNS debugging</emphasis>, 11/03/1994.
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1712</term>
<listitem>
<para>
C. Farrell, M. Schulze, S. Pleitner, D. Baldoni, <emphasis remap="it">DNS Encoding of
Geographical Location</emphasis>, 11/01/1994. 
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1183</term>
<listitem>
<para>
R. Ullmann, P. Mockapetris, L. Mamakos, C. Everhart, <emphasis remap="it">New DNS RR
Definitions</emphasis>, 10/08/1990. 
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1035</term>
<listitem>
<para>
P. Mockapetris, <emphasis remap="it">Domain names - implementation and specification</emphasis>,
11/01/1987. 
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1034</term>
<listitem>
<para>
P. Mockapetris, <emphasis remap="it">Domain names - concepts and facilities</emphasis>, 11/01/1987. 
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1033</term>
<listitem>
<para>
M. Lottor, <emphasis remap="it">Domain administrators operations guide</emphasis>, 11/01/1987. 
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 1032</term>
<listitem>
<para>
M. Stahl, <emphasis remap="it">Domain administrators guide</emphasis>, 11/01/1987.
</para>
</listitem></varlistentry>
<varlistentry>
<term>RFC 974</term>
<listitem>
<para>
C. Partridge, <emphasis remap="it">Mail routing and the domain system</emphasis>, 01/01/1986.
</para>
</listitem></varlistentry>
</variablelist>
</para>

</sect1>

<sect1>
<title>Traducción</title>

<para>
Este documento ha sido traducido por
</para>

<para>
Pedro Pablo Fábrega Martínez, <literal remap="tt"><ulink
url="mailto:pfabrega@arrakis.es"
>pfabrega@arrakis.es</ulink
></literal>
</para>

<para>
Si encontráis mejoras, añadidos o fallos, de cualquier tipo, indicádmelo
para mejorar el documento. 
</para>

</sect1>

<sect1 id="Grupos">
<title>Anexo: El INSFLUG </title>

<para>
El <emphasis>INSFLUG</emphasis> forma parte del grupo internacional 
<emphasis remap="it">Linux Documentation Project</emphasis>, 
encargándose de las traducciones al castellano de los Howtos (Comos),
así como la producción de documentos originales en aquellos casos
en los que no existe análogo en inglés.
</para>

<para>
En el <emphasis remap="bf">INSFLUG</emphasis> se orienta preferentemente a la traducción de documentos
breves, como los <emphasis>COMOs</emphasis> y <emphasis>PUFs</emphasis> (<emphasis remap="bf">P</emphasis>reguntas de
<emphasis remap="bf">U</emphasis>so <emphasis remap="bf">F</emphasis>recuente, las <emphasis remap="it">FAQs</emphasis>. <literal remap="tt">:)</literal> ), etc.
</para>

<para>
Diríjase a la sede del INSFLUG para más información al respecto.
</para>

<para>
En la sede del INSFLUG encontrará siempre las <emphasis remap="bf">últimas</emphasis> versiones 
de las traducciones:  <literal remap="tt"><ulink
url="http://www.insflug.org"
>www.insflug.org</ulink
></literal>. Asegúrese de comprobar cuál es la última versión 
disponible en el Insflug antes de bajar un documento de un servidor réplica.
</para>

<para>
Se proporciona también una lista de los servidores
réplica (<emphasis remap="it">mirror</emphasis>) del Insflug más cercanos a Vd.,  
e información relativa a otros recursos en castellano.
</para>

<para>
Francisco José Montilla, <literal remap="tt"><ulink
url="mailto:pacopepe@insflug.org"
>pacopepe@insflug.org</ulink
></literal>.
</para>

</sect1>

</article>
