<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.1.2//EN"
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">

<article>

<articleinfo>

<title>Reescritura de direcciones con sendmail mini-COMO</title>

<author>
<firstname>Thomas Roessler, <ulink
url="mailto:roessler@guug.de"
>roessler@guug.de</ulink
>
 Traducción: David Marín Carreño,
<ulink
url="mailto:davefx@bigfoot.com"
>davefx@bigfoot.com</ulink
></firstname>
</author>

<pubdate>v0.1, 6 de Mayo de 1998</pubdate>

<abstract>

<para>
 Este documento es una breve descripción de cómo modificar el fichero
de configuración de sendmail para un acceso telefónico doméstico.
</para>

</abstract>

</articleinfo>

<sect1>
<title>Introducción</title>

<para>
Daré por sentado que tiene el tipo de acceso a Internet que parece ser
común en las universidades y en los proveedores de servicios de Internet
hoy en día: usted se conecta con la red de su proveedor utilizando PPP
sobre una conexión serie. Su correo entrante se almacena temporalmente en
el servidor POP o IMAP de su proveedor, mientras que el correo saliente se
envía mediante SMTP. No tiene un nombre de dominio propio, por lo que todo
debe usar <emphasis remap="it">una</emphasis> dirección.
</para>

<para>
Asumiré también que ya ha instalado una versión bastante reciente de
<literal remap="tt">sendmail</literal>, realizado por Eric Allman (la versión más reciente, al
escribir estas líneas, era la <literal remap="tt">8.8.8</literal> 
<footnote>

<para>
Nota del editor: a día
de la revisión, la última versión disponible es la <literal remap="tt">8.9.3</literal>; debería
actualizarse.  De hecho, si hay un programa que tendría que mantener
actualizado, es éste...  
</para>

</footnote>
 y con ella debería funcionar bien).
</para>

<para>
Este documento se refiere particularmente a propiedades específicas de los
sistemas Debian GNU/Linux; los usuarios de otras distribuciones deberían
tener algo de cuidado.
</para>

<para>
Asegúrese de tener esta información a mano:
</para>

<para>

<itemizedlist>
<listitem>

<para>
El servidor de correo de su proveedor de servicios Internet.
</para>
</listitem>
<listitem>

<para>
Su dirección de correo electrónico.
</para>
</listitem>

</itemizedlist>

</para>

<para>
La configuración que planeamos tiene dos metas principales:
</para>

<para>

<orderedlist>
<listitem>

<para>
Debe ser posible enviar correo entre los usuarios locales.

</para>
</listitem>
<listitem>

<para>
El resto del planeta debe ver las direcciones de los usuarios del
proveedor de servicios Internet, no las direcciones locales.
</para>
</listitem>

</orderedlist>

</para>

<para>
Para alcanzar esto, haremos uso del la opción <literal remap="tt">genericstable</literal> de 
<literal remap="tt">sendmail</literal>.
</para>

</sect1>

<sect1>
<title>Mapa de ficheros</title>

<para>
Colocaremos todos los ficheros de configuración de <literal remap="tt">sendmail</literal> en un
directorio aparte bajo <literal remap="tt">/etc</literal>: <literal remap="tt">/etc/mail</literal>. Normalmente,
<literal remap="tt">sendmail</literal> esperará que esos ficheros residan directamente bajo
<literal remap="tt">etc</literal>. Para evitar problemas, <literal remap="tt">/etc/sendmail.cf</literal> debería ser un
enlace simbólico a <literal remap="tt">/etc/mail/sendmail.cf</literal>.
</para>

<para>
Los siguientes ficheros poblarán <literal remap="tt">/etc/mail</literal>:
</para>

<para>

<itemizedlist>
<listitem>

<para>
<literal remap="tt">aliases</literal> - contiene direcciones locales adicionales.
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">genericsdomain</literal> - contiene alguna información acerca de la
configuración de su máquina local.
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">genericstable</literal> - contiene las reglas reales de reescritura.
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">sendmail.cf</literal> - fichero de configuración de sendmail.
</para>
</listitem>
<listitem>

<para>
<literal remap="tt">sendmail.mc</literal> - la fuente de <literal remap="tt">sendmail.cf</literal>.
</para>
</listitem>

</itemizedlist>

</para>

<para>
Algunos de estos ficheros serán acompañados por ficheros <literal remap="tt">.db</literal>, que
contienen bases de datos configuradas para el uso directo de
<literal remap="tt">sendmail</literal>.
</para>

<para>
Asumimos que la parte <literal remap="tt">cf</literal> del árbol de código fuente de <literal remap="tt">sendmail</literal>
reside bajo un directorio llamado <literal remap="tt">/usr/lib/sendmail.cf</literal>. Este es
el caso de los sistemas Debian GNU/Linux. En otras distribuciones este
directorio posiblemente esté en un sitio diferente. Lea la documentación
de su distribución para más detalles.
</para>

</sect1>

<sect1>
<title>Configuración de sendmail</title>

<sect2>
<title>El fichero principal de configuración</title>

<para>
Sendmail utiliza un sistema de reglas muy complejo para su configuración.  
Debido a que se pueden hacer millares de cosas con ellas, escribir un
fichero <literal remap="tt">sendmail.cf</literal> desde cero es bastante inusual y lleva mucho
tiempo. Si está interesado en hacer eso, debería dejar de leer este
documento ahora mismo y leer, en su lugar, el <emphasis remap="it">Bat Book</emphasis> de la
editorial <emphasis remap="it">O'Reilly</emphasis>.
</para>

<para>
En lugar de crear a mano estas reglas, confiaremos en el procesador de
macros <literal remap="tt">m4</literal> para crear nuestro fichero de configuración a partir de
fragmentos escritos anteriormente que se distribuyen junto con sendmail.
</para>

<para>
Echemos un vistazo a las primeras líneas del fichero <literal remap="tt">sendmail.mc</literal>:
</para>

<para>

<screen>
include(/usr/lib/sendmail.cf/m4/cf.m4)
VERSIONID(`sendmail.mc - roessler@guug.de')
OSTYPE(debian)
define(`ALIAS_FILE',`/etc/mail/aliases')
</screen>

</para>

<para>
Al comienzo, se incluye <literal remap="tt">cf.m4</literal>. Este fichero de macros m4 contiene
muchas definiciones de macro para el resto del fichero.  Asegúrese de que
la ruta de archivo que proporciona aquí es correcta (la que aquí se
representa es la típica de Debian GNU/Linux). La macro <literal remap="tt">OSTYPE</literal> se
utiliza para dar algunas configuraciones por defecto muy útiles. Si no
utiliza un sistema Debian, reemplace la palabra <literal remap="tt">debian</literal> por
<literal remap="tt">linux</literal>. <literal remap="tt">ALIAS_FILE</literal> indica a sendmail dónde buscar la lista de
alias.
</para>

<para>
Las siguientes líneas dirán a sendmail que utilice la característica
<literal remap="tt">genericstable</literal>, y dónde encontrar los ficheros de configuración
necesarios para usarla: 
</para>

<para>

<screen>
FEATURE(masquerade_envelope)
FEATURE(genericstable, `hash -o /etc/mail/genericstable')
GENERICS_DOMAIN_FILE(`/etc/mail/genericsdomain')
</screen>

</para>

<para>
La característica <literal remap="tt">masquerade_envelope</literal> le dice a sendmail que aplique
la cabecera reescribiendo el <emphasis remap="it">sobre</emphasis> del remitente de un mensaje.  Esta
es la dirección de correo a la que los subsistemas de reparto dirigirán
los informes de fallo en el reparto y mensajes de advertencia. Los
ficheros <literal remap="tt">generics*</literal> se explicarán más abajo.
</para>

<para>
Ahora, debemos definir un, llamémosle así, servidor «inteligente»
<literal remap="tt">(smart-host)</literal>, esto es, una máquina que manejará el correo
saliente de nuestro sistema. Dése cuenta de que esta máquina puede ser
distinta de los servidores POP e IMAP de su proveedor. En caso de duda,
llame al servicio técnico. El código en el fichero de configuración
maestra es:
</para>

<para>

<screen>
define(`SMART_HOST',`mensajes-salientes.su.proveedor')
</screen>

</para>

<para>
Reemplace <literal remap="tt">mensajes-salientes.su.proveedor</literal> por la dirección completa
de de la máquina de su proveedor de servicios Internet que gestionará el
correo saliente. 
</para>

<para>
Las dos líneas finales incluyen las definiciones del <emphasis remap="it">cartero</emphasis> que son
requeridas por sendmail para averiguar cómo manejar varios tipos de
correo:
</para>

<para>

<screen>
MAILER(local)
MAILER(smtp)
</screen>

</para>

<para>
Para generar el fichero <literal remap="tt">sendmail.cf</literal> a partir de este
<literal remap="tt">sendmail.mc</literal>, teclee los siguientes comandos (como root): 
</para>

<para>

<screen>
# m4 sendmail.mc &#62; _sendmail.cf
# mv -f _sendmail.cf sendmail.cf
</screen>

</para>

<para>
Fíjese en que la técnica de escribir las salidas <literal remap="tt">m4</literal> a un fichero
temporal que será movido a su lugar correcto.  Esto ayuda a prevenir que
sendmail lea ficheros de configuración parcialmente escritos.
</para>

</sect2>

<sect2>
<title>Reescritura de direcciones</title>

<para>
Primero, le debemos comunicar a sendmail qué direcciones van a
considerarse como locales (y de esta manera deberían estar sujetas a la
reescritura). Esto es bastante simple: sólo coloque el nombre completo de
su máquina en el fichero <literal remap="tt">/etc/mail/genericsdomain</literal> Para conseguir
el nombre completo de su máquina, teclee el siguiente comando:
</para>

<para>

<screen>
$ hostname -f
</screen>

</para>

<para>
Ahora, vayamos con la tabla de reescritura propiamente dicha: 
<literal remap="tt">/etc/mail/genericstable</literal>.  Este fichero consiste en dos columnas
separadas por espacios en blanco.  La primera columna contiene la
dirección local, la segunda columna contiene la dirección de correo
electrónico que debería utilizarse en su lugar. El fichero podría tener
este aspecto:
</para>

<para>

<screen>
harry	harryx@su.proveedor
maude	maudey@el.proovedor.de.ella
root	fredx@su.proovedor
news	fredx@su.proovedor
</screen>

</para>

<para>
Note que debe haber una entrada para <emphasis remap="it">cada</emphasis> cuenta de la máquina local,
de manera que el correo generado que salga del sistema local lleve,
automáticamente, información de cabecera correcta.
</para>

<para>
Por razones de prestaciones, sendmail no utiliza este fichero
directamente, utiliza una versión procesada en su lugar.  Para generarla
utilice el siguiente comando:
</para>

<para>

<screen>
# makemap -r hash genericstable.db &#60; genericstable
</screen>

</para>

<para>
Fíjese en que las reglas de reescritura incluidas en <literal remap="tt">genericstable</literal>
<emphasis remap="it">no</emphasis> se aplican al correo local ni a los mensajes que recibe desde
fuera;  el mapeo sólo se utiliza si un mensaje abandona su sistema local a
través del servidor <emphasis remap="it">inteligente</emphasis> de su proovedor de Internet.
</para>

</sect2>

<sect2>
<title>Alias</title>

<para>
El fichero de alias contiene información adicional de los nombres locales
que sólo son válidos para mensajes locales.  Esto es útil para cuentas
administrativas como <literal remap="tt">root</literal> que recibe los mensajes generados
automáticamente por el sistema.
</para>

<para>
Un comienzo razonable para <literal remap="tt">/etc/mail/aliases</literal> podría ser el
siguiente fichero: 
</para>

<para>

<screen>
root: fred
news: root
postmaster: root
mail: root
www: root

nobody: /dev/null
MAILER-DAEMON: nobody
</screen>

</para>

<para>
Este ejemplo reenviará el correo local para los usuarios <literal remap="tt">root</literal>,
<literal remap="tt">news</literal>, <literal remap="tt">postmaster</literal>, <literal remap="tt">mail</literal>, y <literal remap="tt">www</literal> a <literal remap="tt">fred</literal>, mientras
que los mensajes para <literal remap="tt">nobody</literal> y para <literal remap="tt">MAILER-DAEMON</literal> se redirigirán
a <literal remap="tt">/dev/null</literal>. 
</para>

<para>
Al igual que el fichero <literal remap="tt">genericstable</literal>, <literal remap="tt">aliases</literal> puede contener
<emphasis remap="it">cientos</emphasis> de entradas.  Esto es, podría ser ineficiente que sendmail
utilizara el fichero de texto tal y como se describe.  El mismo mecanismo
utilizado para <literal remap="tt">genericstable</literal> se utiliza para <literal remap="tt">aliases</literal>: se genera
una tabla preformateada. En lugar de utilizar <literal remap="tt">makemap</literal> directamente,
puede utilizar el comando <literal remap="tt">newaliases</literal> esta vez. Se encargará
automáticamente de lo que sea necesario para que los cambios tomen efecto.
</para>

</sect2>

</sect1>

<sect1>
<title>Lectura más profunda</title>

<para>
La distribución del código fuente de sendmail incluye bastante más
documentación.  Léala, especialmente el fichero <literal remap="tt">cf/README</literal>. 
</para>

<para>
Si está interesado en profundizar más en las opciones de configuración de
sendmail, puede desear conseguir el <emphasis remap="it">Bat Book</emphasis> de la editorial
<emphasis remap="it">O'Reilly</emphasis>:  Bryan Costales, Eric Allman, and Neil Rickert:
<literal remap="tt">sendmail</literal>.  <emphasis remap="it">O'Reilly</emphasis>, 1993. 
</para>

</sect1>

<sect1 id="Insflug">
<title>Anexo: El INSFLUG </title>

<para>
El <emphasis remap="it">INSFLUG</emphasis> forma parte del grupo internacional <emphasis remap="it">Linux Documentation
Project</emphasis>, encargándose de las traducciones al castellano de los Howtos,
así como de la producción de documentos originales en aquellos casos en los
que no existe análogo en inglés, centrándose, preferentemente, en documentos
breves, como los <emphasis>COMOs</emphasis> y <emphasis>PUFs</emphasis> (<emphasis remap="bf">P</emphasis>reguntas de <emphasis remap="bf">U</emphasis>so
<emphasis remap="bf">F</emphasis>recuente, las <emphasis remap="it">FAQs</emphasis>. <literal remap="tt">:)</literal> ), etc.
</para>

<para>
Diríjase a la sede del Insflug para más información al respecto.
</para>

<para>
En élla encontrará siempre las <emphasis remap="bf">últimas</emphasis> versiones de las traducciones
«oficiales»:  <literal remap="tt"><ulink
url="http://www.insflug.org"
>www.insflug.org</ulink
></literal>. Asegúrese de comprobar cuál es la última
versión disponible en el Insflug antes de bajar un documento de un
servidor réplica. 
</para>

<para>
Además, cuenta con un sistema interactivo de gestión de fe de erratas y
sugerencias en línea, motor de búsqueda específico, y más servicios en los
que estamos trabajando incesantemente.
</para>

<para>
Se proporciona también una lista de los servidores réplica (<emphasis remap="it">mirror</emphasis>)
del Insflug más cercanos a Vd., e información relativa a otros recursos en
castellano.
</para>

<para>
En <literal remap="tt"><ulink
url="http://www.insflug.org/insflug/creditos.php3"
>http://www.insflug.org/insflug/creditos.php3</ulink
></literal> cuenta con una
detallada relación de las personas que hacen posible tanto esto como las
traducciones.
</para>

<para>
¡Diríjase a <literal remap="tt"><ulink
url="http://www.insflug.org/colaboracion/index.php3"
>http://www.insflug.org/colaboracion/index.php3</ulink
></literal> si desea
unirse a nosotros!.
</para>

<para>
«Cartel» Insflug, <literal remap="tt"><ulink
url="mailto:cartel@insflug.org"
>cartel@insflug.org</ulink
></literal>. 
</para>

</sect1>

</article>
