<!-- $Id: ch02.sgm,v 1.19 2002/11/17 17:43:43 pakojavi2000 Exp $ -->
<!--
Nota legal:

   Linux Network Administration Guide, por Olaf Kirch et al.

   La traducción al español se publica bajo la licencia GFDL,
siendo texto de portada el siguiente:

Linux Network Administrator's Guide
by Olaf Kirch and Terry Dawson
Copyright  (c) 1993 Olaf Kirch
Copyright  (c) 2000 Terry Dawson
Copyright on O'Reilly printed version (c) 2000 O'Reilly & Associates

y siendo secciones invariantes, la sección de Agradecimientos,
la sección titulada «La traducción al español», el apéndice C; así
como esta nota.

Capítulo traducido por: Javier Villa <javillariv@yahoo.com>
y Natalia Ballesteros <nbhuesca@yahoo.com>
Revisión 1 por Francisco Javier Fernández serrador@arrakis.es


-->
<chapter id="X-087-2-issues"><title>Cuestiones sobre redes TCP/IP</title>
<indexterm id="chis.tcp.ip.networks" class="startofrange"><primary>TCP/IP (Transmission Control Protocol/Internet Protocol)</primary><secondary>redes</secondary></indexterm>
<indexterm id="chis.networks.tcp.ip" class="startofrange"><primary>redes</primary><secondary>TCP/IP</secondary></indexterm>

<para>
En este capítulo volveremos a las decisiones sobre configuración que se deben
tomar cuando se conecta una máquina Linux a una red TCP/IP, incluyendo el tema
de las direcciones IP, los nombres de los puestos, y cuestiones sobre el
encaminamiento. Este capítulo le enseñerá lo que necesita saber para entender
lo que su sistema requiere, mientras que los siguientes capítulos cubren las
herramientas que serán necesarias.
</para>

<para>
Para aprender más acerca de TCP/IP y las razones de su uso, diríjase al tercer
volumen del libro <emphasis>Internetworking with TCP/IP</emphasis> de Douglas
R. Comer (Prentice Hall). Si busca una guía más detallada del control de una
red TCP/IP, vea <emphasis>TCP/IP Network Administration</emphasis> de Craig
Hunt (O'Reilly).
</para>

<sect1 id="X-087-2-issues.interfaces"><title>Interfaces de red</title>
<indexterm><primary>interfaces</primary></indexterm>
<para>
Para ocultar la diversidad de hardware que puede usarse en un entorno de red,
TCP/IP define una <emphasis>interfaz</emphasis> abstracta a través de la cual
se accede a dicho hardware. Esta interfaz ofrece un conjunto de operaciones
que son las mismas para todos los tipos de hardware y básicamente trata con el
envío y la recepción de paquetes.
</para>

<para>
Tiene que estar presente en el núcleo la correspondiente interfaz para cada
dispositivo periférico de red. Por ejemplo, las interfaces Ethernet se llaman
en GNU/Linux con nombres como <filename>eth0</filename> y
<filename>eth1</filename>; las interfaces PPP (discutido en <xref
linkend="X-087-2-ppp">&thinsp;) se denominan <filename>ppp0</filename> y
<filename>ppp1</filename>; y a las interfaces FDDI se le da nombres como
<filename>fddi0</filename> y <filename>fddi1</filename>. Estos nombres de
interfaz se usan para propósitos de configuración cuando se quiere especificar
un dispositivo físico determinado en una orden de configuración, y no tienen
significado más allá de este uso.
</para>

<para>
Antes de ser usada en una red TCP/IP, a una interfaz se le debe asignar una
dirección IP que sirve como su identificador cuando se comunica con el resto
del mundo. Esta dirección es distinta del nombre de interfaz mencionado
anteriormente; si se compara una interfaz con una puerta, la dirección es como
el número de la puerta.
</para>

<para>
<indexterm><primary>Maximum Transfer Unit (MTU)</primary></indexterm>
Se pueden selecciónar otros parámetros de dispositivo como el tamaño máximo de
los datagramas que pueden ser procesados por una parte del hardware
determinada, a lo que se le denomina <emphasis>Maximum Transfer
Unit</emphasis> (MTU). Hay otros atributos que se introducirán más tarde.
Afortunadamente, la mayoría de esos atributos tienen valores por defecto muy
acertados.
</para>

</sect1>

<sect1 id="X-087-2-issues.ip-addresses"><title>Direcciones IP</title>
<indexterm><primary>direcciones</primary><secondary>IP</secondary></indexterm>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>direcciones</secondary></indexterm>
<para>
Como se menciona en <xref linkend="X-087-2-intro">, el protocolo de red IP
utiliza direcciones formadas por números de 32 bits. Se le debe asignar un
número único a cada máquina del entorno de red.<footnote id="X-087-2-FNIS01">
<para>
La versión del Protocolo de Internet usada más frecuentemente en Internet es la
Versión 4. Se ha hecho un gran esfuerzo para diseñar una versión de reemplazo
llamada IP Versión 6. IPv6 tiene un esquema de direcciones distinto y
direcciones más largas. GNU/Linux tiene un implemento de IPv6, pero no está
preparado para ser documentado en este libro aún. El soporte del núcleo de
GNU/Linux para IPv6 es bueno, pero un gran número de aplicaciones de red necesitan
ser modificadas para soportarlo también. Manténgase informado.
</para>
</footnote>
Si está haciendo funcionar una red local que no tiene tráfico TCP/IP con otras
redes, puede asignar estos números de acuerdo con sus preferencias personales.
Hay algunos rangos de direcciones IP que han sido reservadas para redes
privadas. Estos rangos se listan en <xref
linkend="X-087-2-issues.reserved.addresses">. De cualquier modo, los números
para los sitios en Internet los asigna una autoridad central, el
<emphasis>Network Information Center</emphasis> (NIC).<footnote
id="X-087-2-FNIS02">
<para>
Frecuentemente, las direcciones IP le son asignadas por el proveedor al que
compró su conexión IP. De todos modos, también puede solicitar una dirección
IP directamente al NIC enviando un email a <systemitem
role="emailaddr">hostmaster@internic.net</systemitem>, o usando el formulario
en <systemitem role="url">http://www.internic.net/</systemitem>.
</para>
</footnote>

</para>

<para>
<indexterm><primary>notación de puntos divisorios</primary></indexterm>
<indexterm><primary>octetos</primary></indexterm>
Para facilitar la lectura, las direcciones IP se separan en cuatro números de
ocho bits llamados <emphasis>octetos</emphasis>. Por ejemplo, <systemitem
role="sitename">quark.physics.groucho.edu</systemitem> tiene una dirección IP
<systemitem role="sitename">0x954C0C04</systemitem>, que se escribe como
<systemitem role="sitename">149.76.12.4</systemitem>. Este formato se denomina
normalmente <emphasis>notación de puntos divisorios</emphasis>.
</para>

<para>
Otra razón para usar esta notación es que las direcciones IP se dividen en un
número de <emphasis>red</emphasis>, que es contenido en el octeto principal, y
un número de <emphasis>puesto</emphasis>, que es contenido en el resto. Cuando
se solicita al NIC una dirección IP, no se le asignará una dirección para cada
puesto individual que pretenda usar. En cambio, se le otorgará un número de
red y se le permitirá asignar todas la direcciones IP válidas dentro de ese
rango para albergar puestos en su red de acuerdo con sus preferencias.
</para>

<para>
El tamaño de la parte dedicada al puesto depende del tamaño de la red. Para
complacer diferentes necesidades, se han definido varias clases de redes,
fijando diferentes sitios donde dividir la dirección IP. Las clases de redes
se definen en lo siguiente:
</para>

<para>
<variablelist>
<varlistentry><term>Clase A</term>
<listitem><para>
La clase A comprende redes desde <systemitem
role="sitename">1.0.0.0</systemitem> hasta <systemitem
role="sitename">127.0.0.0</systemitem>. El número de red está contenido en el
primer octeto. Esta clase ofrece una parte para el puesto de 24 bits,
permitiendo aproximadamente 1,6 millones de puestos por red.
</para></listitem>
</varlistentry>

<varlistentry><term>Clase B</term>
<listitem><para>
La clase B comprende las redes desde <systemitem
role="sitename">128.0.0.0</systemitem> hasta <systemitem
role="sitename">191.255.0.0</systemitem>; el número de red está en los dos
primeros octetos. Esta clase permite 16.320 redes con 65.024 puestos cada una.
</para></listitem>
</varlistentry>

<varlistentry><term>Clase C</term> <listitem><para> Las redes de clase C van
desde <systemitem role="sitename">192.0.0.0</systemitem> hasta <systemitem
role="sitename">223.255.255.0</systemitem>, con el número de red contenido en
los tres primeros octetos. Esta clase permite cerca de 2 millones de redes con
más de 254 puestos.
</para></listitem>
</varlistentry>

<varlistentry><term>Clases D, E, y F</term>
<listitem><para>
Las direcciones que están en el rango de <systemitem
role="sitename">224.0.0.0</systemitem> hasta <systemitem
role="sitename">254.0.0.0</systemitem> son experimentales o están reservadas
para uso con propósitos especiales y no especifican ninguna red. La IP
Multicast, un servicio que permite trasmitir material a muchos puntos en una
internet a la vez, se le ha asignado direcciones dentro de este rango.
</para></listitem>
</varlistentry>

</variablelist>
</para>

<para>
Si volvemos al ejemplo del capítulo 1, encontraremos que <systemitem
role="sitename">149.76.12.4</systemitem>, la dirección de <systemitem
role="sitename">quark</systemitem>, se refiere al puesto <systemitem
role="sitename">12.4</systemitem> en la red de clase B <systemitem
role="sitename">149.76.0.0</systemitem>.
</para>

<para>
<indexterm><primary>direcciones</primary><secondary>difusión</secondary></indexterm>
Habrá notado que no se permiten todos los valores posibles de la lista
anterior para todos los octetos de la parte del puesto. Esto se debe a que los
octetos <systemitem role="sitename">0</systemitem> y <systemitem
role="sitename">255</systemitem> se reservan para propósitos especiales. Una
dirección donde todos los bits de la parte del puesto son 0, se refiere a la
red, y una dirección donde todos los bits de la parte del puesto son 1, se
denomina <emphasis>dirección de difusión</emphasis>. Ésta se refiere
simultáneamente a todos los puestos de la red específica. Así, <systemitem
role="sitename">149.76.255.255</systemitem> no es una dirección de puesto
válida, pero se refiere a todos los puestos en la red <systemitem
role="sitename">149.76.0.0</systemitem>.
</para>

<para>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>encaminamiento
por defecto</secondary></indexterm>
<indexterm><primary>encaminamiento por defecto</primary></indexterm>
<indexterm><primary>loopback</primary><secondary>dirección</secondary></indexterm>
<indexterm><primary>direcciones</primary><secondary>loopback</secondary></indexterm>
Algunas direcciones de red se reservan para propósitos especiales. <systemitem
role="sitename">0.0.0.0</systemitem> y <systemitem
role="sitename">127.0.0.0</systemitem> son dos de estas direcciones. La
primera se denomina <emphasis>encaminamiento por defecto</emphasis>, y la
segunda es la <emphasis>dirección loopback</emphasis>. El encaminamiento por
defecto tiene que ver con el camino por el que el IP encamina los datagramas.
</para>

<para>
La red <systemitem role="sitename">127.0.0.0</systemitem> está reservada para
el tráfico local IP del puesto. Normalmente, la dirección <systemitem
role="sitename">127.0.0.1</systemitem> se asignará a una interfaz especial del
puesto, la <emphasis>interfaz loopback</emphasis>, que actúa como un circuito
cerrado. Cualquier paquete IP enviado a esta interfaz por TCP o UDP le será
devuelto a cualquiera de ellos como si simplemente hubiese llegado desde
alguna red. Esto permite desarrollar y probar software de red aunque no se esté
usando una red &ldquo;real&rdquo;. La red loopback también permite usar
software de red en un puesto solitario. Puede que esto no sea tan infrecuente
como parece; por ejemplo, muchos sitios UUCP no tienen conectividad con IP en
absoluto, pero aún pueden querer ejecutar un sistema de noticias INN. Para un
funcionamiento adecuado en GNU/Linux, INN requiere la interfaz loopback.
</para>

<para>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>redes privadas</secondary></indexterm>
Algunos rangos de direcciones de cada una de las clases de red han sido
reservados y designados como rangos de direcciones &ldquo;reservadas&rdquo; o
&ldquo;privadas&rdquo;. Estas direcciones están reservadas para el uso de
redes privadas y no son encaminadas en Internet. Son usadas normalmente por
organizaciones con su propia intranet, pero incluso las redes pequeñas suelen
encontrarlas útiles. Las direcciones de red reservadas se muestran en <xref
linkend="X-087-2-issues.reserved.addresses">.
</para>

<table id="X-087-2-issues.reserved.addresses">
<title>Rangos de direcciones IP reservados para uso público</title>
<tgroup cols=2>
<thead>
<row>
  <entry>Clase</entry>
  <entry>Redes</entry>
</row>
</thead>
<tbody>
<row>
  <entry>A</entry>
  <entry>10.0.0.0 hasta 10.255.255.255</entry>
</row>
<row>
  <entry>B</entry>
  <entry>172.16.0.0 hasta 172.31.0.0</entry>
</row>
<row>
  <entry>C</entry>
  <entry>192.168.0.0 hasta 192.168.255.0</entry>
</row>
</tbody>
</tgroup>
</table>

</sect1>

<sect1 id="X-087-2-issues.arp"><title>Resolución de direcciones</title>
<indexterm id="chis.arp1" class=startofrange><primary>ARP (Address Resolution Protocol)</primary></indexterm>
<indexterm><primary>Ethernet</primary><secondary>Direcciones</secondary></indexterm>
<para>
Ahora que sabe como se componen las direcciones IP, se estará preguntando cómo
se usan en una red Ethernet o Token Ring para identificar los diferentes
puestos. Después de todo, dichos protocolos tienen sus propias direcciones
para identificar los puestos y éstas no tienen absolutamente nada en común
con una dirección IP, ¿verdad? De acuerdo.
</para>

<para>
<indexterm><primary>ham radio</primary></indexterm>
<indexterm><primary>Token Ring</primary><secondary>ARP y</secondary></indexterm>
Se necesita un mecanismo para proyectar las direcciones IP en las direcciones
de la red subyacente. Este mecanismo es el <emphasis>Address Resolution
Protocol</emphasis> (ARP). De hecho, ARP no se limita a Ethernet o Token Ring,
sino que también se usa en otros tipos de redes, tales como el protocolo de
radio amateur AX.25. La idea básica del ARP es exactamente lo que la mayor
parte de la gente haría si tuviese que encontrar al señor X en una multitud de
150 personas: la persona que le busca le llamaría lo suficientemente fuerte
para que todo el mundo en la habitación pueda oírle, esperando que el señor X
responda si está allí. Cuando él responda, sabremos qué persona es.
</para>

<para>
Cuando ARP quiere encontrar la dirección Ethernet correspondiente a una
dirección IP dada, usa una característica Ethernet denominada
<emphasis>difusión</emphasis>, en la cual un datagrama se envía
simultáneamente a todas las estaciones de la red. El datagrama de difusión
enviado por el ARP contiene la dirección IP en cuestión. Cada puesto receptor
compara esta dirección con la suya propia y si coinciden, devuelve una
respuesta ARP al puesto emisor. El puesto emisor puede entonces
obtener la dirección Ethernet del remitente de la respuesta.
</para>

<para>
Se preguntará como un puesto puede localizar una dirección de Internet que
puede estar en una red diferente al otro lado del mundo. La respuesta a esta
pregunta tiene que ver con el <emphasis>encaminamiento</emphasis>, esto es,
encontrar la ubicación física de un puesto en una red. Discutiremos esta
cuestión más profundamente en la próxima sección.
</para>
<?troff .Nd 15>
<para>
Hablemos un poco más sobre ARP. Una vez que un puesto ha descubierto una
dirección Ethernet, la guarda en su caché ARP de forma que no tiene que
preguntar por ella de nuevo la próxima vez que quiera enviar un datagrama al
puesto en cuestión. De cualquier modo, es poco aconsejable mantener esta
información para siempre; la tarjeta Ethernet del puesto remoto puede ser
reemplazada a causa de problemas técnicos, así la entrada ARP sería inválida.
Por tanto, las entradas en la caché ARP son desechadas cada cierto tiempo para
forzar otra búsqueda de la dirección IP.
</para>

<para>
<indexterm><primary>clientes sin disco</primary></indexterm>
<indexterm><primary>BOOTP</primary></indexterm>
<indexterm><primary>RARP (Reverse Address Resolution Protocol)</primary></indexterm>
A veces también es necesario encontrar la dirección IP asociada a una
dirección Ethernet dada. Esto ocurre cuando una máquina sin disco necesita
arrancar desde un servidor de la red, lo que es una situación común en redes
de área local. Un cliente sin disco, de todos modos, virtualmente no tiene 
información de sí mismo&mdash;¡excepto de su dirección
Ethernet! De modo que difunde un mensaje que contiene una petición para que un
servidor de arranque le otorgue una dirección IP. Hay otro protocolo para esta
situación denominado <emphasis>Reverse Address Resolution Protocol</emphasis>
(RARP). Junto al protocolo BOOTP, sirve para definir el proceso de arranque de
clientes sin disco a través de la red.
</para>

<para>
<indexterm startref="chis.arp1" class=endofrange>
</para>

</sect1>

<sect1 id="X-087-2-issues.routing"><title>Encaminamiento IP</title>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>encaminamiento</secondary></indexterm>
<indexterm><primary>encaminamiento</primary><secondary>IP</secondary></indexterm>
<para>
Ahora nos ocuparemos del problema de encontrar el puesto al que se envían los
datagramas basándose en la dirección IP. La diferentes partes de las
direcciones se manejan de forma distinta; es su trabajo configurar los
ficheros que indican como se trata cada parte.
</para>

<sect2 id="X-087-2-issues.routing.networks"><title>Redes IP</title>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>redes</secondary></indexterm>
<para>
Cuando escribe una carta a alguien, normalmente pone una dirección completa en
el sobre especificando el país, la provincia  y el código postal. Después la echa
al buzón, la oficina de correos la hará llegar a su destino: se enviará al
país indicado, donde el servicio nacional la enviará a la provincia y la región
adecuada. La ventaja de este esquema jerarquizado es obvia: mande donde mande
la carta, la oficina de correos local apenas debe conocer a qué dirección
remitir la carta, es más, a la oficina no le importa por dónde viajará esta
siempre que llegue al país de destino.
</para>

<para>
Las redes IP están estructuradas de forma similar. Toda Internet consiste en
varias redes, denominadas <emphasis>sistemas autónomos</emphasis>. Cada
sistema realiza un encaminamiento interno entre los puestos que lo forman, por
lo que la tarea de remitir un datagrama se reduce a encontrar un camino a la
red del puesto de destino. Tan pronto como el datagrama se entrega a
<emphasis>cualquier</emphasis> puesto en esa red particular, el resto del
proceso se realiza exclusivamente en la misma red.
</para>

<?troff .Nd 10>
</sect2>

<sect2 id="X-087-2-issues.routing.subnets"><title>Subredes</title>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>subredes</secondary></indexterm>
<indexterm><primary>subredes</primary><secondary>IP</secondary></indexterm>
<para>
Esta estructura se refleja dividiendo la dirección IP en la parte del puesto y
la de red, como se explicó anteriormente. Por defecto, la red de destino se
obtiene a partir de la parte de red de la dirección IP. De este modo, los
puestos con números idénticos de <emphasis>red</emphasis> IP deben encontrarse
en la misma red.<footnote id="X-087-2-FNIS03"><para>
Los sistemas autónomos son ligeramente más generales. En ellos se puede
comprender más de una red IP.
</para>
</footnote>

</para>

<para>
También tiene sentido proporcionar un esquema similar
<emphasis>dentro</emphasis> de la red, ya que ésta puede constar de un grupo
de cientos de redes más reducidas, con las unidades más pequeñas haciendo de
redes físicas como Ethernets. Por lo tanto, IP permite subdividir una red IP
en varias <emphasis>subredes</emphasis>.
</para>

<para>
<indexterm><primary>interfaces</primary><secondary>máscara de red</secondary></indexterm>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>máscara de red</secondary></indexterm>
Una subred se responsabiliza de enviar datagramas a un cierto rango de
direcciones IP. Esto es una extensión del concepto de dividir campos de bits,
como en las clases A, B, y C. De cualquier forma, la parte de red se extiende
ahora para incluir algunos bits de la parte del puesto. El número de bits que
se interpreta como el número de subred viene dado por la llamada
<emphasis>máscara de subred</emphasis> o <emphasis>máscara de red</emphasis>.
Este es también un número de 32 bits, que especifica la máscara de bit para la
parte de red de la dirección IP.
</para>

<para>
<indexterm><primary>Groucho Marx University (GMU)</primary></indexterm>
La red del campus de la Groucho Marx University es un ejemplo de este tipo de
redes. Tiene un número de red de clase B
<systemitem role="sitename">149.76.0.0</systemitem>, y su máscara de red es
<systemitem role="sitename">255.255.0.0</systemitem>.
</para>

<para>
Internamente, la red del campus de la GMU consta de varias redes más pequeñas,
como son las LANs de varios departamentos. De modo que el rango de direcciones
IP se divide en 254 subredes: desde <systemitem
role="sitename">149.76.1.0</systemitem> hasta <systemitem
role="sitename">149.76.254.0</systemitem>. Por ejemplo, al departamento de
Física Teórica se le ha asignado <systemitem
role="sitename">149.76.12.0</systemitem>. La dorsal del campus es una red por
derecho propio, y se le ha asignado <systemitem
role="sitename">149.76.1.0</systemitem>. Estas subredes comparten el mismo
número de red, mientras que el tercer octeto se usa para distinguirlas entre
sí. Utilizarán así una máscara de subred de <systemitem
role="sitename">255.255.255.0</systemitem>.
</para>

<para>
<xref linkend="X-087-2-issues.fig.subnet"> muestra como <systemitem
role="sitename">149.76.12.4</systemitem>, la dirección de <systemitem
role="sitename">quark</systemitem>, se interpreta de forma distinta cuando la
dirección viene dada como una red de clase B ordinaria y cuando se usa como
subred.
>>>>>>> 1.7
</para>

<figure id="X-087-2-issues.fig.subnet">
<title>División de una red de clase B en subredes</title>
<mediaobject>
  <imageobject><imagedata fileref="lag2_0201" format="eps"></imageobject>
  <imageobject><imagedata fileref="lag2_0201.jpg" format="jpg"></imageobject>
</mediaobject>
</figure>

<para>
<indexterm><primary>delegar</primary><secondary>subredes IP</secondary></indexterm>
Es dificil notar que la técnica de generar subredes es únicamente una
<emphasis>división interna</emphasis> de la red. Las subredes se generan por
el propietario de la red (o el administrador). Frecuentemente, las subredes se
crean para reflejar límites determinados, ya sean físicos (entre dos
Ethernets), administrativos (entre dos departamentos), o geográficos (entre
dos ubicaciones distintas), y la autoridad de cada subred se delega a alguna
persona de contacto. De todos modos, la estructura afecta solo al
funcionamiento interno de la red y es completamente invisible para el mundo
exterior.
</para>

</sect2>

<sect2 id="X-087-2-issues.routing.gateway"><title>Pasarelas</title>
<indexterm><primary>red internet</primary></indexterm>
<indexterm><primary>pasarelas</primary></indexterm>

<para>
La división en subredes no solo es un beneficio para la administración; es
frecuentemente una consecuencia natural de límites de hardware. El alcance de
un puesto en una red física determinada, tal como una Ethernet, es muy
limitado: solo se puede comunicar con puestos de la red donde él mismo se
encuentra. Solo se puede acceder a los demás puestos a través de máquinas con
una utilidad especial denominadas <emphasis>pasarelas</emphasis>. Una pasarela
es un puesto que está conectado simultáneamente a dos o más redes físicas y
está configurado para intercambiar paquetes entre ellas.
</para>

<para>
<xref linkend="X-087-2-issues.fig.ip"> muestra parte de la topología de red en
la Groucho Marx University (GMU). Los puestos que están en dos subredes al
mismo tiempo se muestran con ambas direcciones.
</para>

<figure id="X-087-2-issues.fig.ip">
<title>Parte de la topología de red de la Groucho Marx University</title>
<mediaobject>
  <imageobject><imagedata fileref="lag2_0202" format="eps"></imageobject>
  <imageobject><imagedata fileref="lag2_0202.jpg" format="jpg"></imageobject>
</mediaobject>
</figure>

<para>
Redes físicas diferentes deben pertenecer a redes IP distintas para que IP sea
capaz de reconocer si un puesto está en una red local o no. Por ejemplo, el
número de red <systemitem role="sitename">149.76.4.0</systemitem> se reserva
para los puestos en la LAN de matemáticas. Cuando se manda un datagrama a
<systemitem role="sitename">quark</systemitem>, el software de red en
<systemitem role="sitename">erdos</systemitem> entiende inmediatamente por la
dirección IP <systemitem role="sitename">149.76.12.4</systemitem> que el
puesto de destino está en una red física diferente, y por lo tanto sólo puede
ser alcanzado a través de una pasarela (<systemitem
role="sitename">sophus</systemitem> por defecto).
</para>

<para>
<systemitem role="sitename">sophus</systemitem> está conectada a dos subredes
distintas: el departamento de Matemáticas y la dorsal del campus. Accede a
cada una a través de una interfaz diferente, <filename>eth0</filename> y
<filename>fddi0</filename>, respectivamente. Ahora bien, ¿que dirección IP se
le debe asignar?. ¿Debemos darle una en la subred <systemitem
role="sitename">149.76.1.0</systemitem>, o en la <systemitem
role="sitename">149.76.4.0</systemitem>?
</para>

<para>
La respuesta es: &ldquo;ambas.&rdquo; <systemitem
role="sitename">sophus</systemitem> tiene asignadas la dirección <systemitem
role="sitename">149.76.1.1</systemitem> para su uso en la red <systemitem
role="sitename">149.76.1.0</systemitem> y la dirección <systemitem
role="sitename">149.76.4.1</systemitem> para la red <systemitem
role="sitename">149.76.4.0</systemitem>. Una pasarela debe tener asignada una
dirección IP para cada red a la que pertenezca. Estas<?troff .nD 10>
direcciones&mdash;junto con la correspondiente máscara de red&mdash;están
vinculadas a la interfaz por la que se accede a la subred. De modo que el
esquema de interfaces y direcciones de <systemitem
role="sitename">sophus</systemitem> sería este:
</para>

<informaltable>
<tgroup cols="3">
<thead>
<row>
  <entry>Interfaz</entry>
  <entry>Dirección</entry>
  <entry>Máscara de red</entry>
</row>
</thead>
<tbody>
<row>
  <entry><filename>eth0</filename></entry>
  <entry>149.76.4.1</entry>
  <entry>255.255.255.0</entry>
</row>
<row>
  <entry><filename>fddi0</filename></entry>
  <entry>149.76.1.1</entry>
  <entry>255.255.255.0</entry>
</row>
<row>
  <entry><filename>lo</filename></entry>
  <entry>127.0.0.1</entry>
  <entry>255.0.0.0</entry>
</row>
</tbody></tgroup>
</informaltable>

<?troff .Nd 7>
<para>
La última entrada define la interfaz loopback <filename>lo</filename>, de la
que hablamos anteriormente.
</para>

<para>
<indexterm><primary>pasarelas</primary><secondary>dirección de</secondary></indexterm>
Generalmente, se puede ignorar la sutil diferencia entre destinar una
dirección a un puesto o a su interfaz. En el caso de puestos que están solos en
una red, como <systemitem role="sitename">erdos</systemitem>, normalmente nos
referiremos al puesto con "esta o aquella" dirección IP, aunque estrictamente
hablando, sea la interfaz Ethernet la que tenga esa dirección IP. La
distinción sólo es realmente importante en el caso de referirse a una
pasarela.
</para>

</sect2>

<sect2 id="X-087-2-issues.routing.table"><title>Tabla de encaminamiento</title>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>encaminamiento</secondary><tertiary>tabla</tertiary></indexterm>
<indexterm><primary>tabla de encaminamiento</primary></indexterm>

<para>
Ahora nos centraremos en como IP elige qué pasarela usar para enviar un
datagrama a una red remota.
</para>

<para>
Hemos visto que <systemitem role="sitename">erdos</systemitem>, cuando envía
un datagrama a <systemitem role="sitename">quark</systemitem>, comprueba la
dirección de destino y encuentra que ésta no está en la red local. <systemitem
role="sitename">erdos</systemitem> por lo tanto envía el datagrama a la
pasarela por defecto <systemitem role="sitename">sophus</systemitem>, que se
enfrenta ahora al mismo problema. <systemitem
role="sitename">sophus</systemitem> reconoce que <systemitem
role="sitename">quark</systemitem> no está en ninguna de las redes a las que
está conectada directamente, de modo que todavía tiene que encontrar otra
pasarela a través de la cual remitirlo. La elección correcta debería ser
<systemitem role="sitename">niels</systemitem>, la pasarela del departamento
de Físicas. Por lo tanto <systemitem role="sitename">sophus</systemitem>
necesita información para asociar una red de destino con una pasarela
adecuada.
</para>

<para>
Para esta tarea, IP usa una tabla que asocia redes con las pasarelas por las
que estas pueden ser alcanzadas. Generalmente, debe incluirse también una
entrada que abarque todo (el <emphasis>encaminamiento por
defecto</emphasis>); esta es la pasarela asociada a la red <systemitem
role="sitename">0.0.0.0</systemitem>. Todas las direcciones de destino se
corresponden con este encaminamiento, ya que no se requiere ninguno de los 32
bits para ajustarse a él, y por tanto los paquetes dirigidos a una red
desconocida se envíarán al encaminamiento por defecto. En <systemitem
role="sitename">sophus</systemitem>, la tabla podría ser algo como esto:
</para>

<informaltable>
<tgroup cols="4">
<thead>
<row>
  <entry>Red</entry>
  <entry>Mascara de red</entry>
  <entry>Pasarela</entry>
  <entry>Interfaz</entry>
</row>
</thead>
<tbody>
<row>
  <entry>149.76.1.0</entry>
  <entry>255.255.255.0</entry>
  <entry>-</entry>
  <entry><filename>fddi0</filename></entry>
</row>
<row>
  <entry>149.76.2.0</entry>
  <entry>255.255.255.0</entry>
  <entry>149.76.1.2</entry>
  <entry><filename>fddi0</filename></entry>
</row>
<row>
  <entry>149.76.3.0</entry>
  <entry>255.255.255.0</entry>
  <entry>149.76.1.3</entry>
  <entry><filename>fddi0</filename></entry>
</row>
<row>
  <entry>149.76.4.0</entry>
  <entry>255.255.255.0</entry>
  <entry>-</entry>
  <entry><filename>eth0</filename></entry>
</row>
<row>
  <entry>149.76.5.0</entry>
  <entry>255.255.255.0</entry>
  <entry>149.76.1.5</entry>
  <entry><filename>fddi0</filename></entry>
</row>
<row>
  <entry>&hellip;</entry>
  <entry>&hellip;</entry>
  <entry>&hellip;</entry>
  <entry>&hellip;</entry>
</row>
<row>
  <entry>0.0.0.0</entry>
  <entry>0.0.0.0</entry>
  <entry>149.76.1.2</entry>
  <entry><filename>fddi0</filename></entry>
</row>
</tbody></tgroup>
</informaltable>

<para>
Si es necesario usar un encaminamiento a una red a la que <systemitem
role="sitename">sophus</systemitem> está conectada directamente, no se
necesita una pasarela; en ese caso la columna de la pasarela contiene un
guión.
</para>

<para>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>encaminar</secondary><tertiary>efecto de la máscara de red</tertiary></indexterm>
El proceso que se sigue para identificar si una dirección de destino
determinada corresponde con un encaminamiento es una operación matemática. Es
bastante simple, pero requiere conocimientos de aritmética binaria y lógica:
Un encaminamiento corresponde a un destino si la dirección de red operada
lógicamente por medio de AND con la máscara de red es precisamente la
dirección de destino operada lógicamente por medio de AND con la máscara de
red. </para>
<para>
Traducción: un encaminamiento corresponde si el número de bits de la dirección
de red especificada por la máscara de red (empezando por el bit más a la
izquierda, el orden más alto del byte uno de la dirección) corresponde al
mismo número de bits en la dirección de destino.
</para>

<para>
Cuando la implementación de IP busca el mejor encaminamiento hasta un destino,
puede que encuentre varias entradas que correspondan a la dirección del
objetivo. Por ejemplo, sabemos que el encaminamiento por defecto corresponde
a todos los destinos, pero los datagramas destinados a redes unidas localmente
también corresponderán a su encaminamiento local. ¿Cómo IP decide que
encaminamiento usar? Es aquí donde la máscara de red representa un papel
importante. Mientras que los dos enrutamientos corresponden al destino, uno
de ellos tiene una máscara de red mayor que la del otro. Se dijo anteriormente
que la máscara de red se usa para dividir los espacios de las direcciones en
redes más pequeñas. Cuanto mayor es una máscara de red, mejor especifica la
correspondencia a la dirección de un objetivo; cuando se envían datagramas,
siempre se debería elegir el enrutamiento que tenga la mayor máscara de red.
El encaminamiento por defecto tiene una máscara de red de cero bits, y en la
configuración mostrada anteriormente, las redes enlazadas localmente tienen
una máscara de red de 24 bits. Si un datagrama corresponde a una de estas
redes, será enrutado al dispositivo apropiado en vez de seguir el
encaminamiento por defecto porque el enrutamiento de la red local corresponde
a un mayor número de bits. Los únicos datagramas que se encaminan a través del
encaminamiento por defecto son aquellos que no corresponden a ningún otro
enrutamiento.
</para>

<para>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>encaminamiento
dinámico</secondary></indexterm>
<indexterm><primary>encaminamiento dinámico</primary></indexterm>
<indexterm><primary>encaminamiento</primary><secondary>demonio</secondary></indexterm>
<indexterm><primary>encaminamiento</primary><secondary>dinámico</secondary></indexterm>
Se puede construir tablas de encaminamiento siguiendo distintos métodos. En el
caso de LANs pequeñas, normalmente lo más eficiente es construirlas a mano y
nutrirlas de IP usando el comando <command>route</command> en el momento del
arranque (vease <xref linkend="X-087-2-iface">). Para redes mayores, se
construyen y ajustan en tiempo de ejecución por los <emphasis>demonios de
encaminamiento</emphasis>; estos demonios corren en puestos centrales de la red
e intercambian información de enrutamiento para calcular caminos
&ldquo;óptimos&rdquo; entre los miembros de la red.
</para>

<para>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>encaminamiento</secondary><tertiary>protocolos</tertiary></indexterm>
<indexterm><primary>encaminamiento</primary><secondary>protocolos</secondary></indexterm>
<indexterm><primary>Routing Information Protocol (RIP)</primary></indexterm>
<INDEXTERM><PRIMARY>RIP (Routing Information Protocol)</PRIMARY></INDEXTERM>
<indexterm><primary>orden routed</primary></indexterm>
<indexterm><primary>orden gated</primary></indexterm>
Dependiendo del tamaño de la red, se necesitará usar diferentes protocolos de
encaminamiento. Para enrutar dentro de sistemas autónomos (tales como el
campus de Groucho Marx) se usan los <emphasis>protocolos de encaminamiento
interno</emphasis>. El más importante de éstos es el <emphasis>Routing
Information Protocol</emphasis> (RIP), que es implementado por el demonio BSD
<command>routed</command>. Para enrutar entre sistemas autónomos se tienen que
usar <emphasis>protocolos de encaminamiento externo</emphasis> como
<emphasis>External Gateway Protocol</emphasis> (EGP) o <emphasis>Border
Gateway Protocol</emphasis> (BGP); estos protocolos, incluido RIP, han sido
implementados en el demonio <command>gated</command> de la Universidad de
Cornell.
</para>

</sect2>

<sect2 id="X-087-2-issues.routing.metric"><title>Métrica de encaminamiento</title>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>métricos</secondary><tertiary>valores</tertiary></indexterm>
<indexterm><primary>encaminamiento</primary><secondary>métrica</secondary></indexterm>
<indexterm><primary>valores métricos (para entradas de tablas de encaminamiento)</primary></indexterm>

<para>
<?troff .hw discarded>
Hay que contar con los encaminamientos dinámicos para elegir la mejor ruta
hasta nuestro puesto o red de destino basándonos en el número de
<emphasis>saltos</emphasis>. Los saltos son las pasarelas que un datagrama
debe atravesar antes de llegar al puesto o la red. Cuanto más corta sea una
ruta en mejor consideración la tendrá RIP. Las rutas muy largas con 16 saltos
o más son consideradas como inusable y son descartadas.
</para>

<para>
RIP controla la información interna de encaminamiento de su red local, pero
tiene que ejecutar <command>gated</command> en todos los puestos. En el
momento del arranque, <command>gated</command> comprueba todas las interfaces
de red activas. Si hay más de una interfaz activa (sin contar la interfaz
loopback), asume que el puesto está intercambiando paquetes entre varias redes
e intercambia y emite activamente información de encaminamiento. De cualquier
forma, las actualizaciones de RIP solo se recibirán pasivamente y se pondrá al
día la tabla de encaminamiento local.
</para>

<para>
Cuando se transmite información según la tabla de encaminamiento local,
<command>gated</command> calcula la longitud de la ruta atendiendo al llamado
<emphasis>valor métrico</emphasis> asociado a la entrada de la tabla de
encaminamiento. Este valor métrico lo decide el administrador del sistema
cuando configura el encaminamiento, y debe reflejar el valor actual de la
ruta.<footnote id="X-087-2-FNIS05"><para> El valor de una ruta puede
imaginarse, en casos simples, como el número de saltos requeridos para
alcanzar el destino. Aunque calcular apropiadamente los valores de las rutas
en diseños de redes complejas puede ser una gran dificultad.
</para>
</footnote> Por tanto, la métrica de la ruta a una subred a la que el puesto
está directamente conectada debe ser siempre cero, mientras que una ruta que
vaya a través de dos pasarelas debe tener una métrica de dos. De todos modos,
no deberá preocuparse por las métricas si no usa <command>RIP</command> o
<command>gated</command>.

</para>

</sect2>
</sect1>

<sect1 id="X-087-2-issues.icmp"><title>El Protocolo de Mensajes de Control de Internet</title>

<para>
<indexterm><primary>protocolos</primary><secondary>ICMP</secondary></indexterm>
<indexterm><primary>ICMP (Internet Control Message Protocol)</primary><secondary>mensaje Port Unreachable</secondary></indexterm>
IP tiene otro protocolo complementario del que no hemos hablado todavía. Este
es el <emphasis>Protocolo de Mensajes de Control de Internet</emphasis> (ICMP), usado por
el código de redes del núcleo para comunicar mensajes de error a otros
puestos. Por ejemplo, asumiremos que nos encontramos en <systemitem
role="sitename">erdos</systemitem> otra vez y queremos hacer
<command>telnet</command> al puerto 12345 en <systemitem
role="sitename">quark</systemitem>, pero no hay procesos escuchando en ese
puerto. Cuando el primer paquete TCP para este puerto llegue a <systemitem
role="sitename">quark</systemitem>, la capa de red reconocerá esta llegada e
inmediatamente enviará un mensaje ICMP a <systemitem
role="sitename">erdos</systemitem> empezando con &ldquo;Port
Unreachable.&rdquo;<footnote><para> N. del T.: Puerto
Inalcanzable.</para></footnote>
</para>

<para>
<indexterm><primary>ICMP (Internet Control Message Protocol)</primary><secondary>mensaje Redirect</secondary></indexterm>
<indexterm><primary>encaminamiento</primary><secondary>ICMP Redirect</secondary></indexterm>
<indexterm><primary>encaminamiento</primary><secondary>dinámico</secondary></indexterm>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>encaminamiento</secondary><tertiary>mensaje Redirect (ICMP)</tertiary></indexterm>
El protocolo ICMP ofrece varios mensajes diferentes, muchos de ellos tratan
con condiciones de error. De todas maneras, hay un mensaje muy interesante
denominado mensaje Redirect<footnote><para> N. del T.:
Redirección.</para></footnote>. Lo genera el módulo de encaminamiento cuando
detecta que otro puesto está usándolo como pasarela, aunque exista una ruta
más corta. Por ejemplo, después del arranque, la tabla de encaminamiento de
<systemitem role="sitename">sophus</systemitem> puede estar incompleta. Puede
que contenga las rutas a la red de Matemáticas, a la dorsal FDDI, y el
encaminamiento predeterminado apuntando a la pasarela del Groucho Computing
Center (&thinsp;gcc1). De este modo, los paquetes para <systemitem
role="sitename">quark</systemitem> serán enviados a <systemitem
role="sitename">gcc1</systemitem> en vez de a <systemitem
role="sitename">niels</systemitem>, la pasarela del departamento de Físicas.
Cuando recibe un datagrama como éste, <systemitem
role="sitename">gcc1</systemitem> notará que esa es una mala elección como
ruta y reenviará el paquete a <systemitem role="sitename">niels</systemitem>,
mientras tanto envía un mensaje Redirect ICMP a <systemitem
role="sitename">sophus</systemitem> diciéndole la ruta superior.
</para>

<para>
Esta parece ser una forma muy inteligente de evitar la configuración manual de
las rutas excepto las más básicas. De cualquier forma, hay que decir que
depender de esquemas de encaminamiento dinámicos, sean RIP o mensajes Redirect
ICMP, no es siempre una buena idea. Redirect ICMP y RIP ofrecen muy poca o
ninguna capacidad de verificar si alguna <?troff .ne 10>información de
encaminamiento es efectivamente auténtica. Esta situación permite a algunos
imbéciles perturbar el desarrollo del tráfico de la red completa, o incluso
algo peor. Consecuentemente, el código de red de GNU/Linux trata los mensaje
"Network Redirect" como si fuesen "Host Redirects". Esto minimiza los daños de un
ataque restringiéndolos a sólo un puesto, en vez de la red completa. Por otro
lado, esto significa que se generá un poco más de tráfico en las mismas
condiciones, ya que cada puesto hace que se genere un mensaje &ldquo;Redirect ICMP&rdquo;.
En la actualidad, se considera generalmente una mala costumbre depender de las
redirecciones ICMP para algo.
</para>

</sect1>

<sect1 id="X-087-2-issues.resolving"><title>Resolución de nombres de puesto</title>
<indexterm id="chis.dns.1" class=startofrange><primary>DNS (Domain Name System)</primary></indexterm>
<indexterm><primary>nombre de nodo</primary><secondary>resolución</secondary></indexterm>
<indexterm><primary>nombre de nodo</primary><secondary>asignar a direcciones</secondary></indexterm>
<indexterm><primary>IP (Internet Protocol)</primary><secondary>direcciones</secondary><tertiary>nombres de nodo y</tertiary></indexterm>

<para>
Como se describió anteriormente, las direcciones en una red TCP/IP, al menos
en IP Version 4, giran alrededor de números de 32 bits. De modo que, tendrá
que sufrir recordando más que unos pocos números de este tipo. Aunque los
puestos se reconocen generalmente por nombres &ldquo;ordinarios&rdquo; tales
como <systemitem role="sitename">gauss</systemitem> o <systemitem
role="sitename">strange</systemitem>. Esto se convierte en el cometido de una
aplicación que encuentra la dirección IP correspondiente a un nombre. A este
proceso se le denomina <emphasis>resolución de nombres de nodo</emphasis>.
</para>

<indexterm><primary>gethostbyname(&thinsp;)</primary></indexterm>
<indexterm><primary>gethostbyaddr(&thinsp;)</primary></indexterm>
<para>
Cuando una aplicación necesita encontrar la dirección IP de un nodo dado,
ésta delega en las funciones de biblioteca <function>gethostbyname(3)</function>
y <function>gethostbyaddr(3)</function>. Tradicionalmente, éstos y otros
procedimientos relacionados están agrupados en una biblioteca separada
denominada en GNU/Linux <emphasis>resolverlibrary</emphasis>, estas funciones son
parte de la  <filename>libc</filename> estándar. Coloquialmente, nos referimos
por tanto a este conjunto de funciones como &ldquo;el sistema de
resolución&rdquo;. La configuración del sistema de resolución de nombre se
detalla en <xref linkend="X-087-2-resolv">.
</para>

<para>
En una red pequeña como una Ethernet o incluso un grupo de Ethernets, no es
muy difícil mantener tablas de asignación de nombres de puesto a direcciones.
Esta información la mantiene normalmente un fichero llamado
<filename>/etc/hosts</filename>. Cuando se añaden o se eliminan puestos, o se
reasignan direcciones, lo único que se debe hacer es actualizar el fichero
<filename>hosts</filename> en todos los puestos. Obviamente, esto puede
resultar arduo en redes que cuenten con más de un puñado de equipos.
</para>

<indexterm><primary>NIS (Network Information System)</primary></indexterm>
<indexterm><primary>Yellow Pages (YP)</primary></indexterm>
<indexterm><primary>Páginas Amarillas</primary></indexterm>
<para>
Una solución a este problema es el <emphasis>Network Information
System</emphasis> (NIS), desarrollado por Sun Microsystems, coloquialmente
llamado YP o Yellow Pages. NIS almacena el fichero <filename>hosts</filename>
(y otra información) en una base de datos en un puesto principal de donde los
puestos cliente pueden obtenerla según se necesite. Sin embargo, esta
aproximación es adecuada sólo para redes de tamaño medio tales como LANs, ya
que esto implica mantener centralmente la base de datos
<filename>hosts</filename> al completo y distribuirla a los servidores. La
instalación y la configuración del NIS se discute en detalle en <xref
linkend="X-087-2-nis">.
</para>

<para>
En Internet, la información de direcciones también fue inicialmente almacenada
en una base de datos simple <filename>HOSTS.TXT</filename>. Este fichero se
mantenía en el <emphasis>Network Information Center</emphasis> (NIC), y tenía
que ser descargado e instalado por todos los sitios participantes. Cuando la
red creció, surgieron varios problemas con el esquema. Además del gasto
administrativo que suponía la instalación regular de
<filename>HOSTS.TXT</filename>, la carga de los servidores que distribuía
llegó a ser demasiedo grande. Más grave aún, todos los nombres tenían que
estar registrado en el NIC, lo que aseguraría que ningún nombre se
distribuyese dos veces.
</para>

<para>
Esta es la razón por la que se aprobó un nuevo esquema de resolución de
nombres en 1994: el <emphasis>Sistema de Nombres de Dominios</emphasis>. DNS fue diseñado
por Paul Mockapetris y aborda los dos problemas a la vez. El Sistema de Nombres de Dominios
se discute en detalle en <xref linkend="X-087-2-resolv">.
</para>

<INDEXTERM startref="chis.dns.1" class=endofrange>

</sect1>
<INDEXTERM startref="chis.tcp.ip.networks" class=endofrange>
<INDEXTERM startref="chis.networks.tcp.ip" class=endofrange>
</chapter>


