<!-- $Id: ch22.sgm,v 1.10 2002/11/17 17:43:43 pakojavi2000 Exp $ -->
<!--
Nota legal:

   Linux Network Administration Guide, por Olaf Kirch et al.

   La traducción al español se publica bajo la licencia GFDL,
siendo texto de portada el siguiente:

Linux Network Administrator's Guide
by Olaf Kirch and Terry Dawson
Copyright  (c) 1993 Olaf Kirch
Copyright  (c) 2000 Terry Dawson
Copyright on O'Reilly printed version (c) 2000 O'Reilly & Associates

y siendo secciones invariantes, la sección de Agradecimientos,
la sección titulada «La traducción al español», el apéndice C; así
como esta nota.

Capítulo traducido por:

  Jose M. Fernández, elzo@iespana.es

Revisión 1 por Francisco Javier Fernández

Glosario:
"feed": (relat newsfeed): suministrar
-->
<chapter id="X-087-2-nntp"><title>NNTP y el demonio nntpd</title>

<indexterm id="idx-configuringNNTP-1" class="startofrange"><primary>configurar</primary><secondary>NNTP</secondary></indexterm>
<indexterm><primary>servidores</primary><secondary>NNTP</secondary></indexterm>
<INDEXTERM id="protocols.NNTP" class=startofrange><PRIMARY>protocolos</PRIMARY><SECONDARY>NNTP</SECONDARY></INDEXTERM>
<indexterm id="ch18.nntp.desc" class="startofrange"><primary>NNTP (Protocolo para la Transferencia de Noticias en Red)</primary></indexterm>

<para>
El Protocolo para la Transferencia de Noticias en Red (NNTP) ofrece un
acercamiento al intercambio de noticias muy diferente al de C News y al de
otros nuevos servidores sin soporte nativo para NNTP. Antes que confiar
en una tecnología por lotes como UUCP para transferir los artículos entre
máquinas, permite intercambiar los artículos mediante una conexión de red
interactiva. NNTP no es un paquete de software en particular, sino un
estándar de Internet descrito en el RFC-977. Está basado en conexiones
continuas, normalmente sobre TCP, entre un cliente en cualquier parte de una 
red y un servidor en una máquina que almacena las noticias en disco. Una
conexión de este tipo permite que cliente y servidor negocien de manera 
interactiva la transferencia de artículos sin apenas retrasos manteniendo 
al mismo tiempo el número de artículos duplicados muy bajo. Junto con las 
altas tasas de transferencia de Internet, esto conforma una nueva manera de
transportar noticias que supera con creces a las redes UUCP originales. 
Mientras hace algunos años no era extraño que un artículo tardase dos 
semanas o más en llegar al último rincón de Usenet; ahora lo hace a menudo
en menos de dos días. En cuanto a Internet en sí, eso implica un plazo de 
apenas unos minutos.
</para>

<para>
Varias órdenes permiten a los clientes descargar, enviar y publicar artículos.
La diferencia entre enviar y publicar es que lo último puede afectar a 
artículos con información incompleta en las cabeceras; esto significa
generalmente que el usuario acaba de escribir el artículo.
<footnote id="X-087-2-FNNN01"><para> Cuando se publica un artículo por NNTP,
el servidor siempre añade al menos un campo a la cabecera,
<literal>NNTP-Posting-Host:</literal>. El campo contiene el nombre de la
máquina del cliente.
</para>
</footnote>
La descarga de artículos pueden llevarla a cabo tanto los clientes de
transferencia de noticias como los lectores de noticias. Esto hace de NNTP 
una excelente herramienta para dotar de acceso a las noticias a muchos 
clientes de una red local sin tener que pasar por las complicaciones de usar 
NFS.
</para>

<para>
<indexterm><primary>noticias (red)</primary><secondary>empujar</secondary></indexterm>
<indexterm><primary>noticias (red)</primary><secondary>traer</secondary></indexterm>
<indexterm><primary>enviar noticias</primary></indexterm> 
<indexterm><primary>seleccionar noticias</primary></indexterm> 
<INDEXTERM><PRIMARY>ihave (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>ihave, orden</SECONDARY></INDEXTERM>
NNTP también proporciona un método activo y otro pasivo de transferir noticias,
conocidos coloquialmente como &ldquo;empujar&rdquo;(pushing) y &ldquo;tirar&rdquo;(pulling). Pushing es 
básicamente lo mismo que el protocolo ihave/sendme que usa C News (descrito en <xref linkend="X-087-2-cnews">). 
El cliente ofrece un artículo al servidor mediante la orden <command>IHAVE msgid</command>, y el servidor devuelve un código 
de respuesta que indica si quiere el artículo o si ya lo tiene. Si el servidor quiere el artículo, el cliente se lo envía 
haciéndolo acabar con un punto en una línea aparte.
</para>

<para>
Empujar noticias tiene la única desventaja que supone una gran carga para
el sistema servidor, al tener éste que buscar en la base de datos de
su historial cada artículo de manera individual.
</para>

<para>
<INDEXTERM><PRIMARY>newnews (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>newnews, orden</SECONDARY></INDEXTERM>
La técnica opuesta es seleccionar noticias, en la que el cliente solicita una 
lista con todos los artículos (disponibles) de un grupo que hayan llegado tras
una fecha especificada. Esta petición la realiza la orden
<command>NEWNEWS</command>. De los IDs de los mensajes de la lista devuelta,
el cliente elige aquellos artículos que aún no tenga usando la orden
<command>ARTICLE</command> para cada uno de ellos.
</para>

<para>
Seleccionar noticias necesita de un estricto control por parte del servidor
en lo que se refiere a qué grupos y distribuciones se permite solicitar a 
un cliente. Por ejemplo, tiene que asegurarse de no enviar material 
confidencial de un grupo de noticias local a clientes no autorizados.
</para>

<para>
Hay algunas órdenes convenientes para los lectores de noticias que les
permiten descargar las cabeceras y los cuerpos de los artículos de manera
separada, o incluso líneas sueltas de las cabeceras de un determinado 
rango de artículos. Esto le permite mantener todas las noticias en una
máquina central, con todos los usuarios de la red (presumiblemente local)
usando clientes basados en NNTP para leer y publicar. Esto es una alternativa
a exportar los directorios de noticias mediante NFS, tal y como se describe 
en <xref linkend="X-087-2-cnews">.
</para>

<para>
<indexterm><primary>noticias (red)</primary><secondary>falsear</secondary></indexterm>
<indexterm><primary>falsear noticias</primary></indexterm>
Un problema global de NNTP es que permite a una persona conocida
insertar artículos en el flujo de noticias con las especificaciones del
remitente falseadas. A esto se lo conoce como <emphasis>falsear noticias</emphasis> o 
<emphasis>spoofing</emphasis>.<footnote id="X-087-2-FNNN02"><para>
Existe el mismo problema con el Protocolo para la Transferencia Sencilla de 
Correo (SMTP), aunque muchos agentes transportadores de correo ya ofrecen 
mecanismos para prevenir el "spoofing".
</para>
</footnote>
Una extensión de NNTP le permite requerir una autentificación al usuario para 
ciertas órdenes, ofreciendo algunas medidas de protección contra la gente que 
pueda abusar de esta manera de su servidor de noticias. 
</para>

<para>
<indexterm><primary>nntpd</primary><secondary>componentes</secondary></indexterm>
<indexterm><primary>Lapsley, Phil</primary></indexterm>
<indexterm><primary>Barber, Stan</primary></indexterm>
Existen diferentes paquetes NNTP. Uno de los más conocidos es el demonio NNTP,
también conocido como la <emphasis>implementación de referencia</emphasis>.
Lo escribieron originalmente Stan Barber y Phil Lapsley para ilustrar los 
detalles del RFC-977. Como la mayoría del software de calidad disponible hoy 
en día, puede encontrarlo empaquetado para su distribución de Linux, o puede
obtener las fuentes para compilarlo usted mismo. Si elige compilarlo usted
mismo, necesitará estar familiarizado con su distribución para poder
asegurarse de que configura todas las rutas de ficheros de manera correcta.
</para>

<para>
El paquete <command>nntpd</command> tiene un servidor, dos clientes para
empujar y seleccionar noticias, y un sustituto de <command>inews</command>. 
Habitan un entorno B News, pero con unos pocos retoques también se contentarán
con C News. De todos modos, si piensa usar NNTP para algo más que ofrecer 
acceso de los clientes de noticias al servidor, la implementación de
referencia realmente no es una opción. Sólo discutiremos aquí el demonio
NNTP que contiene el paquete <command>nntpd</command> prescindiendo de 
los clientes.
</para>

<para>
<indexterm><primary>Salz, Rich</primary></indexterm>
<indexterm><primary>INN (Internet News)</primary><secondary>NNTP e</secondary></indexterm>
Si piensa poner en marcha un sitio de noticias de gran tamaño, debería echar
un vistazo al paquete <emphasis>InterNet News</emphasis> o INN, que escribió
Rich Salz. Proporciona transporte de noticias basado tanto en NNTP como en UUCP. El 
transporte de noticias es definitivamente mejor que <command>nntpd</command>. Discutiremos 
INN en detalle en <xref linkend="X-087-2-inn">.
</para>

<sect1 id="X-087-2-nntp.protocol"><title>El Protocolo NNTP</title>
<para>
Hemos mencionado dos órdenes NNTP que son clave en cuanto a cómo los artículos
de noticias se impulsan o seleccionan entre servidores. Ahora, le echaremos un 
vistazo a todo esto en una sesión NNTP real para mostrarle cuán sencillo es el 
protocolo. Para ilustrar nuestros propósitos, usaremos un sencillo cliente
<command>telnet</command> para conectar con un servidor de noticias basado
en INN de la Cervecera Virtual llamado <emphasis role="bold">news.vbrew.com</emphasis>. 
El servidor está corriendo una configuración mínima para que los
ejemplos sean cortos. Ya veremos cómo completar la configuración de este
servidor en <xref linkend="X-087-2-inn">.
En nuestras pruebas pondremos especial cuidado en generar artículos sólo en
el grupo de noticias <emphasis>es.pruebas</emphasis> para evitar molestar a 
nadie.</para>

<sect2><title>Conectar con el servidor de noticias</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>conectar con un servidor de noticias</SECONDARY></INDEXTERM>
Conectar con el servidor de noticias es tan sencillo como abrir una conexión
TCP con su puerto NNTP. Cuando esté conectado, aparecerá un anuncio de
bienvenida. Una de las primeras órdenes que puede probar es 
<systemitem role="keyword">help</systemitem>. La respuesta que reciba dependerá
generalmente de si el servidor cree que somos un servidor NNTP o un cliente
de noticias, al requerirse grupos de órdenes diferentes. Puede cambiar el
modo de operación con la orden <command>mode</command>; veremos eso en un 
momento:
</para>

<screen>
$ <userinput>telnet news.vbrew.com nntp</userinput>
Trying 172.16.1.1...
Connected to localhost.
Escape character is '^]'.
200 news.vbrew.com InterNetNews server INN 1.7.2 08-Dec-1997 ready
<userinput>help</userinput>
100 Legal commands
        authinfo
		help
		ihave
		check
		takethis
		list
		mode
		xmode
		quit
		head
		stat
		xbatch
		xpath
		xreplic
For more information, contact "usenet" at this machine.
.
</screen>

<para>
Las respuestas a las órdenes NNTP siempre acaban con un punto (.) en
una línea separada. Los números que ve en el listado de salida son
<emphasis>códigos de respuesta</emphasis> que usa el servidor para indicar
éxito o fallo de la orden. Los códigos de respuesta se describen en el RFC-977;
hablaremos de los más importantes conforme vayamos avanzando.
</para>
</sect2>

<sect2><title>Empujar un artículo de noticias a un servidor</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>ihave, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>ihave (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>noticias (red)</PRIMARY><SECONDARY>artículos</SECONDARY><TERTIARY>empuljar noticias</TERTIARY></INDEXTERM>
<INDEXTERM><PRIMARY>empujar noticias</PRIMARY></INDEXTERM>
Mencionamos la orden <command>IHAVE</command> cuando hablamos de hacer "pushing"
de noticias a servidores. Fijémonos ahora en cómo funciona realmente
la orden <command>IHAVE</command>:
</para>

<screen>
<userinput>ihave &lt;123456@gw.vk2ktj.ampr.org&gt;</userinput>
335
<userinput>From: terry@gw.vk2ktj.ampr.org
Subject: mensaje de prueba enviado con ihave
Newsgroups: es.pruebas
Distribution: mundo
Path: gw.vk2ktj.ampr.org
Date: 26 Abril 1999
Message-ID: &lt;123456@gw.vk2ktj.ampr.org&gt;
Body: 

Esto es un mensaje de prueba enviado usando la orden NNTP IHAVE.

.</userinput>
235
</screen>

<para>
Ninguna orden NNTP es sensible al uso de mayúsculas o minúsculas, por lo
que resulta indiferente cómo se introduzcan las órdenes. La orden
<command>IHAVE</command> toma una variable obligada, siendo el ID del mensaje
lo que se impulsa.
Se asigna un ID de mensaje único a cada artículo cuando se crea. La orden
<command>IHAVE</command> proporciona al servidor NNTP una manera de decir
qué articulos tiene cuando quiere impulsar artículos a otro servidor.
El servidor que envíe usará una orden <command>IHAVE</command> para cada
artículo que desee impulsar. Si el código de respuesta de la orden que genere
el servidor NNTP receptor se encuentra en el rango &ldquo;3xx&rdquo;,
el servidor NNTP remitente transmitirá el artículo completo,
incluyendo toda su cabecera y haciéndolo terminar con un punto en una línea
aparte. Si el código de respuesta se encuentra en el rango &ldquo;4xx&rdquo;,
el servidor receptor ha elegido no aceptar el artículo, posiblemente porque
ya lo tiene o a causa de algún problema, como que se esté quedando sin 
suficiente espacio en disco.
</para>

<para>
Cuando se ha transmitido el artículo, el servidor receptor emite otro
código de respuesta indicando si la transferencia del artículo ha concluido
con éxito.
</para>
</sect2>

<sect2><title>Cambiar el modo de lectura NNRP</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>cambiar el modo de lectura NNRP</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>lectores de noticias</PRIMARY><SECONDARY>cambiar el modo de lectura NNRP</SECONDARY></INDEXTERM>
Los lectores de noticias usan sus propios grupos de órdenes cuando se comunican
con los servidores de noticias. Para activar estas órdenes, el servidor de
noticias tiene que estar operando en modo <emphasis>de lectura</emphasis>.
La mayoría de servidores de noticias funcionan en modo de lectura de manera
predeterminada, a menos que la dirección IP de la máquina con la que conecten
se encuentre lista como un punto de reenvío de noticias. En cualquier caso,
NNTP incluye una orden para cambiar explícitamente al modo de lectura:
</para>

<screen>
<userinput>mode reader</userinput>
200 news.vbrew.com InterNetNews NNRP server INN 1.7.2 08-Dec-1997 ready/
    (posting ok).
<userinput>help</userinput>
100 Legal commands
  authinfo user Name|pass Password|generic &lt;prog&gt; &lt;args&gt;
  article [MessageID|Number]
  body [MessageID|Number]
  date
  group newsgroup
  head [MessageID|Number]
  help
  ihave
  last
  list [active|active.times|newsgroups|distributions|distrib.pats|/
      overview.fmt|subscriptions]
  listgroup newsgroup
  mode reader
  newgroups yymmdd hhmmss ["GMT"] [&lt;distributions&gt;]
  newnews newsgroups yymmddhhmmss ["GMT"] [&lt;distributions&gt;]
  next
  post
  slave
  stat [MessageID|Number]
  xgtitle [group_pattern]
  xhdr header [range|MessageID]
  xover [range]
  xpat header range|MessageID pat [morepat...]
  xpath MessageID
Report problems to &lt;usenet@vlager.vbrew.com&gt;
.
</screen>

<para>
En el modo de lectura de NNTP se dispone de muchas órdenes. La mayoría de
ellas están diseñadas para facilitar la vida de un lector de noticias.
Mencionamos antes que hay órdenes para pedir al servidor que envíe la
cabecera y el cuerpo de los artículos de manera separada. También hay
órdenes que listan los grupos y artículos disponibles, y otras que permiten
publicar, un medio alternativo de enviar noticias a un servidor.
</para>
</sect2>

<sect2><title>Listar los grupos disponibles</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>listar grupos</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>list, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>la orden list (NNTP)</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>grupos de noticias</PRIMARY><SECONDARY>listar</SECONDARY></INDEXTERM>
La orden <command>list</command> lista diferentes tipos de información;
de manera notable los grupos que soporta el servidor:
</para>

<screen>
<userinput>list newgroups</userinput>
215 Descriptions in form "group description".
control                 News server internal group
junk                    News server internal group
local.general           General local stuff
local.test              Local test group
.
</screen>
</sect2>

<sect2><title>Listar grupos activos</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>list active, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>list active (NNTP), orden</PRIMARY></INDEXTERM>
<option>list active</option> muestra cada grupos soportado y ofrece información
sobre ellos. Los dos números de cada línea de la salida son las marcas de agua 
alta y baja&mdash;es decir, el artículo numerado más alto y el artículo
numerado más bajo en cada grupo. El lector de noticias es capaz de hacerse 
una idea del número de artículos del grupo a partir de éstos. Hablaremos un
poco más sobre estos números en un momento. El último campo de la salida
muestra variables que controlan si se permite publicar en el grupo, si el
grupo está moderado y si los artículos publicados tienen o no que guardarse.
Estas variables se describen con detalle en <xref linkend="X-087-2-inn">. 
Éste es el aspecto de un ejemplo:
</para>

<screen>
<userinput>list active</userinput>
215 Newsgroups in form "group high low flags".
control 0000000000 0000000001 y
junk 0000000003 0000000001 y
alt.test 0000000000 0000000001 y
.
</screen>
</sect2>

<sect2><title>Publicar un artículo</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>post, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>post (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>noticias (red)</PRIMARY><SECONDARY>artículos</SECONDARY><TERTIARY>publicar</TERTIARY></INDEXTERM>
<INDEXTERM><PRIMARY>artículos (noticias)</PRIMARY><SECONDARY>publicar</SECONDARY></INDEXTERM>
Hemos mencionado que había una diferencia entre impulsar un artículo y
publicar uno. Cuando se impulsa un artículo, se asume implícitamente que
el artículo ya existe, que tiene un identificador del mensaje que el servidor
ha asignado al que se publicó originalmente, y que tiene un juego completo de
cabeceras. Cuando se publica un artículo, se crea el artículo por primera 
vez y las únicas cabeceras que se aportan son las que puedan tener algún
sentido para nosotros, como el título o el grupo de noticias al que se 
desea enviar el artículo. El servidor de noticias en el que publiquemos
el artículo se encargará de añadir el resto de cabeceras y de crear un ID
para el mensaje que usará cuando impulse el artículo a otros servidores.
</para>

<para>
Todo esto significa que publicar un artículo es incluso más sencillo que
impulsar uno. Un ejemplo de publicar sería algo como esto:
</para>

<screen>
<userinput>post</userinput>
340 Ok
<userinput>From: terry@richard.geek.org.au
Subject: mensaje de prueba número 1
Newsgroups: es.pruebas
Body: 

Esto es un mensaje de prueba, ignórelo libremente.

.</userinput>
240 Article posted
</screen>

<para>
Hemos generado dos mensajes más como éste para dotar de algo de realismo
a nuestro siguientes ejemplos.
</para>
</sect2>

<sect2><title>Listar nuevos artículos</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>newnews, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>newnews (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>noticias (red)</PRIMARY><SECONDARY>artículos</SECONDARY><TERTIARY>listar</TERTIARY></INDEXTERM>
<INDEXTERM><PRIMARY>artículos (noticias)</PRIMARY><SECONDARY>listar</SECONDARY></INDEXTERM>
Cuando un lector de noticias se conecta por primera vez con un servidor de
noticias y el usuario elige leer un grupo de noticias, el lector querrá
descargar una lista con los nuevos artículos publicados o recibidos desde
la última vez que el usuario entró al sistema. La orden
<option>newnews</option> se usa con este propósito.
Hay variables obligatorias que tienen que proporcionarse: el nombre del
grupo o grupos a consultar, la fecha de comienzo y la hora a partir de la
cual listar los mensajes. La fecha y la hora se especifican con números
de seis dígitos cada una, con la información más significativa primero;
<replaceable>aammdd</replaceable> y
<replaceable>hhmmss</replaceable>, respectivamente:
</para>

<screen>
<userinput>newnews junk 990101 000000</userinput>
230 New news follows
&lt;7g2o5r$aa$6@news.vbrew.com&gt;
&lt;7g5bhm$8f$2@news.vbrew.com&gt;
&lt;7g5bk5$8f$3@news.vbrew.com&gt;
.
</screen>
</sect2>

<sect2><title>Elegir un grupo con el que trabajar</title>
<para>
<INDEXTERM><PRIMARY>grupos de noticias</PRIMARY><SECONDARY>elegir</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>group, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>group (NNTP), orden</PRIMARY></INDEXTERM>
Cuando el usuario elige un grupo de noticias a leer, el lector de noticias
puede decirle al servidor que se ha elegido ese grupo. Esto simplifica
la interacción entre el lector y el servidor de noticias eliminando la 
necesidad de enviar constantemente el nombre del grupo con cada orden. La
orden <option>group</option> simplemente toma el nombre del grupo elegido
como una variable. Muchas de las órdenes siguientes usan el grupo elegido
como el predeterminado, a menos que se especifique otro grupo de noticias
explícitamente:
</para>

<screen>
<userinput>group es.pruebas</userinput>
211 3 1 3 es.pruebas
</screen>

<para>
La orden <option>group</option> devuelve un mensaje en el que se indica
el número de mensajes activos, la marca de agua baja, la marca de agua
alta y el nombre del grupo respectivamente. Tenga en cuenta que mientras
que el número de mensajes activos y la marca de agua alta coinciden en
nuestro ejemplo, a menudo no es éste el caso; en un servidor de noticias
activo, algunos artículos pueden haber expirado o haberse borrado, 
haciendo descender el número de mensajes activos pero dejando intacta la
marca de agua alta.
</para>
</sect2>

<sect2><title>Listar artículos en un grupo</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>listgroup, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>listgroup (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>en grupos de noticias</PRIMARY><SECONDARY>listar artículos</SECONDARY></INDEXTERM>
Para dirigirse a los artículos de noticias, el lector tiene que saber qué
números de artículos representan a los artículos activos. La orden
<option>listgroup</option> ofrece una lista con los números de los artículos
activos en el grupo actual o en un grupo explícito si se proporciona el nombre
del grupo:
</para>

<screen>
<userinput>listgroup es.pruebas</userinput>
211 Article list follows
1
2
3
.
</screen>
</sect2>

<sect2><title>Descargar sólo la cabecera de un artículo</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>head, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>head (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>artículos (noticias)</PRIMARY><SECONDARY>descargar el cuerpo de cabeceras/mensaje</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>noticias (red)</PRIMARY><SECONDARY>artículos</SECONDARY><TERTIARY>descargar el de cuerpo cabeceras/mensaje</TERTIARY></INDEXTERM>
El usuario tiene que disponer de información acerca de un artículo antes
de saber si desea leerlo. Hemos mencionado antes que algunas órdenes nos
permiten descargar la cabecera y el cuerpo de los artículos de manera 
separada. La orden <option>head</option> se usa para solicitar al servidor
que sólo transfiera la cabecera del artículo especificado al lector de 
noticias. Si el usuario no quiere leer el artículo, no hemos desperdiciado
tiempo y ancho de banda transfiriendo innecesariamente el cuerpo de un artículo
potencialmente grande.
</para>

<para>
Puede hacerse referencia a los artículos tanto por su número (el de la orden 
<option>listgroup</option>) como por el identificador del mensaje:
</para>

<screen>
<userinput>head 2</userinput>
221 2 &lt;7g5bhm$8f$2@news.vbrew.com&gt; head
Path: news.vbrew.com!not-for-mail
From: terry@richard.geek.org.au
Newsgroups: es.pruebas
Subject: mensaje de prueba número 2
Date: 27 Apr 1999 21:51:50 GMT
Organization: La Cervecera Virtual
Lines: 2
Message-ID: &lt;7g5bhm$8f$2@news.vbrew.com&gt;
NNTP-Posting-Host: localhost
X-Server-Date: 27 Apr 1999 21:51:50 GMT
Body: 
Xref: news.vbrew.com es.pruebas:2
.
</screen>
</sect2>

<sect2><title>Descargar sólo el cuerpo de un artículo</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>body, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>body (NNTP), orden</PRIMARY></INDEXTERM>
Si, por otra parte, el usuario decide que quiere leer el artículo, su lector
de noticias necesita una manera de solicitar que se le transfiera el cuerpo
del mensaje. La orden <option>body</option> se usa con este propósito. Funciona
de una manera muy similar a la orden <option>head</option>, exceptuando
que sólo se devuelve el cuerpo del mensaje.
</para>

<screen>
<userinput>body 2</userinput>
222 2 &lt;7g5bhm$8f$2@news.vbrew.com&gt; body
Esto es otro mensaje de prueba, ignórelo también libremente.

.
</screen>
</sect2>

<sect2><title>Leer un artículo de un grupo</title>
<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>article, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>article (NNTP), orden</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>leafnode (programa caché NNTP)</PRIMARY></INDEXTERM>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>leafnode</SECONDARY></INDEXTERM>
Aunque normalmente es más eficiente transferir las cabeceras y los cuerpos
de manera separada, hay ocasiones en las que puede resultarnos mejor
descargar el artículo completo. Un buen ejemplo de esto es en aplicaciones
a través de las que queramos transferir todos los artículos de un grupo 
sin ningún tipo de preselección, como cuando usamos un programa con caché
NNTP tipo <command>leafnode</command>.<footnote id="X-087-2-FNNN03">
<para>
<emphasis>leafnode</emphasis> se encuentra disponible por FTP anónimo en
<emphasis role="bold">wpxx02.toxi.uni-wuerzburg.de</emphasis>
en el directorio <filename>/pub/</filename>.
</para>
</footnote>

</para>

<para>
Naturalmente, NNTP nos ofrece una forma de hacer esto, y de manera ya
poco sorprendente, funciona de manera casi idéntica a como lo hace la
orden <option>head</option>.  La orden <option>article</option> también
acepta un número de artículo o un ID de mensaje como variable, pero devuelve
el artículo completo incluyendo su cabecera:
</para>

<screen>
<userinput>article 1</userinput>
220 1 &lt;7g2o5r$aa$6@news.vbrew.com&gt; article
Path: news.vbrew.com!not-for-mail
From: terry@richard.geek.org.au
Newsgroups: es.pruebas
Subject: mensaje de prueba número 1
Date: 26 Apr 1999 22:08:59 GMT
Organization: La Cerveceraa Virtual
Lines: 2
Message-ID: &lt;7g2o5r$aa$6@news.vbrew.com&gt;
NNTP-Posting-Host: localhost
X-Server-Date: 26 Apr 1999 22:08:59 GMT
Body: 
Xref: news.vbrew.com es.pruebas:1

Esto es un mensaje de prueba, ignórelo libremente.

.
</screen>

<para>
Si intenta descargar un artículo desconocido el servidor le devolverá
un mensaje con un código de respuestas apropiado y quizá un mensaje de
texto legible:
</para>

<screen>
<userinput>article 4</userinput>
423 Bad article number
</screen>

<para>
En esta sección hemos descrito cómo se usan las órdenes NNTP más importantes.
Si está interesado en desarrollar software que implemente el protocolo NNTP,
debería acudir a los documentos RFC relevantes; ellos le proporcionarán
información al detalle que aquí no podemos incluir.
</para>

<para>
Veamos ahora a NNTP en acción mediante el servidor <emphasis role="bold">nntpd</emphasis>.
</para>

</sect2>

</sect1>

<sect1 id="X-087-2-nntp.nntpd"><title>Instalar el servidor NNTP</title>

<para>
<indexterm><primary>nntpd</primary><secondary>instalar el servidor</secondary></indexterm>
El servidor NNTP (<emphasis role="bold">nntpd</emphasis>) puede compilarse
de dos manera dependiendo de la carga que se espere en el sistema de noticias.
No hay versiones compiladas disponibles a causa de los ajustes predeterminados
específicos de cada sitio que se integran en el ejecutable. Toda la
configuración se lleva a cabo mediante el uso de macros definidas en
<filename>common/conf.h</filename>.
</para>

<para>
<emphasis role="bold">nntpd</emphasis> puede configurarse tanto como un
servidor independiente que se inicie durante el arranque del sistema desde
un fichero <command>rc</command> o como un demonio que gestione
<command>inetd</command>. En el último caso, tendrá la siguiente entrada
en el <filename>/etc/inetd.conf</filename>:

<screen>
nntp    stream  tcp nowait      news    /usr/etc/in.nntpd    nntpd
</screen>
</para>

<para>
La sintaxis de <filename>inetd.conf</filename> se describe con detalle en 
<xref linkend="X-087-2-appl">. Si configura <command>nntpd</command> como
independiente, asegúrese de que una línea de ese tipo en <command>inetd.conf</command> se encuentre descomentada. En cualquier caso, asegúrese de que aparece
la línea siguiente en <filename>/etc/services</filename>:

<screen>
nntp    119/tcp   readnews untp    # Network News Transfer Protocol
</screen>
</para>

<para>
Para guardar temporalmente cualquier artículo entrante, <command>nntpd</command>también necesita un directorio <filename>.tmp</filename> en su cola de noticias.
Debería crearlo usando las siguientes órdenes:

<screen>
# <userinput>mkdir /var/spool/news/.tmp</userinput>
# <userinput>chown news.news /var/spool/news/.tmp</userinput>
</screen>
</para>

</sect1>

<sect1 id="X-087-2-nntp.access"><title>Restringir el acceso con NNTP</title>

<para>
<indexterm><primary>NNTP (Protocolo para la Transferencia de Ficheros en Red)</primary><secondary>restringir el acceso en</secondary></indexterm>
<indexterm><primary>fichero nntp_access</primary></indexterm>
<indexterm><primary>acceso</primary><secondary>NNTP</secondary></indexterm>
El acceso a los recursos NNTP lo rige el fichero
<filename>nntp_access</filename> en <filename>/etc/news</filename>. En las
líneas de este ficheros se describen los derechos de acceso que se garantizan
a las máquinas del exterior. Cada línea tiene el siguiente formato:

<screen width=110>
<replaceable>site</replaceable>   read|xfer|both|no    post|no      [!<replaceable>exceptgroups</replaceable>]
</screen>
</para>

<para>
Si un cliente conecta con el puerto NNTP, <emphasis role="bold">nntpd</emphasis>
intentará obtener el nombre de dominio completamente cualificado de la máquina
a partir de su dirección IP por medio de una búsqueda inversa. El nombre de
la máquina del cliente y su dirección IP se cotejan con el campo
<replaceable>site</replaceable> de cada entrada en el orden en el que aparecen
en el fichero. Las coincidencias pueden ser parciales o exactas. Si una entrada
coincide de manera exacta se acepta; si sólo coincide parcialmente, sólo se
acepta si no hay otra coincidencia siguiéndola que sea al menos tan buena
como ella.
<replaceable>site</replaceable> puede especificarse de una de las siguientes
maneras:

<variablelist>
<varlistentry><term>Hostname</term>
<listitem><para>
Esto es el nombre de dominio completamente cualificado de una máquina. Si 
coincide literalmente con el nombre canónico de la máquina del cliente, la
entrada se acepta ignorándose todas las entradas posteriores.
</para></listitem>
</varlistentry>

<varlistentry><term>IP address</term>
<listitem><para>
Esto es una dirección IP en notación de cuatro cifras con sus puntos
correspondientes. Si la dirección IP del cliente concuerda con ésta, se
acepta la entrada ignorándose todas las entradas posteriores.
</para></listitem>
</varlistentry>

<varlistentry><term>Domain name</term>
<listitem><para>
Esto es el nombre de dominio especificado como
<systemitem role="sitename">*.</systemitem><replaceable>domain</replaceable>.
Si el nombre de la máquina del cliente concuerda con el nombre de dominio, 
se acepta la entrada.
</para></listitem>
</varlistentry>

<varlistentry><term>Network name</term>
<listitem><para>
Esto es el nombre de una red tal y como se especifica en
<filename>/etc/networks</filename>. Si el número de red de la dirección
IP del cliente coincide con con el número de red asociado al nombre de la
red, se entiende que la entrada coincide.
</para></listitem>
</varlistentry>

<varlistentry><term>Default</term>
<listitem><para>
La cadena <literal>default</literal> concuerda con cualquier cliente.
</para></listitem>
</varlistentry>
</variablelist>
</para>

<para>
Las entradas con una especificación del sitio más general deberían 
especificarse al principio, ya que se encuentran supeditadas a cualquier
concordancia posterior más exacta.
</para>

<para>
Los campos segundo y tercero describen los derechos de acceso que se 
garantizan al cliente. El segundo campo detalla los permisos para descargar
noticias impulsadas 
(<systemitem role="keyword">read</systemitem>), y transmitirlas impulsando
(<systemitem role="keyword">xfer</systemitem>). Un valor de
<systemitem role="keyword">both</systemitem> activa ambas;
<systemitem role="keyword">no</systemitem> deniega el acceso
en conjunto. El tercer campo garantiza al cliente el derecho a publicar 
artículos, p.ej., enviar artículos con la información de la cabecera
incompleta y que el software de noticias se encarga de completarla. Si el
segundo campo contiene <systemitem role="keyword">no</systemitem>, entonces
se ignora el tercer campo.
</para>

<para>
El cuarto campo es opcional y contiene una lista de grupos separados por
comas el acceso a los cuales se deniega al cliente.
</para>

<para>
Esto es un fichero <filename>nntp_access</filename> de ejemplo:

<screen>
#
# de manera predeterminada, cualquiera puede transferir noticias, pero no leer
# ni publicar
default                 xfer            no
#
# public.vbrew.com ofrece el acceso público mediante módem. Les permitimos
# leer y publicar en cualquier grupo excepto en los local.*
public.vbrew.com        read            post    !local
#
# el resto de las máquinas de la cervecera pueden leer y publicar
*.vbrew.com             read            post
</screen>
</para>

</sect1>

<sect1 id="X-087-2-nntp.authorize"><title>Autorización NNTP</title>

<para>
<indexterm><primary>NNTP (Protocolo para la Transferencia de Noticias en Red)</primary><secondary>autorización</secondary></indexterm>
<indexterm><primary>NNTP (Protocolo para la Transferencia de Noticias en Red)</primary><secondary>restringir el acceso en</secondary></indexterm>
<indexterm><primary>acceso</primary><secondary>NNTP</secondary></indexterm>
<indexterm><primary>autorización</primary><secondary>con NNTP</secondary></indexterm>
El demonio <command>nntpd</command> proporciona un sencillo esquema de autorización. 
Si pone en mayúsculas cualquier elemento de acceso en el fichero
<filename>nntp_access</filename>, <command>nntpd</command> requerirá una
autorización por parte del cliente para la operación respectiva. Por ejemplo,
si se especifica un permiso de <systemitem role="keyword">Xfer</systemitem> o
<systemitem role="keyword">XFER</systemitem>, (como opuesto a
<systemitem role="keyword">xfer</systemitem>), <command>nntpd</command> no
permitirá al cliente transferir artículos a su sitio a menos que pase la 
autorización.
</para>

<para>
El proceso de autorización se implementa mediante una nueva orden NNTP
conocida como <command>AUTHINFO</command>. Con esta orden el cliente
transmite un nombre de usuario y una contraseña al servidor NNTP.
<command>nntpd</command> las valida cotejándolas con la base de datos de
<filename>/etc/passwd</filename> y verifica que el usuario pertenezca al grupo 
<systemitem role="userid">nntp</systemitem>.
</para>

<para>
La implementación actual de la autorización en NNTP sólo es experimental,
por lo que aún no resulta muy portable. Como resultado de esto, sólo funciona
con bases de datos en las que las contraseñas se encuentren en texto plano; 
las contraseñas ensombrecidas (shadow passwords) aún no se reconocen. Si está 
compilando desde las fuentes y tiene instalado el paquete PAM, podrá cambiar 
de una manera bastante sencilla la comprobación de la contraseña.
</para>

</sect1>

<sect1 id="X-087-2-nntp.interact"><title>Interacción de nntpd con C News</title>

<para>
<indexterm><primary>C News</primary><secondary>soporte para NNTP</secondary></indexterm>
<indexterm><primary>NNTP (Protocolo para la Transferencia de Noticias en Red)</primary><secondary>C News</secondary></indexterm>
Cuando <command>nntpd</command> recibe un artículo, tiene que enviárselo 
a un nuevo subsistema. Dependiendo de si se recibió como resultado de una
orden <command>IHAVE</command> o <command role="keyword">POST</command>, el
artículo pasa a manejarlo <command>rnews</command> o <command>inews</command>
respectivamente. En vez de invocar a <command>rnews</command>, también puede
configurarlo (durante la compilación) para que procese por lotes los artículos
entrantes y mueva los lotes resultantes a
<filename>/var/spool/news/in.coming</filename>, donde se les deja para que
<command>relaynews</command> los recoja la próxima vez que se ejecute la cola.
</para>

<para>
<INDEXTERM><PRIMARY>NNTP (Protocolo para la Transferencia de Noticias en Red)</PRIMARY><SECONDARY>ihave, orden</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>orden ihave (NNTP)</PRIMARY></INDEXTERM>
<command>nntpd</command> tiene que poder acceder al fichero
<filename>history</filename> para poder ejercer de manera adecuada el protocolo
ihave/sendme. Tiene que asegurarse, durante la compilación, de que la ruta
a ese fichero es la correcta. Si usa C News, asegúrese de que C News y
<command>nntpd</command> están de acuerdo en el formato a usar en el fichero
history. C News usa funciones de marcado <filename>dbm</filename> para acceder
a él; de todas maneras, existen implementaciones diferentes y ligeramente
incompatibles de la biblioteca <filename>dbm</filename>. Si C News se ha enlazado
con una biblioteca <filename>dbm</filename> diferente a la que tenga en su 
<filename>libc</filename> estándar, tendrá que enlazar 
<command>nntpd</command> con esa misma biblioteca.
</para>

<para>
<indexterm><primary>comprobar</primary><secondary>NNTP</secondary></indexterm>
El desacuerdo entre<command>nntpd</command> y C news produce a menudo
mensajes de error en el fichero de registro del sistema que <command>nntpd</command> 
no puede abrir adecuadamente, o quizá vea artículos duplicados recibiéndose
por NNTP. Una buena prueba para corregir errores en la transferencia de noticias
es tomar un artículo de la cola, conectar por telnet al puerto 
<emphasis role="bold">nntp</emphasis> y ofrecérselo a <command>nntpd</command> 
como se muestra en el ejemplo siguiente. Evidentemente, tendrá que sustituir 
<replaceable>msg@id</replaceable>con el ID de mensaje de un artículo con el que quiera suministrar a <command>nntpd</command>:
</para>

<screen>
$ <userinput>telnet localhost nntp</userinput>
Trying 127.0.0.1...
Connected to localhost
Escape characters is '^ ]'.
201 vstout NNTP[auth] server version 1.5.11t (16 November 1991) ready at
Sun Feb 6 16:02:32 1194 (no posting)
<userinput>IHAVE</userinput> <replaceable>msg@id</replaceable>
435 Got it.
<userinput>QUIT</userinput>
</screen>

<para>
Esta conversación muestra la reacción adecuada de <command>nntpd</command>;
el mensaje <literal>Got it</literal> le dice que ya tiene el artículo. Si
en vez de eso obtiene el mensaje <command>335 Ok</command>, la búsqueda 
en el fichero history falló por alguna razón. Termine la conversación con
Ctrl-D. Puede mirar qué ha ido mal comprobando el fichero de registro del
sistema; <command>nntpd</command> anota todo tipo de mensajes gracias a 
la propiedad <systemitem role="keyword">daemon</systemitem> de 
<command>syslog</command>. Una biblioteca<filename>dbm</filename> incompatible
se manifiesta normalmente en un mensaje quejándose de que
<function>dbminit</function> falló.
</para>

<indexterm class="endofrange" startref="ch18.nntp.desc"> 
<indexterm class="endofrange" startref="idx-configuringNNTP-1">
<INDEXTERM startref="protocols.NNTP" class=endofrange>
</sect1>
</chapter>


<!--FIN R1 20020909-->