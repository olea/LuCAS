<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.1.2//EN"
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">

<article>

<articleinfo>

<title>NIS(YP)/NIS+/NYS COMO</title>

<author>
<firstname>Andrea Dell'Amico, Mitchum DSouza, Erwin Embsen, Peter Eriksson 
 Traducción de Carlos Martinez Txakartegi, <ulink
url="mailto:txakar@rigel.deus to.es"
>txakar@rigel.deusto.es</ulink
> </firstname>
</author>

<pubdate>l0.5, 24 de Enero de 1995 18 de Julio de 1996</pubdate>

<abstract>

<para>
Configuración y detalles de NIS(YP), NIS+ y NYS (Yellow Pages), sistemas
de autentificación distribuída.
</para>

</abstract>

</articleinfo>

<sect1>
<title>Glosario</title>

<para>
En este documento se han usado muchos acrónimos. Aquí se listan los más 
importantes junto a una breve explicación:
</para>

<para>
<variablelist>

<varlistentry>
<term>DBM</term>
<listitem>
<para>
<emphasis remap="it">DataBase Management</emphasis>, una librería de funciones que mantiene
pares clave-contenido en una base de datos.
</para>
</listitem></varlistentry>
<varlistentry>
<term>DLL</term>
<listitem>
<para>
<emphasis remap="it">Dynamically Linked Library</emphasis>, una librería enlazada a un programa 
ejecutable en tiempo de ejecución.
</para>
</listitem></varlistentry>
<varlistentry>
<term>domainname</term>
<listitem>
<para>
Un nombre "clave" que es usado por clientes NIS para ser 
capaces de localizar un servidor NIS adecuado que sirve a esa clave 
domainname. Notar que esto no tiene nada que ver necesariamente con el 
"dominio" (nombre de máquina) DNS de la(s) máquina(s).
</para>
</listitem></varlistentry>
<varlistentry>
<term>FTP</term>
<listitem>
<para>
<emphasis remap="it">File Transfer Protocol</emphasis>, un protocolo usado para transferir 
ficheros entre dos ordenadores.
</para>
</listitem></varlistentry>
<varlistentry>
<term>libnsl</term>
<listitem>
<para>
<emphasis remap="it">Name services library</emphasis>, una librería de llamadas a servicios
de nombres (<literal remap="tt">getpwnam, getservbyname,</literal> etc...) en Unixes SVR4.
</para>
</listitem></varlistentry>
<varlistentry>
<term>libsocket</term>
<listitem>
<para>
<emphasis remap="it">Socket services library</emphasis>, una librería para llamadas a 
servicios de sockets (<literal remap="tt">socket, bind, listen,</literal> etc...) en Unixes SVR4.
</para>
</listitem></varlistentry>
<varlistentry>
<term>NIS</term>
<listitem>
<para>
<emphasis remap="it">Network Information Service</emphasis>, un servicio que proporciona 
información, que tiene que ser conocida por toda la red, a todas las 
máquinas de la red. Hay soporte para NIS en la librería estándar de 
Linux <literal remap="tt">libc</literal>, y a la que en el texto nos referiremos como 
"NIS tradicional".
</para>
</listitem></varlistentry>
<varlistentry>
<term>NIS+</term>
<listitem>
<para>
<emphasis remap="it">Network Information Service</emphasis> (Plus :-), es esencialmente un NIS con 
``esteroides''. NIS+ fue diseñado por <emphasis remap="it">Sun Microsystems Inc.</emphasis> como
un 
sustituto de NIS, con una mejor seguridad y un mejor manejo de 
_grandes_ instalaciones.
</para>
</listitem></varlistentry>
<varlistentry>
<term>NYS</term>
<listitem>
<para>
Este es el nombre de un proyecto que viene de NIS+,YP y Switch y 
que está organizado por Peter Eriksson <literal remap="tt">&lt;pen@lysator.liu.se&#62;</literal>. 
Contiene, 
entre otras cosas, una completa reimplementación del código del NIS (=YP) 
usando la funcionalidad del <emphasis remap="it">Name Services Switch</emphasis> de la librería NYS.
</para>
</listitem></varlistentry>
<varlistentry>
<term>RPC</term>
<listitem>
<para>
<emphasis remap="it">Remote Procedure Call</emphasis>. Las rutinas RPC permiten a los programas 
en C realizar llamadas a procedimientos en otras máquinas a través 
de la red. Cuando la gente habla de RPC, normalmente se refiere 
a la variante SunRPC.
</para>
</listitem></varlistentry>
<varlistentry>
<term>YP</term>
<listitem>
<para>
<emphasis remap="it">Yellow Pages(tm)</emphasis>, Páginas Amarillas en Inglés, es una marca registrada 
en el Reino Unido por la <emphasis remap="it">British Telecom plc.</emphasis> (la telefónica 
inglesa, vamos).
</para>
</listitem></varlistentry>
<varlistentry>
<term>TCP-IP</term>
<listitem>
<para>
<emphasis remap="it">Transmission Control Protocol/Internet Protocol</emphasis>. Es un 
protocolo de comunicación de datos usado a menudo en máquinas Unix.
</para>
</listitem></varlistentry>
</variablelist>
</para>

<sect2>
<title>Algo de Información General</title>

<para>
Las siguientes líneas están sacadas del <emphasis remap="it">Sun(tm) System &amp; Network 
Administration Manual</emphasis>:
</para>

<para>

<screen>
    "NIS se llamaba en un principio Sun Yellow Pages (YP)
     pero el nombre Yellow Pages(tm) es una marca registrada
     en el Reino Unido por la British Telecom plc y no
     puede ser usado sin permiso."
</screen>

</para>

<para>
NIS viene de <emphasis remap="it">Network Information Service</emphasis>. Su propósito es proveer 
información, que tiene que ser conocida a lo largo de la red, a todas las 
máquinas de la red. La información más indicada para ser distribuida por 
NIS es:
</para>

<para>

<itemizedlist>
<listitem>

<para>
nombres de login/passwords/directorios home (<literal remap="tt">/etc/passwd</literal>)
</para>
</listitem>
<listitem>

<para>
información de grupos (<literal remap="tt">/etc/group</literal>)
</para>
</listitem>

</itemizedlist>

</para>

<para>
Así que, por ejemplo, si la entrada de tu password está grabada en la base 
de datos <literal remap="tt">passwd</literal> de NIS, serás capaz de entrar en todas las máquinas de la 
red que tengan corriendo los programas clientes NIS.
</para>

<para>
Sun es una marca registrada de <emphasis remap="it">Sun Microsystems, Inc.</emphasis> licenciada a 
<emphasis remap="it">SunSoft, Inc.</emphasis>
</para>

</sect2>

</sect1>

<sect1>
<title>Introducción</title>

<para>
Cada vez más y más máquinas Linux están siendo instaladas como parte de una 
red de computadoras. Para simplificar la administración de la red, la 
mayor parte de las redes (sobre todo, redes basadas en máquinas Sun) 
ejecutan el <emphasis remap="it">Network Information Service</emphasis>. Las máquinas Linux pueden sacar
gran partido a los servicios NIS existentes o proveer servicio NIS por sí 
mismas. Pueden incluso (con la librería NYS) actuar como un cliente NIS+ 
limitado.
</para>

<para>
Este documento intenta responder cuestiones sobre la configuración de 
NIS(YP) en tu máquina Linux. No habla sobre cómo configurar NIS+. No 
olvides leer la sección <xref linkend="puertosrpc"/>
</para>

<sect2>
<title>Nuevas Versiones de Este Documento (En inglés)</title>

<para>
Nuevas versiones de este documento serán enviadas periódicamente 
(aproximadamente, cada mes) a los newsgroups <literal remap="tt">comp.os.linux.announce</literal> y 
<literal remap="tt">comp.os.linux.misc</literal>. Este documento se encuentra archivado en varios 
FTP 
sites, incluyendo <literal remap="tt">sunsite.unc.edu</literal> en el directorio 
<literal remap="tt">/pub/Linux/docs/HOWTO</literal>.
</para>

</sect2>

<sect2>
<title>Nota de Renuncia</title>

<para>
Aunque este documento ha sido recogido con lo mejor de nuestros 
conocimientos, puede contener, y probablemente contendrá, errores. Por 
favor, léete todos los ficheros <literal remap="tt">README</literal> adjuntos a cualquiera de los 
varios paquetes de software descritos en este documento para obtener una
información más detallada y precisa. Nosotros intentaremos mantener este 
documento tan libre de errores como sea posible.
</para>

</sect2>

<sect2>
<title>FeedBack</title>

<para>
Si tienes algún comentario, preguntas o sugerencias, por favor, 
enviámelas por e-mail a <literal remap="tt">Erwin Embsen &lt;erwin@nioz.nl&#62;</literal>. Y si 
encuentras errores u omisiones obvias, definitivamente debes contactar 
con él
<footnote>

<para>
Aunque me temo que no sabe castellano, así que cuéntale lo 
que sea en inglés...
</para>

</footnote>
. 
</para>

</sect2>

<sect2>
<title>Agradecimientos</title>

<para>
Nos gustaría agradecer a toda la gente que ha contribuido (directa o
indirectamente) a la realización de este documento. En orden alfabético:
</para>

<para>

<screen>
Andrea Dell'Amico &#60;adellam@di.unipi.it&#62;
Mitchum DSouza    &#60;Mitch.Dsouza@Dubai.Sun.COM&#62;
Erwin Embsen      &#60;erwin@nioz.nl&#62;
Byron A Jeff      &#60;byron@cc.gatech.edu&#62;
Peter Eriksson    &#60;pen@lysator.liu.se&#62;
</screen>

</para>

<para>
Theo de Raadt <literal remap="tt">&lt;deraadt@fsa.ca&#62;</literal> es responsable del código original
de
los yp-clients. Swen Thuemmler <literal remap="tt">&lt;swen@uni-paderborn.de&#62;</literal> portó el
código de los yp-clients y de las yp-routines en la libc (de nuevo,
basándose en el trabajo de Theo).
</para>

</sect2>

</sect1>

<sect1 id="nisnisplus">
<title>¿ NIS o NIS+ ?</title>

<para>
La elección entre NIS y NIS+ es fácil - usa NIS si no tienes que usar 
NIS+ o si no tienes severas necesidades de seguridad. NIS+ es mucho más 
problemático de administrar (es bastante fácil de manejar la parte del
cliente, pero la parte del servidor es horrible). Otro problema es que el 
soporte para NIS+ bajo Linux está todavía en desarrollo --una cosa 
importante de la que todavía carece es del soporte para encriptación y 
autentificación de datos que es _la_ principal razón por la que alguien 
querría usar NIS+...--
</para>

<sect2>
<title>¿ NIS tradicional o la librería NYS ?</title>

<para>
La elección entre el NIS tradicional o el código NIS de la librería NYS 
es una elección entre vagancia y madurez vs. flexibilidad y deseos de 
aventura.
</para>

<para>
El código "NIS tradicional" está en la librería C estándar y ha estado 
ahí fuera por mucho tiempo, sufriendo a veces de su edad y de un poco de 
inflexibilidad.
</para>

<para>
El código NIS de la librería NYS, por otro lado, requiere, una de dos, o 
que recompiles y re-enlaces todos tus programas a la librería <literal remap="tt">libnsl</literal>, o
que recompiles la librería libc para que incluya el código libnsl (o tal 
vez puedas ir y obtener una versión precompilada de alguien que ya lo
haya hecho).
</para>

<para>
Otra diferencia es que el código tradicional NIS tiene algún soporte para 
Netgroups NIS, cosa que el código NYS no tiene (todavía). Por otro lado, 
el código NYS te permite manejar <emphasis>Shadow Passwords</emphasis> de una forma transparente.
</para>

</sect2>

</sect1>

<sect1>
<title>Cómo trabaja</title>

<para>
En una red debe haber al menos una máquina actuando como un servidor NIS. 
Puedes tener múltiples servidores NIS, cada uno sirviendo a diferentes 
"dominios" NIS - o puedes tener servidores NIS cooperativos, donde uno es 
el llamado servidor NIS maestro, y todos los demás son los llamados 
servidores NIS esclavos (¡para un "dominio" NIS determinado, eso es!) - o 
puedes tener una mezcla de ellos...
</para>

<para>
Los servidores esclavos solo tienen copias de las bases de datos NIS y 
reciben estas copias del servidor NIS maestro cada vez que se realizan
cambios a las bases de datos maestras. Dependiendo del número de máquinas 
que haya en tu red y de la seriedad de tu red, podrías decidir si instalar 
uno o más servidores esclavos. Cada vez que un servidor NIS se cae o va 
muy lento respondiendo peticiones, un cliente NIS conectado a ese 
servidor intentará encontrar otro que no esté caído o que vaya más rápido.
</para>

<para>
Las bases de datos NIS están en el formato DBM, que deriva de las bases 
de datos <literal remap="tt">ASCII</literal>. Por ejemplo, los ficheros <literal remap="tt">/etc/passwd</literal> y 
<literal remap="tt">/etc/group</literal> pueden ser directamente convertidos a formato DBM 
usando software de translación ASCII &#60;--&#62; DBM ("<literal remap="tt">dbload</literal>", incluído con el 
software del servidor). El servidor NIS maestro debería tener ambas, las 
bases de datos ASCII y las DBM.
</para>

<para>
Los servidores esclavos serán notificados de cualquier cambio en los 
mapas NIS, (vía el programa "<literal remap="tt">yppush</literal>"), y recibirán automáticamente los 
cambios necesarios para sincronizar sus bases de datos. Los clientes NIS 
no necesitan hacer esto ya que éstos siempre hablan directamente con el 
servidor NIS para leer la información almacenada en sus bases de datos DBM.
</para>

<para>
El autor de los clientes YP para Linux nos ha informado de que el ypbind 
más reciente (del paquete <literal remap="tt">yp-clients.tar.gz</literal>) es capaz de obtener el 
servidor a partir de un fichero de configuración --lo que quiere decir 
que no es necesario un broadcast (lo cual es inseguro, debido al hecho de 
que cualquiera podría instalar un servidor NIS y contestar a las
peticiones de broadcast...).--
</para>

</sect1>

<sect1>
<title>¿ Qué necesitas para configurar NIS ?</title>

<sect2 id="puertosrpc">
<title>El Mapeador de Puertos RPC </title>

<para>
Para ejecutar algún software de los mencionados más adelante necesitarás 
ejecutar antes el programa <literal remap="tt">/usr/sbin/rpc.portmap</literal>. Algunas 
distribuciones 
Linux ya tienen código para arrancar éste demonio en <literal remap="tt">/etc/rc.d/rc.inet2.</literal> 
Todo lo que tienes que hacer es "descomentar" ese código y rearrancar tu 
máquina Linux para activarlo.
</para>

<para>
El mapeador RPC (<literal remap="tt">portmap(8c)</literal>) es un servidor que convierte números de 
programas RPC en números de puerto de protocolo TCP/IP (o UDP/IP). Debe 
estar ejecutándose para poder realizar llamadas RPC (que es lo que el 
software de cliente NIS hace) a servidores RPC (como un servidor NIS) de 
esa máquina. Cuando un servidor RPC arranca, avisará al mapeador de 
puertos por cuál puerto está escuchando, y a qué números de programas 
RPC está preparado para servir. Cuando un cliente desea hacer una llamada 
RPC a un número de programa dado, primero deberá contactar con el mapeador
de puertos de la máquina servidora para determinar el número de puerto al 
que los paquetes RPC deben ser enviados.
</para>

<para>
Normalmente los servidores RPC estándar son arrancados por <literal remap="tt">inetd(8c)</literal>, de 
modo que el mapeador de puertos debe ser iniciado antes de que <literal remap="tt">inetd</literal> sea 
invocado.
</para>

</sect2>

<sect2>
<title>Determinar si eres Servidor, Esclavo o Cliente.</title>

<para>
Para contestar a esta cuestión debes considerar dos casos:
</para>

<para>

<orderedlist>
<listitem>

<para>
Tu máquina va a ser parte de una red en la que ya existen 
servidores NIS.

</para>
</listitem>
<listitem>

<para>
Todavía no tienes servidores NIS en la red.
</para>
</listitem>

</orderedlist>

</para>

<para>
En el primer caso, sólo necesitas los programas cliente (<literal remap="tt">ypbind, ypwhich,
ypcat, yppoll, ypmatch</literal>). El programa más importante es <literal remap="tt">ypbind</literal>. Este 
programa debe estar ejecutándose en todos los casos, esto es, debe 
aparecer siempre en la lista de procesos. Es un proceso de los llamados 
demonio y necesita ser iniciado desde el fichero de arranque del 
sistema (ej. <literal remap="tt">/etc/rc.local</literal>). Tan pronto como <literal remap="tt">ypbind</literal> esté en marcha, tu 
sistema se convierte en un cliente NIS.
</para>

<para>
En el segundo caso, si no tienes servidores NIS, entonces también 
necesitarás un programa servidor NIS (normalmente llamado <literal remap="tt">ypserv</literal>). La 
sección <xref linkend="confnys"/> 
describe como configurar un servidor NIS en tu maquina Linux 
usando la implementación del <literal remap="tt">ypserv</literal> de Peter Eriksson 
(<literal remap="tt">&lt;pen@lysator.liu.se&#62;</literal>). Nota que ésta implementación NO 
soporta el concepto maestro-esclavo del que hemos hablado en la sección <xref linkend="nisnisplus"/>.
Usando este software, todos tus servidores NIS serán servidores
maestros. Hay otro servidor gratuito disponible, llamado "<literal remap="tt">yps</literal>", escrito
por Tobias Reber en Alemania que sí soporta el concepto maestro-esclavo, 
pero que tiene otras limitaciones.
</para>

</sect2>

<sect2>
<title>El Software</title>

<para>
La librería del sistema "<literal remap="tt">/usr/lib/libc.a</literal>" (version 4.4.2 y superiores) o 
la librería compartida "<literal remap="tt">/usr/lib/libc.sa</literal>" y sus DLL relacionadas 
contienen todas las llamadas al sistema necesarias para compilar 
satisfactoriamente el software del cliente y del servidor NIS.
</para>

<para>
Ha habido informes de gente diciendo que NIS sólo funciona con las 
versiones 4.5.21 y superiores de "<literal remap="tt">/usr/lib/libc.a</literal>" así que si quieres 
ir a lo seguro, no uses libc's más antiguas. El software de cliente NIS 
puede obtenerse de:
</para>

<para>

<screen>
  Servidor               Directorio                       Nombre de fichero
  
  ftp.uni-paderborn.de   /pcsoft2/linux/local/yp          yp-clients.tar.gz
  ftp.funet.fi           /pub/OS/Linux/BETA/NYS/clients   yp-clients.tar.gz
  ftp.lysator.liu.se     /pub/NYS/clients                 yp-clients.tar.gz
  sunsite.unc.edu        /pub/Linux/system/Network/admin  yp-clients.tar.gz
</screen>

</para>

<para>
Una vez hayas obtenido el software, por favor, sigue las instrucciones 
que vienen con él.
</para>

</sect2>

<sect2 id="conficli">
<title>Configurar un Cliente NIS usando NIS Tradicional</title>

<para>
Asumiendo que hayas compilado satisfactoriamente el software, ya estarás 
preparado para instalarlo. Un lugar idóneo para el demonio <literal remap="tt">ypbind</literal> es el 
directorio <literal remap="tt">/usr/sbin</literal>.
</para>

<para>
Por supuesto, para ello deberás entrar como root. Los otros binarios 
(<literal remap="tt">ypwhich, ypcat, yppoll, ypmatch</literal>) deben ir en un directorio accesible por 
todos los usuarios, <literal remap="tt">/usr/etc</literal> o <literal remap="tt">/usr/local/bin</literal> por ejemplo. Sería una 
buena idea probar el <literal remap="tt">ypbind</literal> antes de incorporarlo en <literal remap="tt">/etc/rc.d/rc.inet2</literal>.
</para>

<para>
Para probar el <literal remap="tt">ypbind</literal> haz lo siguiente:
</para>

<para>

<itemizedlist>
<listitem>

<para>
Asegúrate de que tienes establecido ya tu nombre de dominio. Si no 
lo tienes ejecuta el comando:


<screen>
	    /bin/domainname-yp nis.domain
	
</screen>

	
donde <literal remap="tt">nis.domain</literal> debe ser alguna cadena de caracteres, 
que normalmente ¡_NO_ debe estar relacionada con el nombre de 
dominio de tu máquina! La razón para esto es que hace un poco más 
difícil a crackers externos el obtener la base de datos de passwords 
de tus servidores NIS. Si no sabes cuál es el nombre de dominio 
NIS de tu red, pregunta al administrador de tu sistema/red.

</para>
</listitem>
<listitem>

<para>
Arrancar "<literal remap="tt">/usr/sbin/rpc.portmap</literal>" si no está ya ejecutándose.

</para>
</listitem>
<listitem>

<para>
Crear el directorio "<literal remap="tt">/var/yp</literal>" si no existe.

</para>
</listitem>
<listitem>

<para>
Iniciar "<literal remap="tt">/usr/sbin/ypbind</literal>"

</para>
</listitem>
<listitem>

<para>
Usar el comando "<literal remap="tt">rpcinfo -p localhost</literal>" para comprobar si <literal remap="tt">ypbind</literal> es 
capaz de registrar su servicio con el mapeador de puertos. El 
rpcinfo debería producir una salida parecida a:


<screen>
       program vers proto   port
        100000    2   tcp    111  portmapper
        100000    2   udp    111  portmapper
        100007    2   udp    637  ypbind
        100007    2   tcp    639  ypbind
        300019    1   udp    660
      
</screen>


</para>
</listitem>
<listitem>

<para>
Podrías también ejecutar "<literal remap="tt">rpcinfo -u localhost ypbind</literal>". Este 
comando debería producir una salida similar a:


<screen>
        program 100007 version 2 ready and waiting
      
</screen>


</para>
</listitem>

</itemizedlist>

</para>

<para>
Finalmente, no olvides que para búsquedas de nodos debes establecer (o 
añadir) "<literal remap="tt">nis</literal>" a la entrada de orden de búsquedas en tu fichero 
<literal remap="tt">/etc/host.conf</literal>. Por favor, lee la página man "<literal remap="tt">resolv+.8</literal>" para más 
detalles. 
</para>

<para>
En este punto, ya podrías usar programas cliente NIS como <literal remap="tt">ypcat</literal>, etc... 
Por ejemplo, "<literal remap="tt">ypcat passwd</literal>" te devolverá la base de datos NIS de 
los passwords completa.
</para>

<para>
IMPORTANTE: Si te saltaste el procedimiento de prueba asegúrate de que 
has establecido el nombre de dominio, y creado el directorio:
</para>

<para>

<screen>
    /var/yp
</screen>

</para>

<para>
Este directorio DEBE existir para que <literal remap="tt">ypbind</literal> pueda iniciarse 
satisfactoriamente.
</para>

<para>
Si el test funcionó, puede que ahora quieras cambiar los ficheros 
<literal remap="tt">/etc/rc.d/rc.M</literal> y <literal remap="tt">/etc/rc.d/rc.inet2</literal> en tu sistema para que <literal remap="tt">ypbind</literal> se 
inicie durante el arranque y para que tu sistema actúe como un cliente 
NIS. Edita el fichero <literal remap="tt">/etc/rc.d/rc.M</literal> y busca los comandos que establecen 
el nombre de dominio. Cambia el nombre de dominio por el nombre de tu 
dominio. También, edita el fichero <literal remap="tt">/etc/rc.d/rc.inet2</literal>, ``descomenta'' las 
líneas que inician el demonio <literal remap="tt">rpc.portmap</literal>, y añade las siguientes líneas 
justo después del lugar donde se arranca <literal remap="tt">rpc.portmap</literal>:
</para>

<para>

<screen>
    #
    # Arranca el demonio ypbind:
    #
    if [ -f ${NET}/ypbind -a -d /var/yp ]; then
        echo -n " ypbind"
        ${NET}/ypbind
    fi
</screen>

</para>

<para>
Al contrario que con la implementación de Sun del NIS no necesitas editar 
los ficheros <literal remap="tt">/etc/passwd</literal> y <literal remap="tt">/etc/group</literal> para poder aprovechar NIS. La 
implementación de Sun necesita una línea "<literal remap="tt">+:*:0:0:::</literal>" en el <literal remap="tt">/etc/passwd</literal> y 
una línea "<literal remap="tt">+:*:0:</literal>" en el <literal remap="tt">/etc/group</literal> para decirle a NIS que busque en las 
bases de datos NIS de los passwords y de los grupos.
</para>

<para>
IMPORTANTE: Nota que el comando finger te informará con mensajes "no such 
user" si no añades la línea "<literal remap="tt">+:*:0:0:::</literal>" en <literal remap="tt">/etc/passwd</literal>. Volver a 
poner la línea "<literal remap="tt">+:*:0:0:::</literal>" en <literal remap="tt">/etc/passwd</literal> arreglará el finger.
</para>

<para>
Bueno, esto es todo. Rearranca la máquina y observa los mensajes de arranque 
para ver si ypbind efectivamente se ha iniciado.
</para>

<para>
IMPORTANTE: Nota que la característica netgroup está implementada 
empezando en la libc v4.5.26. Los netgroups permiten control de acceso 
para cada máquina y para cada usuario en el dominio NIS, y requieren una 
entrada como ésta:
</para>

<para>

<screen>
    +@this_machine_users
</screen>

</para>

<para>
en <literal remap="tt">/etc/passwd</literal>. Pero si tienes una versión de libc anterior a la 4.5.26, 
todos los usuarios de la base de datos NIS de passwords pueden acceder a 
tu máquina Linux si ejecutas "<literal remap="tt">ypbind</literal>".
</para>

</sect2>

</sect1>

<sect1 id="confnys">
<title>¿ Qué necesitas para configurar NYS ?</title>

<sect2>
<title>Determinar si eres un Servidor, Esclavo o Cliente.</title>

<para>
Para contestar esta cuestión debes considerar dos casos:
</para>

<para>

<itemizedlist>
<listitem>

<para>
Tu máquina va a ser parte de una red en la que ya existen
servidores NIS.

</para>
</listitem>
<listitem>

<para>
Todavía no tienes servidores NIS en la red.
</para>
</listitem>

</itemizedlist>

</para>

<para>
En el primer caso tienes dos opciones:
</para>

<para>

<itemizedlist>
<listitem>

<para>
O reenlazas todos los programas cliente y demonio con la librería 
NYS <literal remap="tt">libnsl.so</literal> (o las enlazas estáticamente con 
<literal remap="tt">libnsl.a</literal>). Esto supone añadir la línea:


<screen>
	    LIBS=-lnsl
	
</screen>


a tu Makefile, que indica que quieres enlazar la Network Services 
Library. Básicamente, todos los demonios de red y el programa 
"<literal remap="tt">login</literal>" necesitan ser recompilados.

</para>
</listitem>
<listitem>

<para>
O puedes recompilar la librería C estándar <literal remap="tt">libc</literal> para que 
incluya las funciones de librería de los clientes NYS, y después 
reenlazar todos los programas enlazados estáticamente (los programas 
enlazados dinámicamente tienen la nueva versión de libc 
automáticamente). Para más información sobre ésta opción, mira la 
sección<xref linkend="hazusar"/>  más abajo.
</para>
</listitem>

</itemizedlist>

</para>

<para>
De forma similar al caso del NIS tradicional, si no tienes servidores NIS, 
entonces también necesitarás un programa servidor NIS (normalmente 
llamado <literal remap="tt">ypserv</literal>) y tendrás que designar una de las máquinas de tu red como 
servidor NIS maestro. De nuevo, quizás quieras establecer al menos un 
servidor esclavo junto con el maestro.
</para>

</sect2>

<sect2>
<title>El Software</title>

<para>
Necesitas obtener y compilar la librería <literal remap="tt">libnsl.so</literal> de servicios NYS. Si 
no tienes las herramientas DLL instaladas puedes obtener una librería 
precompilada compartida, estática o en código fuente del mismo servidor 
mencionado más abajo. Nota, de todos modos, que la versión precompilada 
puede ser (y probablemente es) más vieja que la última edición del 
código fuente.
</para>

<para>
La librería NYS (en versión código fuente y precompilada) puede ser 
obtenida de:
</para>

<para>

<screen>
    Servidor            Directorio                     Nombre fichero

    ftp.lysator.liu.se  /pub/NYS/libs                  nys-0.27.4.tar.gz
    ftp.lysator.liu.se  /pub/NYS/binaries/lib          libnsl.so.1.0.a26
 
    ftp.funet.fi        /pub/OS/Linux/BETA/NYS/libs    nys-0.27.4.tar.gz
    ftp.funet.fi        /pub/OS/Linux/BETA/NYS/lib     libnsl.so.1.0.a26
</screen>

</para>

<para>
Versiones precompiladas de los programas "<literal remap="tt">login</literal>" y "<literal remap="tt">su</literal>" pueden ser 
obtenidos de:
</para>

<para>

<screen>
    Servidor            Directorio                     Nombre fichero

    ftp.lysator.liu.se  /pub/NYS/binaries/bin          login
    ftp.lysator.liu.se  /pub/NYS/binaries/bin          su

    ftp.funet.fi        /pub/OS/Linux/BETA/NYS/bin     login
    ftp.funet.fi        /pub/OS/Linux/BETA/NYS/bin     su
</screen>

</para>

<para>
Similarmente, se pueden obtener ejemplos de ficheros de cofiguración de:
</para>

<para>

<screen>
    Servidor            Directorio                     Nombre fichero

    ftp.lysator.liu.se  /pub/NYS/binaries/etc          *conf
    ftp.funet.fi        /pub/OS/Linux/BETA/NYS/etc     *conf
</screen>

</para>

<para>
Para compilar la librería <literal remap="tt">nsl</literal>, sigue las instrucciones que vienen con el 
software. Si deseas compilar la librería DLL compartida debes tener las 
herramientas DLL instaladas en su sitio (<literal remap="tt">/usr/dll</literal>). Las herramientas DLL 
(el paquete <literal remap="tt">tools-2.11.tar.gz</literal> o posterior) pueden ser obtenidas de los 
servidores habituales.
</para>

</sect2>

<sect2>
<title>Configurar un Cliente NYS usando NYS</title>

<para>
A diferencia del NIS tradicional, no se necesita ninguna configuración 
para un cliente NYS. Todo lo que se necesita, es que el fichero de 
configuración NIS (<literal remap="tt">/etc/yp.conf</literal>) apunte al servidor correcto para su 
información. Además, el fichero de configuración del <emphasis remap="it">Name Services Switch</emphasis> 
(<literal remap="tt">/etc/nsswitch.conf</literal>) debe estar correctamente configurado.
</para>

<para>
Por favor, refieráse a los ejemplos proporcionados con el código fuente.
</para>

</sect2>

<sect2>
<title>El Fichero <literal remap="tt">nsswitch.conf</literal></title>

<para>
El fichero de <emphasis remap="it">Network Services Switch</emphasis> <literal remap="tt">/etc/nsswitch.conf</literal> determina el 
orden de las búsquedas realizadas cuando se pide una pieza específica de 
información, de la misma forma que el fichero <literal remap="tt">/etc/host.conf</literal> determina la 
manera en que se realizan las búsquedas de hosts. Insistimos, eche un 
vistazo al fichero proporcionado en la distribución del código fuente. Por 
ejemplo, la línea
</para>

<para>

<screen>
    hosts: files nis dns
</screen>

</para>

<para>
especifica que las funciones de búsqueda de host deben primero mirar en 
el fichero <literal remap="tt">/etc/hosts</literal> local, seguido de una búsqueda NIS y, finalmente, 
usar el DNS (<literal remap="tt">/etc/resolv.conf</literal> y <literal remap="tt">named</literal>). Si al llegar a este punto no se 
encuentra el host correspondiente se devuelve un error.
</para>

</sect2>

<sect2 id="hazusar">
<title>Haz usar NYS a tus binarios</title>

<para>
En vez de reenlazar cada binario con la librería NYS (<literal remap="tt">libnsl.so</literal>), se ha 
conseguido una solución más limpia proporcionando al usuario la 
posibilidad de compilar una libc que incluya NYS. Esto significa que todo 
lo que necesitas hacer es recompilar una nueva libc y sustituir la 
<literal remap="tt">/lib/libc.so.x.y.z</literal> existente para que todos los programas (los compilados 
no-estáticamente) utilicen NYS.
</para>

<para>
Esta combinación también te da la ventaja sobre la implementación del NIS 
tradicional en la libc de linux, en que permite soporte transparente para 
<emphasis remap="it">shadow passwords</emphasis> (vía el fichero <literal remap="tt">/etc/nisswitch.conf</literal>).
</para>

<para>
Sigue los sencillos pasos indicados más adelante para recompilar una libc que 
incluya NYS.
</para>

<para>

<itemizedlist>
<listitem>

<para>
Asegúrate de que tienes las últimas herramientas DLL instaladas. 
Para más información acerca de dónde conseguirlas léete el GCC-FAQ.

</para>
</listitem>
<listitem>

<para>
Consigue los últimos fuentes de la <literal remap="tt">libc</literal>. (de nuevo, mira el GCC-FAQ)

</para>
</listitem>
<listitem>

<para>
Consigue los últimos fuentes del <literal remap="tt">nys</literal> de:


<screen>
          ftp.lysator.liu.se:/pub/NYS/libs
      
</screen>


y descomprímelos en el directorio de la libc-linux fuente.      
Actualmente la distribución es la "<literal remap="tt">nys-0.27.4.tar.gz</literal>".

</para>
</listitem>
<listitem>

<para>
Ejecuta el <literal remap="tt">./configure</literal> y contesta "n" a la pregunta


<screen>
          Values correct (y/n) [y] ?
      
</screen>


Luego sigue con las siguientes cuestiones y la última pregunta 
ahora será
	 

<screen>
          Build a NYS libc from nys-0.27 (y default) ?
      
</screen>

 
contesta "y" a ésta.

</para>
</listitem>
<listitem>

<para>
Luego ejecuta el comando


<screen>
          % make
      
</screen>


</para>
</listitem>

</itemizedlist>

</para>

<para>
La librería generada tras la compilación se llamará algo así como
</para>

<para>

<screen>
    libc.so.4.5.26
</screen>

</para>

<para>
y estará bajo el directorio <literal remap="tt">jump/libc-nys</literal>. Para instalar esta librería 
nuestro consejo sería copiarla a <literal remap="tt">/lib</literal> con un nombre lexicográficamente 
superior que el número que actualmente tiene. Simplemente con añadir la 
letra "a" lo podremos conseguir. Por ejemplo:
</para>

<para>

<screen>
    % cp jump/libc-nys/libc.so.4.5.26 /lib/libc.so.4.5.26a
</screen>

</para>

<para>
Alternativamente, podríamos añadirle "nys" para poder identificarlo 
rápidamente. Ahora ejecuta el siguiente comando
</para>

<para>

<screen>
    % ldconfig
</screen>

</para>

<para>
que reseteará tu caché para usar la nueva librería. La estrategia del 
enlazador dinámico puede ser examinada con el comando "<literal remap="tt">ldconfig -p</literal>".
</para>

<para>
Básicamente esto es todo. Ahora todos tus programas deben poder utilizar 
NYS. Por favor, nota que usualmente el programa "<literal remap="tt">login</literal>" está 
compilado estáticamente y que por lo tanto no puede acceder a las nuevas 
funciones NYS de la nueva <literal remap="tt">libc</literal>. Deberás recompilar "<literal remap="tt">login</literal>" sin el parámetro 
<literal remap="tt">-static</literal>, o enlazarlo estáticamente a la librería <literal remap="tt">libnsl.a</literal>.
</para>

</sect2>

</sect1>

<sect1>
<title>Configurar un Servidor NIS</title>

<sect2>
<title>El Programa Servidor <literal remap="tt">ypserv</literal></title>

<para>
Este documento sólo describe cómo configurar el servidor NIS "<literal remap="tt">ypserv</literal>". La 
configuración del servidor "<literal remap="tt">yps</literal>" es similar _pero_ no exactamente igual 
así que ¡ten esto en cuenta si intentas aplicar estas instrucciones a "<literal remap="tt">yps</literal>"!
</para>

<para>
El software del Servidor NIS puede ser encontrado en:
</para>

<para>

<screen>
    Servidor            Directorio                         Nombre fichero

    ftp.lysator.liu.se  /pub/NYS/servers                   ypserv-0.11.tar.gz
    ftp.funet.fi        /pub/OS/Linux/BETA/NYS/servers     ypserv-0.11.tar.gz
    mcsun.eu.net        /os/linux/BETA/NYS/servers         ypserv-0.11.tar.gz
    ftp.univie.ac.at    /unix/system/linux/funet/BETA/NYS/servers
                                                           ypserv-0.11.tar.gz
</screen>

</para>

<para>
El setup del servidor es el mismo para NIS tradicional y para NYS.
</para>

<para>
Compila el software para generar los programas "<literal remap="tt">ypserv</literal>", "<literal remap="tt">dbcat</literal>" y 
"<literal remap="tt">dbload</literal>". Primeramente debes determinar qué ficheros necesitas que estén 
disponibles via NIS y después añade o elimina las entradas apropiadas de 
ypMakefile. Luego instala el fichero <literal remap="tt">ypMakefile</literal> en 
<literal remap="tt">/var/yp</literal> con el nombre <literal remap="tt">Makefile</literal>.
</para>

<para>
Y ahora crea los ficheros DLL escribiendo:
</para>

<para>

<screen>
    % cd /var/yp; make
</screen>

</para>

<para>
Cerciórate de que el mapeador de puertos (<literal remap="tt">rpc.portmap</literal>) está en marcha, y 
arranca el servidor "<literal remap="tt">ypserv</literal>". El comando
</para>

<para>

<screen>
    % rpcinfo -u localhost ypserv
</screen>

</para>

<para>
debería dar una salida como
</para>

<para>

<screen>
    program 100004 version 2 ready and waiting
</screen>

</para>

<para>
Ya está, tu servidor ya está en marcha.
</para>

</sect2>

<sect2>
<title>El Programa <literal remap="tt">yppasswdd</literal></title>

<para>
Cada vez que los usuarios cambien sus passwords, la base de datos NIS y 
probablemente otras bases de datos que dependan de la base de datos NIS 
de los passwords deben ser actualizadas. El programa "<literal remap="tt">yppasswdd</literal>" es un 
servidor que maneja cambios de password y que se asegura de que la 
información NIS será actualizada acordemente. El software para 
"<literal remap="tt">yppasswdd</literal>" puede encontrarse en:
</para>

<para>

<screen>
    Servidor                   Directorio                     Nombre fichero

    ftp.lysator.liu.se    /pub/NYS                        yppasswdd-0.5.tar.gz
    ftp.funet.fi          /pub/OS/Linux/BETA/NYS/servers  yppasswdd-0.5.tar.gz
</screen>

</para>

<para>
Una vez obtenido el software, sigue las instrucciones que vienen con él.
</para>

</sect2>

</sect1>

<sect1>
<title>Verificar la Instalación NIS/NYS</title>

<para>
Si todo es correcto (como debería serlo), deberías poder verificar tu 
instalación con unos pocos comandos. Asumiendo, por ejemplo, que tu 
fichero <literal remap="tt">passwd</literal> está siendo soportado por NIS, el comando
</para>

<para>

<screen>
    % ypcat passwd
</screen>

</para>

<para>
debería devolverte los contenidos de tu fichero NIS passwd. El comando
</para>

<para>

<screen>
    % ypmatch userid passwd
</screen>

</para>

<para>
(donde <literal remap="tt">userid</literal> es el nombre de login de un usuario arbitrario) debería 
devolver la entrada correspondiente a ese usuario en el fichero NIS 
passwd. Los programas "<literal remap="tt">ypcat</literal>" e "<literal remap="tt">ypmatch</literal>" deberían venir incluidos con tu 
distribución de NIS tradicional o de NYS.
</para>

</sect1>

<sect1>
<title>Problemas Comunes y soluciones con NIS</title>

<para>
Aquí van algunos problemas comunes según los informes de varios usuarios:
</para>

<para>

<orderedlist>
<listitem>

<para>
La versión 4.5.19 de libc no funciona. NIS no funcionará con ellas.

</para>
</listitem>
<listitem>

<para>
Si actualizas las librerías de 4.5.19 a 4.5.24, el comando <literal remap="tt">su</literal> dejará 
de funcionar. Necesitas obtener el comando su de la distribución 
1.2.0 de Slackware. También de ahí podrás obtener las librerías 
actualizadas.

</para>
</listitem>
<listitem>

<para>
Puedes encontrar problemas con NIS y DNS en la misma máquina.
Mi servidor DNS a veces pasa del NIS. Todavía no he averiguado por 
qué. 

</para>
</listitem>
<listitem>

<para>
Cuando un servidor NIS se cae y vuelve a levantarse <literal remap="tt">ypbind</literal> arranca 
con mensajes como:

         yp_match: clnt_call:
                     RPC: Unable to receive; errno = Connection refused
	

y los logins de aquellos que están registrados en la base de datos 
NIS son rechazados. Intenta entrar como root y si lo consigues, 
mata el <literal remap="tt">ypbind</literal> y arráncalo de nuevo.  
</para>
</listitem>

</orderedlist>

</para>

</sect1>

<sect1>
<title>Preguntas Realizadas Frecuentemente</title>

<para>
La mayoría de tus preguntas ya deberían estar contestadas. Si todavía 
tienes alguna pregunta sin contestar tal vez quieras enviar un mensaje a
</para>

<para>

<screen>
    comp.os.linux.help
</screen>

</para>

<para>
o contactar con uno de los autores de este HOWTO.
</para>

</sect1>

<sect1 id="Grupos">
<title>Anexo: El INSFLUG </title>

<para>
El <emphasis>INSFLUG</emphasis> forma parte del grupo internacional 
<emphasis remap="it">Linux Documentation Project</emphasis>, 
encargándose de las traducciones al castellano de los Howtos (Comos),
así como la producción de documentos originales en aquellos casos
en los que no existe análogo en inglés.
</para>

<para>
En el <emphasis remap="bf">INSFLUG</emphasis> se orienta preferentemente a la traducción de documentos
breves, como los <emphasis>COMOs</emphasis> y <emphasis>PUFs</emphasis> (<emphasis remap="bf">P</emphasis>reguntas de
<emphasis remap="bf">U</emphasis>so <emphasis remap="bf">F</emphasis>recuente, las <emphasis remap="it">FAQs</emphasis>. <literal remap="tt">:)</literal> ), etc.
</para>

<para>
Diríjase a la sede del INSFLUG para más información al respecto.
</para>

<para>
En la sede del INSFLUG encontrará siempre las <emphasis remap="bf">últimas</emphasis> versiones 
de las traducciones:  <literal remap="tt"><ulink
url="www.insflug.org"
>www.insflug.org</ulink
></literal>. Asegúrese de comprobar cuál es la última versión 
disponible en el Insflug antes de bajar un documento de un servidor réplica.
</para>

<para>
Se proporciona también una lista de los servidores
réplica (<emphasis remap="it">mirror</emphasis>) del Insflug más cercanos a Vd.,  
e información relativa a otros recursos en castellano.
</para>

<para>
Francisco José Montilla, <literal remap="tt"><ulink
url="mailto:pacopepe@insflug.org"
>pacopepe@insflug.org</ulink
></literal>.
</para>

</sect1>

</article>
