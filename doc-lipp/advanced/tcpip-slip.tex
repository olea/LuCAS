% Linux Installation and Getting Started    -*- TeX -*-
% tcpip.tex
% Copyright (c) 1992, 1993 by Matt Welsh <mdw@sunsite.unc.edu>
%
% This file is freely redistributable, but you must preserve this copyright
% notice on all copies, and it must be distributed only as part of "Linux
% Installation and Getting Started". This file's use is covered by the
% copyright for the entire document, in the file "copyright.tex".
%
% Copyright (c) 1998 by Specialized Systems Consultants Inc.
% <ligs@ssc.com>
%
% Traduccion realizada por Juan Jose Amor. Envie sus comentarios a:
%            Juan Jose Amor, 2:341/12.19 (FidoNet)
%            jjamor@gedeon.ls.fi.upm.es (InterNet)
% $Log: tcpip-slip.tex,v $
% Revision 1.13  2003/07/19 07:14:40  joseluis.ranz
% Correcciones varias.
%
% Revision 1.12  2002/09/28 21:12:19  montuno
% Yo no he modificado tantos ficheros.
%
% Revision 1.11  2002/09/19 20:28:58  pakojavi2000
% Modificaciones menores
%
% Revision 1.10  2002/09/09 16:50:46  pakojavi2000
% Corrección de fallos pequeños
%
% Revision 1.9  2002/07/25 02:08:22  pakojavi2000
% Beta 2.1
%
% Revision 1.8  2002/07/21 00:56:45  pakojavi2000
% Beta2.1
%
% Revision 1.7  2002/07/19 16:53:55  pakojavi2000
% Beta 1
%
% Revision 1.6  2002/07/15 03:17:32  pakojavi2000
%  Corregida la corrección de Cancerbero. Gold
%
% Revision 1.5  2002/07/14 20:27:55  cancerbero
% arreglados errores de formato
%
% Revision 1.4  2002/07/13 11:08:13  pakojavi2000
% Gold version
%
% Revision 1.3  2002/07/13 09:48:04  pakojavi2000
% Nuevo makefile
%
% Revision 1.2  2002/07/07 10:19:11  pakojavi2000
% Más correcciones
%
% Revision 1.1  2000/11/13 16:38:29  montuno
% Se añade la traduccion.
%
% Revision 0.5.0.1  1996/02/10 23:45:06  rcamus
% Primera beta publica
%
%
% Oct 1999 Traducción de la versión 2 realizada por David Gaya.
%          david@generalsistemas.es, dgaya@hotmail.com, david_gaya@yahoo.com
%
%Revision 5 de julio 2002 por Francisco Javier Fernandez <jm@hal9000.eui.upm.es>
%Revisión 6 el 13 de julio de 2002 pof JFS <serrador@arrakis.es>
%gold
%Revisión de índices
\section{Redes TCP/IP}
\label{sec-tcpip}
\markboth{Redes}{Redes TCP/IP}
\index{redes!TCP/IP|(}
\index{TCP/IP|(}

{\linux} soporta una implementación completa de los protocolos de red
TCP/IP (Transport Control Protocol/Internet Protocol). TCP/IP ha
resultado ser hasta ahora el mejor mecanismo de comunicación entre
ordenadores de todo el mundo. Con {\linux} y una tarjeta Ethernet podrá
conectar su máquina a una red local o (si se tienen las conexiones
apropiadas) a la Internet, la red TCP/IP de ámbito mundial.

Poner en marcha una pequeña red local de máquinas Unix es fácil. Sólo
requiere una tarjeta Ethernet en cada máquina y los cables adecuados
así como hardware accesorio (terminadores, etc). Y si su universidad o
empresa tiene acceso a Internet, podrá conectar su máquina {\linux} en
esta red.

\index{TCP/IP!implementación de NET-3}
\index{NET-3}
\index{redes!NET-3}
La implementación actual de TCP/IP y los protocolos relacionados para
{\linux} se llama ``NET-3'', anteriormente se llamaba ``NET-2''. No tiene
que ver con la versión NET-2 para BSD Unix. En realidad, se refiere a que
es la segunda implementación de TCP/IP que se hace para {\linux}.

\index{NET-3!soporte para protocolo de línea serie (SLIP)}
\index{SLIP}
\index{redes!SLIP}
\index{Protocolo de línea serie}
\index{Protocolos!linea serie|(}
\index{Protocolos!SLIP|(}
NET-3 de {\linux} soporta también SLIP (Serial Line Internet Protocol)
y PPP (Point to Point Protocol). SLIP y PPP le permiten disponer de
acceso telefónico a Internet con un módem. Si su universidad o
empresa proporciona accesos por SLIP o PPP, podrá llamar desde su
casa al servidor SLIP o PPP y conectarse así a la Red. Recíprocamente,
si tiene una máquina {\linux} con acceso a Internet a través de una
Ethernet y con un módem, podrá configurar {\linux} como un servidor
SLIP o PPP.

Para obtener más información sobre la configuración de TCP/IP en {\linux}, le
animamos a que lea el documento NET-3 HOWTO, disponible mediante
FTP anónimo en {\tt sunsite.unc.edu}. Se trata de una guía completa de
configuración de TCP/IP, que incluye conexiones mediante Ethernet, SLIP
y PPP. Otro documento relacionado es el Ethernet HOWTO, que se centra en
cómo configurar diversos modelos de tarjetas Ethernet.
Además, en el Proyecto de Documentación de {\linux}, al que pertenece este
libro, se ha desarrollado otro sobre este tema, {\em Guía del Administrador de Redes Linux (garl)}. Vea, para más información el
apéndice~\ref{app-sources-num} y el Apéndice~\ref{app-tldpes}.

Otro libro interesante es {\em TCP/IP Network Administration},
de Craig Hunt. Contiene información completa acerca del uso y la
configuración de TCP/IP en máquinas Unix.

\subsection*{Hardware necesario.}
\index{TCP/IP!requerimientos hardware}
Puede utilizar TCP/IP para {\linux} sin ningún hardware de red configurando el modo
``bucle local'' con la que se puede hablar con uno mismo. Hay algunos programas que necesitan
conexiones de red en``bucle local'' para funcionar.

\index{ethernet!tarjetas soportadas}
\index{hardware!tarjetas ethernet}
\index{redes!tarjetas ethernet, soportadas}
Sin embargo, si quiere usar {\linux} en una red TCP/IP Ethernet,
necesitará una tarjeta Ethernet. Están soportadas las tarjetas más comunes
como 3com 3c503, HP PCLAN (27245 y las series 27xxx), Western Digital WD80x3,
y Novell NE2000/NE1000 al igual que muchas más. Si quiere más detalles
consulte los CÓMOS sobre Ethernet y sobre el hardware soportado.

Hay algunos casos especiales a tener en cuenta con las tarjetas soportadas:
1) Algunas tarjetas están soportadas pero ofrecen un rendimiento pobre o tienen
algunas restricciones. Esto sucede, por ejemplo, con la 3Com 3C501 que funciona pero 
con un horrible rendimiento y con la Racal-Interlan NI6510 que utiliza el chip am7990
la cual no funciona con más de 16 megas de RAM. Igualmente, muchas tarjetas que son 
clónicas compatibles con NE1000/NE2000 pueden tener distintos problemas. Consulte 
los CÓMOS sobre Ethernet de {\linux} si desea una discusión completa acerca de la 
compatibilidad del hardware Ethernet.

{\linux} también soporta SLIP y PPP, que permiten utilizar un módem para acceder a
Internet a través de una línea telefónica. En este caso, necesitará un módem compatible
con su servidor SLIP o PPP; la mayoría de servidores necesitan un módem a 14,4bps V32bis
como mínimo. Se obtiene un mayor rendimiento con módems a 33.6bps o superiores.

\subsection{Configuración de TCP/IP en su sistema}

\index{TCP/IP!configuración}
En esta sección intentaremos explicar cómo configurar una conexión
TCP/IP con Ethernet. Nótese que este método tendría que funcionar en muchos
sistemas, pero no en todos. Nuestra explicación debería ser suficiente
para aclararle el camino en la configuración de los parámetros de red de su máquina,
pero hay además otros trucos y detalles que no mencionaremos aquí.
Le aconsejamos que consulte los documentos {\em Guía del Administrador de Redes {\linux}}
 y NET-3 HOWTO para más
información.\footnote{Algunas de las cosas que aquí se exponen
proceden del documento NET-3 HOWTO de Terry Dawson y Matt Welsh.} 

En primer lugar, vamos a asumir que su sistema {\linux} ha sido instalado
con el software TCP/IP. Esto incluye clientes básicos como {\tt telnet} y {\tt
ftp}, órdenes de administración del sistema como {\tt ifconfig} y {\tt route}
(que suelen estar en {\tt /etc}) y ficheros de configuración de red,
como {\tt /etc/hosts}. Los documentos adicionales que hemos mencionado anteriormente
explican cómo instalar todo ese software si aún no lo ha hecho.

También vamos a suponer que el núcleo se ha configurado y compilado habilitando el soporte
TCP/IP. Vea la sección~\ref{sec-sysadm-upgrade} para informarse de
cómo recompilar el núcleo. Para incluir el soporte de red, tendrá que
contestar afirmativamente a la pregunta correspondiente que se le hará
durante la instrucción {\tt make config}, y a continuación recompilar el núcleo.

Una vez hecho esto, se deben modificar algunos ficheros de configuración
que usa NET-3. Esta parte suele ser bastante simple. Lamentablemente hay
bastante desacuerdo entre las distribuciones de {\linux} sobre dónde deben ir 
los distintos ficheros de configuración y programas de soporte de TCP/IP.
Normalmente pueden encontrarse en {\tt /etc}, pero en otros casos están en {\tt /usr/etc}
{\tt /usr/etc/inet} o incluso en lugares más rebuscados. En el peor caso tendrá que usar
la orden  {\tt find} para localizar los ficheros. Tenga en cuenta también que no todas
las distribuciones mantienen los ficheros y software de NET-3 en el mismo sitio y pueden
estar esparcidos en varios directorios.

Lo siguiente es fundamentalmente aplicable a conexiones Ethernet. Si
lo que va a usar es SLIP o PPP, léase esta sección para ir entendiendo los
conceptos y luego vea las instrucciones específicas en las secciones siguientes.

\subparagraph*{La configuración de red.}

\index{TCP/IP!configuración}
Antes de configurar su sistema con TCP/IP necesita conocer cierta
información sobre la red. En muchos casos, el administrador local se
la proporcionará.
\begin{itemize}
\index{TCP/IP!dirección IP}
\index{dirección IP !definición}
\item Dirección IP. Es la dirección exclusiva de cada máquina, formada por
          números separados por puntos. Por ejemplo, 128.253.153.54. El
          administrador de red le dará este número.

          Si sólo está configurando el modo ``bucle local'' (o sea sin SLIP ni 
          Ethernet, únicamente conexiones TCP/IP a su propia máquina)
          su dirección IP será 127.0.0.1.         

\index{TCP/IP!máscara de red}
\index{máscara de red!definición}
\item Máscara de red \NT{netmask}. Es un número similar a la
dirección IP, que determina qué parte de la dirección IP determina el
número de sub-red, y qué parte especifica el {\it host} en la
sub-red (si tiene dudas sobre estos conceptos de redes TCP/IP le recomendamos
que lea alguna introducción a la administración de redes).

  La máscara de red es un patrón de bits, que al ser superpuesto a una
  dirección de la red, le dirá en qué sub-red se encuentra esa
  dirección. Esto es muy importante para el enrutado y, si usted nota
  que puede comunicar con gente de redes externas pero no con gente de
  su misma red, hay muchas probabilidades que tenga mal puesta la máscara.

  Los administradores de la red habrán seleccionado las máscaras de red
  cuando se diseñó la red, y serán quienes deban darle la máscara correcta
  a utilizar. La mayoría de redes son subredes de clase C las cuales usan la máscara
  255.255.255.0. Las redes de clase B usan 255.255.0.0. El código de NET-3
  seleccionará automáticamente, si usted no especifica ninguna, una máscara
  que asume que no hay subred.

  Todo esto debe aplicarse también al puerto del
  ``bucle local''. Dado que la dirección del ``bucle local'' es siempre
  127.0.0.1, la máscara siempre será 255.0.0.0. Puede especificarla de forma
  explícita o dejar que el sistema ponga la predeterminada.

\index{TCP/IP!dirección de red}
\index{dirección de red!definición}
\item Dirección de red. Es el resultado de la operación lógica AND
entre su dirección IP y la máscara. Por ejemplo, si su dirección IP es
128.253.154.32 y la máscara es 255.255.255.0, su dirección de red
es 128.253.154.0. Con una máscara 255.255.0.0, la dirección sería
128.253.0.0.

Si utiliza sólo la configuración en ``bucle local'', la
dirección de red no existe.

\index{TCP/IP!dirección de broadcast}
\index{dirección de broadcast!definición}
\item Dirección de ``broadcast''. Se utiliza para emitir paquetes que
deben recibir todas las máquinas de la subred. Así pues, si el número
de {\it host} de la subred se obtiene mediante el último octeto de la
dirección IP (o sea, la máscara es 255.255.255.0), su dirección de
``broadcast'' será su dirección de red operado un OR con 0.0.0.255.

  Por ejemplo, si su número IP es 128.253.154.32, y la máscara es
  255.255.255.0, la dirección de ``broadcast'' sería la 128.253.154.255. 

  Observe que por motivos {\it históricos}, algunas subredes están
  configuradas para usar la dirección de red como dirección de
  ``broadcast''. Si tiene dudas, consulte con el administrador de la
  red. En muchos casos, bastará con copiar la configuración que tengan
  otras máquinas de la subred y cambiar únicamente el valor IP, por supuesto.

  La dirección ``broadcast'' tampoco tiene utilidad en una
  configuración en ``bucle local''.

\index{TCP/IP!dirección de pasarela}
\index{dirección de pasarela!definición}
\index{gateway!definición}
\item Dirección de pasarela. Se trata de la dirección de la máquina
          que va a ser su puerta al mundo exterior (el resto de máquinas que
          no están en su misma subred) . Muchas veces es la misma dirección IP 
          que la suya, sólo que terminada en ``.1''. Por ejemplo, si su dirección
          IP es 128.253.154.32, la de la pasarela podría ser la 128.253.154.1. El
          administrador se la dirá en cualquier caso.

          En realidad se puede tener varias pasarelas. Una pasarela o {\em
          gateway} es simplemente una máquina que se encuentra a la vez en dos
          subredes (tiene una dirección IP por cada una), y direcciona los paquetes
          entre ellas. En muchas subredes existe una sola pasarela para
          comunicarse con las redes externas, pero en otras hay varias, una para
          cada subred adyacente.

          Si su red está aislada de otras, o su máquina se encuentra en
          configuración de ``bucle local'', no necesitará dirección de pasarela.

\index{TCP/IP!name server address}
\index{name server address!definición}
\item Dirección del servidor de nombres. Suele existir un servidor que
          traduce nombres de máquinas a direcciones IP. El administrador
          le facilitará la dirección del servidor de nombres. También
          puede ejecutar en su propia máquina un servidor de nombres con
          el programa {\tt named}, en cuyo caso la dirección del servidor
          de nombres será la 127.0.0.1. A menos que realmente lo necesite, le
          recomendamos que procure siempre usar otra máquina distinta. La
          configuración de {\tt named} es otro tema; y lo primordial aquí
          es que comunique con la red. Puede tratar estos asuntos más tarde.

          En una configuración de ``bucle local'' no es necesario un servidor de 
          nombres.
          
\end{itemize}

Nota para usuarios de SLIP/PPP: La información anterior puede necesitarla
o no. Cuando use SLIP su dirección IP será determinada de dos formas:
bien ``estática'', lo que significa que será siempre la misma, o bien
``dinámica'', lo que indica que le será asignada una de las
disponibles cada vez que conecte con el servidor SLIP. En la sección
sobre SLIP ampliaremos el tema.

        NET-3 implementa enrutado completo, múltiples rutas, subredes (actualmente
        sólo las limitadas por bytes) etc. Lo anterior describe
        las configuraciones de TCP/IP más básicas. Pero la suya puede
        ser diferente: cuando tenga alguna duda, consulte a los gurús de
        la red, y eche un vistazo a las páginas de manual para {\tt route} e
        {\tt ifconfig}. La configuración completa de redes TCP/IP supera
        ampliamente las intenciones de este libro, y con lo anterior sólo
        pretendemos posibilitar que todo el mundo pueda poner en marcha su
        sistema en una red ya configurada.

\subparagraph*{Los ficheros {\tt rc} para trabajo en redes}
\index{TCP/IP!scripts de configuración}
\index{script de configuración!TCP/IP}
\index{ficheros rc@{\tt rc}}
Los ficheros {\tt rc} son scripts de configuración general del sistema.
Son ejecutados por el proceso {\tt init}, y ponen en marcha los {\it demonios}
básicos (como {\tt sendmail}, {\tt cron} etc.) y además configuran
parámetros de la red como la dirección IP y el nombre del {\it host}.
Los ficheros {\tt rc} suelen estar en el directorio {\tt /etc/rc.d}, pero hay
sistemas en que están en {\tt /etc}. En general las distribuciones Slackware 
usan los ficheros {\tt rc.inet1} etc. en {\tt /etc/rc.d} mientras que las 
distribuciones RetHat usan un conjunto de subdirectorios.

\index{ficheros!rc@{\tt rc}!para TCP/IP}
\index{TCP/IP!rc.inet1@{\tt rc.inet1}}
\index{rc.inet1@{\tt rc.inet1}}
\index{TCP/IP!rc.inet2@{\tt rc.inet2}}
\index{rc.inet2@{\tt rc.inet2}}
Lo que vamos a hacer aquí es describir los ficheros {\tt rc} que
configuran TCP/IP. Son dos: {\tt rc.inet1} y {\tt rc.inet2}. El primero
configura parámetros básicos de la red (como direcciones IP
e información de enrutado). El segundo lanza los demonios TCP/IP
({\tt telnetd} {\tt ftpd} y demás).

\index{TCP/IP!rc.inet@{\tt rc.inet}}
\index{rc.inet@{\tt rc.inet}}
\index{TCP/IP!rc.net@{\tt rc.net}}
\index{rc.net@{\tt rc.net}}
En muchos sistemas se juntan los dos ficheros en uno, el {\tt rc.inet}
o {\tt rc.net}. No tiene importancia el nombre concreto de los ficheros 
{\tt rc}, siempre que realicen las funciones correctas y que sean ejecutados
durante el arranque por {\tt init}. Para conseguirlo, puede que tenga que
editar {\tt /etc/inittab} y quitar los comentarios de las líneas que ejecutan
los ficheros {\tt rc}. En el peor caso tendría usted que crear desde cero
los ficheros {\tt rc.inet1} y {\tt rc.inet2} y añadir las entradas adecuadas 
en el fichero {\tt inittab}.

Como hemos dicho, {\tt rc.inet1} configura los parámetros básicos de
red. Esto incluye el número IP y la dirección de red, y la tabla de
rutado. Estas tablas se usan para rutar los datagramas entrantes y
salientes de otras máquinas. En el caso más simple existen tres rutas: una
para enviar paquetes a su propia máquina, otra para enviarlos a otras
máquinas de la subred y una tercera para enviarlos a máquinas de otras
subredes (a través de la pasarela). Para configurar esto se usan los
programas {\tt ifconfig} y {\tt route}, programas que suelen estar en
{\tt /etc}.

\index{TCP/IP!ifconfig@{\tt ifconfig}}
\index{ifconfig@{\tt ifconfig}}
\index{route@{\tt route}}
\index{TCP/IP!route@{\tt route}}
{\tt ifconfig} se utiliza para configurar la interfaz de dispositivo de
red con los parámetros que necesita, como la dirección IP, la máscara,
dirección de {\it broadcast} y otros.
{\tt route}, por su lado, se utiliza para crear o modificar entradas de la
tabla de enrutado.

\index{rc.inet1@{\tt rc.inet1}!ejemplo}
\index{TCP/IP!rc.inet1@{\tt rc.inet1}!ejemplo}
Para muchas configuraciones, el siguiente {\tt rc.inet1} puede valer.
Aunque, por supuesto, necesitará editarlo para adecuarlo a su sistema.
{\em No\/} utilice las direcciones IP y de red del ejemplo para su propio sistema;
estas corresponden a una máquina real de Internet.

\begin{tscreen}\begin{verbatim}
#!/bin/sh
# Este fichero es /etc/rc.d/rc.inet1 -- Configuración de las interfaces TCP/IP

# Primero, configurar el dispositivo bucle local

HOSTNAME=`nombre_de_host`

/etc/ifconfig lo 127.0.0.1      # utiliza la máscara de red por omisión 255.0.0.0
/etc/route add 127.0.0.1        # ruta que apunta al dispositivo bucle local

# Siguiente paso, configurar el dispositivo ethernet. Si usted sólo utiliza bucle local o
# SLIP, ponga comentarios al resto de estas líneas.

# Editar estos valores para su configuración.
IPADDR="128.253.154.32"         # SUSTITUYA con SU dirección IP.
NETMASK="255.255.255.0"         # SUSTITUYA con SU máscara de subred.
NETWORK="128.253.154.0"         # SUSTITUYA con SU dirección de red.
BROADCAST="128.253.154.255"     # SUSTITUYA con SU dirección de broadcast, si dispone.
                                # de una. Si no, dejar en blanco y editar la línea de abajo.
GATEWAY="128.253.154.1"         # SUSTITUYA con SU dirección de pasarela.

/etc/ifconfig eth0 ${IPADDR} netmask ${NETMASK} broadcast ${BROADCAST}

# Si no tiene dirección de broadcast, cambie la línea anterior por:
# /etc/ifconfig eth0 ${IPADDR} netmask ${NETMASK}

/etc/route add ${NETWORK}

# La línea siguiente sólo es necesaria si dispone de una pasarela; o sea que su red está
# conectada al mundo exterior.
/etc/route add default gw ${GATEWAY} metric 1

# Fin de la configuración Ethernet 
\end{verbatim}\end{tscreen}

% Esto es de emacs $

Quizás tenga que estudiarse un poco más el tema para su instalación
particular, aunque en la mayor parte de los casos el fichero anterior
será suficiente.

\index{rc.inet2@{\tt rc.inet2}}
\index{inetd@{\tt inetd}}
\index{TCP/IP!inetd@{\tt inetd}}
{\tt rc.inet2} arranca servidores usados por TCP/IP. El más importante
es {\tt inetd}. {\tt Inetd} queda en segundo plano y escucha por varios
puertos de la red. Cuando una máquina intenta conectarse por uno de
ellos (por ejemplo, por el de {\tt telnet}), {\tt inetd} arranca una
copia del servidor correspondiente a ese puerto (para {\tt telnet}
arranca {\tt in.telnetd}). Esto es mejor que mantener en
ejecución todos los servidores de red necesarios (múltiples copias de
{\tt telnetd}, {\tt ftpd} y demás). {\tt inetd} arranca los demonios
conforme se van necesitando.

\index{TCP/IP!syslogd@{\tt syslogd}}
\index{syslogd@{\tt syslogd}}
\index{routed@{\tt routed}}
\index{TCP/IP!routed@{\tt routed}}
{\tt Syslogd} es el demonio de registro del sistema. Se ocupa de acumular
los mensajes de registro generados por diversas aplicaciones almacenándolos
en ficheros de registro según las instrucciones del fichero {\tt
/etc/syslogd.conf}.
{\tt routed} es un servidor que se ocupa de la información de enrutado dinámica.
Cuando su sistema intenta enviar paquetes a otra red, puede requerir nuevas
entradas en las tablas de enrutado.
{\tt routed} se encarga de manipular la tabla de enrutado sin necesidad de intervención
del usuario.

\index{redes!NFS}
\index{NFS}
El ejemplo de {\tt rc.inet2} siguiente sólo arranca un número mínimo de
servidores. Existen otros servidores que pueden interesarle, todos ellos
relacionados con NFS. Cuando instale TCP/IP en su sistema, es mejor empezar
con una configuración sencilla y luego ir añadiendo partes más complicadas
(como NFS) a medida que funcionan las anteriores.

Observe que en el fichero siguiente se asume que los servidores de red
se encuentran en {\tt /etc}. Como es normal, tiene que editar este fichero
para adecuarlo a su propia configuración.

\index{rc.inet2@{\tt rc.inet2}!ejemplo}
\index{TCP/IP!rc.inet2@{\tt rc.inet2}!ejemplo}
\begin{tscreen}\begin{verbatim}
#! /bin/sh
# Ejemplo de /etc/rc.d/rc.inet2

# Arrancar syslogd
if [ -f /etc/syslogd ]
then
      /etc/syslogd
fi

# Arrancar inetd
if [ -f /etc/inetd ]
then
      /etc/inetd
fi

# Arrancar routed
if [ -f /etc/routed ]
then
      /etc/routed -q
fi

# Hecho!
\end{verbatim}\end{tscreen}

\index{TCP/IP!named@{\tt named}}
\index{named@{\tt named}}
Otro servidor que puede interesarle arrancar desde {\tt rc.inet2} es
{\tt named}. {\tt named} es un servidor de nombres, que traducirá
nombres (locales) a direcciones IP y viceversa. Si no hay servidor de
nombres en su subred o quiere proporcionar nombres nuevos a la misma,
necesitará arrancar {\tt named} (sin embargo para la mayoría de 
configuraciones no es necesario).
La configuración de {\tt named} es un poco compleja y requiere cierto cuidado y
planificación, por lo que le recomendamos consultar bibliografía
específica.

\subparagraph*{El fichero {\tt /etc/hosts}}
\index{TCP/IP!/etc/hosts@{\tt /etc/hosts}}
\index{/etc/hosts@{\tt /etc/hosts}}
{\tt /etc/hosts} contiene una lista de direcciones IP y nombres de
máquinas que les corresponden. En general, {\tt /etc/hosts} sólo
contiene entradas para su máquina y quizás alguna otra ``importante'',
como servidores de nombres o pasarelas. El servidor de nombres local
convierte automáticamente los nombres de otras máquinas a su dirección IP.

Por ejemplo, si su máquina es {\tt loomer.vpizza.com} con la dirección
IP 128.253.154.32, su {\tt /etc/hosts} sería como este:
\begin{tscreen}\begin{verbatim}
127.0.0.1               localhost
128.253.154.32          loomer.vpizza.com loomer
\end{verbatim}\end{tscreen}
Si solo usa el ``bucle local'', la única línea necesaria en {\tt /etc/hosts} es la que tiene
el número 127.0.0.1, añadiendo tras {\tt localhost} el nombre de su máquina.

\subparagraph*{El fichero {\tt /etc/networks}}
\index{TCP/IP!/etc/networks@{\tt /etc/networks}}
\index{/etc/networks@{\tt /etc/networks}}
El fichero {\tt /etc/networks} contiene los nombres y las direcciones de su red y otras.
Es usado por la orden {\tt route} y permite, si lo desea, referirse a las redes por nombre.

\index{route@{\tt route}!entrada en /etc/networks@entrada en {\tt /etc/networks}}
Cada subred para la que quiera añadir una ruta con el mandato {\tt route}
(generalmente llamado desde {\tt rc.inet1} como se ha descrito antes) 
{\em debe aparecer\/} en el fichero {\tt /etc/networks}.

Por ejemplo,
\begin{tscreen}\begin{verbatim}
default         0.0.0.0         # enrutado por omisión - obligatorio
loopnet         127.0.0.0       # red de 'bucle local' - obligatorio 
mynet           128.253.154.0   # Ponga aqui su direccion de red  
\end{verbatim}\end{tscreen}

\subparagraph*{El fichero {\tt /etc/host.conf}}
\index{TCP/IP!/etc/host.conf@{\tt /etc/host.conf}}
\index{/etc/host.conf@{\tt /etc/host.conf}}
Este fichero dice a su sistema cómo resolver los nombres de los {\it
hosts}. Debe contener dos líneas:
\begin{tscreen}\begin{verbatim}
order hosts,bind
multi on
\end{verbatim}\end{tscreen}
Estas líneas indican a los mecanismos de resolución que empiecen
buscando en el fichero {\tt /etc/hosts} y luego pregunten al servidor
de nombres, si existe. La entrada {\tt multi} permite que para un
nombre de máquina haya varias direcciones IP en {\tt /etc/hosts}.

\subparagraph*{El fichero {\tt /etc/resolv.conf}}
\label{sec-resolve.conf}
\index{TCP/IP!/etc/resolve.conf@{\tt /etc/resolve.conf}}
\index{/etc/resolve.conf@{\tt /etc/resolve.conf}}
En este fichero se configura el mecanismo de resolución, especificando
la dirección del servidor de nombres (si existe) y el nombre del dominio de su
máquina. El nombre de dominio es el nombre de host completamente calificado
(si su máquina tiene un nombre Internet registrado)
pero cortando el nombre de host. O sea, si su máquina se llama
{\tt loomer.vpizza.com}, el dominio es simplemente {\tt vpizza.com}.

Por ejemplo, si su máquina es {\tt goober.norelco.com}, y dispone de un servidor
de nombres en la dirección 128.253.154.5, su {\tt /etc/resolv.conf} tendría
este aspecto:
\begin{tscreen}\begin{verbatim}
domain      norelco.com
nameserver  127.253.154.5
\end{verbatim}\end{tscreen}
        Con líneas {\tt nameserver} adicionales podrá especificar la
        existencia de varios servidores de nombres.

\subparagraph*{Ajuste del nombre de su host}
\index{nombre del host}
\index{hostname@{\tt hostname}}
Para establecer el nombre de su {\it host} debería usar la orden {\tt
hostname}. Esto suele hacerse desde el fichero {\tt /etc/rc} o {\tt
/etc/rc.local}. Busque en sus ficheros {\tt rc} y localice desde dónde 
se llama. Por ejemplo, si su nombre de host completo es {\tt loomer.vpizza.com},
edite el archivo {\tt rc} correspondiente para que ejecute el mandato:
\begin{tscreen}
/bin/hostname loomer.vpizza.com
\end{tscreen}
Tenga en cuenta que el ejecutable {\tt hostname} puede no encontrarse en el 
directorio {\tt bin} de su sistema.

\subparagraph*{A ver si funciona.}
\index{TCP/IP!problemas}
Una vez que haya puesto a punto los ficheros anteriores, debería
reiniciar {\linux} e intentar utilizar la red. Hay muchos sitios donde las
cosas pueden fallar, por lo que es mejor probar partes independientes de
la configuración de red (no es una buena idea probar la configuración
de la red ejecutando Mosaic a través de una conexión de red X).

\index{netstat@{\tt netstat}}
\index{TCP/IP!tablas de encaminamiento}
Con la orden {\tt netstat} puede ver las tablas de encaminamiento. Ésta
suele ser la principal fuente de problemas. En la página del manual
para esta instrucción encontrará detallada la sintaxis adecuada.
Para comprobar que funciona su conexión, le sugerimos probar un cliente como {\tt telnet}
para ver si puede conectarse a máquinas de su subred y de otras
redes. Esto le ayudará a delimitar el origen del problema. Por ejemplo, si
puede conectarse a máquinas de otras subredes pero no de la suya
propia, es más que probable que se trate de un problema con la máscara de red o las
tablas de encaminamiento. Ejecutando {\tt route} como {\tt root} podrá modificar
directamente las entradas de la tabla.

También debería hacer pruebas de conectividad utilizando direcciones IP directamente en 
lugar de nombres. Así, si tiene problemas para ejecutar
\begin{tscreen}
\$ telnet shoop.vpizza.com
\end{tscreen}
la causa puede ser una configuración incorrecta del servidor de
nombres. Si funciona usando la dirección IP, se puede casi asegurar
que el resto de la configuración está bien hecha y que el problema se
encuentra en la dirección del servidor de nombres.

La depuración de configuraciones de red puede ser tarea difícil, y no
podemos tratarla aquí. Le sugerimos, si no consigue otra ayuda, que
consulte el libro {\em Guía del Administrador de Redes Linux} de esta
misma serie.

\subsection{Configuración de SLIP}

\index{TCP/IP!sobre línea serie|(}
\index{protocolo de línea serie|(}
\index{SLIP|(}
\index{TCP/IP!SLIP|(}
El protocolo SLIP (Serial Line Internet Protocol\NT{Protocolo de línea serie}) permite utilizar TCP/IP
mediante una línea serie, como puede ser una línea telefónica con módem o
cualquier tipo de línea dedicada asíncrona. Por supuesto, para usar SLIP tiene que tener
acceso a un servidor SLIP. Muchas empresas y universidades
proporcionan acceso SLIP por poco dinero.

\index{dip@{\tt dip}}
\index{slattach@{\tt slattach}}
Existen principalmente dos programas relacionados con SLIP: {\tt dip} y {\tt
slattach}. Ambos se usan para iniciar una conexión SLIP sobre un
dispositivo serie. Es {\em necesario} utilizar uno de estos dos programas
para habilitar SLIP; no es suficiente con llamar al servidor SLIP con
programas como {\tt kermit} y después usar las instrucciones {\tt ifconfig}
y {\tt route}. 
Esto se debe a que {\tt dip} y {\tt slattach} realizan
una llamada del sistema {\em ioctl()\/} especial para hacerse con el control del
dispositivo serie y ponerlo a disposición de la interfaz de SLIP.

Con {\tt dip} puede llamarse a un servidor SLIP, hacer ciertas
negociaciones de entrada con el mismo (intercambio de usuario y
password, por ejemplo) y después iniciar la conexión SLIP. Por su
lado, {\tt slattach} se limita prácticamente a modificar la línea
serie para que la utilice SLIP, por lo que está indicado para líneas dedicadas que no
requieren interacción con el módem o ni ninguna negociación de protocolo. Casi todo el mundo, sin
embargo, usa {\tt dip}.

Con {\tt dip} también puede configurar su sistema {\linux} como servidor SLIP,
permitiendo a otras máquinas hacer una llamada telefónica y conectarse a la red a través de su módem
y su conexión Ethernet. Vea la documentación y los manuales en línea de {\tt dip} para
más información.

\index{TCP/IP!conexión punto a punto}
\index{TCP/IP!PPP}
\index{red!PPP}
\index{PPP}
A SLIP se le llama conexión ``punto a punto'' (point-to-point) pues a
ambos lados de la línea existen sólo las dos máquinas involucradas (no
como sucede en una ethernet). Esta idea se generaliza y mejora con el
protocolo PPP (point-to-point protocol) que también se ha portado a {\linux}.

Cuando inicia una conexión al servidor SLIP, se le asignará una
dirección IP, bien de forma ``estática'' (su dirección IP es siempre
la misma) o ``dinámica'' (su dirección puede ser diferente de un día
para otro). Por lo general, los valores de la dirección y pasarela
asignados serán impresos por el servidor SLIP al conectarse. El
programa {\tt dip} es capaz de capturar esos valores y configurar su
sistema para adaptarse a ellos.

Esencialmente, configurar una conexión SLIP es como configurar la
conexión en ``bucle local'' o con Ethernet. En las siguientes líneas
le mostramos las diferencias. Es importante que vea lo que hemos
explicado antes sobre configuración en general de TCP/IP, y aplique ahora las
modificaciones que le vamos a contar.

\subparagraph*{Conexiones SLIP con asignación de IP estática usando {\tt dip}}
\label{sec-adv-slip-dip}
\index{TCP/IP!SLIP!IP estática con dip@dirección IP estática con {\tt dip}}
\index{SLIP!dirección IP estática con dip@direccion IP estática con {\tt dip}}
\index{dip@{\tt dip}!direccion IP estática con}
Si su servidor SLIP le permite tener la dirección IP estática, lo más
adecuado es insertar la dirección y el nombre del {\it host} en el
fichero {\tt /etc/hosts}. Además, debería configurar los ficheros {\tt
rc.inet2}, {\tt host.conf} y {\tt resolv.conf} como se ha dicho antes.

Igualmente, configure el fichero {\tt rc.inet1} como se ha descrito antes.
Sin embargo, solo tiene que ejecutar {\tt ifconfig} y {\tt route} para el dispositivo
``bucle local'', puesto que {\tt dip} ya ejecutará las órdenes {\tt ifconfig}
y {\tt route} adecuadas para el dispositivo
SLIP. Pero si usa {\tt slattach} {\em sí tendrá\/} que incluir
órdenes {\tt ifconfig}/{\tt route} en {\tt rc.inet1} para el
dispositivo SLIP (en breve veremos cómo).

El programa {\tt dip} {\em debería\/} configurar sus tablas de enrutado
para la conexión SLIP. Sin embargo, puede no hacerlo bien, y tendrá
que corregirlo ejecutando por su cuenta {\tt ifconfig} o {\tt route}
cuando se haya conectado. Quizás le convenga entonces escribirse un
{\tt shell script} que lo haga automáticamente. En muchos casos, la
pasarela es el propio servidor SLIP. Puede que conozca la dirección con antelación
o que la imprima el servidor SLIP en el momento de la conexión.  De todas formas,
el script que utilice {\tt dip} (que detallamos a continuación) puede deducirlo 
de la información que envía el servidor SLIP.

Puede que necesite el argumento {\tt pointopoint} en {\tt ifconfig} si
ve que {\tt dip} no configura bien la interfaz. Por ejemplo, si la dirección
del servidor SLIP es 128.253.154.2 y la suya es 128.253.154.32, la orden
a ejecutar (como {\tt root}) podría ser:
\begin{tscreen}
ifconfig sl0 128.253.154.32 pointopoint 128.253.154.2
\end{tscreen}
ejecutado como {\tt root} y tras conectar con {\tt dip}.
La documentación en línea de esta orden le será útil.

\index{TCP/IP!SLIP!nombres de dispositivo para}
\index{SLIP!nombres de dispositivo para}
Observe que los nombres de dispositivo SLIP que se usan en {\tt ifconfig} y {\tt
route} son {\tt sl0}, {\tt sl1}, etc. (y no como en ethernet, que es
{\tt eth0}, {\tt eth1}, etc.)

En la sección posterior~\ref{sec-adv-using-dip} le explicaremos cómo
configurar {\tt dip} para conectarse a un servidor SLIP.

\subparagraph*{Conexiones SLIP con asignación de IP estática usando {\tt slattach}}
\index{TCP/IP!SLIP!direcciones IP estáticas con slattach@direcciones IP estáticas con {\tt slattach}}
\index{SLIP!direcciones IP estáticas con slattach@direcciones IP estáticas con {\tt slattach}}
\index{stattach@{\tt slattach}!direcciones IP estáticas con}
%If you have a leased line or cable running directly to your SLIP
%server, then there is no need to use {\tt dip} to initiate a connection.
%{\tt slattach} can be used to configure the SLIP device instead.
Si tiene una línea dedicada o un cable conectado directamente al
servidor SLIP, no es necesario usar {\tt dip} para iniciar la
conexión. En su lugar puede usar {\tt slattach} para configurar el dispositivo
SLIP.

En este caso, el fichero {\tt /etc/rc.inet1} puede quedar como sigue:
\begin{tscreen}\begin{verbatim}
#!/bin/sh
IPADDR="128.253.154.32"         # Ponga aqui su direccion IP          
REMADDR="128.253.154.2"         # Ponga aqui la del servidor de SLIP  

# Modifique lo siguiente para su dispositivo serie adecuado a la
# conexión SLIP:
slattach -p cslip -s 19200 /dev/ttyS0
/etc/ifconfig sl0 $IPADDR pointopoint $REMADDR up
/etc/route add default gw $REMADDR
\end{verbatim}\end{tscreen}
% Esto es de emacs $
{\tt slattach} asigna el primer dispositivo SLIP disponible ({\tt
sl0},{\tt sl1}, etc.) a la línea serie especificada.

Observe que el primer parámetro de {\tt slattach} es el protocolo SLIP
a utilizar. Actualmente solo valen {\tt slip} y {\tt cslip}. 
{\tt slip} es el SLIP normal, y {\tt cslip}
es un SLIP que incluye compresión de las cabeceras de los
datagramas. Por ello su elección habitual será cslip a menos que tenga
algún problema con esta conexión.

Si tiene más de una interfaz SLIP tendrá que tener en cuenta algunas cosas
respecto al enrutado. Tiene que decidir qué rutas añadir, y esto debe
hacerse en función de la configuración de la red a la que se
conecte. Le serán de ayuda los libros sobre configuración de TCP/IP,
la documentación en línea de la orden {\tt route}, etc.

\subparagraph*{Conexiones SLIP con asignación de IP dinámica usando {\tt dip}.}

\index{TCP/IP!SLIP!direcciones IP dinámicas con dip@direcciones IP dinámicas con {\tt dip}}
\index{SLIP!direcciones IP dinámicas con dip@direcciones IP dinámicas con {\tt dip}}
\index{dip@{\tt dip}!direcciones IP dinámicas con diph}
Si el servidor SLIP le asigna dinámicamente las direcciones IP, no
sabrá, evidentemente, su dirección IP antes de conectarse, con lo que
no puede incluir esa información en {\tt /etc/hosts} (aunque sí
incluirá la información del ``bucle local'', 127.0.0.1).

Muchos servidores SLIP envían al terminal la dirección IP y la del
propio servidor. Por ejemplo, un servidor SLIP podría decirle esto al
conectarse:
\begin{tscreen}
Your IP address is 128.253.154.44. \\
Server address is 128.253.154.2.
\end{tscreen}
{\tt dip} puede capturar estos números devueltos por el servidor y utilizarlos
para configurar el dispositvo SLIP.

Vea la sección~\pageref{sec-adv-slip-dip} para informarse sobre la
configuración de los ficheros de TCP/IP para utilizar con SLIP. Ahora le indicaremos
cómo se configura {\tt dip} para conectarse al servidor SLIP.

\subsection*{Utilización de {\tt dip}}
\label{sec-adv-using-dip}

\index{dip@{\tt dip}!conexión con un servidor SLIP|(}
\index{SLIP!conexión con un servidor con dip@conexiona un servidor con {\tt dip}}
%{\tt dip} can simplify the process of connecting to a SLIP server,
%logging in, and configuring the SLIP device. Unless you have a leased
%line running to your SLIP server, {\tt dip} is the way to go.
{\tt dip} puede facilitar el proceso de conexión a un servidor SLIP,
pues se ocupará de entrar en el sistema remoto y configurar el
dispositivo SLIP. Este programa es el más indicado a menos que
su línea sea dedicada.

\index{dip@{\tt dip}!script chat para|(}
Para utilizar {\tt dip} tendrá que escribir un ``script'' que
contendrá órdeness para comunicar con el servidor SLIP durante la
entrada en el sistema remoto. Por ejemplo, incluirá envío automático
de usuario y contraseña al servidor así como lo necesario para obtener 
su la dirección IP desde el servidor.

Lo que sigue es un ejemplo de script {\it dip} para asignación dinámica de
dirección IP. Para asignación estática tendrá que poner al principio del
script los valores fijos de las direcciones IP en las variables {\tt \$local} y
{\tt \$remote}. Vea la página de manual de {\tt dip} para más información.

\begin{tscreen}\begin{verbatim}
main:
  # MTU es 'Maximum Transfer Unit' o tamaño máximo de los paquetes
  # transmitidos por el dispositivo SLIP. En muchos servidores este
  # valor debe ser 1500 o 1506. Hable con el administrador de la red
  # si no está seguro.
  get $mtu 1500

  # Hacer que el enrutado de SLIP sea el de su sistema por omisión.
  default

  # Elegir puerto serie y velocidad.
  port cua03
  speed 38400

  # Reiniciar el modem y la linea del terminal. Si le da problemas,
  # comente la linea.
  reset

  # Preparar para hacer la llamada. Sustituya la línea siguiente
  # con la cadena de inicialización del módem.
  send ATT&C1&D2\\N3&Q5%M3%C1N1W1L1S48=7\r
  wait OK 2
  if $errlvl != 0 goto error
  # Llamada al servidor SLIP. Ponga aquí el número de teléfono
  dial 2546000
  if $errlvl != 0 goto error
  wait CONNECT 60
  if $errlvl != 0 goto error

  # Ahora estamos conectados. Hay que entrar en el sistema.
login:
  sleep 3
  send \r\n\r\n
  # Esperar la solicitud de entrada (login:)
  wait login: 10
  if $errlvl != 0 goto error

  # Enviar el nombre de usuario
  send USERNAME\n

  # Esperar la solicitud de contraseña (password)
  wait ord: 5
  if $errlvl != 0 goto error

  # Enviar la contraseña
  send PASSWORD\n

  # Esperar la confirmación del servidor SLIP de que está preparado
  wait annex: 30
  if $errlvl != 0 goto error

  # Enviar instrucciones al servidor para iniciar la conexión SLIP
  send slip\n
  wait Annex 30

  # Obtener la direccion IP desde el servidor. La orden 'get...remote'
  # lee un texto de la forma xxx.xxx.xxx.xxx y lo asigna a la variable
  # dada como segundo argumento (aqui es $remote).
  get $remote remote
  if $errlvl != 0 goto error
  wait Your 30

  # Obtener la direccion local IP desde el servidor y asignarla a $local.
  get $local remote
  if $errlvl != 0 goto error

  # Lanzar la conexión SLIP
done:
  print CONECTADO a $remote en $rmtip
  print La dirección de PASARELA es $rmtip
  print La dirección LOCAL es $local
  mode SLIP
  goto exit
error:
  print Conexión SLIP a $remote ha fallado.

exit:
\end{verbatim}\end{tscreen}

{\tt dip} ejecuta automáticamente las órdenes {\tt ifconfig} y {\tt
route} según los valores asignados a las variables {\tt \$local} y {\tt
\$remote}. Aquí, estas variables son asignadas con la orden {\tt
get\ldots remote}, que obtiene el texto del servidor SLIP y lo asigna
a la variable.

Si las órdenes {\tt ifconfig} y {\tt route} que {\tt dip} ejecuta no
funcionan, siempre puede llamarlas por su cuenta desde un guión de shell
tras ejecutar {\tt dip} o modificar las fuentes del propio {\tt dip}.
Con la opción {\tt -v} {\tt dip} dará información de depuración
generada durante la conexión y le ayudará a averiguar las causas del
problemas.

Ahora, para ejecutar {\tt dip} y abrir la conexión SLIP, escriba una
orden como:
\begin{tscreen}
\verb!/etc/dip/dip -v /etc/dip/mychat 2>&1!
\end{tscreen}
Estando los ficheros de {\tt dip}, incluyendo  {\it script} y {\tt
mychat.dip} en {\tt /etc/dip}.
\index{dip@{\tt dip}!guión chat para|)}
\index{dip@{\tt dip}!conexion a un servidor SLIP con|)}

Las explicaciones de esta sección le deberían haber permitido
conectarse a la red, bien sea por Ethernet o por SLIP. De nuevo le
volvemos a recomendar que consulte un libro sobre configuración de
redes TCP/IP, en especial si en la red hay configuraciones especiales
de enrutado o similar.
\index{TCP/IP!sobre línea serie|)}
\index{protocolo de línea serie|)}
\index{SLIP|)}
\index{TCP/IP!SLIP|)}
\index{redes!TCP/IP|)}
\index{TCP/IP|)}
