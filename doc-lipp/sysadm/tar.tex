% Linux Installation and Getting Started    -*- TeX -*-
% tar.tex
% Copyright (c) 1993 by Matt Welsh and Lars Wirzenius
%
% This file is freely redistributable, but you must preserve this copyright 
% notice on all copies, and it must be distributed only as part of "Linux 
% Installation and Getting Started". This file's use is covered by
% the copyright for the entire document, in the file "copyright.tex".
%
% Copyright (c) 1998 by Specialized Systems Consultants Inc. 
% <ligs@ssc.com>
%

%Traducido por Sebastián Gurin, Cancerbero <anon@adinet.com.uy> el 12/01/01

%Revisado por Sebastián Gurin, Cancerbero <anon@adinet.com.uy> el 18/01/01
%Revisión 1 por Francisco Javier Martínez <serrador@arrakis.es>   el 7/7/02


 

\section{Almacenamiento y compresión de ficheros}
\markboth{Administración de Sistema}{Almacenando y Comprimiendo ficheros}
\subsection*{Preámbulo a la traducción al castellano}
{\em En español existe cierta confusión entre los términos fichero y archivo, los cuáles se toman como sinónimos. En informática y en este texto, 
existe una sutil pero importante diferencia entre los términos. Cuando nos referimos a un fichero, nos referimos a cualquier tipo de documento,
imagen, sonido almacenado en un soporte lógico. Sin embargo, un archivo es una clase especial de fichero que contiene otros ficheros. El origen
de dicha confusión parece ser la traducción errónea de fichero por archivo en los sistemas operativos de Microsoft. No cometeremos el mismo error aquí,
Por lo tanto aquí se llamarán archivos a los ficheros .tar y similares cuyo propósito es contener otros ficheros.}
{\em(Nota del Revisor)}

\subsection{Usando {\tt tar}}
Antes de que podamos hablar de copias de seguridad, necesitamos realizar una presentación de las herramientas utilizadas para almacenar ficheros en sistemas UNIX. 

La orden {\tt tar} es la más usada para almacenar ficheros. Su sintaxis es:
\begin{tscreen}
tar \cparam{opciones} \cparam{ficheros} 
\end{tscreen}
en donde \textsl{opciones} es la lista de opciones para {\tt tar},
y \textsl{ficheros} es la lista de ficheros a agregar o extraer del archivo tar.  
Por ejemplo, la orden 
\begin{tscreen}
\# tar cvf backup.tar /etc
\end{tscreen}
empaqueta todos los ficheros del directorio {\tt /etc} en el archivo tar {\tt
backup.tar}. El primer parámetro que se le entrega a {\tt tar}, ``{\tt cvf}'', es la orden que le transmitimos a {\tt tar}.
``{\tt c}'' le dice a tar que cree un nuevo archivo. La opción ``{\tt v}''  fuerza a tar en el modo detallado,
imprimiendo los nombres de los ficheros según se archivan. La opción ``{\tt f}'' le informa a {\tt tar}, que el próximo argumento, 
{\tt backup.tar}, es el nombre del archivo a crear. El resto de los argumentos para {\tt tar} son el/los nombre(s) de ficheros(s) y
directorio(s) para agregar al archivo tar.

La instrucción
\begin{tscreen}
\# tar xvf backup.tar
\end{tscreen}
extraerá todos los ficheros archivados dentro de {\tt backup.tar} en el directorio actual.

\blackdiamond Los ficheros antiguos con el mismo nombre son sobrescritos cuando se extraen en un directorio existente. 
Antes de extraer ficheros de un archivo tar, es importante saber dónde deben ser desempaquetados los ficheros.
Digamos que se han archivado los siguientes ficheros: {\tt /etc/hosts}, {\tt /etc/group}, y {\tt /etc/passwd}. Si se usó la orden

\begin{tscreen}
\# tar cvf backup.tar /etc/hosts /etc/group /etc/passwd
\end{tscreen}
el nombre del directorio {\tt /etc/} se añadirá al principio de los nombres de cada fichero. Para extraer los ficheros en su ubicación correcta, debe usarse
\begin{tscreen}
\# cd / \\
\# tar xvf backup.tar
\end{tscreen}
porque los ficheros son extraídos con el nombre de ruta, guardado, en el archivo tar.
Sin embargo, si se han archivado los ficheros con la orden
\begin{tscreen}
\# cd /etc \\
\# tar cvf hosts group passwd
\end{tscreen}
el nombre del directorio no se conserva en el archivo tar. En consecuencia, necesitarás hacer un ``{\tt cd /etc}'', 
antes de extraer los ficheros. Como puedes ver, el cómo haya sido creado un fichero tar, marca una gran diferencia en cómo se extrae; 
o dicho de otra modo: la manera en la que serán extraídos los ficheros de un archivo tar, está estrechamente relacionada con la manera en cómo han sido archivados.
La orden
\begin{tscreen}
\# tar tvf backup.tar
\end{tscreen}
se puede usar para mostrar una lista de los ficheros del archivo tar, pero sin extraerlos. De esta forma se puede ver qué
directorio se utilizó como origen de los nombres de los ficheros, y se puede extraer el fichero desde la localización correcta.

\subsection{{\tt gzip} y {\tt compress}}
A diferencia de los de archivado para MS-DOS, {\tt tar} no comprime
los ficheros automáticamente según los archiva. Por ejemplo: si se
archivan  dos ficheros de 1 Mega byte cada uno, en un archivo tar, el
tamaño de este último será de 2 Mega bytes. En \linux, la orden {\tt
gzip}, puede utilizarse para comprimir un archivo, (no tiene por que
ser un archivo tar). La instrucción
\begin{tscreen}
\# gzip -9 backup.tar
\end{tscreen}
comprime {\tt backup.tar}, dejándonos el fichero {\tt backup.tar.gz}, una versión
comprimida del archivo. El parámetro {\tt -9}, hace que {\tt gzip}, utilice el mayor factor de compresión.
La orden gunzip puede ser utilizado para descomprimir un fichero comprimido con gzip. La orden {\tt gzip -d} es equivalente a {\tt gunzip}.
{\tt gzip} es una herramienta relativamente nueva en la comunidad
UNIX. Durante muchos años, se utilizó en su lugar {\tt compress}. Sin
embargo, debido a varios factores, incluyendo una disputa por una
patente de software contra su algoritmo de compresión, y el hecho de
que {\tt gzip} es mucho más eficiente, {\tt compress} se está
volviendo anticuado.



\subsection{Aplicándolos en conjunto}
Para archivar un grupo de ficheros y comprimir el resultado, use las órdenes
\begin{tscreen}
\# tar cvf backup.tar /etc \\
\# gzip -9 backup.tar
\end{tscreen}

Como resultado obtendrá {\tt backup.tar.gz}. Para descomprimir este
archivo, use las órdenes inversas:

\begin{tscreen}
\# gunzip backup.tar.gz \\
\# tar xvf backup.tar
\end{tscreen}

Recordatorio: Siempre hay que estar seguro de encontrarse en el
directorio correcto antes de descomprimir un archivo tar.
También se puede usar algunas de las ingeniosidades de {\linux} para
realizar esto, pero en una sola línea de ordenes: 
\begin{tscreen}
\# tar cvf - /etc $\mid$ gzip -9c $>$ backup.tar.gz
\end{tscreen}
Aquí, enviamos el fichero tar a ``{\tt -}'', que representa la salida estándar de {\tt
tar}. Esto es canalizado a {\tt gzip}, quien comprime el archivo tar entrante. El producto es guardado en {\tt backup.tar.gz}.
La opción {\tt -c} le ordena a {\tt gzip} que envíe su salida a la salida estándar, que es reencauzada a {\tt backup.tar.gz}.
Una simple orden para descomprimir este archivo sería:
\begin{tscreen}
\# gunzip -c backup.tar.gz $\mid$ tar xvf -
\end{tscreen}
Nuevamente, {\tt gunzip} descomprime el contenido de {\tt backup.tar.gz} y envía el archivo tar resultante a la salida estándar. Ésta es canalizada a {\tt tar},
quien lee ``{\tt -}'', lo cual representa, esta vez, la entrada estándar de {\tt tar}.

Felizmente, la orden {\tt tar} incluye también la opción {\tt z} que, automáticamente realiza los procesos  de comprimir/descomprimir ficheros, e
invoca el programa, usando el algoritmo de compresión de {\tt gzip}.
La orden
\begin{tscreen}
\# tar cvfz backup.tar.gz /etc
\end{tscreen}
es equivalente a 
\begin{tscreen}
\# tar cvf backup.tar /etc \\
\# gzip backup.tar
\end{tscreen}
Tal como la orden
\begin{tscreen}
\# tar xvfz backup.tar.Z
\end{tscreen}
puede ser usado en lugar de 
\begin{tscreen}
\# uncompress backup.tar.Z  \\
\# tar xvf backup.tar
\end{tscreen}
Indagando en las páginas man se puede obtener mas información acerca de tar y gzip. 
