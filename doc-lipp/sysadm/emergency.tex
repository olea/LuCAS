% Linux Installation and Getting Started    -*- TeX -*-
% emergency.tex
% Copyright (c) 1993 by Matt Welsh and Lars Wirzenius
%
% This file is freely redistributable, but you must preserve this copyright 
% notice on all copies, and it must be distributed only as part of "Linux 
% Installation and Getting Started". This file's use is covered by
% the copyright for the entire document, in the file "copyright.tex".
%
% Copyright (c) 1998 by Specialized Systems Consultants Inc. 
% <ligs@ssc.com>
%
% Este fichero es de distribución libre, pero debe mantenerse esta 
% información de Copyright en todas las copias, y debe distribuirse solo como
% parte de "Instalación y Primeros Pasos en Linux". El uso de este fichero esta
% cubierto por el Copyright del documento completo, en el fichero "copyright.tex"
% Copyright (c) 1995 por Gerardo Izquierdo para la versión al Castellano
% $Log: emergency.tex,v $
% Revision 1.9  2003/07/19 06:55:42  joseluis.ranz
% Correcciones varias.
%
% Revision 1.8  2002/10/12 19:53:23  montuno
% quitando defectos y comandos
%
% Revision 1.7  2002/07/30 16:23:05  pakojavi2000
% Beta 2.2 Formatos de párrafo
%
% Revision 1.6  2002/07/21 00:56:46  pakojavi2000
% Beta2.1
%
% Revision 1.5  2002/07/20 17:41:16  pakojavi2000
% beta2
%
% Revision 1.4  2002/07/12 10:38:33  pakojavi2000
% Corregidos errores de compilación
%
% Revision 1.3  2002/07/07 21:03:13  pakojavi2000
%  Errores de deletreo
%
% Revision 1.2  2001/05/17 12:33:17  amolina
% traducción de emergency.tex: Ya acabamos sysadm/ :-)
%
% Revision 0.5.0.1  1996/02/10 23:45:12  rcamus
% Primera beta publica
%
%

%
% Versión para lipp 2.0 por Alberto Molina. Comentarios a:
%            alberto@nucle.us.es 
%

\section{Qué hacer en caso de emergencia}

\index{emergencias!recuperación de|(}
\index{desastres!recuperación de|(}
En algunas ocasiones, el administrador de sistemas se encuentra con el 
problema de recuperarse de un desastre completo, como puede ser el 
olvidarse la palabra clave del usuario root, o el enfrentarse 
con sistemas de ficheros dañados. El mejor 
consejo es, {\em obrar sin pánico}. Todo el mundo comete errores 
estúpidos, ésta es la mejor forma de aprender sobre 
administración de sistemas: la forma difícil.

Linux no es una versión inestable de UNIX. De hecho, he tenido menos problemas
con ``cuelgues'' de sistemas Linux que con versiones comerciales de UNIX en 
muchas plataformas. Linux también se beneficia de un fuerte complemento de 
asistentes que pueden ayudar a salir del agujero.

El primer paso al investigar cualquier problema es intentar arreglarlo 
uno mismo. Hay que echar un vistazo y ver cómo funcionan las cosas. Demasiadas 
veces, un administrador de sistemas pone un mensaje desesperado 
rogando ayuda antes de investigar el problema. Muchas de las veces, 
arreglar problemas por uno mismo es realmente muy 
fácil. Este es el camino que debe seguir para convertirse en un gurú.

Hay pocos casos en los que sea necesario reinstalar el sistema desde cero.
Muchos nuevos usuarios borran accidentalmente algún fichero esencial del 
sistema, e inmediatamente acuden a los discos de instalación. Esta no 
es una buena idea. Antes de tomar medidas drásticas como esa, 
investigar el problema y preguntar a otros ayudará a solucionar las 
cosas. En prácticamente todos los casos, podrá recuperar el sistema 
desde un disquete de mantenimiento.

\subsection{Recuperación utilizando un disquete de mantenimiento}
\label{sec-maint-diskette}
\index{desastres!recuperación de!con disquete de mantenimiento}
\index{emergencias!recuperación de!con disquete de mantenimiento}
\index{arrancando!de un disquete de mantenimiento}
\index{disquete de mantenimiento}
\index{disquete de arranque}
\index{disquette!arranque/raíz}
\index{disquette!de mantenimiento}
Una herramienta indispensable para el administrador de sistemas es el 
llamado ``disco arranque/raíz'' (``boot/root disk'') ---un disquete 
desde el que se puede arrancar un sistema GNU/Linux completo, independiente 
del disco duro. Los discos de arranque/raíz son realmente muy
simples, se crea un sistema de ficheros raíz en el disquete, se ponen todas 
las utilidades necesarias en él y se instala LILO y un núcleo 
arrancable en el disquete. Otra técnica es usar un disquete para el 
núcleo y otro para el sistema de ficheros raíz. En cualquier caso, 
el resultado es el mismo: Ejecutar un sistema Linux completamente desde 
disquete.

El ejemplo más claro de un disco de arranque/raíz son los discos de 
arranque Slackware\footnote{Véase la 
Sección~\ref{sec-getting-internet} para la información sobre cómo 
obtener ésta desde Internet. Para este procedimiento, no se necesita 
obtener la versión completa de Slackware, sólo los disquetes de 
arranque y raíz.}. Estos disquetes contienen un núcleo capaz de iniciar y 
un sistema de ficheros raíz, todo en disquete. Están diseñados 
para usarse en la instalación de la distribución Slackware, pero 
vienen muy bien cuando hay que hacer mantenimiento del sistema.

El disco de arranque/raíz de H.J Lu, disponible en 
{\tt /pub/Linux/GCC/rootdisk} en {\tt sunsite.unc.edu}, es otro ejemplo de 
este tipo de discos de mantenimiento. O, si se es ambicioso, se puede crear
uno su propio disco. En muchos casos, sin embargo, la utilización de un 
disco de arranque/raíz prefabricado es mucho más simple y 
probablemente será más completo.

La utilización de un disco de arranque/raíz es muy simple. Tan 
sólo arranque
el sistema con el disco, y haga login como {\tt root} (normalmente sin 
clave). Para poder acceder a los ficheros del disco duro, se necesitará 
montar el sistema de ficheros a mano. Por ejemplo, la orden
\begin{tscreen}
\# {\em mount -t ext2 /dev/hda2 /mnt}
\end{tscreen}
montará un sistema de ficheros ext2fs existente en {\tt /dev/hda2} bajo
{\tt /mnt}. Recuerde que {\tt /} es ahora el propio disco de arranque/raíz;
se necesitará montar los sistemas de ficheros de su disco duro bajo algún
directorio para poder acceder a los ficheros. Por lo tanto, el fichero {\tt 
/etc/passwd} de su disco duro es ahora {\tt /mnt/etc/passwd} si se 
montó el sistema de ficheros raíz bajo {\tt /mnt}.

\subsection{Arreglando la clave de root}
\index{contraseña!arreglando la de root}
\index{root!arreglando la password de}
Si se olvida de la clave de root, no hay problema. Sólo hay que
arrancar del disco de arranque/raíz, montar su sistema de ficheros raíz
en {\tt /mnt}, y eliminar el campo de la clave de {\tt /root} en
{\tt /mnt/etc/passwd}, como por ejemplo:
\begin{tscreen}
root::0:0:root:/:/bin/sh
\end{tscreen}
Ahora {\tt root} no tiene clave; al reiniciar desde el disco duro 
debería ser capaz de hacer login como {\tt root} y poner la clave
que desee utilizando {\tt passwd}.

¿No quiso aprender a utilizar {\tt vi}? En el disco de 
arranque/raíz probablemente no estarán disponibles otros editores como 
pueda ser Emacs, pero {\tt vi} debería estarlo.

\subsection{Arreglando sistemas de ficheros corrompidos}
\index{sistemas de ficheros!arreglando corrompidos}
\index{e2fsck@{\tt e2fsck}}
\index{fsck@{\tt fsck}}
Si se corrompiese de alguna forma el sistema de ficheros, se puede ejecutar
{\tt e2fsck} o la forma apropiadad de {\tt fsck} para el tipo de
sistema de ficheros (vease la
página~\pageref{sec-checking-file-system}). En muchos casos, es más
seguro corregir cualquier dato dañado en el sistema de ficheros del
disco duro desde un disquete.

\index{super bloque!definición}
\index{super bloque!corrompido, arreglo}
Una causa común de daño en un sistema de ficheros es la
corrupción del super bloque. 
El {\bf super bloque\/} es la ``cabecera'' del sistema de ficheros que 
contiene información acerca del estado del sistema de ficheros, tamaño, 
bloques libres, y demás. Si se corrompe el super bloque (por ejemplo,
escribiendo accidentalmente datos directamente a la partición del sistema 
de ficheros), el sistema no puede reconocer nada del sistema de ficheros.
Cualquier intento de montar el sistema de ficheros fallará y {\tt e2fsck} no
será capaz de arreglar el problema.

Afortunadamente, el tipo de sistema de ficheros {\em ext2fs} salva copias del
super bloque en los lí mites de ``grupos de bloques'' en el disco 
---normalmente cada 8K bloques. Para poder decirle al {\tt e2fsck} que 
utilice una copia del super bloque, se puede utilizar una orden tal que
\begin{tscreen}
\# {\em e2fsck -b 8193 \cparam{partición}}
\end{tscreen} 
donde \cparam{partición} es la partición en la que reside el sistema de 
ficheros. La opción {\tt -b 8193} le dice al {\tt e2fsck} que utilice la copia
del super bloque almacenada en el bloque 8193 del sistema de ficheros.

\subsection{Recuperando ficheros perdidos}
\index{ficheros!recuperación}
Si accidentalmente se borran ficheros importantes del sistema no 
hay forma de recuperarlos. Sin embargo, se pueden copiar los ficheros
relevantes desde el disquete al disco duro. Por ejemplo, si se hubiese borrado
{\tt /bin/login} de su sistema (que le permite registrarse en el sistema), simplemente
arranque del disquete de arranque/raíz, monte el sistema de ficheros raíz
en {\tt /mnt}, y use la orden
\begin{tscreen}
\# {\em cp -a /bin/login /mnt/bin/login}
\end{tscreen}
La opción {\tt -a} le dice a {\tt cp} que conserve los permisos en los
ficheros que se están copiando.

Por supuesto, si los ficheros que se borraron no fuesen ficheros esenciales 
del sistema que tengan contrapartidas en el disquete de arranque/raíz, se
habrá acabado la suerte. Si se hicieron copias de seguridad, siempre se
podrá recuperar de ellas.

\subsection{Arreglando bibliotecas corrompidas}
\index{bibliotecas!arreglando corrompidas}
Si accidentalmente se llegasen a corromper las bibliotecas de enlaces 
simbólicos en {\tt /lib}, es más que seguro que instrucciones que dependan de 
estas bibliotecas no vuelvan a funcionar (Véase la 
Sección~\ref{sec-upgrade-libs}). La solución más simple es arrancar 
del disquete de arranque/raíz, montar el sistema de ficheros raíz 
y arreglar las bibliotecas en {\tt /mnt/lib}.

En la página~\pageref{sec-upgrade-libs} se describe cómo instalar este
tipo de bibliotecas y sus enlaces simbólicos.

\index{emergencias!recuperación de|)}
\index{desastres!recuperación de|)}

