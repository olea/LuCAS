% inittabl.tex. this is new to the SSC edition, 12/8/97 -- rak
%
% Copyright (c) 1998 by Specialized Systems Consultants Inc. 
% <ligs@ssc.com> 

% Traducción realizada por Alberto Molina. Comentarios a:
%            alberto@nucle.us.es
% 


\subsection{El fichero {\tt /etc/inittab}} \label{sec-inittab}
\markboth{Administración del Sistema}{El fichero {\tt /etc/inittab}}

Después de que {\linux} arranque y el núcleo monte el sistema de
ficheros de root, el primer programa que ejecuta el sistema es {\tt
  init}. Este programa es el encargado de lanzar los guiones de
inicialización del sistema y de modificar el sistema operativo de su
estado inicial de arranque al estado estándar multiusuario. También
define los intérpretes de órdenes {\tt login:} de todos los dispositivos tty del
sistema y especifica otras características del arranque y apagado.

Tras el arranque, {\tt init} permanece latente en segundo plano,
``monitoreando'' y si fuera necesario alterando la ejecución del
sistema. Hay muchos detalles que deben comentarse del programa {\tt
  init}. Todas las tareas que realiza se definen en el fichero {\tt
  /etc/inittab}. Un ejemplo de dicho fichero se muestra a continuación.

\blackdiamond Modificar el fichero {\tt /etc/inittab} de forma
incorrecta, puede impedirle registrarse en el sistema. Por ello, cuando se
modifique dicho fichero, hay que guardar una copia del fichero
original, además de tener a mano el disquete de inicio, para el caso
en que se cometiera algún error.

\begin{tscreen}\begin{verbatim}
#
# inittab       Este fichero describe como el proceso INIT debe 
#               ajustar el sistema en ciertos niveles de ejecución.
#
# Version:      @(#)inittab             2.04    17/05/93        MvS
#                                       2.10    02/10/95        PV
#
# Author:       Miquel van Smoorenburg, <miquels@drinkel.nl.mugnet.org>
# Modified by:  Patrick J. Volkerding, <volkerdi@ftp.cdrom.com>
# Minor modifications by:
#               Robert Kiesling, <kiesling@terracom.net>
#
# Nivel de ejecución asumido.
id:3:initdefault:

# Iniciación del sistema (se ejecuta al arrancar el sistema).
si:S:sysinit:/etc/rc.d/rc.S

# Script para ejecutarse cuando el sistema vaya a un usuario 
# (nivel de ejecución 1).  
su:1S:wait:/etc/rc.d/rc.K

# Script para ejecutarse cuando el sistema vaya a multiusuario.
rc:23456:wait:/etc/rc.d/rc.M

# Qué hacer cuando se pulse Ctrl-Alt-Del
ca::ctrlaltdel:/sbin/shutdown -t5 -rfn now

# El nivel de ejecución 0 para el sistema.
l0:0:wait:/etc/rc.d/rc.0

# El nivel de ejecución 6 reinicia el sistema.
l6:6:wait:/etc/rc.d/rc.6

# Qué hacer cuando se va el suministro eléctrico (bajar al nivel de
# ejecución de un usuario).
pf::powerfail:/sbin/shutdown -f +5 "EL SUMINISTRO ELÉCTRICO SE ESTÁ CORTANDO"

# Si el suministro vuelve antes de bajar, cancelar el proceso.
pg:0123456:powerokwait:/sbin/shutdown -c "El SUMINISTRO ELÉCTRICO ESTÁ
VOLVIENDO"

# Si vuelve el suministro cuando se está en modo de un usuario, volver
# al modo multiusuario.
ps:S:powerokwait:/sbin/init 5

# Los ``gettys'' en el modo multiusuario y las líneas serie.
#
# NOTA NOTA NOTA ¡ajuste esto a su ``getty'' o no será capaz de ingresar!
#
# Nota: Debe especificar la velocidad de línea para ``agetty''.
# para ``getty_ps'' se usa una línea, se especifica la velocidad de
# línea y también se utiliza ``gettydefs''
c1:1235:respawn:/sbin/agetty 38400 tty1 linux
c2:1235:respawn:/sbin/agetty 38400 tty2 linux
c3:1235:respawn:/sbin/agetty 38400 tty3 linux
c4:1235:respawn:/sbin/agetty 38400 tty4 linux
c5:1235:respawn:/sbin/agetty 38400 tty5 linux
c6:12345:respawn:/sbin/agetty 38400 tty6 linux

# Líneas serie
# s1:12345:respawn:/sbin/agetty -L 9600 ttyS0 vt100
s2:12345:respawn:/sbin/agetty -L 9600 ttyS1 vt100

# Líneas de marcado telefónico
d1:12345:respawn:/sbin/agetty -mt60 38400,19200,9600,2400,1200 ttyS0 vt100
#d2:12345:respawn:/sbin/agetty -mt60 38400,19200,9600,2400,1200 ttyS1 vt100

# El nivel de ejecución 4 debería usarse para un sistema con X-window
# únicamente, hasta que nos dimos cuenta de
# que lanzaba init en un bucle que mantenía la carga al menos a 1 todo  
# el tiempo. Así que, ahora hay un getty abierto en tty6. Esperemos que
# nadie se de cuenta. ;^)
# Quizá no sea malo tener una consola de texto por ahí, en caso de que 
# le ocurriera algo a X.
x1:4:wait:/etc/rc.d/rc.4

# Fin de /etc/inittab

\end{verbatim}\end{tscreen}

Al iniciar, este {\tt /etc/inittab} lanza seis consolas virtuales, un
prompt de ingreso para el módem en {\tt /dev/ttys0} y un prompt de
ingreso para una terminal de caracteres conectada a través de la línea
serie RS-232 a {\tt /dev/ttyS1}.

Brevemente podríamos decir que el programa {\tt init} pasa a través de
una serie de {\bf niveles de ejecución}, que corresponden a varios
estados del sistema. Al nivel de ejecución 1 se entra inmediatamente
después de iniciar el sistema, los niveles de ejecución 2 y 3 son los
modos de operación del sistema normal y multiusuario respectivamente,
el nivel de ejecución 4 lanza el sistema X Window a través del X
display manager {\tt xdm} y el nivel de ejecución 6 reinicia el
sistema. Los niveles de ejecución asociados a cada orden, son el
segundo término de cada línea del fichero {\tt /etc/inittab}.

Por ejemplo, la línea:
\begin{tscreen}
s2:12345:respawn:/sbin/agetty -L 9600 ttyS1 vt100
\end{tscreen}
mantendrá un prompt de ingreso en una terminal serie para los niveles
de ejecución 1--5. El ``{\tt s2}'' antes de los primeros dos puntos es
un identificador simbólico que usa internamente {\tt init}. {\tt
  respawn} es una clave de {\tt init} que se usa a veces junto con las
terminales serie. Si tras un cierto período de tiempo, el programa
{\tt agetty}, que genera los prompt de ingreso en las terminales, no
recibe señal alguna en la terminal, termina su ejecución. ``{\tt
respawn}'' hace que {\tt init} vuelva a ejecutar {\tt agetty},
asegurando que haya siempre un prompt de ingreso en la terminal,
independientemente de que haya algún otro ingreso. El resto de
parámetros se pasan directamente a {\tt agetty} y le especifican cómo
debe generar la shell de ingreso, la capacidad de transferencia de
datos de la línea, el dispositivo serie y el tipo de terminal, como se
define en {\tt /etc/termcap} o {\tt /etc/terminfo}.

%The {\tt /sbin/agetty} program handles many details related to
%terminal I/O on the system. There are several different versions that
%are commonly in use on Linux systems. They include {\tt mgetty}, {\tt
%psgetty}, or simply, {\tt getty}.
El programa {\tt /sbin/agetty} maneja muchos detalles acerca de la E/S por
terminal en el sistema. Hay varias versiones diferentes que se unen regularmente en sistemas GNU/Linux.
Se incluyen {\tt mgetty}, {\tt psgetty} y {\tt getty}.

%In the case of the {\tt /etc/inittab} line 
En el caso de la línea de {\tt /etc/inittab}

\begin{tscreen}
d1:12345:respawn:/sbin/agetty -mt60 38400,19200,9600,2400,1200 ttyS0 vt100
\end{tscreen}
%which allows users to log in via a modem connected to serial line {\tt
%/dev/ttyS0}, the {\tt /sbin/agetty} parameters ``{\tt -mt60}'' allow
%the system to step through all of the modem speeds that a caller
%dialing into the system might use, and to shut down {\tt /sbin/agetty}
%if there is no connection after 60 seconds. This is called {\bf
%negotiating} a connection. The supported modem speeds are enumerated
%on the command line also, as well as the serial line to use, and the
%terminal type. Of course, both of the modems must support the data
%rate which is finally negotiated by both machines.

que permite a los usuarios ingresar usando un módem conectado a una línea serie
{\tt /dev/ttyS0}, los parámetros de {\tt /sbin/agetty} ``{\tt -m60}'' permiten
al sistema ir paso a paso por todas las velocidades del módem que un usuario
llamando al sistema puede usar, y apagar {\tt /sbin/getty}
si no hay ninguna conexión en 60 segundos. Esto se llama {\tt negociar} una
conexión. Las velocidades de modem soportadas se enumeran en la línea de órdenes
también, así como la línea serie a usar y el tipo de terminal. Desde luego, ambos módems
deben soportar el flujo de datos que se negocie finalmente por ambas máquinas.


Se han pasado por alto muchos detalles importantes en esta
sección. Las tareas de {\tt /etc/inittab} ocuparían un libro
completo. Para más información, pueden consultarse las páginas del
manual de {\tt init} y {\tt agetty} y los ``HOWTO'' del Proyecto de
Documentación de Linux, disponibles en los lugares que se presentan en
el apéndice~\ref{app-sources-num}.


















