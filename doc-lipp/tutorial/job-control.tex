% \linux Installation and Getting Started    -*- TeX -*-
% job-control.tex
% Copyright (c) 1992, 1993 by Matt Welsh, Larry Greenfield and Karl Fogel
%
% This file is freely redistributable, but you must preserve this copyright 
% notice on all copies, and it must be distributed only as part of "\linux 
% Installation and Getting Started". This file's use is covered by
% the copyright for the entire document, in the file "copyright.tex".
%
% Copyright (c) 1998 by Specialized Systems Consultants Inc. 
% <ligs@ssc.com>

\section{Control de tareas.}\label{sec-job-control}
\markboth{Tutorial de {\linux}}{Control de Tareas}

\index{control de tareas|(}
\subsection{Tareas y procesos.}
\label{sec-process}\label{sec-processes}

\index{shells!controlde tareas proporcionado por}
El {\bf control de tareas} es una característica que incluyen muchos {\bf intérpretes de órdenes}
(incluyendo {\tt bash} y {\tt tcsh}) que permiten controlar múltiples órdenes o {\bf tareas}
ejecutándose a la vez. Antes de ir más lejos, hay que hablar de los {\bf procesos}.

\index{proceso!definición}
\index{ps@{\tt ps}}
\index{proceso!ps para listar@{\tt ps} para listar}
Cada vez que se ejecuta un programa, se arranca lo que se denomina un proceso.
La orden {\tt ps} muestra una lista de los procesos actualmente en ejecución,
como se ve aquí:
\begin{tscreen}
/home/larry\# ps
\begin{verbatim}
  PID TT STAT  TIME COMMAND 
   24  3 S     0:03 (bash) 
  161  3 R     0:00 ps
\end{verbatim}
/home/larry\#
\end{tscreen}
\index{proceso!ID!definición}
En la primera columna aparece el {\tt PID} o {\bf identificador de proceso},
un número único dado a cada proceso en ejecución. La última columna,
{\tt COMMAND}, es el nombre de la orden en ejecución. Aquí, estamos viendo
únicamente los procesos que está ejecutando el propio Larry. (También hay otros
muchos procesos en ejecución en el sistema---''{\tt ps -aux}''
los lista todos.) Éstos son {\tt bash} (el {\bf intérprete de órdenes} de Larry)
y la propia orden {\tt ps}. Como puede ver,
{\tt bash} se ejecuta al mismo tiempo que la orden {\tt ps}.
{\tt bash} hizo que se ejecutara {\tt ps} cuando Larry escribió la orden. Cuando
{\tt ps} ha finalizado su ejecución (después de haber mostrado la tabla de procesos),
el proceso {\tt bash} vuelve a tomar el control, y muestra el símbolo del sistema,
listo para recibir otra orden.

\index{tarea!definición}
A un proceso en ejecución se le llama también {\em tarea\/}. Los términos
{\em proceso\/} y {\em tarea\/} son intercambiables. Sin embargo, nos referimos a
un proceso como ''tarea'' cuando lo usamos en conjunción con {\bf
control de tareas} ---una característica del {\bf intérprete de órdenes} que permite conmutar entre
varios procesos independientes.

En muchos casos, los usuarios ejecutan una única tarea a la vez---cualquiera que
fuera la última orden que escribieron. Sin embargo, usando el control de
tareas, se puede ejecutar varias tareas a la vez y conmutar entre ellas
cuando haga falta.

¿Para qué puede ser esto útil? Digamos que está editando un fichero de texto y
quiere interrumpir la edición para hacer cualquier otra cosa. Mediante el control
de tareas, puede suspender temporalmente el editor, volver al símbolo del {\bf intérprete de órdenes}
y empezar a trabajar en otra cosa. Cuando haya terminado, puede volver al editor donde
lo dejó, como si no lo hubiera abandonado. Hay otros muchos usos prácticos
del control de tareas.

%\subsection{Foreground and background.}
\subsection{Primer plano y segundo plano.}

\index{proceso!foreground}
\index{proceso!background}
\index{tarea!foreground}
\index{tarea!background}
\index{proceso en primer plano}
\index{proceso en segundo plano}
\index{primer plano}
\index{segundo plano}
\index{proceso!primer plano}
\index{proceso!segundo plano}

Las tareas pueden estar tanto en {\bf primer plano} como en {\bf segundo plano}.
Sólo puede haber una tarea en primer plano cada vez. La tarea que está
en primer plano es aquella con la que se interactúa --recibe la entrada
desde el teclado y envía la salida a la pantalla, a menos que, por supuesto, se haya
redireccionado la entrada o la salida, como se describe en la
página~\pageref{sec-plumbing}--. Por otro lado, las tareas que están en segundo
plano no reciben entradas desde el terminal --en general, se ejecutan
tranquilamente sin necesidad de interacción--.

Algunas tareas tardan mucho tiempo en acabar y no hacen nada interesante mientras
se están ejecutando. Compilar programas es una de esas tareas, como también
lo es comprimir un fichero grande. No hay ningún motivo para estar sentado y aburrido
mientras espera a que estas tareas acaben; simplemente ejecútelos
en segundo plano. Mientras esas tareas corren en segundo plano, existe libertad
para ejecutar otros programas.

\index{tarea!suspendida}
Las tareas también pueden ser {\bf suspendidas}. Una tarea suspendida es una
tarea que está detenida temporalmente. Después de suspender una tarea,
se puede hacer que continúe en primer o segundo plano cuando haga falta.
Reanudar una tarea suspendida no cambia el estado de la tarea de ninguna
manera --la tarea continúa su ejecución por donde se quedó--.

\index{proceso!interrumpido}
\index{tarea!interrupción}
Suspender una tarea no es lo mismo que interrumpirla. Cuando se {\bf
interrumpe} un proceso en ejecución (pulsando la tecla de interrupción, que
suele ser \key{Ctrl-C})\footnote{Se puede establecer la tecla de
interrupción con la orden {\tt stty}.}, se mata ese proceso, para siempre. Una
vez que se mata el proceso, no hay manera de que se reanude. Hay que ejecutar
la orden otra vez. Además, algunos programas capturan la interrupción, de manera
que pulsar \key{Ctrl-C} no matará inmediatamente al proceso. Esto permite al 
programa llevar a cabo cualquier operación de limpieza necesaria antes de salir.
De hecho, algunos programas no permitirán de ningún modo que se les mate mediante
interrupción.

Comencemos con un ejemplo simple. La orden {\tt yes} es una orden
inútil en apariencia que manda una cadena infinita de {\tt y}s a la
salida estándar. (En realidad sí es útil. Si se enlaza mediante una tubería la salida de
{\tt yes} a otra orden que realice una serie preguntas de sí o no, la cadena
de {\tt y}s confirmará todas las preguntas.)

Intentémoslo:
\begin{tscreen}
/home/larry\# yes \\
y \\
y \\
y \\
y \\
y
\end{tscreen}
\index{proceso!matar}
\index{proceso!interrumpir}
\index{tarea!matar}
\index{tarea!interrumpir}
Las {\tt y}s continuarán {\em ad infinitum}. Puede matar el proceso
pulsando la tecla de interrupción, que normalmente es \key{Ctrl-C}.
Para que no tengamos que aguantar la molesta cadena de {\tt y}s,
redirijamos la salida estándar de {\tt yes} a {\tt /dev/null}.
Si recuerda, {\tt /dev/null} actúa como un ''agujero negro'' para los datos.
Cualquier dato que se le envíe desaparece. Es un modo muy efectivo de
silenciar un programa charlatán.
\begin{tscreen}
/home/larry\# yes $>$ /dev/null
\end{tscreen}
Ah, mucho mejor. No aparece nada, pero el símbolo del {\bf intérprete de órdenes} no vuelve.
Esto es porque {\tt yes} está todavía en ejecución, y está mandando
esas inútiles {\tt y}s a {\tt /dev/null}. Para matar otra vez, la tarea,
pulse la tecla de interrupción.

Supongamos que quiere que la orden {\tt yes} continúe su ejecución pero
conservando el símbolo del {\bf intérprete de órdenes} para que pueda trabajar en otras cosas.
Puede pasar {\tt yes} a segundo plano, permitiendo su ejecución, sin necesidad
de interactuar.

\index{tarea!paso a segundo plano}
\index{tarea!segundo plano}
Una manera de poner un proceso en segundo plano es añadir un ''{\tt \&}''
al final de la orden.
\begin{tscreen}
/home/larry\# yes $>$ /dev/null \& \\
\verb+[1] 164+ \\
/home/larry\#
\end{tscreen}
Como puede ver, el símbolo del {\bf intérprete de órdenes} ha vuelto. Pero ¿qué es este
''{\tt \verb+[1] 164+}''? Y ¿está ejecutándose realmente la orden {\tt yes}?

''{\tt \verb+[1]+}'' representa el {\bf número de tarea} para el proceso {\tt yes}.
El {\bf intérprete de órdenes} asigna un número de tarea a cada tarea en ejecución. Dado que
{\tt yes} es la única tarea que estamos ejecutando, tiene asignado el número
de trabajo {\tt 1}. ''{\tt 164}'' es el identificador de proceso, o
PID, el número otorgado a la tarea por el sistema. Se puede usar cualquiera de
los números para referirse a la tarea, como se verá más adelante.

\index{tareas@{\tt tareas}}
Ahora tenemos el proceso {\tt yes} ejecutándose en segundo plano, mandando
continuamente una cadena de {\tt y}s a {\tt /dev/null}. Para comprobar
el estado de este proceso, utilizamos la orden interna del {\bf intérprete de órdenes} {\tt jobs}.
\begin{tscreen}
/home/larry\# jobs \\
\verb-[1]+  Running                 yes >/dev/null  &- \\
/home/larry\#
\end{tscreen}
Efectivamente, ahí está. También se podría haber utilizado la orden {\tt ps} tal y como
se mostró arriba para comprobar el estado de la tarea.

\index{kill@{\tt kill}}
\index{proceso!segundo plano!matar}
\index{tarea!segundo plano!matar}
Para acabar con la tarea, utilice la orden {\tt kill}.
Esta orden toma un número de tarea o un identificador de proceso como
argumento. Ésta era la tarea número 1, así que usando la orden
\begin{tscreen}
/home/larry\# kill \%1
\end{tscreen}
se mata la tarea. Cuando se identifica la tarea con su número de tarea,
se debe anteponer al número un carácter de tanto por ciento (''{\tt \%}'').

Ahora que ha matado la tarea, utilice {\tt jobs} otra vez para comprobarlo:
\begin{tscreen}
/home/larry\# jobs
\begin{verbatim}
[1]+  Terminated              yes >/dev/null 
\end{verbatim}
/home/larry\# 
\end{tscreen}
Desde luego, la tarea está muerta, y si utiliza la orden {\tt jobs} otra vez,
no debería aparecer ya nada.

También se puede matar la tarea usando el número de identificación del proceso (PID),
que aparece junto con el número de tarea cuando lo arranca. En nuestro ejemplo,
el identificador de proceso es 164, así que la orden
\begin{tscreen}
/home/larry\# kill 164
\end{tscreen}
equivale a
\begin{tscreen}
/home/larry\# kill \%1
\end{tscreen}
No necesita usar ''{\tt \%}'' para hacer referencia a una tarea mediante su
identificador de proceso.

%\subsection{Stopping and restarting tareas.}
\subsection{Parando y relanzando tareas}
\index{tarea!detener}
Hay otra manera de pasar una tarea a segundo plano. Puede
arrancar la tarea normalmente (en primer plano), {\bf suspender} la tarea,
y reiniciarla en segundo plano.

Primero, arranque el proceso {\tt yes} en primer plano, como
hizo antes:
\begin{tscreen}
/home/larry\# yes $>$ /dev/null
\end{tscreen}
Otra vez, como {\tt yes} está ejecutándose en primer plano, no debería ver
el símbolo del {\bf intérprete de órdenes}.

Ahora, mejor que interrumpir la tarea con \key{Ctrl-C}, {\bf suspéndala}.
Suspender una tarea no la mata: sólo la detiene temporalmente
hasta que se la reinicia de nuevo. Para hacer esto, pulse la tecla de suspensión, que
normalmente es \key{Ctrl-Z}.
\begin{tscreen}
/home/larry\# yes $>$ /dev/null \\
\key{ctrl-Z} \\
\verb-[1]+  Stopped                 yes >/dev/null- \\
/home/larry\#
\end{tscreen}
Mientras la tarea está suspendida, simplemente no está en ejecución. No se
emplea tiempo de CPU para esa tarea. Sin embargo, puede reiniciar la tarea, lo que provoca
que se ejecute otra vez como si nada hubiera pasado. Continuará su ejecución
por donde se quedó.

\index{fg@{\tt fg}}
\index{tarea!recomenzar}
Para reiniciar la tarea en primer plano, utilice la orden
{\tt fg} (de ''foreground''). 
\begin{tscreen}
/home/larry\# fg \\
yes >/dev/null 
\end{tscreen}
\index{tarea!segundo plano}
\index{bg@{\tt bg}}
El {\bf intérprete de órdenes} muestra el nombre de la orden otra vez para que esté al tanto de qué tarea
acaba de mandar a primer plano. Detenga la tarea otra vez con \key{Ctrl-Z}.
Esta vez, use la orden {\tt bg} para pasar la tarea a segundo plano.
Esto provoca que la orden se ejecute como si lo hubiera arrancado con
''{\tt \&}'', como en la última sección.
\begin{tscreen}
/home/larry\# bg \\
\verb-[1]+- yes >/dev/null  \& \\
/home/larry\# 
\end{tscreen}
Y aquí tiene su símbolo del {\bf intérprete de órdenes} de vuelta. {\tt jobs} debería informar que {\tt yes}
está ciertamente ejecutándose, y puede matar la tarea con {\tt kill} como
hicimos antes.

¿Cómo se puede detener la tarea otra vez? Utilizar \key{Ctrl-Z} no funcionará, porque
la tarea está en segundo plano. La respuesta es pasar la tarea a primer
plano con {\tt fg}, y luego detenerla. Tal y como parece, puede
utilizar {\tt fg} tanto en tareas detenidas como en tareas en segundo plano.

Hay una gran diferencia entre una tarea en segundo plano y una tarea
detenida. Una tarea detenida no está en ejecución ---no está usando
tiempo de CPU, y no está haciendo nada (la tarea todavía ocupa memoria del
sistema, aunque puede haber sido volcada a disco). Una tarea en
segundo plano sí está ejecutándose y usando memoria, al tiempo que
completa alguna acción mientras usted hace otra cosa.

Sin embargo, una tarea en segundo plano puede intentar mostrar texto por
el terminal, lo que puede resultar molesto si está intentando trabajar en
otra cosa. Por ejemplo, si utilizó la orden
\begin{tscreen}
/home/larry\# yes \&
\end{tscreen}
sin redirigir stdout a {\tt /dev/null}, una cadena de {\tt y}s
estará apareciendo en la pantalla, sin posibilidad de interrumpirla.
(No se puede usar \key{Ctrl-C} para interrumpir tareas en segundo plano.)
Para detener las infinitas {\tt y}s, utilice la orden {\tt fg} para
pasar la tarea a primer plano, y luego utilice \key{Ctrl-C}
para matarla.

Otra nota. Las órdenes {\tt fg} y {\tt bg} normalmente afectan a la última
tarea detenida (indicado por un ''{\tt +}'' junto al número de tarea
cuando se usa la orden {\tt jobs}).
Si está ejecutando diversas tareas a la vez, puede pasar tareas a primer o
segundo plano pasando el número de tarea como argumento a {\tt fg} o {\tt bg}, como en
\begin{tscreen}
/home/larry\# fg \%2
\end{tscreen}
(para pasar la tarea número 2 a primer plano), o
\begin{tscreen}
/home/larry\# bg \%3
\end{tscreen}
(para pasar la tarea número 3 a segundo plano). No se pueden usar identificadores
de proceso (PID) con {\tt fg} o {\tt bg}. 

Además, usar el número de tarea sólamente, como en
\begin{tscreen}
/home/larry\# \%2
\end{tscreen}
equivale a
\begin{tscreen}
/home/larry\# fg \%2
\end{tscreen}

Recuerde que el control de tareas es una característica del {\bf intérprete de órdenes}. Las instrucciones
{\tt fg}, {\tt bg} y {\tt jobs} son internas del {\bf intérprete de órdenes}.
Si por cualquier motivo usted utiliza un {\bf intérprete de órdenes} que no soporte control de tareas,
no espere encontrar estas instrucciones disponibles.

Por añadidura, hay algunos aspectos del control de tareas que varían entre
{\tt bash} y {\tt tcsh}. De hecho, algunos {\bf intérpretes de órdenes} no proporcionan control
de tareas en absoluto---de cualquier manera, la mayoría de los {\bf intérpretes de órdenes} disponibles
para {\linux} sí lo proporcionan.

\index{control de tareas|)}





