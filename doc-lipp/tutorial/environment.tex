% Linux Installation and Getting Started    -*- TeX -*-
% environment.tex
% Copyright (c) 1992, 1993 by Matt Welsh, Larry Greenfield and Karl Fogel
%
% This file is freely redistributable, but you must preserve this copyright 
% notice on all copies, and it must be distributed only as part of "Linux 
% Installation and Getting Started". This file's use is covered by
% the copyright for the entire document, in the file "copyright.tex".
%
% Traducción al español por Eduardo Lluna Gil <elluna@aii.upv.es>
% $Log: environment.tex,v $
% Revision 1.8  2003/07/19 06:01:30  joseluis.ranz
% Correcciones varias.
%
% Revision 1.7  2002/10/12 19:53:24  montuno
% quitando defectos y comandos
%
% Revision 1.6  2002/09/09 16:50:47  pakojavi2000
% Corrección de fallos pequeños
%
% Revision 1.5  2002/07/20 17:41:17  pakojavi2000
% beta2
%
% Revision 1.4  2002/07/20 15:40:18  pakojavi2000
% Beta2
%
% Revision 1.3  2002/07/09 02:05:04  pakojavi2000
% Correcciones menores
%
% Revision 1.2  2000/11/13 08:45:31  amolina
% *** empty log message ***
%
% Revision 0.5.0.1  1996/02/10 23:45:14  rcamus
% Primera beta publica
% Revisión 2 2002/07/02 por Francisco Javier Fernández <serrador@arrakis.es>
% Release Candidate 1


\section{Personalizando su entorno}

\index{entorno!personalización|(}

El intérprete de órdenes proporciona muchos mecanismos para 
personalizar su entorno de trabajo. Como hemos mencionado antes, el 
intérprete de órdenes es más que un mero intérprete---es 
también un poderoso lenguaje de programación. Aunque escribir guiones 
del intérprete de órdenes es una tarea extensa, nos gustaría 
introducirle algunas formas en las que puede simplificar su trabajo en 
un sistema UNIX mediante el uso de características avanzadas del 
intérprete.

Como mencionamos antes, diferentes intérpretes usan diferentes sintaxis para
la ejecución de guiones. Por ejemplo, Tcsh usa una notación al estilo C,
mientras que Bourne usa otro tipo de sintaxis. En esta sección no nos
fijaremos en las diferencias entre los dos y supondremos que los guiones se
escriben con la sintaxis del intérprete de órdenes Bourne.

\subsection{Guiones del intérprete de órdenes}
\label{sec-shell-script}
\index{guiones de intérprete de órdenes!definición}
\index{órdenes!agrupando con guiones}

Supongamos que usa una serie de órdenes a menudo, y le gustaría 
acortar el tiempo requerido para teclear agrupándolos en una única 
``orden''. Por ejemplo, las órdenes
\begin{tscreen}
/home/larry\# {\em cat capítulo1 capítulo2 capitulo3 $>$ libro} \\
/home/larry\# {\em wc -l libro} \\
/home/larry\# {\em lp libro}
\end{tscreen}
concatenarán los ficheros {\tt capítulo1}, {\tt capítulo2} y {\tt capítulo3} y
guardará el resultado en el fichero {\tt libro}. Entonces, se mostrará el
recuento del número de líneas del fichero {\tt libro} y finalmente se
imprimirá con la intrucción {\tt lp}.

En lugar de teclear todas esas órdenes, podría agruparlas en un 
{\bf guión del intérprete de órdenes}. Describimos los guiones 
brevemente en la Sección~\ref{sec-shell-script}. El guión usado para 
ejecutar todas las órdenes sería
\begin{tscreen}\begin{verbatim}
#!/bin/sh
# Un guión para crear e imprimir el libro

cat capítulo1 capítulo2 capítulo3 > libro
wc -l libro
lp libro
\end{verbatim}\end{tscreen}

Si el guión se salva en el fichero {\tt hacerlibro}, podría simplemente 
usar la orden
\begin{tscreen}
/home/larry\# {\em hacerlibro}
\end{tscreen}
para ejecutar todas las órdenes del guión. Los guiones son simples 
ficheros de texto; puede crearlos con un editor como {\tt emacs} o {\tt vi}
% \ifodd\igsascii {} \else
\footnote{{\tt vi} se describe en la Sección~\ref{sec-vi}.}.
% \fi

Veamos este guión. La primera línea ``{\tt \#!/bin/sh}'', 
identifica el fichero como un guión y le dice al intérprete de 
órdenes cómo ejecutarlo. Instruye al intérprete a pasarle el guión 
a {\tt /bin/sh} para la ejecución, donde {\tt /bin/sh} es el programa 
del intérprete. ¿Por qué es esto importante? En la mayoría de los 
sistemas UNIX {\tt /bin/sh} es un intérprete de órdenes Bourne, como 
Bash. Forzando al guión a ejecutarse usando {\tt /bin/sh} nos estamos 
asegurando de que será interpretado según la sintaxis de Bourne. Esto 
hará que el guión se ejecute usando la sintaxis Bourne aunque esté 
usando Tcsh como intérprete de órdenes.

\index{guiones del intérprete de órdenes!comentarios}
La segunda línea es un {\em comentario}. Estos comienzan con el 
carácter ``{\tt \#}'' y continúan hasta el final de la línea. Los 
comentarios son ignorados por el intérprete de órdenes---son 
habitualmente usados para identificar el guión con el programador.

El resto de las líneas del guión son simplemente órdenes como las 
que podría teclear directamente. En efecto, el intérprete de 
órdenes lee cada línea del guión y ejecuta la línea como si 
hubiese sido tecleada en la línea de órdenes.

\index{guiones del intérprete de órdenes!permisos para}
\index{permisos!para los guiones del intérprete de órdenes}
Los permisos son importantes para los guiones. Si crea un guión, debe
asegurarse de que tiene permisos de ejecución para poder
ejecutarlo\footnote{Cuando crea ficheros de texto, los permisos por omisión
usualmente no incluyen los de ejecución.}.
La orden
\begin{tscreen}
/home/larry\# {\em chmod u+x hacerlibro}
\end{tscreen}
puede usarse para dar permisos de ejecución al guión {\tt hacerlibro}.

\subsection{Variables del intérprete de órdenes y el entorno}
\index{intérprete de órdenes!variables!definición}
\index{variables!intérprete de órdenes}
\index{variables!en guiones}
\index{guiones del intérprete de órdenes!variables en}
El intérprete de órdenes le permite definir {\bf variables} como la 
mayoría de los lenguajes de programación. Una variable es simplemente 
un trozo de datos al que se le da un nombre.

\blackdiamond Nótese que Tcsh, así como otros intérpretes del estilo C, usan
un mecanismo diferente para inicializar variables del descrito aquí. Esta
discusión supondrá el uso del intérprete Bourne, como es Bash (el cual
probablemente está usando). Vea la página de manual de Tcsh para más
detalles.

Cuando asigna un valor a una variable (usando el operador ``{\tt =}''),
puede acceder a la variable anteponiendo a su nombre ``{\tt \$}'', como se 
ve a continuación.
\begin{tscreen}
/home/larry\# {\em foo=``hola allí''} 
\end{tscreen}
A la variable {\tt foo} se le da el valor ``{\tt hola allí}''. Podemos
ahora hacer referencia a ese valor a través del nombre de la variable con el
prefijo ``{\tt \$}''. La orden
\begin{tscreen}
/home/larry\# {\em echo \$foo} \\
hola allí \\
/home/larry\# 
\end{tscreen}
produce el mismo resultado que
\begin{tscreen}
/home/larry\# {\em echo ``hola allí''} \\
hola allí \\
/home/larry\# 
\end{tscreen}

Estas variables son internas al intérprete. Esto significa que sólo éste
podrá acceder a las variables. Esto puede ser útil en los guiones; si
necesita mantener, por ejemplo, el nombre de un fichero, puede almacenarlo
en una variable. Usando la orden {\tt set} mostrará una lista de todas las
variables definidas en el intérprete de órdenes.

\index{variables del intérprete de órdenes!exportando al entorno}
\index{exportar@{\tt exportar}}
De cualquier modo, el intérprete de órdenes permite {\bf exportar} 
variables al {\bf entorno}. El entorno es el conjunto de variables a las 
cuáles tienen acceso todas las órdenes que ejecute. Una vez que se 
define una variable en el intérprete, exportarla hace que se convierta 
también en parte del entorno. La orden {\tt export} se usa para 
exportar variables al entorno.

\index{setenv@{\tt setenv}}
\blackdiamond De nuevo, hemos de diferenciar entre Bash y Tcsh. Si está
usando Tcsh, deberá usar una sintaxis diferente para las variables de
entorno (se usa la orden {\tt setenv}). Diríjase a la página de 
manual de Tcsh para más información.

\index{variables!entorno}
El entorno es muy importante en un sistema UNIX. Le permite configurar
ciertas órdenes simplemente inicializando variables con las órdenes ya
conocidas.

Veamos un ejemplo rápido. La variable de entorno {\tt PAGER} se usa por la
orden {\tt man}. Especifica la orden que se usará para mostrar las páginas
del manual una a una. Si inicializa {\tt PAGER} con el nombre del
programa, se usará éste para mostrar las páginas de manual en lugar de 
{\tt more} (el cuál es usado por omisión).

Inicialice {\tt PAGER} a ``{\tt cat}''. Esto hará que la salida de 
{\tt man} sea mostrada de una vez, sin pausas entre páginas.
\begin{tscreen}
/home/larry\# {\em PAGER=``cat''}
\end{tscreen}

Ahora exportamos {\tt PAGER} al entorno.
\begin{tscreen}
/home/larry\# {\em export PAGER}
\end{tscreen}

Pruebe la orden {\tt man ls}. La página debería volar por su 
pantalla sin detenerse entre páginas.

Ahora, si inicializa {\tt PAGER} a ``{\tt more}'', se usará la orden 
{\tt more} para mostrar las páginas del manual.
\begin{tscreen}
/home/larry\# {\em PAGER=``more''}
\end{tscreen}

Nótese que no hemos de usar la orden {\tt export} después del cambio 
de la variable {\tt PAGER}. Solo hemos de exportar las variables una vez; 
cualquier cambio efectuado con posterioridad será automáticamente 
propagado al entorno.

Las páginas de manual para una orden en particular, le informarán acerca del
uso de alguna variable de entorno por parte de esa orden; por ejemplo, la
página de manual de {\tt man} explica que {\tt PAGER} es usado para
especificar la orden de paginado.

Algunas órdenes comparten variables de entorno; por ejemplo, muchas órdenes
usan la variable {\tt EDITOR} para especificar el editor por omisión que se
usará si es necesario.

El entorno es también usado para guardar información importante acerca de
la sesión en curso. Un ejemplo es la variable de entorno {\tt HOME}, que
contiene el nombre del directorio de origen del usuario.
\begin{tscreen}
/home/larry/papers\# {\em echo \$HOME} \\
/home/larry
\end{tscreen}

Otra variable de entorno interesante es {\tt PS1}, la cuál define el
indicador (``prompt'') principal que usará el intérprete. Por ejemplo,
\begin{tscreen}
/home/larry\# {\em PS1=``Su instrucción, por favor: ''} \\
Su instrucción, por favor: 
\end{tscreen}

Para volver a inicializar el ``prompt'' a su valor habitual (el cual
contiene el directorio actual seguido por el símbolo ``{\tt \#}''),
\begin{tscreen}
Su instrucción , por favor: {\em PS1=``{\verb'-w#'} -''} \\
/home/larry\# 
\end{tscreen}
La página de manual de {\tt bash} describe la sintaxis usada para
inicializar el indicador.

\subsubsection{La variable de entorno {\tt PATH}}
\index{entorno!variables!PATH@{\tt PATH}}

Cuando usa la orden {\tt ls} ?`cómo encuentra el intérprete el programa
ejecutable {\tt ls}?. De hecho, {\tt ls} se encuentra en {\tt /bin/ls} en la
mayoría de los sistemas. El intérprete usa la variable de entorno 
{\tt PATH} (``camino'') para localizar los ficheros ejecutables u órdenes que tecleamos.

Por ejemplo, su variable {\tt PATH} puede inicializarse a:
\begin{tscreen}
/bin:/usr/bin:/usr/local/bin:.
\end{tscreen}

Esto es una lista de directorios en los que el intérprete debe buscar. Cada
directorio está separado por un ``{\tt :}''. Cuando usa la orden {\tt ls},
el intérprete primero busca {\tt /bin/ls}, luego {\tt /usr/bin/ls} y 
así hasta que lo localice o acabe la lista.

Nótese que {\tt PATH} no interviene en la localización de ficheros
regulares. Por ejemplo, si usa la orden
\begin{tscreen}
/home/larry\# {\em cp foo bar}
\end{tscreen}
El intérprete no usará {\tt PATH} para localizar los ficheros {\tt foo} y
{\tt bar} --esos nombres se suponen completos--. Sólo se usará {\tt PATH} para
localizar el programa ejecutable {\tt cp}.

Ésto le permitirá ahorrar mucho tiempo; significa que no deberá recordar
dónde se guardan las instrucciones. En muchos sistemas los ficheros 
ejecutables se dispersan por muchos sitios, como {\tt /usr/bin}, {\tt 
/bin} o {\tt /usr/local/bin}. En lugar de dar el nombre completo con el 
camino (como {\tt /usr/bin/cp}), solo hemos de inicializar {\tt PATH} con 
la lista de los directorios donde queremos que se busquen automáticamente.

Nótese que {\tt PATH} contiene ``{\tt .}'', el cual es el directorio 
actual de trabajo. Esto le permite crear guiones o programas y 
ejecutarlos desde su directorio de trabajo actual sin tener que 
especificarlo directamente (como en {\tt ./makebool}). Si un directorio 
no está en su {\tt PATH}, entonces el intérprete no buscará en él 
órdenes para ejecutar --ésto incluye al directorio de trabajo--.

\subsection{Guiones de inicialización del intérprete}\label{sec-init-scripts}
\index{guiones del intérprete de órdenes!inicializacion}
\index{guiones de inicialización!para intérpretes de ordenes}

Aparte de los guiones que puede crear, hay un número de éstos que usa el
intérprete de órdenes para ciertos propósitos. Los más importantes 
son sus {\bf guiones de inicialización}, guiones automáticamente 
ejecutados por el intérprete al abrir una sesión.

Los guiones de inicialización son eso, simples guiones como los descritos
arriba. De cualquier modo, son muy útiles para la inicialización de su
entorno al ejecutarse automáticamente. Por ejemplo, si siempre usa la orden
{\tt mail} para comprobar si tiene correo al iniciar una sesión, incluya en
su guión de inicialización dicha orden y será ejecutada automáticamente.

\index{Intérprete de presentación!definición}
Tanto Bash como Tcsh distinguen entre un {\bf intérprete de presentación} y
otras invocaciones del intérprete. Un intérprete de presentación es 
el que se ejecuta en el momento de la presentación al sistema (login). 
Es el único que usará. De cualquier modo, si ejecuta una opción de 
salir a un intérprete desde algún programa, como {\tt vi}, inicializa 
otra instancia del intérprete de órdenes, el cual no es su 
intérprete de presentación. Además, en cualquier momento que 
ejecuta un guión, automáticamente está arrancando otro intérprete 
que va a ser el encargado de ejecutar el guión.

\index{intérpretes de orddenes!ficheros de inicialización}
\index{ficheros de inicialización!para intérpretes de ordenes}
\index{/etc/profile@{\tt /etc/profile}}
\index{.bash\_profile@{\tt .bash\_profile}}
\index{.bashrc@{\tt .bashrc}}
\index{.profile@{\tt .profile}}
Los ficheros de inicialización usados por Bash son: {\tt /etc/profile}
(configurado por el administrador del sistema, y ejecutado por todos los
usuarios de Bash en el momento de la presentación al sistema), 
{\tt \$HOME/.bash\_profile} (ejecutado por una sesión de presentación Bash)
y {\tt \$HOME/.bashrc} (ejecutadas por todas las sesiones Bash que no son de
presentación). Si {\tt .bash\_profile} no está presente, se usa en su lugar 
{\tt .profile}

\index{/etc/csh.login@{\tt csh.login}}
\index{.tcshrc@{\tt.tcshrc}}
Tcsh usa los siguientes guiones de inicialización: {\tt /etc/csh.login}
(ejecutado por todos los usuarios de Tcsh en el momento de la presentación
al sistema), {\tt \$HOME/.tcshrc} (ejecutado en la presentación al sistema
por todas las instancias nuevas de Tcsh) y {\tt \$HOME/.login} (ejecutado en
la presentación al sistema, seguido {\tt .tcshrc}).
Si {\tt .tcshrc} no está presente, {\tt .cshrc} se usa en su lugar.

Para entender completamente la función de estos ficheros, necesitará
aprender más acerca del intérprete de órdenes. La programación de 
guiones es una materia complicada, más allá del alcance de este 
libro. Lea las páginas de manual de {\tt bash} y/o {\tt tcsh} para 
aprender más sobre la configuración de su entorno.

\index{entorno!personalización|)}
